!
!
!   This is Personalized Test Creator
!           Version 1.0
!   free for registered non-commercial use.
!   This file is not suggested to be changed by users for normal usage.
!   Any problems/suggestions/comments, please send to gang.liu@queensu.ca 
!   or to gl.cell@outlook.com.
!   Please be advised that neither the author nor HPCVL accept any
!   responsibility for any consequences arising out of the usage of this
!   software, especially for damage.
!   Copyright (c) 2007-2021 by High Performance Computing Virtual Laboratory
!
!
MODULE ENVIRONMENT_SETTING
    IMPLICIT NONE
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CHARACTERS_PL=2000
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CHARACTERS_P2=MAX_NUMBER_OF_CHARACTERS_PL*5
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CHARACTERS_SSS=200
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_SSS_INPUT_TERMS=2000
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_QUESTIONS=1000
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_INPUTS_PQ=10000
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CALCULATES_PQ=10000
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CHARA_CNST=100
    INTEGER, PARAMETER       ::  MAX_NUMBER_OF_CONSTANTS=100
    INTEGER, PARAMETER       ::  MAX_DIGITS_AFTER_DOT=100
    INTEGER, PARAMETER       ::  MAX_LAYER_OF_CHOICES=10
    INTEGER, PARAMETER       ::  MAX_LAYER_TO_ORDER=1000
    INTEGER, PARAMETER       ::  MAX_ITEMS_IN_A_COLUMN=1000
    INTEGER, PARAMETER       ::  PAGE_NUMBER_JUMPER=1000
    INTEGER, PARAMETER       ::  DOUBLE_COMPLEX_KIND_=8
    INTEGER, PARAMETER       ::  MAX_LINES_OF_OUT_TABLE=10
    INTEGER, PARAMETER       ::  MAX_LINES_OF_CONSTANT_TABLE=10
    INTEGER, PARAMETER       ::  MAX_LINES_OF_TABLE=3
    INTEGER, PARAMETER       ::  NUMBER_QUESTION_STATISTICS_PT=12
    INTEGER, PARAMETER       ::  NUMBER_OF_MATRIX_BRACES=10
    INTEGER, PARAMETER       ::  MAX_OF_CHARACTERS_AS_NONE_CHOICE=1000
    INTEGER, PARAMETER       ::  MAX_WRONG_POSSIBLE=10
    INTEGER, PARAMETER       ::  MAX_WRONG_TRYS=10000
    INTEGER, PARAMETER       ::  MAX_NUMBER_AUTO_ANSWERS=1000
    INTEGER, PARAMETER       ::  DEFAULT_CHOICES_TO_GENERATE=4

    INTEGER, PARAMETER       ::  QUESTIONS_DISORDERED=1           !IF 1, yes
    INTEGER, PARAMETER       ::  BOXES_IN_PAPER_TITLE=1           !IF 1, yes
    INTEGER, PARAMETER       ::  MARK_BOX_FOR_QUESTIONS=1         !IF 1, yes
    INTEGER, PARAMETER       ::  BOX_FOR_CHOICE=1                 !IF 1, yes
    INTEGER, PARAMETER       ::  SIMPLE_PRINT_INPUTS=1            !IF 1, yes
    INTEGER, PARAMETER       ::  SHORTEST_PAGED=1                 !IF 1, yes
    INTEGER, PARAMETER       ::  SIMPLE_HEADS=0                   !IF 1, yes for all files except exam.tex file.
    INTEGER, PARAMETER       ::  MARKS_SCALED_TO_TOTAL_FULL=1     !IF 1, yes
    INTEGER, PARAMETER       ::  QUESTIONS_SUMMARIZED_TO_PAPERS=0 !IF 1, yes
    INTEGER, PARAMETER       ::  REQUIRED_QUESTIONS_STATED=0      !IF 1, yes
    INTEGER, PARAMETER       ::  AUTO_ANSWER_SWITCH=1             !IF 1, yes
    INTEGER, PARAMETER       ::  END_OF_PAPER_WITH_SEED_SWITCH=1  !IF 1, yes
    INTEGER, PARAMETER       ::  NO_PRINTING_SWITCH=1             !IF 1, yes
    INTEGER, PARAMETER       ::  ABSTRACTS_PRINTED=0              !IF 1, yes
    INTEGER, PARAMETER       ::  PRINT_SOME_ADDITIONALS=0         !IF 1, yes
    INTEGER, PARAMETER       ::  NOTE_TO_ANSWER_SOLUTION=1        !IF 1, yes

    INTEGER, PARAMETER          :: MARK_ACCURACY=-2
    INTEGER, PARAMETER          :: MIN_TOTAL_TERMS_FOR_NONE=1
    DOUBLE PRECISION, PARAMETER :: BIGGER_THEN_NONE_CHOICE=0.8D0

    CHARACTER (*), PARAMETER ::  ROOT_KEY='PTC-'

    CHARACTER (*), PARAMETER ::  TITLE_KEY=ROOT_KEY//'EXAM-TITLE'
    CHARACTER (*), PARAMETER ::  END_TITLE_KEY=ROOT_KEY//'EXAM-TITLE-END'
    CHARACTER (*), PARAMETER ::  TAIL_KEY=ROOT_KEY//'EXAM-TAIL'
    CHARACTER (*), PARAMETER ::  END_TAIL_KEY=ROOT_KEY//'EXAM-TAIL-END'
    CHARACTER (*), PARAMETER ::  CHOOSE_KEY=ROOT_KEY//'CHOOSE'
    CHARACTER (*), PARAMETER ::  END_CHOOSE_KEY=ROOT_KEY//'CHOOSE-END'
    CHARACTER (*), PARAMETER ::  QUESTION_KEY=ROOT_KEY//'QUESTION'
    CHARACTER (*), PARAMETER ::  END_QUESTION_KEY=ROOT_KEY//'QUESTION-END'
    CHARACTER (*), PARAMETER ::  QUESTION_TITLE_KEY=ROOT_KEY//'QUESTION-TITLE'
    CHARACTER (*), PARAMETER ::  END_QUESTION_TITLE_KEY=ROOT_KEY//'QUESTION-TITLE-END'
    CHARACTER (*), PARAMETER ::  ABSTRACT_KEY=ROOT_KEY//'ABSTRACT'
    CHARACTER (*), PARAMETER ::  END_ABSTRACT_KEY=ROOT_KEY//'ABSTRACT-END'
    CHARACTER (*), PARAMETER ::  NOTE_KEY=ROOT_KEY//'NOTE'
    CHARACTER (*), PARAMETER ::  END_NOTE_KEY=ROOT_KEY//'NOTE-END'
    CHARACTER (*), PARAMETER ::  PRINT_PARAMETER_KEY=ROOT_KEY//'PRINT-PARAMETER'
    CHARACTER (*), PARAMETER ::  PRINT_AUTO_ANSWER_KEY=ROOT_KEY//'PRINT-AUTO-ANSWER'

    CHARACTER (*), PARAMETER ::  SWITCH_ON_KEY=ROOT_KEY//'SWITCH-ON'
    CHARACTER (*), PARAMETER ::  SWITCH_OFF_KEY=ROOT_KEY//'SWITCH-OFF'

    CHARACTER (*), PARAMETER ::  SOLUTION_KEY=ROOT_KEY//'SOLUTION'
    CHARACTER (*), PARAMETER ::  END_SOLUTION_KEY=ROOT_KEY//'SOLUTION-END'
    CHARACTER (*), PARAMETER ::  ANSWER_KEY=ROOT_KEY//'ANSWER'
    CHARACTER (*), PARAMETER ::  END_ANSWER_KEY=ROOT_KEY//'ANSWER-END'

    CHARACTER (*), PARAMETER ::  MANY_CHOICES_KEY=ROOT_KEY//'MULTICHOICE-AUTO'
    CHARACTER (*), PARAMETER ::  END_MANY_CHOICES_KEY=ROOT_KEY//'MULTICHOICE-AUTO-END'
    CHARACTER (*), PARAMETER ::  MANY_TO_ORDER_KEY=ROOT_KEY//'MULTICHOICE-USER'
    CHARACTER (*), PARAMETER ::  END_MANY_TO_ORDER_KEY=ROOT_KEY//'MULTICHOICE-USER-END'
    CHARACTER (*), PARAMETER ::  COLUMN_MATCH_KEY=ROOT_KEY//'COLUMN-MATCH'
    CHARACTER (*), PARAMETER ::  END_COLUMN_MATCH_KEY=ROOT_KEY//'COLUMN-MATCH-END'

    CHARACTER (*), PARAMETER ::  REAL_KEY=ROOT_KEY//'RRR'
    CHARACTER (*), PARAMETER ::  INTEGER_KEY=ROOT_KEY//'III'
    CHARACTER (*), PARAMETER ::  COMPLEX_KEY=ROOT_KEY//'CCC'
    CHARACTER (*), PARAMETER ::  VECTOR_KEY=ROOT_KEY//'VVV'
    CHARACTER (*), PARAMETER ::  STRING_KEY=ROOT_KEY//'SSS'
    CHARACTER (*), PARAMETER ::  NEW_STRING_KEY=ROOT_KEY//'NEW-SSS'
    CHARACTER (*), PARAMETER ::  LOGICAL_KEY=ROOT_KEY//'LLL'
    CHARACTER (*), PARAMETER ::  PRINT_IN_KEY=ROOT_KEY//'PRINT-IN'
    CHARACTER (*), PARAMETER ::  PRINT_OUT_KEY=ROOT_KEY//'PRINT-OUT'
    CHARACTER (*), PARAMETER ::  SOME_CHOICE_KEY=ROOT_KEY//'CHOICES'
    CHARACTER (*), PARAMETER ::  SET_ACCURACY_KEY=ROOT_KEY//'SET-ACCURACY'
    CHARACTER (*), PARAMETER ::  ONE_TO_ORDER_KEY=ROOT_KEY//'CHOICE'
    CHARACTER (*), PARAMETER ::  COLUMN_LEFT_KEY=ROOT_KEY//'COLUMN-LEFT'
    CHARACTER (*), PARAMETER ::  COLUMN_RIGHT_KEY=ROOT_KEY//'COLUMN-RIGHT'
    CHARACTER (*), PARAMETER ::  REAL_MATRIX_KEY=ROOT_KEY//'REAL-MATRIX'
    CHARACTER (*), PARAMETER ::  INTEGER_MATRIX_KEY=ROOT_KEY//'INTEGER-MATRIX'
    CHARACTER (*), PARAMETER ::  COMPLEX_MATRIX_KEY=ROOT_KEY//'COMPLEX-MATRIX'
    CHARACTER (*), PARAMETER ::  STRING_MATRIX_KEY=ROOT_KEY//'STRING-MATRIX'
   !CHARACTER (*), PARAMETER ::  LOGICAL_MATRIX_KEY=ROOT_KEY//'LOGICAL-MATRIX'

    CHARACTER (*), PARAMETER ::  NO_PRINTING_KEY=ROOT_KEY//'HIDE'

    CHARACTER (*), PARAMETER ::  NOT_KEY='.NOT.'
    CHARACTER (*), PARAMETER ::  TRUE_KEY='.TRUE.'
    CHARACTER (*), PARAMETER ::  FALSE_KEY='.FALSE.'
    CHARACTER (*), PARAMETER ::  ADDITION_KEY='ADD'
    CHARACTER (*), PARAMETER ::  ABSOLUTE_KEY='RAW'

    CHARACTER (*), PARAMETER ::  BOTH_KEY='BOTH'
    CHARACTER (*), PARAMETER ::  LEFT_KEY='LEFT'
    CHARACTER (*), PARAMETER ::  RIGHT_KEY='RIGHT'

    CHARACTER (*), PARAMETER ::  PAPER_KEY='PAPER'
    CHARACTER (*), PARAMETER ::  TOTAL_PAPER_KEY='TOTAL-PAPERS'
    CHARACTER (*), PARAMETER ::  PROBLEM_KEY='QUESTION'
    CHARACTER (*), PARAMETER ::  TOTAL_PROBLEM_KEY='TOTAL-QUESTIONS'
    CHARACTER (*), PARAMETER ::  SUBPROBLEM_KEY='SUBQUESTION'
    CHARACTER (*), PARAMETER ::  TOTAL_SUBPROBLEM_KEY='TOTAL-SUBQUESTIONS'
    CHARACTER (*), PARAMETER ::  TOTAL_SUBPROBLEM_REQUIRED_KEY='TOTAL-REQUIRED-SUBQUESTIONS'
    CHARACTER (*), PARAMETER ::  GLOBAL_SUBPROBLEM_KEY='GLOBAL-SUBQUESTIONS'
    CHARACTER (*), PARAMETER ::  GLOBAL_SUBPROBLEM_REQUIRED_KEY='GLOBAL-REQUIRED-SUBQUESTIONS'

    CHARACTER (1), PARAMETER ::  MATRIX_BRACES(NUMBER_OF_MATRIX_BRACES)= &
                                                 (/ 'a','A','m','M','p','P','b','B','v','V' /)
    INTEGER      , PARAMETER ::  MATRIX_DATA_ONLY=0
    INTEGER      , PARAMETER ::  MATRIX_BRACE_A=1
    INTEGER      , PARAMETER ::  MATRIX_BRACE_ARRAY_FROM=1
    INTEGER      , PARAMETER ::  MATRIX_BRACE_ARRAY_TO=2
    INTEGER      , PARAMETER ::  MATRIX_BRACE_M=3
    INTEGER      , PARAMETER ::  MATRIX_BRACE_P=5
    INTEGER      , PARAMETER ::  MATRIX_BRACE_LOWER_B=7
    INTEGER      , PARAMETER ::  MATRIX_BRACE_UPPER_B=8
    INTEGER      , PARAMETER ::  MATRIX_BRACE_LOWER_V=9
    INTEGER      , PARAMETER ::  MATRIX_BRACE_UPPER_V=10
    CHARACTER (*), PARAMETER ::  MATRIX_BRACES_BEGIN(NUMBER_OF_MATRIX_BRACES)=       &
                                    (/ '  \left( \begin{array}',  ' \left( \begin{array} ', &
                                       '  \begin{matrix}      ',  '  \begin{matrix}      ', &
                                       '  \begin{pmatrix}     ',  '  \begin{pmatrix}     ', &
                                       '  \begin{bmatrix}     ',  '  \begin{Bmatrix}     ', &
                                       '  \begin{vmatrix}     ',  '  \begin{Vmatrix}     '    /)

    CHARACTER (*), PARAMETER ::  MATRIX_BRACES_END(NUMBER_OF_MATRIX_BRACES)=         &
                                    (/ ' \end{array} \right) ', ' \end{array} \right) ', &
                                       ' \end{matrix}        ', ' \end{matrix}        ', &
                                       ' \end{pmatrix}       ', ' \end{pmatrix}       ', &
                                       ' \end{bmatrix}       ', ' \end{Bmatrix}       ', &
                                       ' \end{vmatrix}       ', ' \end{Vmatrix}       '    /)

    CHARACTER (*), PARAMETER ::  CONSTANT_PREKEY=ROOT_KEY//'CONSTANT-'
    CHARACTER (*), PARAMETER ::  WHOLE_TABLE_KEY='WHOLE-TABLE'
    CHARACTER (*), PARAMETER ::  TABLE_HEAD_KEY= 'TABLE-HEAD'
    CHARACTER (*), PARAMETER ::  TABLE_TAIL_KEY= 'TABLE-TAIL'
    CHARACTER (*), PARAMETER ::  M_TABLE_LINE_KEY='-TABLE-LINE'
    CHARACTER (*), PARAMETER ::    TABLE_LINE_KEY= 'TABLE-LINE'
    CHARACTER (*), PARAMETER ::  M_NAME_EQUATION_KEY= '-NAME-EQUATION'
    CHARACTER (*), PARAMETER ::    NAME_EQUATION_KEY=  'NAME-EQUATION'
    CHARACTER (*), PARAMETER ::  M_EQUATION_KEY= '-EQUATION'
    CHARACTER (*), PARAMETER ::    EQUATION_KEY=  'EQUATION'
    CHARACTER (*), PARAMETER ::  M_VALUE_UNIT_KEY= '-VALUE-UNIT'
    CHARACTER (*), PARAMETER ::    VALUE_UNIT_KEY=  'VALUE-UNIT'
    CHARACTER (*), PARAMETER ::  M_VALUE_KEY= '-VALUE'
    CHARACTER (*), PARAMETER ::    VALUE_KEY=  'VALUE'

    CHARACTER (*), PARAMETER ::  QUESTION_BEGIN='{\textbf{\Large{QUESTION'
    CHARACTER (*), PARAMETER ::  QUESTION_BEGIL='{\textbf{\Large{Question'
    CHARACTER (*), PARAMETER ::  QUESTION_BEGIN2='{\textbf{\large{QUESTION'
    CHARACTER (*), PARAMETER ::  QUESTION_BEGIL2='{\textbf{\large{Question'
    CHARACTER (*), PARAMETER ::  QUESTION_END='}}}'
    CHARACTER (*), PARAMETER ::  ABSTRACT_WORD='\noindent\vspace{0.05in}{\textbf{\Large{Abstract:}}}'
    CHARACTER (*), PARAMETER ::  ABSTRACT_WORD_END='\noindent\vspace{0.05in}{\textbf{\Large{end of abstract.}}}'
    CHARACTER (*), PARAMETER ::  VALUES_TITLE='\noindent\vspace{0.1in}{\textbf{\Large{Values chosen: }}}'
    CHARACTER (*), PARAMETER ::  SOLUTION_TITLE='\noindent\vspace{0.1in}{\textbf{\Large{Solution: }}}'
    CHARACTER (*), PARAMETER ::  SOLUTION_END='\noindent\vspace{0.1in}{\textbf{\Large{End of Solution.}}}'
    CHARACTER (*), PARAMETER ::  CALCULATED_TITLE='\noindent\vspace{0.1in}{\textbf{\Large{Calculated values:}}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWER='\noindent\vspace{0.05in}{\textbf{\Large{Auto-answer:}}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWER_END='\noindent\vspace{0.05in}{\textbf{\Large{End of auto-answer.}}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWEM='\noindent\vspace{0.05in}{\textbf{\Large{(Auto-answer:}}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWER_ENM='\noindent\vspace{0.05in}{\textbf{\Large{)}}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWEL='{\textbf{(Auto-answer:}}'
    CHARACTER (*), PARAMETER ::  CORRECT_ANSWER_ENL='{\textbf{)}}'
    CHARACTER (*), PARAMETER ::  ANSWER_REGION='\noindent\vspace{0.05in}{\textbf{\Large{Answer:}}}'
    CHARACTER (*), PARAMETER ::  ANSWER_REGION_END='\noindent\vspace{0.05in}{\textbf{\Large{End of Answer.}}}'
    CHARACTER (*), PARAMETER ::  CHOICE_CHARATER_BEGIN='\noindent{\textbf{\large{'
    CHARACTER (*), PARAMETER ::  CHOICE_CHARATER_BEGIN2='{\textbf{\large{'
    CHARACTER (*), PARAMETER ::  CHOICE_CHARATER_END='.}}}'
    CHARACTER (*), PARAMETER ::  SPACING='\vspace{0.2in}'
    CHARACTER (*), PARAMETER ::  REAL_FORM_HEAD='F100.'
    CHARACTER (*), PARAMETER ::  HEAD_RESET=        '\markboth{ {\today}}{For examinees. {\today}}'
    CHARACTER (*), PARAMETER ::  HEAD_RESET_ANSW_LUTION= '\markboth{Answer and solution NOT for examinees !!!' &
                                     &//'{\today}}{Answer and solution NOT for examinees !!! {\today}}'
    CHARACTER (*), PARAMETER ::  HEAD_RESET_SOLUTION='\markboth{Solutions NOT for examinees !!! {\today}}'&
                                                           &//'{Solutions NOT for examinees !!! {\today}}'
    CHARACTER (*), PARAMETER ::  HEAD_RESET_JOURNAL='\markboth{Journal NOT for examinees !!! {\today}}'&
                                                          &//'{Journal NOT for examinees !!! {\today}}'
    CHARACTER (*), PARAMETER ::  HEAD_RESET_ANSWER='\markboth{Answers NOT for examinees !!! {\today}}'&
                                                         &//'{Answers NOT for examinees !!! {\today}}'
    CHARACTER (*), PARAMETER ::  HEAD_RESET_SHORTEST='\markboth{Answer-ONLY NOT for examinees !!! {\today}}'&
                                                           &//'{Answer-ONLY NOT for examinees !!! {\today}}'
    CHARACTER (*), PARAMETER ::  COLUMN_NAMES=' Column Left & Column Right '

    CHARACTER (*), PARAMETER ::  WORDS_SUMMARIZED_TO_PAPER_1='{\textbf{\large{Please be advised}}} that '&
                                                           &//'in this paper there are questions from '
    CHARACTER (*), PARAMETER ::  WORDS_SUMMARIZED_TO_PAPER_2=' through '
    CHARACTER (*), PARAMETER ::  WORDS_SUMMARIZED_TO_PAPER_3='. And any one of them may contain more '&
              &//'than one sub-question, thus the total number of sub-questions here is around '
    CHARACTER (*), PARAMETER ::  WORDS_SUMMARIZED_TO_PAPER_4=', of which '
    CHARACTER (*), PARAMETER ::  WORDS_SUMMARIZED_TO_PAPER_5=' should be answered. '

    CHARACTER (*), PARAMETER ::  WORDS_REQUIRED_QUESTIONS_1='{\textbf{\Large{Please answer ONLY '
    CHARACTER (*), PARAMETER ::  WORDS_REQUIRED_QUESTIONS_2=' of the following '
    CHARACTER (*), PARAMETER ::  WORDS_REQUIRED_QUESTIONS_3=' questions (Questions '
    CHARACTER (*), PARAMETER ::  WORDS_REQUIRED_QUESTIONS_4=' through '
    CHARACTER (*), PARAMETER ::  WORDS_REQUIRED_QUESTIONS_5=' ). }}}'

    CHARACTER (*), PARAMETER ::  END_PAPER_WORD0='\vspace{1.0in} '
    CHARACTER (*), PARAMETER ::  END_PAPER_WORD1='{\textbf{\large{ *** END OF PAPER, THANKS *** }}} '
    CHARACTER (*), PARAMETER ::  END_PAPER_WORD2='\hspace{1.0in} By: '

    CHARACTER (*), PARAMETER ::  YOUR_NAME='YOUR NAME (FIRST, ... LAST) '
    CHARACTER (*), PARAMETER ::  YOUR_NAME_POST='\noindent'
    CHARACTER (*), PARAMETER ::  YOUR_ID=' YOUR   ID   INFORMATION '
    CHARACTER (*), PARAMETER ::  YOUR_ID_POST='\hspace{0.05in} '
    CHARACTER (*), PARAMETER ::  TOTAL_MARK='YOUR TOTAL MARKS '
    CHARACTER (*), PARAMETER ::  TOTAL_MARK_POST='\vspace{0.2in}\noindent'
    CHARACTER (*), PARAMETER ::  FULL_TOTAL_MARK='TOTAL FULL MARKS '
    CHARACTER (*), PARAMETER ::  FULL_TOTAL_MARK_POST='\hspace{0.05in} '
    CHARACTER (*), PARAMETER ::  YOUR_MARK=' YOUR MARKS '
    CHARACTER (*), PARAMETER ::  YOUR_MARK_POST='\noindent'
    CHARACTER (*), PARAMETER ::  YOUR_MARL=' Your marks '
    CHARACTER (*), PARAMETER ::  YOUR_MARL_POST='         '
    CHARACTER (*), PARAMETER ::  FULL_MARK=' Full Marks '
    CHARACTER (*), PARAMETER ::  FULL_MARK_POST='\hspace{0.05in} '
    CHARACTER (*), PARAMETER ::  FULL_MARL=' Full marks '
    CHARACTER (*), PARAMETER ::  FULL_MARL_POST='\hspace{0.05in} '
    CHARACTER (*), PARAMETER ::  YOUR_CHOICE='Your choice'
    CHARACTER (*), PARAMETER ::  YOUR_CHOICE_POST='\noindent\hspace{3.0in} '

    CHARACTER (*), PARAMETER ::  SEED_FILE='ini.dat'
    CHARACTER (*), PARAMETER ::  OUTPUT_FILE='exams.tex'
    CHARACTER (*), PARAMETER ::  INPUT_FILE='exam_in.tex'
    CHARACTER (*), PARAMETER ::  ANSWER_FILE='answer.tex'
    CHARACTER (*), PARAMETER ::  SHORTEST_ANSWER_FILE='shortest.answer.tex'
    CHARACTER (*), PARAMETER ::  SOLUTION_FILE='solution.tex'
    CHARACTER (*), PARAMETER ::  NEW_INPUT_FILE='exam_in_new.tex'
    CHARACTER (*), PARAMETER ::  ANSW_LUTION_FILE='answer.and.solution.tex'
    CHARACTER (*), PARAMETER ::  JOURNAL_FILE='journal.tex'
    CHARACTER (*), PARAMETER ::  LATEX_END='\end{document}'
    CHARACTER (*), PARAMETER ::  DOT='.'
    CHARACTER (*), PARAMETER ::  DOT_END=' '
    CHARACTER (*), PARAMETER ::  CHOICE_REPLACED_BY_SPACE='\vspace{2.0in}'


    CHARACTER (*), PARAMETER ::  BASIC_FORMAT=" F20.2 "
    CHARACTER (*), PARAMETER ::  DEFAULT_F_FORMAT= "(1X,'  $ ', "//BASIC_FORMAT//",' $ ')"
    CHARACTER (*), PARAMETER ::  DEFAULT_2F_FORMAT="(1X,' ($ ', "//BASIC_FORMAT//", ' , ', "//BASIC_FORMAT//",' $) ')"
    CHARACTER (*), PARAMETER ::  DEFAULT_E_FORMAT= "(1X,'  $ ', "//BASIC_FORMAT//", ' \times 10^{ ', I20,' }$ ')"
    CHARACTER (*), PARAMETER ::  DEFAULT_2E_FORMAT="(1X,' ($ ', "//BASIC_FORMAT//", ' \times 10^{ ', I20, ' } , ', "&
                                                                 //BASIC_FORMAT//", ' \times 10^{ ', I20,' }$) ')"
    CHARACTER (*), PARAMETER ::  ADDITIONAL_EMPTY='          '
    CHARACTER (*), PARAMETER ::  CHOICE_OR_ANSWER(2)=(/'Your choinces', 'Answers      '/)

    CHARACTER (LEN=1), PARAMETER ::  DATA_SEPARATE_KEY=';'
    CHARACTER (LEN=1), PARAMETER ::  DATA_BEGIN_KEY='('
    CHARACTER (LEN=1), PARAMETER ::  DATA_END_KEY=')'

   !INTEGER, PARAMETER       ::  MULTIPLE_CHOICE_ENABLED=1
   !INTEGER, PARAMETER       ::  MULTIPLE_CHOICE_DISABLED=0
   !INTEGER, PARAMETER       ::  MULTIPLE_CHOICE_PRIORITY=1

END MODULE ENVIRONMENT_SETTING




MODULE BASE_DATA
    USE ENVIRONMENT_SETTING
    IMPLICIT NONE
    INTEGER, PARAMETER       ::  SEED_FILE_TUNNEL=10
    INTEGER, PARAMETER       ::  INPUT_FILE_TUNNEL=11
    INTEGER, PARAMETER       ::  NEW_INPUT_FILE_TUNNEL=12
    INTEGER, PARAMETER       ::  OUTPUT_FILE_TUNNEL=13
    INTEGER, PARAMETER       ::  ANSW_LUTION_FILE_TUNNEL=14
    INTEGER, PARAMETER       ::  JOURNAL_FILE_TUNNEL=15
    INTEGER, PARAMETER       ::  ANSWER_FILE_TUNNEL=16
    INTEGER, PARAMETER       ::  SOLUTION_FILE_TUNNEL=17
    INTEGER, PARAMETER       ::  SHORTEST_ANSWER_FILE_TUNNEL=18

    INTEGER, PARAMETER       ::  ROOT_KEY_LENGTH=LEN(ROOT_KEY)
    INTEGER, PARAMETER       ::  ADDITIONAL_LENTH=LEN(ADDITIONAL_EMPTY)

    CHARACTER (*), PARAMETER ::  TEMP1_FILE='temp1.dat'
    CHARACTER (*), PARAMETER ::  TEMP2_FILE='temp2.dat'
    CHARACTER (*), PARAMETER ::  TEMP3_FILE='temp3.dat'
    CHARACTER (*), PARAMETER ::  TEMP4_FILE='temp4.dat'
    CHARACTER (*), PARAMETER ::  TEMP5_FILE='temp5.dat'
    CHARACTER (*), PARAMETER ::  AUTO_ANSWER_TEMP_FILE='autoat.dat'
    INTEGER, PARAMETER       ::  TEMP1_FILE_TUNNEL=41
    INTEGER, PARAMETER       ::  TEMP2_FILE_TUNNEL=42
    INTEGER, PARAMETER       ::  TEMP3_FILE_TUNNEL=43
    INTEGER, PARAMETER       ::  TEMP4_FILE_TUNNEL=44
    INTEGER, PARAMETER       ::  TEMP5_FILE_TUNNEL=45
    INTEGER, PARAMETER       ::  AUTO_TEMP_FILE_TUNNEL=51

    INTEGER                  ::  POINTER_TEMP3

    INTEGER, PARAMETER       ::  REAL_KEY_LENTH=LEN(REAL_KEY)
    INTEGER, PARAMETER       ::  INTEGER_KEY_LENTH=LEN(INTEGER_KEY)
    INTEGER, PARAMETER       ::  COMPLEX_KEY_LENTH=LEN(COMPLEX_KEY)
    INTEGER, PARAMETER       ::  VECTOR_KEY_LENTH=LEN(VECTOR_KEY)
    INTEGER, PARAMETER       ::  STRING_KEY_LENTH=LEN(STRING_KEY)
    INTEGER, PARAMETER       ::  LOGICAL_KEY_LENTH=LEN(LOGICAL_KEY)
    INTEGER, PARAMETER       ::  PRINT_IN_KEY_LENTH=LEN(PRINT_IN_KEY)
    INTEGER, PARAMETER       ::  PRINT_OUT_KEY_LENTH=LEN(PRINT_OUT_KEY)
    INTEGER, PARAMETER       ::  SOME_CHOICE_KEY_LENTH=LEN(SOME_CHOICE_KEY)
    INTEGER, PARAMETER       ::  SET_ACCURACY_KEY_LENTH=LEN(SET_ACCURACY_KEY)
    INTEGER, PARAMETER       ::  ONE_TO_ORDER_KEY_LENTH=LEN(ONE_TO_ORDER_KEY)
    INTEGER, PARAMETER       ::  NEW_STRING_KEY_LENTH=LEN(NEW_STRING_KEY)
    INTEGER, PARAMETER       ::  COLUMN_LEFT_KEY_LENTH=LEN(COLUMN_LEFT_KEY)
    INTEGER, PARAMETER       ::  COLUMN_RIGHT_KEY_LENTH=LEN(COLUMN_RIGHT_KEY)
    INTEGER, PARAMETER       ::  REAL_MATRIX_KEY_LENTH=LEN(REAL_MATRIX_KEY)
    INTEGER, PARAMETER       ::  INTEGER_MATRIX_KEY_LENTH=LEN(INTEGER_MATRIX_KEY)
    INTEGER, PARAMETER       ::  COMPLEX_MATRIX_KEY_LENTH=LEN(COMPLEX_MATRIX_KEY)
    INTEGER, PARAMETER       ::  STRING_MATRIX_KEY_LENTH=LEN(STRING_MATRIX_KEY)
   !INTEGER, PARAMETER       ::  LOGICAL_MATRIX_KEY_LENTH=LEN(LOGICAL_MATRIX_KEY)

    INTEGER, PARAMETER       ::  NOT_KEY_LENTH=LEN(NOT_KEY)
    INTEGER, PARAMETER       ::  TRUE_KEY_LENTH=LEN(TRUE_KEY)
    INTEGER, PARAMETER       ::  FALSE_KEY_LENTH=LEN(FALSE_KEY)
    INTEGER, PARAMETER       ::  ADDITION_KEY_LENTH=LEN(ADDITION_KEY)
    INTEGER, PARAMETER       ::  ABSOLUTE_KEY_LENTH=LEN(ABSOLUTE_KEY)

    INTEGER, PARAMETER       ::  BOTH_KEY_LENTH=LEN(BOTH_KEY)
    INTEGER, PARAMETER       ::  LEFT_KEY_LENTH=LEN(LEFT_KEY)
    INTEGER, PARAMETER       ::  RIGHT_KEY_LENTH=LEN(RIGHT_KEY)
    INTEGER                  ::  LEFT_RIGHT_OR_BOTH

    INTEGER, PARAMETER       ::  MANY_CHOICES_KEY_LENTH=LEN(MANY_CHOICES_KEY)
    INTEGER, PARAMETER       ::  END_MANY_CHOICES_KEY_LENTH=LEN(END_MANY_CHOICES_KEY)
    INTEGER, PARAMETER       ::  MANY_TO_ORDER_KEY_LENTH=LEN(MANY_TO_ORDER_KEY)
    INTEGER, PARAMETER       ::  END_MANY_TO_ORDER_KEY_LENTH=LEN(END_MANY_TO_ORDER_KEY)
    INTEGER, PARAMETER       ::  COLUMN_MATCH_KEY_LENTH=LEN(COLUMN_MATCH_KEY)
    INTEGER, PARAMETER       ::  END_COLUMN_MATCH_KEY_LENTH=LEN(END_COLUMN_MATCH_KEY)
    INTEGER, PARAMETER       ::  ABSTRACT_KEY_LENTH=LEN(ABSTRACT_KEY)
    INTEGER, PARAMETER       ::  END_ABSTRACT_KEY_LENTH=LEN(END_ABSTRACT_KEY)
    INTEGER, PARAMETER       ::  NOTE_KEY_LENTH=LEN(NOTE_KEY)
    INTEGER, PARAMETER       ::  END_NOTE_KEY_LENTH=LEN(END_NOTE_KEY)
    INTEGER, PARAMETER       ::  PRINT_PARAMETER_KEY_LENTH=LEN(PRINT_PARAMETER_KEY)
    INTEGER, PARAMETER       ::  PRINT_AUTO_ANSWER_KEY_LENTH=LEN(PRINT_AUTO_ANSWER_KEY)

    INTEGER, PARAMETER       ::  CONSTANT_PREKEY_LENTH=LEN(CONSTANT_PREKEY)
    INTEGER, PARAMETER       ::  WHOLE_TABLE_KEY_LENTH=LEN(WHOLE_TABLE_KEY)
    INTEGER, PARAMETER       ::  TABLE_HEAD_KEY_LENTH=LEN(TABLE_HEAD_KEY)
    INTEGER, PARAMETER       ::  TABLE_TAIL_KEY_LENTH=LEN(TABLE_TAIL_KEY)
    INTEGER, PARAMETER       ::  M_TABLE_LINE_KEY_LENTH=LEN(M_TABLE_LINE_KEY)
    INTEGER, PARAMETER       ::    TABLE_LINE_KEY_LENTH=LEN(  TABLE_LINE_KEY)
    INTEGER, PARAMETER       ::  M_NAME_EQUATION_KEY_LENTH=LEN(M_NAME_EQUATION_KEY)
    INTEGER, PARAMETER       ::    NAME_EQUATION_KEY_LENTH=LEN(  NAME_EQUATION_KEY)
    INTEGER, PARAMETER       ::  M_EQUATION_KEY_LENTH=LEN(M_EQUATION_KEY)
    INTEGER, PARAMETER       ::    EQUATION_KEY_LENTH=LEN(  EQUATION_KEY)
    INTEGER, PARAMETER       ::  M_VALUE_UNIT_KEY_LENTH=LEN(M_VALUE_UNIT_KEY)
    INTEGER, PARAMETER       ::    VALUE_UNIT_KEY_LENTH=LEN(  VALUE_UNIT_KEY)
    INTEGER, PARAMETER       ::  M_VALUE_KEY_LENTH=LEN(M_VALUE_KEY)
    INTEGER, PARAMETER       ::    VALUE_KEY_LENTH=LEN(  VALUE_KEY)

    INTEGER, PARAMETER       ::  SWITCH_ON_KEY_LENTH=LEN(SWITCH_ON_KEY)
    INTEGER, PARAMETER       ::  SWITCH_OFF_KEY_LENTH=LEN(SWITCH_OFF_KEY)

    INTEGER, PARAMETER       ::  NO_PRINTING_KEY_LENTH=LEN(NO_PRINTING_KEY)
    LOGICAL                  ::  PRINTING

    INTEGER, PARAMETER       ::  PAPER_KEY_LENTH=LEN(PAPER_KEY)
    INTEGER, PARAMETER       ::  TOTAL_PAPER_KEY_LENTH=LEN(TOTAL_PAPER_KEY)
    INTEGER, PARAMETER       ::  PROBLEM_KEY_LENTH=LEN(PROBLEM_KEY)
    INTEGER, PARAMETER       ::  TOTAL_PROBLEM_KEY_LENTH=LEN(TOTAL_PROBLEM_KEY)
    INTEGER, PARAMETER       ::  SUBPROBLEM_KEY_LENTH=LEN(SUBPROBLEM_KEY)
    INTEGER, PARAMETER       ::  TOTAL_SUBPROBLEM_KEY_LENTH=LEN(TOTAL_SUBPROBLEM_KEY)
    INTEGER, PARAMETER       ::  TOTAL_SUBPROBLEM_REQUIRED_L=LEN(TOTAL_SUBPROBLEM_REQUIRED_KEY)
    INTEGER, PARAMETER       ::  GLOBAL_SUBPROBLEM_KEY_LENGTH=LEN(GLOBAL_SUBPROBLEM_KEY)
    INTEGER, PARAMETER       ::  GLOBAL_SUBPROBLEM_REQUIRED_L=LEN(GLOBAL_SUBPROBLEM_REQUIRED_KEY)

    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  GENERAL_READ
    INTEGER                                     ::  GENERAL_READ_LENTH
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ
    INTEGER                                     ::  THE_READ_LENGTH
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK
    INTEGER                                     ::  THE_READ_WORK_LENGTH
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK2
    INTEGER                                     ::  THE_READ_WORK2_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_INT
    INTEGER                                     ::  CHAR_OF_INT_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_INT2
    INTEGER                                     ::  CHAR_OF_INT2_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_INT3
    INTEGER                                     ::  CHAR_OF_INT3_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_TOTAL_BIG_QUESTIONS
    INTEGER                                     ::  CHAR_OF_TOTAL_BIG_QUESTIONS_L

    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK3
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK4
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK5
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK6
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_P2)  ::  THE_READ_WORK7
    INTEGER                                     ::  THE_READ_WORK3_LENGTH
    INTEGER                                     ::  THE_READ_WORK4_LENGTH
    INTEGER                                     ::  THE_READ_WORK5_LENGTH
    INTEGER                                     ::  THE_READ_WORK6_LENGTH
    INTEGER                                     ::  THE_READ_WORK7_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_INT5
    INTEGER                                     ::  CHAR_OF_INT5_LENGTH
    CHARACTER(LEN=20)                           ::  CHAR_OF_INT6
    INTEGER                                     ::  CHAR_OF_INT6_LENGTH

    CHARACTER(LEN=10)  :: REAL_DIGITS(0:MAX_DIGITS_AFTER_DOT)

    INTEGER            :: THE_FIRST_EXAMINEE
    INTEGER            :: THE_LAST_EXAMINEE
    INTEGER            :: TOTAL_NUMBER_OF_EXAMINEES
    INTEGER            :: TOTAL_NUMBER_OF_BIG_QUESTIONS
    INTEGER            :: TOTAL_NUMBER_OF_QUESTIONS
    INTEGER            :: TOTAL_NUMBER_OF_VARIABLES
    INTEGER            :: TOTAL_NUMBER_OF_CONSTANTS
    INTEGER            :: TOTAL_NUMBER_OF_ANSWERS
    INTEGER            :: TOTAL_NUMBER_OF_CHOOSES
    INTEGER            :: TOTAL_NUMBER_OF_NOTES
    INTEGER            :: TOTAL_NUMBER_OF_LINES
    INTEGER            :: TOTAL_NUMBER_OF_ITEMS
    INTEGER            :: TOTAL_NUMBER_OF_AUTO_ANSWERS
    INTEGER            :: TOTAL_NUMBER_OF_LEFT_COLUMN
    INTEGER            :: TOTAL_NUMBER_OF_RIGHT_COLUMN

    DOUBLE PRECISION   :: TOTAL_FULL_MARKS
    DOUBLE PRECISION   :: TOTAL_ACTUAL_MARKS
    INTEGER            :: TOTAL_ACTUAL_QUESTIONS
    INTEGER            :: TOTAL_QUESTIONS_TO_BE_ANSWERED

    INTEGER            :: EFFECTIVE_SWITCH_VALUE
    INTEGER            :: READ_SWITCH_VALUE

    INTEGER            :: QUESTION_IDENTIFIER
    INTEGER            :: EXAMINEE_NUMBER
    INTEGER            :: QUESTION_NUMBER
    INTEGER            :: ORDERED_QUESTION_NUMBER
    INTEGER            :: BIG_QUESTION_NUMBER
    INTEGER            :: ORDERED_BIG_QUESTION_NUMBER
    INTEGER            :: VARIABLE_NUMBER
    INTEGER            :: ANSWER_NUMBER
    INTEGER            :: COLUMN_NUMBER
    INTEGER            :: LINE_NUMBER=0
    INTEGER            :: A_SUM_CHAR
    INTEGER            :: IIIRRRCCC
    INTEGER            :: LINE_NUMBER_LIMIT=0
    INTEGER            :: READ_ROUTINE_SWITCH=0

    INTEGER            :: PAIRS_FOR_MATCH
    INTEGER            :: COLUMN_RANGES(2,2)
    DOUBLE PRECISION   :: POSSIBILITY_FROM_LEFT_COLUMN

    INTEGER            :: TITLE_POSITION=-1
    INTEGER            :: TITLE_POSITION_END=-1
    INTEGER            :: TAIL_POSITION=-1
    INTEGER            :: TAIL_POSITION_END=-1
    INTEGER            :: CHOOSE_POSITION(  0:4,MAX_NUMBER_OF_QUESTIONS+10)=-1
    INTEGER            :: QUESTION_POSITION(0:5,MAX_NUMBER_OF_QUESTIONS+10)=-1
    INTEGER            :: BIG_QUESTIONS(0:6,  0:MAX_NUMBER_OF_QUESTIONS+10)=-1
    INTEGER            :: NOTE_POSITION(  0:2,MAX_NUMBER_OF_QUESTIONS+10)=-1
    LOGICAL            :: NOTE_TO_OUTPUT(MAX_NUMBER_OF_QUESTIONS+10)
    INTEGER            :: MAX_PRIORITY_NOTE

    DOUBLE PRECISION   :: BIG_MARKS(         MAX_NUMBER_OF_QUESTIONS+10)
    DOUBLE PRECISION   :: CHOOSE_MARKS(      MAX_NUMBER_OF_QUESTIONS+10)
    DOUBLE PRECISION   :: QUESTION_MARKS(1:2,MAX_NUMBER_OF_QUESTIONS+10)

    LOGICAL            :: INSIDE_BIGQUESTION=.FALSE.
    LOGICAL            :: INSIDE_QUESTION=.FALSE.
    LOGICAL            :: INSIDE_SUBQUESTION=.FALSE.
    LOGICAL            :: SWITCH_TURNED_ON=.FALSE.

    LOGICAL            :: FILE_NOT_END
    LOGICAL            :: TAIL_FOUND
    LOGICAL            :: END_TAIL_FOUND
    LOGICAL            :: TITLE_FOUND
    LOGICAL            :: END_TITLE_FOUND
    LOGICAL            :: CHOOSE_FOUND
    LOGICAL            :: CHOOSE_END_FOUND
    LOGICAL            :: QUESTION_FOUND
    LOGICAL            :: SOLUTION_FOUND
    LOGICAL            :: ANSWER_FOUND
    LOGICAL            :: QUESTION_END_FOUND
    LOGICAL            :: QUESTION_TITLE_FOUND
    LOGICAL            :: MANY_CHOICES_FOUND
    LOGICAL            :: MANY_TO_ORDER_FOUND
    LOGICAL            :: SOME_CHOICE_KEY_FOUND
    LOGICAL            :: COLUMN_MATCH_FOUND
    LOGICAL            :: CONSTANT_TABLE_HEAD_FOUND

    LOGICAL            :: NONE_CHOICE_WON

    LOGICAL            :: DO_NOT_OUTPUT

    INTEGER            :: ANSWER_COUNTER
    INTEGER            :: SOLUTION_COUNTER
    INTEGER            :: MANY_CHOICES_COUNTER
    INTEGER            :: MANY_TO_ORDER_COUNTER
    INTEGER            :: COLUMN_MATCH_COUNTER

    INTEGER            :: BIG_QUESTIONS_USED(MAX_NUMBER_OF_QUESTIONS)
    INTEGER            :: ALL_QUESTIONS_USED(MAX_NUMBER_OF_QUESTIONS)
    INTEGER            :: TEMP_QUESTIONS_USED(MAX_NUMBER_OF_QUESTIONS)


    INTEGER, PARAMETER :: UNDEFINED_TYPE=-1
    INTEGER, PARAMETER :: I_TYPE=1
    INTEGER, PARAMETER :: R_TYPE=2
    INTEGER, PARAMETER :: C_TYPE=3
    INTEGER, PARAMETER :: S_TYPE=4
    INTEGER, PARAMETER :: L_TYPE=5
    INTEGER, PARAMETER :: V_TYPE=6

    INTEGER, PARAMETER :: I_MATRIX_TYPE=101
    INTEGER, PARAMETER :: R_MATRIX_TYPE=102
    INTEGER, PARAMETER :: C_MATRIX_TYPE=103
    INTEGER, PARAMETER :: S_MATRIX_TYPE=104
   !INTEGER, PARAMETER :: L_MATRIX_TYPE=105

    TYPE MATRIX_TYPES
         INTEGER       :: SIZES(2)
         INTEGER       :: BRACE_INDEX
         INTEGER, DIMENSION(:,:), POINTER :: INTEGER_M
         DOUBLE PRECISION, DIMENSION(:,:), POINTER :: REAL_M
         DOUBLE COMPLEX  , DIMENSION(:,:), POINTER :: COMPLEX_M
         CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_SSS), DIMENSION(:,:), POINTER :: STRING_M
    END TYPE MATRIX_TYPES

    INTEGER            :: DOLLAR_NUMBER
    INTEGER            :: INPUT_NUMBER
    INTEGER            :: INPUT_STRING_POSITION
    INTEGER            :: INPUT_ACCURACY(3, MAX_NUMBER_OF_INPUTS_PQ)
    INTEGER            :: INPUT_TYPE(    MAX_NUMBER_OF_INPUTS_PQ)
    INTEGER            :: INPUT_III(3,   MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE PRECISION   :: INPUT_RRR(3,   MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE COMPLEX     :: INPUT_CCC(3,   MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE PRECISION   :: INPUT_VVV(9,   MAX_NUMBER_OF_INPUTS_PQ)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_SSS)  ::  INPUT_SSS(MAX_NUMBER_OF_SSS_INPUT_TERMS)
    INTEGER            :: INPUT_STK(                           MAX_NUMBER_OF_SSS_INPUT_TERMS)
    INTEGER, PARAMETER :: S_POST=1
    INTEGER, PARAMETER :: T_POST=1
    INTEGER, PARAMETER :: F_POST=2

    INTEGER            :: GENERATED_I(         MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE PRECISION   :: GENERATED_R(         MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE COMPLEX     :: GENERATED_C(         MAX_NUMBER_OF_INPUTS_PQ)
    LOGICAL            :: GENERATED_L(         MAX_NUMBER_OF_INPUTS_PQ)
    DOUBLE PRECISION   :: GENERATED_V(3,       MAX_NUMBER_OF_INPUTS_PQ)
    TYPE(MATRIX_TYPES) :: GENERATED_M(         MAX_NUMBER_OF_INPUTS_PQ)
    INTEGER            :: GENERATED_POSITION(2,MAX_NUMBER_OF_INPUTS_PQ)

    INTEGER            :: CALCULATED_NUMBER
    INTEGER            :: CALCULATED_ACCURACY(3,MAX_NUMBER_OF_CALCULATES_PQ)
    INTEGER            :: CALCULATED_TYPE(      MAX_NUMBER_OF_CALCULATES_PQ)
    INTEGER            :: CALCULATED_I(         MAX_NUMBER_OF_CALCULATES_PQ)
    DOUBLE PRECISION   :: CALCULATED_R(         MAX_NUMBER_OF_CALCULATES_PQ)
    DOUBLE COMPLEX     :: CALCULATED_C(         MAX_NUMBER_OF_CALCULATES_PQ)
    LOGICAL            :: CALCULATED_L(         MAX_NUMBER_OF_CALCULATES_PQ)
    DOUBLE PRECISION   :: CALCULATED_V(3,       MAX_NUMBER_OF_CALCULATES_PQ)
    TYPE(MATRIX_TYPES) :: CALCULATED_M(         MAX_NUMBER_OF_CALCULATES_PQ)
    INTEGER            :: CALCULATED_POSITION(2,MAX_NUMBER_OF_CALCULATES_PQ)
    INTEGER, PARAMETER :: DEFAULT_CALCULATED_ACCURACY=6
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_SSS)  ::  OUTPUT_SSS(MAX_NUMBER_OF_SSS_INPUT_TERMS)
    INTEGER            :: OUTPUT_STK(                           MAX_NUMBER_OF_SSS_INPUT_TERMS)

    INTEGER            :: LAYER_NUMBER
    INTEGER            :: LAYER_CALCULATED(MAX_LAYER_OF_CHOICES)
    INTEGER            :: LAYER_ACCURACY(3,MAX_LAYER_OF_CHOICES)
    INTEGER            :: LAYER_TYPE(      MAX_LAYER_OF_CHOICES)
    INTEGER            :: LAYER_EXT(       MAX_LAYER_OF_CHOICES)
    DOUBLE PRECISION   :: LAYER_RANGE(4,   MAX_LAYER_OF_CHOICES)
    DOUBLE PRECISION   :: LAYER_L_POSSIBILITY(              MAX_LAYER_OF_CHOICES)
    INTEGER            :: LAYER_I(0:MAX_WRONG_POSSIBLE,     MAX_LAYER_OF_CHOICES)
    DOUBLE PRECISION   :: LAYER_R(0:MAX_WRONG_POSSIBLE,     MAX_LAYER_OF_CHOICES)
   !DOUBLE PRECISION   :: LAYER_V(3, 0:MAX_WRONG_POSSIBLE,  MAX_LAYER_OF_CHOICES)
   !DOUBLE COMPLEX     :: LAYER_C(0:MAX_WRONG_POSSIBLE,     MAX_LAYER_OF_CHOICES)
    LOGICAL            :: LAYER_L(0:MAX_WRONG_POSSIBLE,     MAX_LAYER_OF_CHOICES)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARACTERS_SSS):: LAYER_S(0:MAX_WRONG_POSSIBLE,MAX_LAYER_OF_CHOICES)
    INTEGER            :: LAYER_POSITION(2,    MAX(2**MAX_LAYER_OF_CHOICES,MAX_LAYER_TO_ORDER+1))
    INTEGER            :: LAYER_USED(          MAX(2**MAX_LAYER_OF_CHOICES,MAX_LAYER_TO_ORDER))
    INTEGER            :: LAYER_CORRECT(                                   MAX_LAYER_TO_ORDER)
    INTEGER            :: LAYER_GENERATOR(     MAX(2**MAX_LAYER_OF_CHOICES,MAX_LAYER_TO_ORDER,MAX_WRONG_POSSIBLE**2))
    INTEGER            :: LAYER_GENERATOR_TEMP(MAX(2**MAX_LAYER_OF_CHOICES,MAX_LAYER_TO_ORDER,MAX_WRONG_POSSIBLE**2))

    INTEGER            :: LEFT_COLUMN(2,MAX_ITEMS_IN_A_COLUMN+1)
    INTEGER            :: RIGHT_COLUMN(2,MAX_ITEMS_IN_A_COLUMN+1)
    INTEGER            :: SELECTED_LEFT_COLUMN(MAX_ITEMS_IN_A_COLUMN+1)
    INTEGER            :: SELECTED_TEMP_COLUMN(MAX_ITEMS_IN_A_COLUMN+1)
    INTEGER            :: SELECTED_RIGHT_COLUMN(MAX_ITEMS_IN_A_COLUMN+1)

    DOUBLE PRECISION   :: CONSTANT_R(MAX_NUMBER_OF_CONSTANTS)
    INTEGER            :: CONSTANT_ACCURACY(MAX_NUMBER_OF_CONSTANTS)
    INTEGER            :: CONSTANT_KEY_LENGTH(MAX_NUMBER_OF_CONSTANTS)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARA_CNST)  ::  CONSTANT_KEY(   MAX_NUMBER_OF_CONSTANTS)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARA_CNST)  ::  CONSTANT_NAME(  MAX_NUMBER_OF_CONSTANTS)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARA_CNST)  ::  CONSTANT_UNIT(  MAX_NUMBER_OF_CONSTANTS)
    CHARACTER(LEN=MAX_NUMBER_OF_CHARA_CNST)  ::  CONSTANT_SYMBOL(MAX_NUMBER_OF_CONSTANTS)

    INTEGER            :: DATA_BEGIN_NUMBER

    INTEGER                                          :: CHOICES_TO_BE_GENERATED
    INTEGER                                          :: NONE_CHOICE_REPLACES
    CHARACTER(LEN=MAX_OF_CHARACTERS_AS_NONE_CHOICE)  :: NONE_ABOVE_CHOICE

    INTEGER            :: AUTO_ANSWER_INDEX(4, MAX_NUMBER_AUTO_ANSWERS)
    INTEGER            :: LINE_OF_AUTO_ANSWERS


CONTAINS

    SUBROUTINE READ_A_LINE()
        IMPLICIT NONE
        INTEGER :: I,J
        10 LINE_NUMBER=LINE_NUMBER+1
        FILE_NOT_END=.TRUE.
        THE_READ=' '
        READ(INPUT_FILE_TUNNEL,'(A)', END=100) THE_READ
        DO_NOT_OUTPUT=.FALSE.
        THE_READ_LENGTH=LEN_TRIM(THE_READ)
        IF(THE_READ_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_PL) THEN
           PRINT*, 'Sorry, too long line in the input file: ', THE_READ_LENGTH, &
                                      MAX_NUMBER_OF_CHARACTERS_PL, LINE_NUMBER
           STOP
        ELSE
           THE_READ(THE_READ_LENGTH+1:THE_READ_LENGTH+ADDITIONAL_LENTH)=ADDITIONAL_EMPTY
        END IF

        IF(INSIDE_QUESTION) THEN
           IF(INDEX(THE_READ(1:THE_READ_LENGTH),SWITCH_OFF_KEY).GT.0) THEN
              SWITCH_TURNED_ON=.FALSE.
              GO TO 10
           ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),SWITCH_ON_KEY).GT.0) THEN
              SWITCH_TURNED_ON=.TRUE.
              I=INDEX(THE_READ(1:THE_READ_LENGTH),SWITCH_ON_KEY)+SWITCH_ON_KEY_LENTH
              THE_READ(1:I-1)=' '
              DO J=I, THE_READ_LENGTH
                 IF(THE_READ(J:J).EQ.'(') THE_READ(J:J)=' '
                 IF(THE_READ(J:J).EQ.')') THE_READ(J:J)=' '
                 IF(THE_READ(J:J).EQ.'$') THE_READ(J:J)=' '
                 IF(THE_READ(J:J).EQ.';') THE_READ(J:J)=' '
                 IF(THE_READ(J:J).EQ.',') THE_READ(J:J)=' '
              END DO
              THE_READ_WORK2=' '
              THE_READ_WORK2=ADJUSTL(THE_READ(I:THE_READ_LENGTH))
              READ(THE_READ_WORK2,*) READ_SWITCH_VALUE
              GO TO 10
           ELSE IF(SWITCH_TURNED_ON) THEN
              IF(EFFECTIVE_SWITCH_VALUE.NE.READ_SWITCH_VALUE) GO TO 10
           END IF
        END IF

        DO I=1, THE_READ_LENGTH+ADDITIONAL_LENTH
           IF((IACHAR(THE_READ(I:I)).GE.0).AND.(IACHAR(THE_READ(I:I)).LE.31)) THE_READ(I:I)=' '
        END DO
        !DO I=1, THE_READ_LENGTH
        !   IF(THE_READ(I:I).EQ.' ') THEN
        !   ELSE IF(THE_READ(I:I).EQ.'%') THEN
        !      GO TO 10
        !   ELSE
        !      EXIT
        !   END IF
        !END DO
        !DO I=1, THE_READ_LENGTH
        !   IF(THE_READ(I:I).EQ.'%') THEN
        !      IF(THE_READ(I-1:I-1).NE.'\') THEN
        !         PRINT*, 'Sorry, the percent sign "%" can only be used as the first '
        !         PRINT*, 'non-spacing character or immediately after the backslash "\".'
        !         PRINT*, 'Otherwise NOT ALLOWED: ', THE_READ(1:I), ' at ', I
        !         PRINT*, 'of the line ', LINE_NUMBER, ' of the input file '//INPUT_FILE//' .'
        !         STOP
        !      END IF
        !   END IF
        !END DO
        RETURN
        100 FILE_NOT_END=.FALSE.
        RETURN
    END SUBROUTINE READ_A_LINE


    SUBROUTINE READ_A_LINE2()
        IMPLICIT NONE

        CALL READ_A_LINE()

        IF(INDEX(THE_READ(1:THE_READ_LENGTH),     END_QUESTION_KEY).GT.0) THEN
           ANSWER_FOUND=.FALSE.
           SOLUTION_FOUND=.FALSE.
        ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_SOLUTION_KEY).GT.0) THEN
           IF(ANSWER_FOUND) THEN
              PRINT*, 'Sorry, '//END_SOLUTION_KEY//' can not be placed in ANSWER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_CHOICES_FOUND) THEN
              PRINT*, 'Sorry, '//END_SOLUTION_KEY//' can not be placed in CHOICE region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, 'Sorry, '//END_SOLUTION_KEY//' can not be placed in ORDER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, 'Sorry, '//END_SOLUTION_KEY//' can not be placed in A MATCH region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(SOLUTION_FOUND) THEN
              SOLUTION_FOUND=.FALSE.
           ELSE
              PRINT*, 'Sorry, '//END_SOLUTION_KEY//' found but no '//SOLUTION_KEY//': ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') SOLUTION_END
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') SOLUTION_END
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') SOLUTION_END
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           THE_READ=' '
        ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_ANSWER_KEY).GT.0) THEN
           IF(SOLUTION_FOUND) THEN
              PRINT*, 'Sorry, '//END_ANSWER_KEY//' can not be placed in SOLUTION region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_CHOICES_FOUND) THEN
              PRINT*, 'Sorry, '//END_ANSWER_KEY//' can not be used IN a CHOICE region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, 'Sorry, '//END_ANSWER_KEY//' can not be used IN an ORDER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, 'Sorry, '//END_ANSWER_KEY//' can not be used IN a MATCH region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(ANSWER_FOUND) THEN
              ANSWER_FOUND=.FALSE.
           ELSE
              PRINT*, 'Sorry, '//END_ANSWER_KEY//' found but no '//ANSWER_KEY//': ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ANSWER_REGION_END
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ANSWER_REGION_END
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSWER_FILE_TUNNEL,'(A)') ANSWER_REGION_END
          !WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
           THE_READ=' '
        ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),    SOLUTION_KEY).GT.0) THEN
           IF(ANSWER_FOUND) THEN
              PRINT*, 'Sorry, '//SOLUTION_KEY//' can not be placed in ANSWER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_CHOICES_FOUND) THEN
              PRINT*, 'Sorry, '//SOLUTION_KEY//' can not be placed in CHOICE region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, 'Sorry, '//SOLUTION_KEY//' can not be placed in ORDER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, 'Sorry, '//SOLUTION_KEY//' can not be placed in MATCH region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(SOLUTION_FOUND) THEN
              PRINT*, 'Sorry, two '//SOLUTION_KEY//'s found without ending: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           SOLUTION_FOUND=.TRUE.
           SOLUTION_COUNTER=SOLUTION_COUNTER+1
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') SOLUTION_TITLE
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') SOLUTION_TITLE
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') SOLUTION_TITLE
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           THE_READ=' '
        ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),     ANSWER_KEY).GT.0) THEN
           IF(SOLUTION_FOUND) THEN
              PRINT*, 'Sorry, '//ANSWER_KEY//' can not be placed in SOLUTION region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_CHOICES_FOUND) THEN
              PRINT*, 'Sorry, '//ANSWER_KEY//' can not be used IN a CHOICE region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, 'Sorry, '//ANSWER_KEY//' can not be used IN an ORDER region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, 'Sorry, '//ANSWER_KEY//' can not be used IN a MATCH region: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           IF(ANSWER_FOUND) THEN
              PRINT*, 'Sorry, two '//ANSWER_KEY//'s found without ending: ', &
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF
           ANSWER_FOUND=.TRUE.
           ANSWER_COUNTER=ANSWER_COUNTER+1
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ANSWER_REGION
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ANSWER_REGION
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
           WRITE(ANSWER_FILE_TUNNEL,'(A)') ANSWER_REGION
          !WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
          !WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
           THE_READ=' '
        END IF

        RETURN
        100 FILE_NOT_END=.FALSE.
        RETURN
    END SUBROUTINE READ_A_LINE2


    SUBROUTINE WRITE_THE_READ()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(OUTPUT_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(OUTPUT_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ


    SUBROUTINE WRITE_THE_READ_TO_ANSW_LUTION()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ_TO_ANSW_LUTION


    SUBROUTINE WRITE_THE_READ_TO_JOURNAL()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ_TO_JOURNAL


    SUBROUTINE WRITE_THE_READ_TO_SOLUTION()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(SOLUTION_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ_TO_SOLUTION


    SUBROUTINE WRITE_THE_READ_TO_ANSWER()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(ANSWER_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ_TO_ANSWER


    SUBROUTINE WRITE_THE_READ_TO_SHORTEST()
        IMPLICIT NONE
        IF(THE_READ_LENGTH.GT.0) THEN
           IF(FILE_NOT_END) WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') TRIM(ADJUSTL(THE_READ(1:THE_READ_LENGTH)))
        ELSE
           IF(FILE_NOT_END) WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') ' '
        END IF
        RETURN
    END SUBROUTINE WRITE_THE_READ_TO_SHORTEST


    SUBROUTINE OPEN_READ_TO(K)
        IMPLICIT NONE
        INTEGER :: I, K
        LINE_NUMBER=MAX(0,K)
        THE_READ_LENGTH=0
        ANSWER_FOUND=.FALSE.
        SOLUTION_FOUND=.FALSE.
        OPEN(INPUT_FILE_TUNNEL,FILE=INPUT_FILE)
        FILE_NOT_END=.TRUE.
        IF(K.LE.0) RETURN

        DO I=1, K-1
           READ(INPUT_FILE_TUNNEL,'(A)', END=100) THE_READ
        END DO
        THE_READ=' '
        READ(INPUT_FILE_TUNNEL,'(A)', END=100) THE_READ
        THE_READ_LENGTH=LEN_TRIM(THE_READ)

        IF(THE_READ_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_PL) THEN
           PRINT*, 'Sorry, too long line in the input file: ', THE_READ_LENGTH, &
                                      MAX_NUMBER_OF_CHARACTERS_PL, LINE_NUMBER
           STOP
        ELSE
           THE_READ(THE_READ_LENGTH+1:THE_READ_LENGTH+ADDITIONAL_LENTH)=ADDITIONAL_EMPTY
        END IF

        DO I=1, THE_READ_LENGTH+ADDITIONAL_LENTH
           IF((IACHAR(THE_READ(I:I)).GE.0).AND.(IACHAR(THE_READ(I:I)).LE.31)) THE_READ(I:I)=' '
        END DO
        !DO I=1, THE_READ_LENGTH
        !   IF(THE_READ(I:I).EQ.' ') THEN
        !   ELSE IF(THE_READ(I:I).EQ.'%') THEN
        !      PRINT*,'Warning: the following comment line of line number ', K,' is nulled'
        !      PRINT*,THE_READ(1:THE_READ_LENGTH)
        !      THE_READ=' '
        !      THE_READ_LENGTH=0
        !   ELSE
        !      EXIT
        !   END IF
        !END DO
        !DO I=1, THE_READ_LENGTH
        !   IF(THE_READ(I:I).EQ.'%') THEN
        !      IF(THE_READ(I-1:I-1).NE.'\') THEN
        !         PRINT*, 'Sorry, the percent sign "%" can only be used as the first '
        !         PRINT*, 'non-spacing character or immediately after the backslash "\".'
        !         PRINT*, 'Otherwise NOT ALLOWED: ', THE_READ(1:I), ' at ', I
        !         PRINT*, 'of the line ', LINE_NUMBER, ' of the input file '//INPUT_FILE//' .'
        !         STOP
        !      END IF
        !   END IF
        !END DO
        RETURN
        100 FILE_NOT_END=.FALSE.
        RETURN
    END SUBROUTINE OPEN_READ_TO


    SUBROUTINE WRITE_TITLE_AND_TAIL(K,L)
        IMPLICIT NONE
        INTEGER :: K, CP, L, KK=1
        LAYER_NUMBER=0
        INPUT_NUMBER=0
        INPUT_STRING_POSITION=0
        CALCULATED_NUMBER=0
        ANSWER_FOUND=.FALSE.
        SOLUTION_FOUND=.FALSE.
        MANY_CHOICES_FOUND=.FALSE.
        MANY_TO_ORDER_FOUND=.FALSE.
        ANSWER_COUNTER=0
        SOLUTION_COUNTER=0
        MANY_CHOICES_COUNTER=0
        MANY_TO_ORDER_COUNTER=0
        TOTAL_NUMBER_OF_ITEMS=0
        CALCULATED_ACCURACY=DEFAULT_CALCULATED_ACCURACY
        CONSTANT_TABLE_HEAD_FOUND=.FALSE.

        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'\vspace{0.2in}'
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
        WRITE(SOLUTION_FILE_TUNNEL,*)'\vspace{0.2in}'
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'\vspace{0.2in}'
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
        WRITE(ANSWER_FILE_TUNNEL,*)'\vspace{0.2in}'
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'\vspace{0.2in}'
        IF(K.LE.0) RETURN
        CALL OPEN_READ_TO(K)

        READ_DO: DO
        CALL READ_A_LINE()
        IF(LINE_NUMBER.GT.L) EXIT READ_DO
        CHECK_DO: DO

           CP=-1
           CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
           IF(CP.LE.0) THEN
              CALL WRITE_THE_READ_TO_ANSW_LUTION()
              CALL WRITE_THE_READ_TO_SOLUTION()
              CALL WRITE_THE_READ_TO_JOURNAL()
              CALL WRITE_THE_READ_TO_ANSWER()
              CALL WRITE_THE_READ()
              CYCLE READ_DO
           END IF

           IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO

           ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO

           ELSE
              PRINT*, 'No other key is allowed IN THE TITLE OR TAIL REGION: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF

        END DO CHECK_DO
        END DO READ_DO
        CALL CLOSE_INPUT()

        IF(CONSTANT_TABLE_HEAD_FOUND) THEN
              PRINT*, 'NOT ENDDED CONSTANT TABLE (WRITE_TITLE_AND_TAIL): ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
        END IF

        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '

        IF(QUESTIONS_SUMMARIZED_TO_PAPERS.EQ.1) THEN

           WRITE(OUTPUT_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(OUTPUT_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(OUTPUT_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(OUTPUT_FILE_TUNNEL,*)'  '
           WRITE(OUTPUT_FILE_TUNNEL,*)'  '

           WRITE(ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(ANSWER_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(ANSWER_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(ANSWER_FILE_TUNNEL,*)'  '
           WRITE(ANSWER_FILE_TUNNEL,*)'  '

           WRITE(JOURNAL_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(JOURNAL_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(JOURNAL_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(JOURNAL_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(JOURNAL_FILE_TUNNEL,*)'  '
           WRITE(JOURNAL_FILE_TUNNEL,*)'  '

           WRITE(SOLUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(SOLUTION_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(SOLUTION_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(SOLUTION_FILE_TUNNEL,*)'  '
           WRITE(SOLUTION_FILE_TUNNEL,*)'  '

           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '

           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_1//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//'1'//DOT_END//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_2//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)//DOT//&
                   &CHAR_OF_TOTAL_BIG_QUESTIONS(1:CHAR_OF_TOTAL_BIG_QUESTIONS_L)//DOT_END//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_3//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)TOTAL_ACTUAL_QUESTIONS,          '%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_4//'%'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)TOTAL_QUESTIONS_TO_BE_ANSWERED, ' %'
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')WORDS_SUMMARIZED_TO_PAPER_5
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
        END IF

        RETURN
    END SUBROUTINE WRITE_TITLE_AND_TAIL


    SUBROUTINE MAKE_A_NOTE(N)
        IMPLICIT NONE
        INTEGER :: N, K, CP, L, KK
        K=NOTE_POSITION(1,N)
        L=NOTE_POSITION(2,N)
        LINE_NUMBER_LIMIT=L
        READ_ROUTINE_SWITCH=1

        LAYER_NUMBER=0
        INPUT_NUMBER=0
        INPUT_STRING_POSITION=0
        CALCULATED_NUMBER=0
        ANSWER_FOUND=.FALSE.
        SOLUTION_FOUND=.FALSE.
        MANY_CHOICES_FOUND=.FALSE.
        MANY_TO_ORDER_FOUND=.FALSE.
        ANSWER_COUNTER=0
        SOLUTION_COUNTER=0
        MANY_CHOICES_COUNTER=0
        MANY_TO_ORDER_COUNTER=0
        TOTAL_NUMBER_OF_ITEMS=0
        CALCULATED_ACCURACY=DEFAULT_CALCULATED_ACCURACY
        CONSTANT_TABLE_HEAD_FOUND=.FALSE.

        IF(NOTE_TO_ANSWER_SOLUTION.EQ.1) THEN
           KK=1
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        ELSE
           KK=11
        END IF
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '

        IF(K.LE.0) RETURN
        CALL OPEN_READ_TO(K)

        READ_DO: DO
        CALL READ_A_LINE()
        IF(LINE_NUMBER.GT.L) EXIT READ_DO
        CHECK_DO: DO

           CP=-1
           CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
           IF(CP.LE.0) THEN
              IF(NOTE_TO_ANSWER_SOLUTION.EQ.1) CALL WRITE_THE_READ_TO_ANSW_LUTION()
              CALL WRITE_THE_READ_TO_JOURNAL()
              CALL WRITE_THE_READ()
              CYCLE READ_DO
           END IF

           IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO

           ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO

           ELSE
              PRINT*, 'No other key is allowed IN THE NOTE REGION: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF

        END DO CHECK_DO
        END DO READ_DO
        CALL CLOSE_INPUT()

        IF(CONSTANT_TABLE_HEAD_FOUND) THEN
              PRINT*, 'NOT ENDDED CONSTANT TABLE (MAKE_A_NOTE): ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
        END IF

        IF(NOTE_TO_ANSWER_SOLUTION.EQ.1) THEN
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
           WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        END IF
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '

        NOTE_TO_OUTPUT(N)=.FALSE.

        RETURN
    END SUBROUTINE MAKE_A_NOTE


    SUBROUTINE ACCUMULATE_CHAR(K,L)
        IMPLICIT NONE
        INTEGER :: I, K, L
        A_SUM_CHAR=0
        IF(K.GT.L) RETURN
        I=0
        CALL OPEN_READ_TO(I)
        DO I=1, L
           CALL READ_A_LINE()
           IF((I.GE.K).AND.(FILE_NOT_END)) A_SUM_CHAR=A_SUM_CHAR+THE_READ_LENGTH
        END DO
        CALL CLOSE_INPUT()
        RETURN
    END SUBROUTINE ACCUMULATE_CHAR


    SUBROUTINE CLOSE_INPUT()
        IMPLICIT NONE
        CLOSE(INPUT_FILE_TUNNEL)
        RETURN
    END SUBROUTINE CLOSE_INPUT


    SUBROUTINE RESET_THE_READ()
        IMPLICIT NONE
        INTEGER :: I, K
        K=0
        DO I=1, THE_READ_LENGTH
           IF(THE_READ(I:I).NE.' ') THEN
              K=I
              EXIT
           END IF
        END DO
        IF(K.LE.0) THEN
           THE_READ_LENGTH=0
           THE_READ_WORK2_LENGTH=THE_READ_LENGTH
           THE_READ_WORK2=' '
           THE_READ=' '
        ELSE
           THE_READ_WORK2_LENGTH=THE_READ_LENGTH-K+1
           THE_READ_WORK2=' '
           THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=THE_READ(K:THE_READ_LENGTH)
           THE_READ_LENGTH= THE_READ_WORK2_LENGTH
           THE_READ=' '
           THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
        END IF
        RETURN
    END SUBROUTINE RESET_THE_READ


    SUBROUTINE RESET_THE_WORK2()
        IMPLICIT NONE
        INTEGER :: I, J, K
        K=0
        DO I=1, THE_READ_WORK2_LENGTH
           IF(THE_READ_WORK2(I:I).NE.' ') THEN
              K=I
              EXIT
           END IF
        END DO
        IF(K.LE.0) THEN
           THE_READ_WORK2_LENGTH=0
           THE_READ_WORK2=' '
        ELSE IF(K.GT.1) THEN
           DO I=K, THE_READ_WORK2_LENGTH
              J=I-K+1
              THE_READ_WORK2(J:J)=THE_READ_WORK2(I:I)
           END DO
           THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH-K+1
           THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:MAX_NUMBER_OF_CHARACTERS_P2)=' '
        END IF
        RETURN
    END SUBROUTINE RESET_THE_WORK2


    SUBROUTINE RESET_THE_WORK2_2(K)
        IMPLICIT NONE
        INTEGER :: I, J, K

        IF(K.GE.THE_READ_WORK2_LENGTH) THEN
           THE_READ_WORK2=' '
           THE_READ_WORK2_LENGTH=0
        ELSE IF(K.LE.0) THEN
          !PRINT*, 'ILLEGAL L IN RESET_THE_WORK2_2: ',K
          !STOP
        ELSE
           DO I=K+1, THE_READ_WORK2_LENGTH
              J=I-K
              THE_READ_WORK2(J:J)=THE_READ_WORK2(I:I)
           END DO
           THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH-K
           THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:MAX_NUMBER_OF_CHARACTERS_P2)=' '
        END IF
        RETURN
    END SUBROUTINE RESET_THE_WORK2_2


END MODULE BASE_DATA


MODULE SEED_MODULE
    IMPLICIT NONE
    INTEGER, PARAMETER   :: SEED_NUMBER_JUMPER=3
    INTEGER              :: SEED_SIZE
    INTEGER, ALLOCATABLE :: SEED_VALUES(:)
    INTEGER, ALLOCATABLE :: SEED_NEW_VALUES(:)
    INTEGER              :: SEED_NUMBER0
    INTEGER              :: SEED_NUMBER
END MODULE SEED_MODULE


MODULE MYRAND_INTERFACE
    INTERFACE
        DOUBLE PRECISION FUNCTION MYRAND()
           IMPLICIT NONE
        END              FUNCTION MYRAND
    END INTERFACE
END MODULE MYRAND_INTERFACE


MODULE MYRAND_INTERFACE_1
    INTERFACE
      INTEGER FUNCTION AN_INTEGER_RANDOM(L,U)
        USE MYRAND_INTERFACE
           IMPLICIT NONE
        INTEGER :: L, U
      END FUNCTION AN_INTEGER_RANDOM
    END INTERFACE

    INTERFACE
      DOUBLE PRECISION FUNCTION A_DOUBLE_RANDOM(L,U)
        USE MYRAND_INTERFACE
        IMPLICIT NONE
        DOUBLE PRECISION :: L, U
      END FUNCTION A_DOUBLE_RANDOM
    END INTERFACE


    INTERFACE
      INTEGER FUNCTION AN_INTEGER_RAN_EXCLUSIVE(S,R)
        USE MYRAND_INTERFACE
        IMPLICIT NONE
        INTEGER            :: S, R(4)
      END FUNCTION AN_INTEGER_RAN_EXCLUSIVE
    END INTERFACE


    INTERFACE
      DOUBLE PRECISION FUNCTION A_DOUBLE_RAN_EXCLUSIVE(S,R)
        USE MYRAND_INTERFACE
        IMPLICIT NONE
        DOUBLE PRECISION   :: S, R(4)
      END FUNCTION A_DOUBLE_RAN_EXCLUSIVE

      DOUBLE PRECISION FUNCTION USE_A_DOUBLE_RAN_EXCLUSIVE(T,S,R)
        USE MYRAND_INTERFACE
        IMPLICIT NONE
        DOUBLE PRECISION   :: T, S, R(4)
      END FUNCTION USE_A_DOUBLE_RAN_EXCLUSIVE
    END INTERFACE
END MODULE MYRAND_INTERFACE_1


MODULE MYRAND_INTERFACE_2

    INTERFACE
      INTEGER FUNCTION AN_INTEGER_RAN_EXCLUSIVE2(I,L,U)
        USE MYRAND_INTERFACE_1
        IMPLICIT NONE
        INTEGER :: I, L, U
      END FUNCTION AN_INTEGER_RAN_EXCLUSIVE2
    END INTERFACE

    INTERFACE
      DOUBLE COMPLEX FUNCTION A_COMPLEX_RANDOM(L,U)
        USE BASE_DATA
        USE MYRAND_INTERFACE_1
        IMPLICIT NONE
        DOUBLE COMPLEX   :: L, U
      END FUNCTION A_COMPLEX_RANDOM
    END INTERFACE

    INTERFACE
      DOUBLE COMPLEX FUNCTION A_COMPLEX_RAN_EXCLUSIVE(S,R)
        USE BASE_DATA
        USE MYRAND_INTERFACE_1
        IMPLICIT NONE
        DOUBLE COMPLEX     :: S, R(4)
      END FUNCTION A_COMPLEX_RAN_EXCLUSIVE
    END INTERFACE


    INTERFACE
      INTEGER FUNCTION A_STEPPED_RAN_INTEGER(L,U,S)
        USE MYRAND_INTERFACE_1
        IMPLICIT NONE
        INTEGER :: L, U, S
      END FUNCTION A_STEPPED_RAN_INTEGER
    END INTERFACE


    INTERFACE
      DOUBLE PRECISION FUNCTION A_STEPPED_RAN_DOUBLE(L,U,S)
        USE MYRAND_INTERFACE_1
        IMPLICIT NONE
        DOUBLE PRECISION :: L, U, S
      END FUNCTION A_STEPPED_RAN_DOUBLE
    END INTERFACE


END MODULE MYRAND_INTERFACE_2


MODULE MYRAND_INTERFACE_3

    INTERFACE
      DOUBLE COMPLEX FUNCTION A_STEPPED_RAN_COMPLEX(L,U,S)
        USE BASE_DATA
        USE MYRAND_INTERFACE_2
        IMPLICIT NONE
        DOUBLE COMPLEX   :: L, U, S
      END FUNCTION A_STEPPED_RAN_COMPLEX
    END INTERFACE

END MODULE MYRAND_INTERFACE_3


MODULE RAND_INTERFACE
    USE  MYRAND_INTERFACE
    USE  MYRAND_INTERFACE_1
    USE  MYRAND_INTERFACE_2
    USE  MYRAND_INTERFACE_3
        IMPLICIT NONE
END MODULE RAND_INTERFACE


MODULE INT_TO_CHAR_INTERFACE
    INTERFACE
       function integer_to_character(i,length)
         IMPLICIT NONE
         character*20 :: integer_to_character
         integer      :: i,length
       end function integer_to_character

      !INTEGER FUNCTION GET_TOP(D)
      !  IMPLICIT NONE
      !  DOUBLE PRECISION :: D
      !END FUNCTION GET_TOP

    END INTERFACE
END MODULE INT_TO_CHAR_INTERFACE




MODULE PROCESSING_INTERFACE
    INTERFACE
        SUBROUTINE FIRST_PROCESSING(KEY)
            USE BASE_DATA
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  KEY
        END SUBROUTINE FIRST_PROCESSING

        SUBROUTINE FIRST_PROCESSING0(KEY)
            USE BASE_DATA
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  KEY
        END SUBROUTINE FIRST_PROCESSING0


        SUBROUTINE FIRST_PROCESSING_TEMP3(KEY)
            USE BASE_DATA
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  KEY
        END SUBROUTINE FIRST_PROCESSING_TEMP3
    END INTERFACE
END MODULE PROCESSING_INTERFACE




MODULE A_TITLED_BOX_INTERFACE
    INTERFACE
        SUBROUTINE A_TITLED_BOX(TUNNEL, N_LINES, STRING, PSTION)
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  STRING,  PSTION
            INTEGER           ::  TUNNEL, N_LINES
        END SUBROUTINE A_TITLED_BOX

        SUBROUTINE A_FILLED_BOX(TUNNEL, N_LINES, FILLS, STRING, PSTION)
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  FILLS, STRING, PSTION
            INTEGER           ::  TUNNEL, N_LINES
        END SUBROUTINE A_FILLED_BOX
    END INTERFACE
END MODULE A_TITLED_BOX_INTERFACE




MODULE CONSTANT_INTERFACE
    INTERFACE
        DOUBLE PRECISION FUNCTION GET_CONSTANT_VALUE_OF(STRING)
            USE BASE_DATA
            IMPLICIT NONE
            CHARACTER (LEN=*) ::  STRING
        END FUNCTION GET_CONSTANT_VALUE_OF
    END INTERFACE
END MODULE CONSTANT_INTERFACE




PROGRAM  EXAMS
    USE  BASE_DATA
    IMPLICIT NONE
    CALL INITIALIZE()
    CALL MAKEPAPERS()
    CALL STATISTICS(ANSWER_FILE_TUNNEL)
    CALL STATISTICS(SHORTEST_ANSWER_FILE_TUNNEL)
    CALL STATISTICS(JOURNAL_FILE_TUNNEL)
    CALL STATISTICS(SOLUTION_FILE_TUNNEL)
    CALL STATISTICS(ANSW_LUTION_FILE_TUNNEL)
    CALL FINALIZE()
    STOP
END PROGRAM EXAMS




SUBROUTINE STATISTICS(TUNNEL)
    USE BASE_DATA
    USE SEED_MODULE
    IMPLICIT NONE
    INTEGER :: I, J, K, L, TUNNEL, ACC
    DOUBLE PRECISION :: DB

    ACC=MARK_ACCURACY
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)')SPACING
    WRITE(TUNNEL,'(A)')SPACING
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'\newpage'
    WRITE(TUNNEL,'(A)')'\setcounter{page}{1} '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'{\LARGE{STATISTICS}}'
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)')SPACING
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'\begin{tabular}{|l|l|}'
    WRITE(TUNNEL,*)'\hline'

    WRITE(TUNNEL,*)'Initial seed for random numbers &', SEED_NUMBER0,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'First paper number &', THE_FIRST_EXAMINEE,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Last  paper number &', THE_LAST_EXAMINEE,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total papers to be generated &', TOTAL_NUMBER_OF_EXAMINEES,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    DB=TOTAL_FULL_MARKS
    CALL CONVERT_A_DOUBLE(DB,ACC)
    WRITE(TUNNEL,'(A)')'Total marks from input file & '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    DB=TOTAL_ACTUAL_MARKS
    CALL CONVERT_A_DOUBLE(DB,ACC)
    WRITE(TUNNEL,'(A)')'Total actual marks & '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' \\'
    WRITE(TUNNEL,'(A)')'\hline'

    WRITE(TUNNEL,*)'Total lines of the input file &', TOTAL_NUMBER_OF_LINES,' \\'
    WRITE(TUNNEL,*)'\hline'
    WRITE(TUNNEL,*)'Total QUESTIONs in input file &', TOTAL_NUMBER_OF_QUESTIONS,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total CHOOSEs in input file &', TOTAL_NUMBER_OF_CHOOSES,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total NOTEs in input file &', TOTAL_NUMBER_OF_NOTES,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total (big) questions in each paper &', TOTAL_NUMBER_OF_BIG_QUESTIONS,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total actual (sub)questions in each paper &', TOTAL_ACTUAL_QUESTIONS,' \\'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,*)'Total (sub)questions to be answered in each paper &', TOTAL_QUESTIONS_TO_BE_ANSWERED,' \\'
    WRITE(TUNNEL,'(A)')'\hline'

    WRITE(TUNNEL,*)'\end{tabular}'

    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'\newpage'
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)')'{\LARGE{For each big question}}'
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)')SPACING
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '

    L=TOTAL_NUMBER_OF_QUESTIONS/NUMBER_QUESTION_STATISTICS_PT
    DO I=1, L
       J=(I-1)*NUMBER_QUESTION_STATISTICS_PT+1
       K=I*NUMBER_QUESTION_STATISTICS_PT
       CALL QUESTION_STATISTICS(TUNNEL,J,K)
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'\vspace{0.2in}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
    END DO

    IF(TOTAL_NUMBER_OF_QUESTIONS.GT.L*NUMBER_QUESTION_STATISTICS_PT) THEN
       J=L*NUMBER_QUESTION_STATISTICS_PT+1
       CALL QUESTION_STATISTICS(TUNNEL,J,TOTAL_NUMBER_OF_QUESTIONS)
    END IF

    RETURN
END SUBROUTINE STATISTICS




SUBROUTINE QUESTION_STATISTICS(TUNNEL,I1,I2)
    USE  BASE_DATA
    IMPLICIT NONE
    INTEGER :: I1,I2,I, J, K, L, M, N, O, P, R, T, U, TUNNEL, ACC
    LOGICAL :: THINGS
    DOUBLE PRECISION :: DB
    ACC=MARK_ACCURACY
    WRITE(TUNNEL,'(A)')'\noindent\hspace{-0.4in}\begin{tabular}{|l|l|l|l|l|}'
    WRITE(TUNNEL,'(A)')'\hline'
    WRITE(TUNNEL,'(A)')' Big question & Choose? & Questions needed & Questions from & Question IDs \\ '
    WRITE(TUNNEL,'(A)')'\hline'
    DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
       J=BIG_QUESTIONS(3,I)
       K=BIG_QUESTIONS(4,I)
       T=BIG_QUESTIONS(5,I)
       L=QUESTION_POSITION(0,J)
       M=QUESTION_POSITION(0,K)
       N=BIG_QUESTIONS(1,I)
       O=BIG_QUESTIONS(0,I)
       U=BIG_QUESTIONS(6,I)
       P=BIG_QUESTIONS(2,I)
       THINGS=.FALSE.
       IF((J.GE.I1).AND.(J.LE.I2)) THEN
          DB=BIG_MARKS(I)
          CALL CONVERT_A_DOUBLE(DB,ACC)
          WRITE(TUNNEL,*)I,'(',T,','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          IF(N.EQ.0) WRITE(TUNNEL,*) ') &  No   & '
          IF(N.EQ.1) THEN
             DB=CHOOSE_MARKS(P)
             CALL CONVERT_A_DOUBLE(DB,ACC)
             WRITE(TUNNEL,'(A)')','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
             WRITE(TUNNEL,*) ') & ',P,' & '
          END IF
          WRITE(TUNNEL,*) O, '(', U, ', ', K-J+1,') & ',J,'(',QUESTION_POSITION(5,J)
          DB=QUESTION_MARKS(2,J)
          CALL CONVERT_A_DOUBLE(DB,ACC)
          WRITE(TUNNEL,'(A)') ','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          DB=QUESTION_MARKS(1,J)
          CALL CONVERT_A_DOUBLE(DB,ACC)
          WRITE(TUNNEL,*) ','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//') & ',L,' \\'
          THINGS=.TRUE.
       END IF
       DO R=J+1, K
          IF((R.GE.I1).AND.(R.LE.I2)) THEN
             WRITE(TUNNEL,*) ' & & & ', R,'(',QUESTION_POSITION(5,R)
             DB=QUESTION_MARKS(2,R)
             CALL CONVERT_A_DOUBLE(DB,ACC)
             WRITE(TUNNEL,*) ','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
             DB=QUESTION_MARKS(1,R)
             CALL CONVERT_A_DOUBLE(DB,ACC)
             WRITE(TUNNEL,*) ','//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//') & ', QUESTION_POSITION(0,R),' \\'
             THINGS=.TRUE.
          END IF
       END DO
       IF(THINGS) WRITE(TUNNEL,*)'\hline'
    END DO
    WRITE(TUNNEL,*)'\end{tabular}'
    RETURN
END SUBROUTINE QUESTION_STATISTICS




SUBROUTINE A_TITLED_BOX(TUNNEL, N_LINES, STRING, PSTION)
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  STRING, PSTION
    INTEGER           ::  TUNNEL, N_LINES, I
    WRITE(TUNNEL,'(A)')   PSTION//'\begin{tabular}{|l|}'
    WRITE(TUNNEL,'(A)')   '\hline'
    WRITE(TUNNEL,'(A)')   STRING//' \\'
    WRITE(TUNNEL,'(A)')   '\hline'
   ! WRITE(TUNNEL,'(A)')      '\vspace{1.0in} .'
    DO I=1, N_LINES
       WRITE(TUNNEL,'(A)')    ' \\ '
    END DO
    WRITE(TUNNEL,'(A)')   '\hline'
    WRITE(TUNNEL,'(A)')   '\end{tabular}'
    RETURN
END SUBROUTINE A_TITLED_BOX




SUBROUTINE A_FILLED_BOX(TUNNEL, N_LINES, FILLS, STRING, PSTION)
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  FILLS, STRING, PSTION
    INTEGER           ::  TUNNEL, N_LINES, I
    WRITE(TUNNEL,'(A)')   PSTION//'\begin{tabular}{|l|}'
    WRITE(TUNNEL,'(A)')   '\hline'
    WRITE(TUNNEL,'(A)')   STRING//' \\'
    WRITE(TUNNEL,'(A)')   '\hline'
    DO I=1, N_LINES-1
       WRITE(TUNNEL,'(A)')    ' \\ '
    END DO
    WRITE(TUNNEL,'(A)')   FILLS//' \\'
    WRITE(TUNNEL,'(A)')   '\hline'
    WRITE(TUNNEL,'(A)')   '\end{tabular}'
    RETURN
END SUBROUTINE A_FILLED_BOX




SUBROUTINE WRITE_A_HEAD(TUNNEL,STRING)
  CHARACTER (LEN=*) ::  STRING
  INTEGER           ::  TUNNEL
  WRITE(TUNNEL,'(A)') '\documentclass[12pt]{article}'
  WRITE(TUNNEL,'(A)') '\markboth{{'//STRING//'\today}}{{'//STRING//'\today}}'
  WRITE(TUNNEL,'(A)') '\pagestyle{myheadings}'
  WRITE(TUNNEL,'(A)') '\usepackage{amsmath}'
  WRITE(TUNNEL,'(A)') '\usepackage{epsfig}'
  WRITE(TUNNEL,'(A)') '\begin{document}'
  RETURN
END SUBROUTINE WRITE_A_HEAD




SUBROUTINE SET_CONSTANTS()
    USE BASE_DATA
    IMPLICIT NONE

    CONSTANT_NAME(1)="Acceleration due to earth's gravity"
    CONSTANT_KEY(1)="EARTH-ACCELERATION"
    CONSTANT_KEY_LENGTH(1)=LEN_TRIM(CONSTANT_KEY(1))
    CONSTANT_SYMBOL(1)="$g$"
    CONSTANT_R(1)=9.80D0
    CONSTANT_ACCURACY(1)=3
    CONSTANT_UNIT(1)="m/s$^2$"

    CONSTANT_NAME(2)="Avogadro's number"
    CONSTANT_KEY(2)="AVOGADRO-NUMBER"
    CONSTANT_KEY_LENGTH(2)=LEN_TRIM(CONSTANT_KEY(2))
    CONSTANT_SYMBOL(2)="$N_A$"
    CONSTANT_R(2)=6.0221367D23
    CONSTANT_ACCURACY(2)=8
    CONSTANT_UNIT(2)="mol$^{-1}$"

    CONSTANT_NAME(3)="Boltzmann's constant"
    CONSTANT_KEY(3)="BOLTZMANN-CONSTANT"
    CONSTANT_KEY_LENGTH(3)=LEN_TRIM(CONSTANT_KEY(3))
    CONSTANT_SYMBOL(3)="$k$"
    CONSTANT_R(3)=1.380658D-23
    CONSTANT_ACCURACY(3)=7
    CONSTANT_UNIT(3)="J/K"

    CONSTANT_NAME(4)="Coulomb's constant"
    CONSTANT_KEY(4)="COULOMB-CONSTANT"
    CONSTANT_KEY_LENGTH(4)=LEN_TRIM(CONSTANT_KEY(4))
    CONSTANT_SYMBOL(4)="$k$"
    CONSTANT_R(4)=8.99D9
    CONSTANT_ACCURACY(4)=3
    CONSTANT_UNIT(4)="N$\cdot $m$^2$/C$^2$"

    CONSTANT_NAME(5)="Electron charge magnitiude"
    CONSTANT_KEY(5)="ELECTRON-CHARGE"
    CONSTANT_KEY_LENGTH(5)=LEN_TRIM(CONSTANT_KEY(5))
    CONSTANT_SYMBOL(5)="$e$"
    CONSTANT_R(5)=1.60217733D-19
    CONSTANT_ACCURACY(5)=9
    CONSTANT_UNIT(5)="C"

    CONSTANT_NAME(6)="Permeability of free space"
    CONSTANT_KEY(6)="FREE-PERMEABILITY"
    CONSTANT_KEY_LENGTH(6)=LEN_TRIM(CONSTANT_KEY(6))
    CONSTANT_SYMBOL(6)="$\mu _0$"
    CONSTANT_R(6)=1.25663706D-6
    CONSTANT_ACCURACY(6)=9
    CONSTANT_UNIT(6)="T$\cdot $m/A"

    CONSTANT_NAME(7)="Permittivity of free space"
    CONSTANT_KEY(7)="FREE-PERMITTIVITY"
    CONSTANT_KEY_LENGTH(7)=LEN_TRIM(CONSTANT_KEY(7))
    CONSTANT_SYMBOL(7)="$\epsilon _0$"
    CONSTANT_R(7)=8.854187817D-12
    CONSTANT_ACCURACY(7)=10
    CONSTANT_UNIT(7)="C$^2$/(N$\cdot $m$^2$)"

    CONSTANT_NAME(8)="Pi"
    CONSTANT_KEY(8)="PI"
    CONSTANT_KEY_LENGTH(8)=LEN_TRIM(CONSTANT_KEY(8))
    CONSTANT_SYMBOL(8)="$\pi$"
    CONSTANT_R(8)=3.14159265D0
    CONSTANT_ACCURACY(8)=9
    CONSTANT_UNIT(8)="$ $"

    CONSTANT_NAME(9)="Planck's constant"
    CONSTANT_KEY(9)="PLANCK-CONSTANT"
    CONSTANT_KEY_LENGTH(9)=LEN_TRIM(CONSTANT_KEY(9))
    CONSTANT_SYMBOL(9)="$h$"
    CONSTANT_R(9)=6.6260755D-34
    CONSTANT_ACCURACY(9)=8
    CONSTANT_UNIT(9)="J$\cdot $s"

    CONSTANT_NAME(10)="Mass of electron"
    CONSTANT_KEY(10)="ELECTRON-MASS"
    CONSTANT_KEY_LENGTH(10)=LEN_TRIM(CONSTANT_KEY(10))
    CONSTANT_SYMBOL(10)="$m_e$"
    CONSTANT_R(10)=9.1093897D-31
    CONSTANT_ACCURACY(10)=8
    CONSTANT_UNIT(10)="kg"

    CONSTANT_NAME(11)="Mass of neutron"
    CONSTANT_KEY(11)="NEUTRON-MASS"
    CONSTANT_KEY_LENGTH(11)=LEN_TRIM(CONSTANT_KEY(11))
    CONSTANT_SYMBOL(11)="$m_n$"
    CONSTANT_R(11)=1.6749286D-27
    CONSTANT_ACCURACY(11)=8
    CONSTANT_UNIT(11)="kg"

    CONSTANT_NAME(12)="Mass of proton"
    CONSTANT_KEY(12)="PROTON-MASS"
    CONSTANT_KEY_LENGTH(12)=LEN_TRIM(CONSTANT_KEY(12))
    CONSTANT_SYMBOL(12)="$m_p$"
    CONSTANT_R(12)=1.6726231D-27
    CONSTANT_ACCURACY(12)=8
    CONSTANT_UNIT(12)="kg"

    CONSTANT_NAME(13)="Speed of light in vacuum"
    CONSTANT_KEY(13)="SPEED-OF-LIGHT"
    CONSTANT_KEY_LENGTH(13)=LEN_TRIM(CONSTANT_KEY(13))
    CONSTANT_SYMBOL(13)="$c$"
    CONSTANT_R(13)=2.99792458D+8
    CONSTANT_ACCURACY(13)=9
    CONSTANT_UNIT(13)="m/s"

    CONSTANT_NAME(14)="Universal gravitational constant"
    CONSTANT_KEY(14)="GRAVITATIONAL-CONSTANT"
    CONSTANT_KEY_LENGTH(14)=LEN_TRIM(CONSTANT_KEY(14))
    CONSTANT_SYMBOL(14)="$G$"
    CONSTANT_R(14)=6.67259D-11
    CONSTANT_ACCURACY(14)=6
    CONSTANT_UNIT(14)="N$\cdot $m$^2$/kg$^2$"

    CONSTANT_NAME(15)="Universal gas constant"
    CONSTANT_KEY(15)="UNIVERSAL-GAS-CONSTANT"
    CONSTANT_KEY_LENGTH(15)=LEN_TRIM(CONSTANT_KEY(15))
    CONSTANT_SYMBOL(15)="$R$"
    CONSTANT_R(15)=8.314510D0
    CONSTANT_ACCURACY(15)=7
    CONSTANT_UNIT(15)="J/(mol$\cdot $K)"

    TOTAL_NUMBER_OF_CONSTANTS=15

    RETURN
END SUBROUTINE SET_CONSTANTS




SUBROUTINE INITIALIZE()
  USE BASE_DATA
  USE SEED_MODULE
  USE INT_TO_CHAR_INTERFACE
  IMPLICIT NONE
  INTERFACE
    SUBROUTINE WRITE_A_HEAD(TUNNEL,STRING)
      CHARACTER (LEN=*) :: STRING
      INTEGER           :: TUNNEL
    END SUBROUTINE WRITE_A_HEAD
  END INTERFACE
  INTEGER :: I, J, K, L, NUMBER_NOTE_END, NUMBER_CHOOSE_END, NUMBER_QUESTION_END, ACC, KKK(0:2)
  DOUBLE PRECISION :: DB

  INSIDE_BIGQUESTION=.FALSE.
  INSIDE_QUESTION=.FALSE.
  INSIDE_SUBQUESTION=.FALSE.
  SWITCH_TURNED_ON=.FALSE.

  IF(LEN(DATA_BEGIN_KEY).NE.1) THEN
     PRINT*, 'DATA_BEGIN_KEY must be of one character: '//DATA_BEGIN_KEY
     STOP
  END IF

  IF(LEN(DATA_SEPARATE_KEY).NE.1) THEN
     PRINT*, 'DATA_SEPARATE_KEY must be of one character: '//DATA_SEPARATE_KEY
     STOP
  END IF

  IF(LEN(DATA_END_KEY).NE.1) THEN
     PRINT*, 'DATA_END_KEY must be of one character: '//DATA_END_KEY
     STOP
  END IF

  CALL SET_CONSTANTS()

  IF(TOTAL_NUMBER_OF_CONSTANTS.GT.MAX_NUMBER_OF_CONSTANTS) THEN
     PRINT*, 'Sorry, too many constants: ', TOTAL_NUMBER_OF_CONSTANTS
     STOP
  END IF

  IF(MAX_LAYER_OF_CHOICES.LE.3) THEN
     PRINT*, 'Sorry, too few layers: ', MAX_LAYER_OF_CHOICES
     STOP
  END IF

  IF(ADDITIONAL_LENTH.LE.0) THEN
     PRINT*, 'Sorry, character lenth problem0: ', ADDITIONAL_LENTH
     STOP
  END IF

  IF(ADDITIONAL_LENTH.GT.(MAX_NUMBER_OF_CHARACTERS_P2-MAX_NUMBER_OF_CHARACTERS_PL)) THEN
     PRINT*, 'Sorry, character lenth problem: ', ADDITIONAL_LENTH, MAX_NUMBER_OF_CHARACTERS_P2, &
          MAX_NUMBER_OF_CHARACTERS_PL, MAX_NUMBER_OF_CHARACTERS_P2-MAX_NUMBER_OF_CHARACTERS_PL
     STOP
  END IF

  DO I=0, MAX_DIGITS_AFTER_DOT
     CHAR_OF_INT=INTEGER_TO_CHARACTER(I,CHAR_OF_INT_LENGTH)
     REAL_DIGITS(I)=' '
     REAL_DIGITS(I)(1:CHAR_OF_INT_LENGTH)=CHAR_OF_INT(1:CHAR_OF_INT_LENGTH)
  END DO

  OPEN(SEED_FILE_TUNNEL,FILE=SEED_FILE)
  READ(SEED_FILE_TUNNEL,*) THE_FIRST_EXAMINEE
  IF(THE_FIRST_EXAMINEE.LT.1) THEN
     PRINT*,'The first examinee/paper number is not allowed less than one: ', THE_FIRST_EXAMINEE
     PRINT*,'Please check your '//SEED_FILE//' file.'
     STOP
  END IF
  READ(SEED_FILE_TUNNEL,*) THE_LAST_EXAMINEE
  TOTAL_NUMBER_OF_EXAMINEES=THE_LAST_EXAMINEE-THE_FIRST_EXAMINEE+1
  IF(TOTAL_NUMBER_OF_EXAMINEES.LT.1) THEN
     PRINT*,'The total number of examinees/papers is less than one: ', TOTAL_NUMBER_OF_EXAMINEES
     PRINT*,'I will do nothing for you. Please check your '//SEED_FILE//' file, if you want.'
     STOP
  END IF
  READ(SEED_FILE_TUNNEL,*) TOTAL_FULL_MARKS
  READ(SEED_FILE_TUNNEL,*) SEED_NUMBER0

  CALL RANDOM_SEED( )
  CALL RANDOM_SEED(SIZE=SEED_SIZE )
  ALLOCATE(SEED_VALUES(SEED_SIZE))
  ALLOCATE(SEED_NEW_VALUES(SEED_SIZE))
 !CALL RANDOM_SEED(GET=SEED_VALUES)
 !SEED_NUMBER=SEED_NUMBER0
 !CALL RANDOM_SEED(SEED_NUMBER)
  DO I=1, SEED_SIZE
     SEED_NEW_VALUES(I)=SEED_NUMBER0+I
  END DO
  CALL RANDOM_SEED(PUT=SEED_NEW_VALUES)
  CLOSE(SEED_FILE_TUNNEL)

  OPEN(OUTPUT_FILE_TUNNEL,FILE=OUTPUT_FILE)
  OPEN(ANSW_LUTION_FILE_TUNNEL,FILE=ANSW_LUTION_FILE)
  OPEN(SOLUTION_FILE_TUNNEL,FILE=SOLUTION_FILE)
  OPEN(JOURNAL_FILE_TUNNEL,FILE=JOURNAL_FILE)
  OPEN(ANSWER_FILE_TUNNEL,FILE=ANSWER_FILE)
  OPEN(SHORTEST_ANSWER_FILE_TUNNEL,FILE=SHORTEST_ANSWER_FILE)

  IF(SIMPLE_HEADS.EQ.1) THEN
     CALL WRITE_A_HEAD(ANSW_LUTION_FILE_TUNNEL,' Answer and solutions NOT for examinees !!! ')
     CALL WRITE_A_HEAD(SOLUTION_FILE_TUNNEL,' Solutions NOT for examinees !!! ')
     CALL WRITE_A_HEAD(JOURNAL_FILE_TUNNEL,' Journal NOT for examinees !!! ')
     CALL WRITE_A_HEAD(ANSWER_FILE_TUNNEL,' Answers NOT for examinees !!! ')
     CALL WRITE_A_HEAD(SHORTEST_ANSWER_FILE_TUNNEL,' Answers-ONLY NOT for examinees !!! ')
  END IF

  TAIL_FOUND=.FALSE.
  END_TAIL_FOUND=.FALSE.
  TITLE_FOUND=.FALSE.
  END_TITLE_FOUND=.FALSE.
  CHOOSE_FOUND=.FALSE.
  CHOOSE_END_FOUND=.FALSE.
  QUESTION_FOUND=.FALSE.
  QUESTION_END_FOUND=.FALSE.

  TITLE_POSITION=-1
  TITLE_POSITION_END=-1
  TAIL_POSITION=-1
  TAIL_POSITION_END=-1
  CHOOSE_POSITION=-1
  QUESTION_POSITION=-1
  MAX_PRIORITY_NOTE=-1

  NUMBER_NOTE_END=0
  NUMBER_CHOOSE_END=0
  NUMBER_QUESTION_END=0
  TOTAL_NUMBER_OF_LINES=0
  TOTAL_NUMBER_OF_NOTES=0
  TOTAL_NUMBER_OF_CHOOSES=0
  TOTAL_NUMBER_OF_QUESTIONS=0

  READ_ROUTINE_SWITCH=0

  K=0
  CALL OPEN_READ_TO(K)
  FIRST_DO: DO
      CALL READ_A_LINE()
      IF(FILE_NOT_END) THEN
         TOTAL_NUMBER_OF_LINES=LINE_NUMBER

         IF(INDEX(THE_READ(1:THE_READ_LENGTH), END_TITLE_KEY).GT.0) THEN
            IF(.NOT.END_TITLE_FOUND) TITLE_POSITION_END=TOTAL_NUMBER_OF_LINES-1
            END_TITLE_FOUND=.TRUE.

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),TITLE_KEY).GT.0) THEN
            IF(.NOT.TITLE_FOUND) TITLE_POSITION=TOTAL_NUMBER_OF_LINES
            TITLE_FOUND=.TRUE.

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_QUESTION_KEY).GT.0) THEN
            QUESTION_END_FOUND=.TRUE.
            NUMBER_QUESTION_END=NUMBER_QUESTION_END+1
            QUESTION_POSITION(2,NUMBER_QUESTION_END)=TOTAL_NUMBER_OF_LINES-1

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_QUESTION_TITLE_KEY).GT.0) THEN

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),    QUESTION_TITLE_KEY).GT.0) THEN

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),          QUESTION_KEY).GT.0) THEN
            QUESTION_FOUND=.TRUE.
            TOTAL_NUMBER_OF_QUESTIONS=TOTAL_NUMBER_OF_QUESTIONS+1
            QUESTION_POSITION(1,TOTAL_NUMBER_OF_QUESTIONS)=TOTAL_NUMBER_OF_LINES
            L=INDEX(THE_READ(1:THE_READ_LENGTH), QUESTION_KEY)+LEN(QUESTION_KEY)
            THE_READ_WORK2=' '
            THE_READ_WORK2=THE_READ(L:THE_READ_LENGTH+ADDITIONAL_LENTH)
            THE_READ_WORK2_LENGTH=LEN_TRIM(THE_READ_WORK2)
            DATA_BEGIN_NUMBER=0
            CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
            CALL GET_AN_INTEGER(K)
            QUESTION_POSITION(0,TOTAL_NUMBER_OF_QUESTIONS)=K
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_A_DOUBLE(DB,ACC)
            QUESTION_MARKS(1,TOTAL_NUMBER_OF_QUESTIONS)=DB
            QUESTION_MARKS(2,TOTAL_NUMBER_OF_QUESTIONS)=DB

            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER(K)
            QUESTION_POSITION(4,TOTAL_NUMBER_OF_QUESTIONS)=K
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER(K)
            QUESTION_POSITION(5,TOTAL_NUMBER_OF_QUESTIONS)=K
            !IF(K.EQ.MULTIPLE_CHOICE_ENABLED) THEN
            !   QUESTION_POSITION(4,TOTAL_NUMBER_OF_QUESTIONS)=MULTIPLE_CHOICE_PRIORITY
            !ELSE IF(K.EQ.MULTIPLE_CHOICE_DISABLED) THEN
            !ELSE
            !   PRINT*,'PROBLEM of question key: ', K, TRIM(THE_READ), LINE_NUMBER
            !   STOP
            !END IF
            CALL CHECK_AND_DELETE(DATA_END_KEY)

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_CHOOSE_KEY).GT.0) THEN
            CHOOSE_END_FOUND=.TRUE.
            NUMBER_CHOOSE_END=NUMBER_CHOOSE_END+1
            CHOOSE_POSITION(2,NUMBER_CHOOSE_END)=TOTAL_NUMBER_OF_LINES-1

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),    CHOOSE_KEY).GT.0) THEN
            CHOOSE_FOUND=.TRUE.
            TOTAL_NUMBER_OF_CHOOSES=TOTAL_NUMBER_OF_CHOOSES+1
            CHOOSE_POSITION(1,TOTAL_NUMBER_OF_CHOOSES)=TOTAL_NUMBER_OF_LINES
            L=INDEX(THE_READ(1:THE_READ_LENGTH), CHOOSE_KEY)+LEN(CHOOSE_KEY)
            THE_READ_WORK2=' '
            THE_READ_WORK2=THE_READ(L:THE_READ_LENGTH+ADDITIONAL_LENTH)
            THE_READ_WORK2_LENGTH=LEN_TRIM(THE_READ_WORK2)
            DATA_BEGIN_NUMBER=0
            CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
            CALL GET_AN_INTEGER(K)
            CHOOSE_POSITION(0,TOTAL_NUMBER_OF_CHOOSES)=K
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER(K)
            CHOOSE_POSITION(4,TOTAL_NUMBER_OF_CHOOSES)=K
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_A_DOUBLE(DB,ACC)
            CHOOSE_MARKS(TOTAL_NUMBER_OF_CHOOSES)=DB
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER(K)
            CHOOSE_POSITION(3,TOTAL_NUMBER_OF_CHOOSES)=K
            CALL CHECK_AND_DELETE(DATA_END_KEY)

            IF(CHOOSE_POSITION(0,TOTAL_NUMBER_OF_CHOOSES).GT.0)THEN
            IF(CHOOSE_POSITION(0,TOTAL_NUMBER_OF_CHOOSES).LT.CHOOSE_POSITION(4,TOTAL_NUMBER_OF_CHOOSES))THEN
               PRINT*,'Sorry, bad CHOOSE construct: ', THE_READ(1:THE_READ_LENGTH), &
                  CHOOSE_POSITION(0,TOTAL_NUMBER_OF_CHOOSES),CHOOSE_POSITION(4,TOTAL_NUMBER_OF_CHOOSES), &
                  TOTAL_NUMBER_OF_CHOOSES, CHOOSE_POSITION(1,TOTAL_NUMBER_OF_CHOOSES)
               STOP
            END IF
            END IF

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),  END_NOTE_KEY).GT.0) THEN
           !NOTE_END_FOUND=.TRUE.
            NUMBER_NOTE_END=NUMBER_NOTE_END+1
            NOTE_POSITION(2,NUMBER_NOTE_END)=TOTAL_NUMBER_OF_LINES-1

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),      NOTE_KEY).GT.0) THEN
           !NOTE_FOUND=.TRUE.
            TOTAL_NUMBER_OF_NOTES=TOTAL_NUMBER_OF_NOTES+1
            NOTE_POSITION(1,TOTAL_NUMBER_OF_NOTES)=TOTAL_NUMBER_OF_LINES
            L=INDEX(THE_READ(1:THE_READ_LENGTH), NOTE_KEY)+LEN(NOTE_KEY)
            THE_READ_WORK2=' '
            THE_READ_WORK2=THE_READ(L:THE_READ_LENGTH+ADDITIONAL_LENTH)
            THE_READ_WORK2_LENGTH=LEN_TRIM(THE_READ_WORK2)
            DATA_BEGIN_NUMBER=0
            CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
            CALL GET_AN_INTEGER(K)
            NOTE_POSITION(0,TOTAL_NUMBER_OF_NOTES)=K
            IF(MAX_PRIORITY_NOTE.LT.K) MAX_PRIORITY_NOTE=K
            CALL CHECK_AND_DELETE(DATA_END_KEY)

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),END_TAIL_KEY).GT.0) THEN
            END_TAIL_FOUND=.TRUE.
            TAIL_POSITION_END=TOTAL_NUMBER_OF_LINES-1

         ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),    TAIL_KEY).GT.0) THEN
            TAIL_FOUND=.TRUE.
            TAIL_POSITION=TOTAL_NUMBER_OF_LINES

         END IF

         IF(.NOT.TITLE_FOUND) THEN
            CALL WRITE_THE_READ()
            IF(SIMPLE_HEADS.NE.1) THEN
               CALL WRITE_THE_READ_TO_ANSW_LUTION()
               CALL WRITE_THE_READ_TO_SOLUTION()
               CALL WRITE_THE_READ_TO_JOURNAL()
               CALL WRITE_THE_READ_TO_ANSWER()
               CALL WRITE_THE_READ_TO_SHORTEST()
            END IF
         END IF

      ELSE
         EXIT FIRST_DO
      END IF
  END DO FIRST_DO

  CALL CLOSE_INPUT()

  IF(TOTAL_NUMBER_OF_LINES.LE.0) THEN
     PRINT*, 'Sorry: input file empty. ', TOTAL_NUMBER_OF_LINES
     STOP
  END IF

  IF(TOTAL_NUMBER_OF_NOTES.GT.MAX_NUMBER_OF_QUESTIONS) THEN
     PRINT*, 'Sorry: too many note keys.',TOTAL_NUMBER_OF_NOTES,MAX_NUMBER_OF_QUESTIONS
     STOP
  END IF

  IF(NUMBER_NOTE_END.NE.TOTAL_NUMBER_OF_NOTES) THEN
     PRINT*, 'Sorry: not match note and end keys.',TOTAL_NUMBER_OF_NOTES,NUMBER_NOTE_END
     STOP
  END IF

  IF(TOTAL_NUMBER_OF_QUESTIONS.GT.MAX_NUMBER_OF_QUESTIONS) THEN
     PRINT*, 'Sorry: too many question keys.',TOTAL_NUMBER_OF_QUESTIONS,MAX_NUMBER_OF_QUESTIONS
     STOP
  END IF

  IF(NUMBER_QUESTION_END.NE.TOTAL_NUMBER_OF_QUESTIONS) THEN
     PRINT*, 'Sorry: not match question and end keys.',TOTAL_NUMBER_OF_QUESTIONS,NUMBER_QUESTION_END
     STOP
  END IF

  IF(TOTAL_NUMBER_OF_CHOOSES.GT.MAX_NUMBER_OF_QUESTIONS) THEN
     PRINT*, 'Sorry: too many CHOOSE keys.',TOTAL_NUMBER_OF_CHOOSES,MAX_NUMBER_OF_QUESTIONS
     STOP
  END IF

  IF(NUMBER_CHOOSE_END.NE.TOTAL_NUMBER_OF_CHOOSES) THEN
     PRINT*, 'Sorry: not match CHOOSE and END keys.',TOTAL_NUMBER_OF_CHOOSES,NUMBER_CHOOSE_END
     STOP
  END IF

  IF(.NOT.TITLE_FOUND) THEN
     PRINT*, 'Sorry: NO '//TITLE_KEY//' found.',TOTAL_NUMBER_OF_LINES
     STOP
  END IF

  IF(.NOT.END_TITLE_FOUND) THEN
     PRINT*, 'Sorry: NO '//END_TITLE_KEY//' found.',TOTAL_NUMBER_OF_LINES
     STOP
  END IF

  IF(.NOT.TAIL_FOUND) THEN
     PRINT*, 'Sorry: NO '//TAIL_KEY//' found.',TOTAL_NUMBER_OF_LINES
     STOP
  END IF

  IF(.NOT.END_TAIL_FOUND) THEN
     PRINT*, 'Sorry: NO '//END_TAIL_KEY//' found.',TOTAL_NUMBER_OF_LINES
     STOP
  END IF

  IF(.NOT.QUESTION_FOUND) THEN
    PRINT*, 'Sorry: NO '//QUESTION_KEY//' found.',TOTAL_NUMBER_OF_LINES
    STOP
  END IF

  IF(.NOT.QUESTION_END_FOUND) THEN
    PRINT*, 'Sorry: NO '//END_QUESTION_KEY//' found.',TOTAL_NUMBER_OF_LINES
    STOP
  END IF

  IF(TITLE_POSITION.GT.TITLE_POSITION_END) THEN
     PRINT*, 'Sorry: exam TITLE area problem ', TITLE_POSITION, TITLE_POSITION_END
     STOP
  END IF

  IF(TAIL_POSITION.GT.TAIL_POSITION_END) THEN
     PRINT*, 'Problem in Tail area or a bug of this code: ', TAIL_POSITION, TAIL_POSITION_END
     STOP
  END IF

  K=TOTAL_NUMBER_OF_NOTES
  TOTAL_NUMBER_OF_NOTES=0
  DO I=1, K
     IF(NOTE_POSITION(0,I).GE.0) THEN
        TOTAL_NUMBER_OF_NOTES=TOTAL_NUMBER_OF_NOTES+1
        IF(TOTAL_NUMBER_OF_NOTES.NE.I) THEN
           NOTE_POSITION(:,TOTAL_NUMBER_OF_NOTES)=NOTE_POSITION(:,I)
        END IF
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_NOTES
     IF(NOTE_POSITION(1,I).GT.NOTE_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for NOTE construct ',I &
              ,' of lines ',CHOOSE_POSITION(1,I),CHOOSE_POSITION(2,I)+1
        STOP
     END IF
  END DO

  IF(TOTAL_NUMBER_OF_NOTES.GT.0) THEN
  IF(TITLE_POSITION_END.GT.NOTE_POSITION(1,1)) THEN
     PRINT*, 'Title End is after a NOTE: ', TITLE_POSITION_END, NOTE_POSITION(1,1)
     STOP
  END IF
  END IF

  IF(TOTAL_NUMBER_OF_NOTES.GT.0) THEN
  IF(TAIL_POSITION.LT.NOTE_POSITION(2,TOTAL_NUMBER_OF_NOTES)) THEN
     PRINT*, 'Tail is before a NOTE-END: ', TAIL_POSITION, &
                  NOTE_POSITION(2,TOTAL_NUMBER_OF_NOTES)
     STOP
  END IF
  END IF

  DO I=1, TOTAL_NUMBER_OF_NOTES-1
     IF(NOTE_POSITION(1,I+1).LE.NOTE_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for NOTES ',I,' and ',I+1 &
              ,' of lines ',NOTE_POSITION(1,I:I+1),NOTE_POSITION(2,I)
        STOP
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_NOTES
     DO J=1, TOTAL_NUMBER_OF_CHOOSES
        IF((NOTE_POSITION(1,I).GE.CHOOSE_POSITION(1,J)).AND.(NOTE_POSITION(1,I).LE.CHOOSE_POSITION(2,J)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1,I),CHOOSE_POSITION(1:2,J)
           STOP
        END IF
        IF((NOTE_POSITION(2,I).GE.CHOOSE_POSITION(1,J)).AND.(NOTE_POSITION(2,I).LE.CHOOSE_POSITION(2,J)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(2,I),CHOOSE_POSITION(1:2,J)
           STOP
        END IF

        IF((CHOOSE_POSITION(1,J).GE.NOTE_POSITION(1,I)).AND.(CHOOSE_POSITION(1,J).LE.NOTE_POSITION(2,I)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1:2,I),CHOOSE_POSITION(1,J)
           STOP
        END IF
        IF((CHOOSE_POSITION(2,J).GE.NOTE_POSITION(1,I)).AND.(CHOOSE_POSITION(2,J).LE.NOTE_POSITION(2,I)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1:2,I),CHOOSE_POSITION(2,J)
           STOP
        END IF
     END DO

     DO J=1, TOTAL_NUMBER_OF_QUESTIONS
        IF((NOTE_POSITION(1,I).GE.QUESTION_POSITION(1,J)).AND.(NOTE_POSITION(1,I).LE.QUESTION_POSITION(2,J)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1,I),QUESTION_POSITION(1:2,J)
           STOP
        END IF
        IF((NOTE_POSITION(2,I).GE.QUESTION_POSITION(1,J)).AND.(NOTE_POSITION(2,I).LE.QUESTION_POSITION(2,J)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(2,I),QUESTION_POSITION(1:2,J)
           STOP
        END IF

        IF((QUESTION_POSITION(1,J).GE.NOTE_POSITION(1,I)).AND.(QUESTION_POSITION(1,J).LE.NOTE_POSITION(2,I)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1:2,I),QUESTION_POSITION(1,J)
           STOP
        END IF
        IF((QUESTION_POSITION(2,J).GE.NOTE_POSITION(1,I)).AND.(QUESTION_POSITION(2,J).LE.NOTE_POSITION(2,I)))THEN
           PRINT*,'The note/choose/question structs are illegal at lines: ', &
                  NOTE_POSITION(1:2,I),QUESTION_POSITION(2,J)
           STOP
        END IF
     END DO
  END DO

  DO I=1, TOTAL_NUMBER_OF_NOTES-1
  DO J=I+1, TOTAL_NUMBER_OF_NOTES
     IF(NOTE_POSITION(0,I).GT.NOTE_POSITION(0,J)) THEN
        KKK(0:2)=NOTE_POSITION(0:2,I)
        NOTE_POSITION(0:2,I)=NOTE_POSITION(0:2,J)
        NOTE_POSITION(0:2,J)=KKK(0:2)
     END IF
  END DO
  END DO

  DO I=1, TOTAL_NUMBER_OF_CHOOSES
     IF(CHOOSE_POSITION(1,I).GT.CHOOSE_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for CHOOSE construct ',I &
              ,' of lines ',CHOOSE_POSITION(1,I),CHOOSE_POSITION(2,I)+1
        STOP
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_QUESTIONS
     IF(QUESTION_POSITION(1,I).GT.QUESTION_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for Question ',I &
              ,' of lines ',QUESTION_POSITION(1,I),QUESTION_POSITION(2,I)+1
        STOP
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_CHOOSES-1
     IF(CHOOSE_POSITION(1,I+1).LE.CHOOSE_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for CHOOSE constructs ',I,' and ',I+1 &
              ,' of lines ',CHOOSE_POSITION(1,I:I+1),CHOOSE_POSITION(2,I)
        STOP
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_QUESTIONS-1
     IF(QUESTION_POSITION(1,I+1).LE.QUESTION_POSITION(2,I)) THEN
        PRINT*,'Something wrong in the input file for Questions ',I,' and ',I+1 &
              ,' of lines ',QUESTION_POSITION(1,I:I+1),QUESTION_POSITION(2,I)
        STOP
     END IF
  END DO

  DO I=1, TOTAL_NUMBER_OF_QUESTIONS-1
     IF(QUESTION_POSITION(0,I).GT.0) THEN
        DO J=I+1, TOTAL_NUMBER_OF_QUESTIONS
           IF(QUESTION_POSITION(0,I).EQ.QUESTION_POSITION(0,J)) THEN
              PRINT*,'Two questions use the same solution routine:', &
                      QUESTION_POSITION(0:2,I), QUESTION_POSITION(0:2,J),' : ', I, J
              STOP
           END IF
        END DO
     END IF
  END DO

  L=TOTAL_NUMBER_OF_QUESTIONS
  TOTAL_NUMBER_OF_QUESTIONS=0
  DO I=1, L
     IF(QUESTION_POSITION(0, I).GT.0) THEN
        J=QUESTION_POSITION(1, I)+1
        K=QUESTION_POSITION(2, I)
        CALL ACCUMULATE_CHAR(J,K)
        IF(A_SUM_CHAR.GT.0) THEN
           TOTAL_NUMBER_OF_QUESTIONS=TOTAL_NUMBER_OF_QUESTIONS+1
           IF(TOTAL_NUMBER_OF_QUESTIONS.LT.I) THEN
              QUESTION_MARKS(:,   TOTAL_NUMBER_OF_QUESTIONS)=QUESTION_MARKS(:,   I)
              QUESTION_POSITION(:,TOTAL_NUMBER_OF_QUESTIONS)=QUESTION_POSITION(:,I)
           ELSE IF(TOTAL_NUMBER_OF_QUESTIONS.GT.I) THEN
              PRINT*,'A bug in initial ... :',TOTAL_NUMBER_OF_QUESTIONS,I,QUESTION_POSITION(:,I)
              STOP
           END IF
        END IF
     END IF
  END DO

 !DO QUESTION_NUMBER=1, TOTAL_NUMBER_OF_QUESTIONS
 !   CALL SOLVE_THE_QUESTION(0,0)
 !END DO

  IF(TOTAL_NUMBER_OF_QUESTIONS.LE.0) THEN
     PRINT*, 'Sorry: no Questions. ',TOTAL_NUMBER_OF_QUESTIONS
     STOP
  END IF

  IF(TITLE_POSITION_END.GT.QUESTION_POSITION(1,1)) THEN
     PRINT*, 'Title End is after a Question: ', TITLE_POSITION_END, QUESTION_POSITION(1,1)
     STOP
  END IF

  IF(TOTAL_NUMBER_OF_CHOOSES.GT.0) THEN
  IF(TITLE_POSITION_END.GT.CHOOSE_POSITION(1,1)) THEN
     PRINT*, 'Title End is after a Choose: ', TITLE_POSITION_END, CHOOSE_POSITION(1,1)
     STOP
  END IF
  END IF

  IF(TAIL_POSITION.LT.QUESTION_POSITION(2,TOTAL_NUMBER_OF_QUESTIONS)) THEN
     PRINT*, 'Tail is before a question end: ', TAIL_POSITION, &
                  QUESTION_POSITION(2,TOTAL_NUMBER_OF_QUESTIONS)
     STOP
  END IF

  IF(TOTAL_NUMBER_OF_CHOOSES.GT.0) THEN
  IF(TAIL_POSITION.LT.CHOOSE_POSITION(2,TOTAL_NUMBER_OF_CHOOSES)) THEN
     PRINT*, 'Tail is before a choose end: ', TAIL_POSITION, &
                    CHOOSE_POSITION(2,TOTAL_NUMBER_OF_CHOOSES)
     STOP
  END IF
  END IF

  QUESTION_DO: DO I=1, TOTAL_NUMBER_OF_QUESTIONS
     CHOOSE_DO: DO J=1, TOTAL_NUMBER_OF_CHOOSES
        IF(CHOOSE_POSITION(1,J).LT.QUESTION_POSITION(1,I)) THEN
           IF(CHOOSE_POSITION(2,J).LT.QUESTION_POSITION(1,I)) THEN
              CYCLE CHOOSE_DO
           ELSE IF(CHOOSE_POSITION(2,J).LT.QUESTION_POSITION(2,I)) THEN
              PRINT*,'Something wrong in the input file for Question and Choose constructs ',I,J &
                                                  ,QUESTION_POSITION(1:2,I),CHOOSE_POSITION(1:2,J)
              STOP
           ELSE
              QUESTION_POSITION(3,I)=J
              QUESTION_MARKS(2,I)=CHOOSE_MARKS(J)
              EXIT CHOOSE_DO
           END IF
        ELSE
           IF(CHOOSE_POSITION(1,J).LT.QUESTION_POSITION(2,I)) THEN
              PRINT*,'Something wrong in the input file for Question and Choose ',I,J &
                                        ,QUESTION_POSITION(1:2,I),CHOOSE_POSITION(1:2,J)
              STOP
           ELSE
              EXIT CHOOSE_DO
           END IF
        END IF
     END DO CHOOSE_DO
  END DO QUESTION_DO

  TOTAL_NUMBER_OF_BIG_QUESTIONS=0
  BIG_QUESTIONS=0
  DO I=1, TOTAL_NUMBER_OF_QUESTIONS
     IF(QUESTION_POSITION(3,I).LE.0) THEN
        TOTAL_NUMBER_OF_BIG_QUESTIONS=TOTAL_NUMBER_OF_BIG_QUESTIONS+1
        BIG_QUESTIONS(0,TOTAL_NUMBER_OF_BIG_QUESTIONS)=1
        BIG_QUESTIONS(1,TOTAL_NUMBER_OF_BIG_QUESTIONS)=0
        BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
        BIG_QUESTIONS(3,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
        BIG_QUESTIONS(4,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
        BIG_QUESTIONS(5,TOTAL_NUMBER_OF_BIG_QUESTIONS)=QUESTION_POSITION(4,I)
        BIG_QUESTIONS(6,TOTAL_NUMBER_OF_BIG_QUESTIONS)=1
        BIG_MARKS(      TOTAL_NUMBER_OF_BIG_QUESTIONS)=QUESTION_MARKS(2,I)
     ELSE IF(QUESTION_POSITION(3,I).LE.TOTAL_NUMBER_OF_CHOOSES) THEN
        K=QUESTION_POSITION(3,I)
        IF(BIG_QUESTIONS(1,TOTAL_NUMBER_OF_BIG_QUESTIONS).LE.0) THEN
           TOTAL_NUMBER_OF_BIG_QUESTIONS=TOTAL_NUMBER_OF_BIG_QUESTIONS+1
           BIG_QUESTIONS(0,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(0,K)
           BIG_QUESTIONS(1,TOTAL_NUMBER_OF_BIG_QUESTIONS)=1
           BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS)=K
           BIG_QUESTIONS(3,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
           BIG_QUESTIONS(4,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
           BIG_QUESTIONS(5,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(3,K)
           BIG_QUESTIONS(6,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(4,K)
           BIG_MARKS(      TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_MARKS(K)
        ELSE
           IF(BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS).GT.K) THEN
              PRINT*,'A bug in initialB ... ',K,BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS),&
                                              I,QUESTION_POSITION(3,I),TOTAL_NUMBER_OF_CHOOSES
              STOP
           ELSE IF(BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS).EQ.K) THEN
              BIG_QUESTIONS(4,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
           ELSE
              TOTAL_NUMBER_OF_BIG_QUESTIONS=TOTAL_NUMBER_OF_BIG_QUESTIONS+1
              BIG_QUESTIONS(0,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(0,K)
              BIG_QUESTIONS(1,TOTAL_NUMBER_OF_BIG_QUESTIONS)=1
              BIG_QUESTIONS(2,TOTAL_NUMBER_OF_BIG_QUESTIONS)=K
              BIG_QUESTIONS(3,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
              BIG_QUESTIONS(4,TOTAL_NUMBER_OF_BIG_QUESTIONS)=I
              BIG_QUESTIONS(5,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(3,K)
              BIG_QUESTIONS(6,TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_POSITION(4,K)
              BIG_MARKS(      TOTAL_NUMBER_OF_BIG_QUESTIONS)=CHOOSE_MARKS(K)
           END IF
        END IF
     ELSE
        PRINT*,'A bug in initialC ... ',I,QUESTION_POSITION(3,I),TOTAL_NUMBER_OF_CHOOSES
        STOP
     END IF
  END DO

  !DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
  !   DO J=BIG_QUESTIONS(3,I), BIG_QUESTIONS(4,I)
  !      DO K=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
  !         DO L=BIG_QUESTIONS(3,K), BIG_QUESTIONS(4,K)
  !           IF(J.EQ.L) THEN
  !           ELSE IF(QUESTION_POSITION(0,J).EQ.QUESTION_POSITION(0,L)) THEN
  !              PRINT*,'Two questions use the same solution routine:', &
  !                        QUESTION_POSITION(0,J),QUESTION_POSITION(0,L),J,L
  !              STOP
  !           END IF
  !         END DO
  !      END DO
  !   END DO
  !END DO

  L=TOTAL_NUMBER_OF_BIG_QUESTIONS
  TOTAL_NUMBER_OF_BIG_QUESTIONS=0
  TOTAL_ACTUAL_QUESTIONS=0
  TOTAL_QUESTIONS_TO_BE_ANSWERED=0
  DO I=1, L
     IF(BIG_QUESTIONS(0, I).LE.0) THEN
     ELSE IF(BIG_QUESTIONS(0,I).LE.(BIG_QUESTIONS(4,I)-BIG_QUESTIONS(3,I)+1)) THEN
        IF(BIG_QUESTIONS(6, I).LE.0) THEN
        ELSE IF(BIG_QUESTIONS(6,I).LE.BIG_QUESTIONS(0,I)) THEN
           TOTAL_NUMBER_OF_BIG_QUESTIONS=TOTAL_NUMBER_OF_BIG_QUESTIONS+1
           IF(TOTAL_NUMBER_OF_BIG_QUESTIONS.LT.I) THEN
              BIG_MARKS(TOTAL_NUMBER_OF_BIG_QUESTIONS)=BIG_MARKS(I)
              BIG_QUESTIONS(:,TOTAL_NUMBER_OF_BIG_QUESTIONS)=BIG_QUESTIONS(:,I)
           ELSE IF(TOTAL_NUMBER_OF_BIG_QUESTIONS.GT.I) THEN
              PRINT*,'A bug in initial C... :',TOTAL_NUMBER_OF_BIG_QUESTIONS,I,BIG_QUESTIONS(:,I)
              STOP
           END IF
           TOTAL_ACTUAL_QUESTIONS=TOTAL_ACTUAL_QUESTIONS+BIG_QUESTIONS(0,TOTAL_NUMBER_OF_BIG_QUESTIONS)
           TOTAL_QUESTIONS_TO_BE_ANSWERED=TOTAL_QUESTIONS_TO_BE_ANSWERED+BIG_QUESTIONS(6,TOTAL_NUMBER_OF_BIG_QUESTIONS)
        ELSE
           PRINT*,'For choose construct # ',BIG_QUESTIONS(2,I),', ',BIG_QUESTIONS(0,I)     &
                            , ' questions will be generated, but examinees need to solve ',&
                                                            BIG_QUESTIONS(6,I), ' questions.'
           STOP
        END IF
     ELSE
        PRINT*,'For choose construct # ',BIG_QUESTIONS(2,I),', ',BIG_QUESTIONS(0,I) &
            , ' questions were asked to be generated, but only ',BIG_QUESTIONS(4,I) &
                        -BIG_QUESTIONS(3,I)+1,' available from ',BIG_QUESTIONS(3,I) &
                                                       , ' to ', BIG_QUESTIONS(4,I)
        STOP
     END IF
  END DO

  CHAR_OF_TOTAL_BIG_QUESTIONS=INTEGER_TO_CHARACTER(TOTAL_NUMBER_OF_BIG_QUESTIONS, &
                                                   CHAR_OF_TOTAL_BIG_QUESTIONS_L)

  !OPEN(NEW_INPUT_FILE_TUNNEL,FILE=NEW_INPUT_FILE)
  !K=0
  !CALL OPEN_READ_TO(K)
  !SECOND_DO: DO I=1, TOTAL_NUMBER_OF_LINES
  !    CALL READ_A_LINE()
  !    DO J=1, TOTAL_NUMBER_OF_QUESTIONS
  !     IF(LINE_NUMBER.EQ.) THEN
  !         WRITE()
  !         CYCLE SECOND_DO
  !      END IF
  !    END DO
  !    WRITE(NEW_INPUT_FILE_TUNNEL,*)
  !END DO SECOND_DO
  !CALL CLOSE_INPUT()
  !CLOSE(NEW_INPUT_FILE_TUNNEL)

  TOTAL_ACTUAL_MARKS=0.0D0
  DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
     TOTAL_ACTUAL_MARKS=TOTAL_ACTUAL_MARKS+BIG_MARKS(I)*BIG_QUESTIONS(6,I)
     BIG_MARKS(I)=BIG_MARKS(I)*BIG_QUESTIONS(6,I)
  END DO

  IF(MARKS_SCALED_TO_TOTAL_FULL.EQ.1) THEN
     DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
        BIG_MARKS(I)=BIG_MARKS(I)*TOTAL_FULL_MARKS/TOTAL_ACTUAL_MARKS
     END DO
     DO I=1, TOTAL_NUMBER_OF_QUESTIONS
        QUESTION_MARKS(2,I)=QUESTION_MARKS(2,I)*TOTAL_FULL_MARKS/TOTAL_ACTUAL_MARKS
     END DO
     TOTAL_ACTUAL_MARKS=0.0D0
     DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
        TOTAL_ACTUAL_MARKS=TOTAL_ACTUAL_MARKS+BIG_MARKS(I)
     END DO
  END IF

  PRINT*, 'INITIALIZATION COMPLETED ...'

  RETURN
END SUBROUTINE INITIALIZE




DOUBLE PRECISION FUNCTION MYRAND()
  USE SEED_MODULE
  IMPLICIT NONE
  REAL    :: RAN
 !IF(SEED_NUMBER.EQ.SEED_NUMBER0) THEN
 !   CALL RANDOM_SEED(SEED_NUMBER)
 !  !SEED_NUMBER=SEED_NUMBER+SEED_NUMBER_JUMPER
 !END IF
 !SEED_NUMBER0=SEED_NUMBER0+1
 !SEED_NUMBER=SEED_NUMBER0
 !CALL RANDOM_SEED(SEED_NUMBER)

 !SEED_NEW_VALUES=SEED_NEW_VALUES+I
 !CALL RANDOM_SEED(PUT=SEED_NEW_VALUES)

  CALL RANDOM_NUMBER(RAN)
  MYRAND=ABS(RAN)
  IF(MYRAND.GT.1.0D0) MYRAND=1.0D0
  RETURN
END FUNCTION MYRAND




INTEGER FUNCTION AN_INTEGER_RANDOM(L,U)
  USE MYRAND_INTERFACE
  IMPLICIT NONE
  INTEGER :: L, U, L2, U2
  L2=L
  U2=U
  AN_INTEGER_RANDOM=L2+(U2-L2)*MYRAND()+0.2
  IF(L2.GT.U2) THEN
     U2=L
     L2=U
  END IF
  IF(AN_INTEGER_RANDOM.LT.L2) AN_INTEGER_RANDOM=L2
  IF(AN_INTEGER_RANDOM.GT.U2) AN_INTEGER_RANDOM=U2
  RETURN
END FUNCTION AN_INTEGER_RANDOM




INTEGER FUNCTION A_STEPPED_RAN_INTEGER(L,U,S)
  USE MYRAND_INTERFACE_1
  IMPLICIT NONE
  INTEGER :: L, U, S, L2, U2
  L2=0
  U2=(U-L)/S
  A_STEPPED_RAN_INTEGER=L+S*AN_INTEGER_RANDOM(L2,U2)
  L2=L
  U2=U
  IF(L2.GT.U2) THEN
     U2=L
     L2=U
  END IF
  IF(A_STEPPED_RAN_INTEGER.LT.L2) A_STEPPED_RAN_INTEGER=L2
  IF(A_STEPPED_RAN_INTEGER.GT.U2) A_STEPPED_RAN_INTEGER=U2
  RETURN
END FUNCTION A_STEPPED_RAN_INTEGER




INTEGER FUNCTION AN_INTEGER_RAN_EXCLUSIVE2(I,L,U)
  USE MYRAND_INTERFACE_1
  IMPLICIT NONE
  INTEGER :: I, L, U
  IF((I.EQ.L).AND.(I.EQ.U)) THEN
     PRINT*, 'WITH THREE SAME INTEGERS, NO EXCLUSIVE RANDOM: ', I, L, U
     STOP
  END IF
  TRY: DO
    AN_INTEGER_RAN_EXCLUSIVE2=AN_INTEGER_RANDOM(L,U)
    IF(AN_INTEGER_RAN_EXCLUSIVE2.NE.I) EXIT TRY
  END DO TRY
  RETURN
END FUNCTION AN_INTEGER_RAN_EXCLUSIVE2




INTEGER FUNCTION AN_INTEGER_RAN_EXCLUSIVE(S,R)
  USE MYRAND_INTERFACE
  IMPLICIT NONE
  INTEGER            :: I, J, S, R(4), R2(4), IT
  DOUBLE PRECISION   :: T, DOTFIVE=0.5D0
  R2=R
  DO I=1, 4-1
  DO J=I+1, 4
     IF(R2(I).GT.R2(J)) THEN
        IT=R2(I)
        R2(I)=R2(J)
        R2(J)=IT
     END IF
  END DO
  END DO

  IF((S.EQ.R2(1)).AND.(S.EQ.R2(4))) THEN
     R2(1)=S-10
     R2(2)=S-01
     R2(3)=S+01
     R2(4)=S+10
  END IF

  10 CONTINUE

  T=MYRAND()
  IF(S.GT.R2(2)) THEN
     IF(S.LT.R2(3)) THEN
        IF(T.LE.DOTFIVE) THEN
           AN_INTEGER_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*(T/DOTFIVE)+0.2
           IF(AN_INTEGER_RAN_EXCLUSIVE.LT.R2(1)) AN_INTEGER_RAN_EXCLUSIVE=R2(1)
           IF(AN_INTEGER_RAN_EXCLUSIVE.GT.R2(2)) AN_INTEGER_RAN_EXCLUSIVE=R2(2)
        ELSE
           AN_INTEGER_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*((T-DOTFIVE)/(1.0D0-DOTFIVE))+0.2
           IF(AN_INTEGER_RAN_EXCLUSIVE.GT.R2(4)) AN_INTEGER_RAN_EXCLUSIVE=R2(4)
           IF(AN_INTEGER_RAN_EXCLUSIVE.LT.R2(3)) AN_INTEGER_RAN_EXCLUSIVE=R2(3)
        END IF
     ELSE
        AN_INTEGER_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*T+0.2
        IF(AN_INTEGER_RAN_EXCLUSIVE.LT.R2(1)) AN_INTEGER_RAN_EXCLUSIVE=R2(1)
        IF(AN_INTEGER_RAN_EXCLUSIVE.GT.R2(2)) AN_INTEGER_RAN_EXCLUSIVE=R2(2)
     END IF

  ELSE
     IF(S.LT.R2(3)) THEN
        AN_INTEGER_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*T+0.2
        IF(AN_INTEGER_RAN_EXCLUSIVE.GT.R2(4)) AN_INTEGER_RAN_EXCLUSIVE=R2(4)
        IF(AN_INTEGER_RAN_EXCLUSIVE.LT.R2(3)) AN_INTEGER_RAN_EXCLUSIVE=R2(3)
     ELSE
        AN_INTEGER_RAN_EXCLUSIVE=2*S+1
        PRINT*,'Warning: the random double exclusive seems not available. '
        PRINT*, S, R, AN_INTEGER_RAN_EXCLUSIVE
     END IF
  END IF

  IF (AN_INTEGER_RAN_EXCLUSIVE.EQ.S) GO TO 10

  RETURN
END FUNCTION AN_INTEGER_RAN_EXCLUSIVE




DOUBLE PRECISION FUNCTION A_STEPPED_RAN_DOUBLE(L,U,S)
  USE MYRAND_INTERFACE_1
  IMPLICIT NONE
  DOUBLE PRECISION :: L, U, S, L2, U2
  INTEGER          :: I, J
  I=0
  J=0.1D0+(U-L)/S
  A_STEPPED_RAN_DOUBLE=L+S*AN_INTEGER_RANDOM(I,J)
  L2=L
  U2=U
  IF(L2.GT.U2) THEN
     U2=L
     L2=U
  END IF
  IF(A_STEPPED_RAN_DOUBLE.LT.L2) A_STEPPED_RAN_DOUBLE=L2
  IF(A_STEPPED_RAN_DOUBLE.GT.U2) A_STEPPED_RAN_DOUBLE=U2
  RETURN
END FUNCTION A_STEPPED_RAN_DOUBLE




DOUBLE PRECISION FUNCTION A_DOUBLE_RANDOM(L,U)
  USE MYRAND_INTERFACE
  IMPLICIT NONE
  DOUBLE PRECISION :: L, U, L2, U2
  L2=L
  U2=U
  IF(L2.GT.U2) THEN
     U2=L
     L2=U
  END IF
  A_DOUBLE_RANDOM=L2+(U2-L2)*MYRAND()
  IF(A_DOUBLE_RANDOM.LT.L2) A_DOUBLE_RANDOM=L2
  IF(A_DOUBLE_RANDOM.GT.U2) A_DOUBLE_RANDOM=U2
  RETURN
END FUNCTION A_DOUBLE_RANDOM




DOUBLE PRECISION FUNCTION A_DOUBLE_RAN_EXCLUSIVE(S,R)
  USE MYRAND_INTERFACE
  IMPLICIT NONE
  INTEGER            :: I, J
  DOUBLE PRECISION   :: S, R(4), R2(4), T, DOTFIVE=0.5D0
  R2=R
  DO I=1, 4-1
  DO J=I+1, 4
     IF(R2(I).GT.R2(J)) THEN
        T=R2(I)
        R2(I)=R2(J)
        R2(J)=T
     END IF
  END DO
  END DO

  IF((ABS(S)+ABS(R2(1))+ABS(R2(4))).EQ.0.0D0) THEN
     R2(1)=-10.0D0
     R2(2)=-01.0D0
     R2(3)= 01.0D0
     R2(4)= 10.0D0
  END IF

  T=MYRAND()
  IF(S.GT.R2(2)) THEN
     IF(S.LT.R2(3)) THEN
        IF(T.LE.DOTFIVE) THEN
           A_DOUBLE_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*(T/DOTFIVE)
           IF(A_DOUBLE_RAN_EXCLUSIVE.LT.R2(1)) A_DOUBLE_RAN_EXCLUSIVE=R2(1)
           IF(A_DOUBLE_RAN_EXCLUSIVE.GT.R2(2)) A_DOUBLE_RAN_EXCLUSIVE=R2(2)
        ELSE
           A_DOUBLE_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*((T-DOTFIVE)/(1.0D0-DOTFIVE))
           IF(A_DOUBLE_RAN_EXCLUSIVE.GT.R2(4)) A_DOUBLE_RAN_EXCLUSIVE=R2(4)
           IF(A_DOUBLE_RAN_EXCLUSIVE.LT.R2(3)) A_DOUBLE_RAN_EXCLUSIVE=R2(3)
        END IF
     ELSE
        A_DOUBLE_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*T
        IF(A_DOUBLE_RAN_EXCLUSIVE.LT.R2(1)) A_DOUBLE_RAN_EXCLUSIVE=R2(1)
        IF(A_DOUBLE_RAN_EXCLUSIVE.GT.R2(2)) A_DOUBLE_RAN_EXCLUSIVE=R2(2)
     END IF

  ELSE
     IF(S.LT.R2(3)) THEN
        A_DOUBLE_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*T
        IF(A_DOUBLE_RAN_EXCLUSIVE.GT.R2(4)) A_DOUBLE_RAN_EXCLUSIVE=R2(4)
        IF(A_DOUBLE_RAN_EXCLUSIVE.LT.R2(3)) A_DOUBLE_RAN_EXCLUSIVE=R2(3)
     ELSE
        A_DOUBLE_RAN_EXCLUSIVE=2*S+1.0D0
        PRINT*,'Warning: the random double exclusive seems not available. '
        PRINT*, S, R, A_DOUBLE_RAN_EXCLUSIVE
     END IF
  END IF

  RETURN
END FUNCTION A_DOUBLE_RAN_EXCLUSIVE




DOUBLE PRECISION FUNCTION USE_A_DOUBLE_RAN_EXCLUSIVE(T,S,R)
  IMPLICIT NONE
  INTEGER            :: I, J
  DOUBLE PRECISION   :: T, DOTFIVE=0.5D0, S, R(4), R2(4), P
  R2=R
  DO I=1, 4-1
  DO J=I+1, 4
     IF(R2(I).GT.R2(J)) THEN
        P=R2(I)
        R2(I)=R2(J)
        R2(J)=P
     END IF
  END DO
  END DO

  IF((ABS(S)+ABS(R2(1))+ABS(R2(4))).EQ.0.0D0) THEN
     R2(1)=-10.0D0
     R2(2)=-01.0D0
     R2(3)= 01.0D0
     R2(4)= 10.0D0
  END IF

 !T=MYRAND()
  IF(S.GT.R2(2)) THEN
     IF(S.LT.R2(3)) THEN
        IF(T.LE.DOTFIVE) THEN
           USE_A_DOUBLE_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*(T/DOTFIVE)
           IF(USE_A_DOUBLE_RAN_EXCLUSIVE.LT.R2(1)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(1)
           IF(USE_A_DOUBLE_RAN_EXCLUSIVE.GT.R2(2)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(2)
        ELSE
           USE_A_DOUBLE_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*((T-DOTFIVE)/(1.0D0-DOTFIVE))
           IF(USE_A_DOUBLE_RAN_EXCLUSIVE.GT.R2(4)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(4)
           IF(USE_A_DOUBLE_RAN_EXCLUSIVE.LT.R2(3)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(3)
        END IF
     ELSE
        USE_A_DOUBLE_RAN_EXCLUSIVE=R2(1)+(R2(2)-R2(1))*T
        IF(USE_A_DOUBLE_RAN_EXCLUSIVE.LT.R2(1)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(1)
        IF(USE_A_DOUBLE_RAN_EXCLUSIVE.GT.R2(2)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(2)
     END IF

  ELSE
     IF(S.LT.R2(3)) THEN
        USE_A_DOUBLE_RAN_EXCLUSIVE=R2(3)+(R2(4)-R2(3))*T
        IF(USE_A_DOUBLE_RAN_EXCLUSIVE.GT.R2(4)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(4)
        IF(USE_A_DOUBLE_RAN_EXCLUSIVE.LT.R2(3)) USE_A_DOUBLE_RAN_EXCLUSIVE=R2(3)
     ELSE
        USE_A_DOUBLE_RAN_EXCLUSIVE=2*S+1.0D0
        PRINT*,'Warning: the USE random double exclusive seems not available. '
        PRINT*, T, S, R, USE_A_DOUBLE_RAN_EXCLUSIVE
     END IF
  END IF

  RETURN
END FUNCTION USE_A_DOUBLE_RAN_EXCLUSIVE




DOUBLE COMPLEX FUNCTION A_COMPLEX_RANDOM(L,U)
  USE BASE_DATA
  USE MYRAND_INTERFACE_1
  IMPLICIT NONE
  DOUBLE COMPLEX   :: L, U
  DOUBLE PRECISION :: L2, U2, R, I
  L2=REAL(L)
  U2=REAL(U)
  R=A_DOUBLE_RANDOM(L2,U2)
  L2=AIMAG(L)
  U2=AIMAG(U)
  I=A_DOUBLE_RANDOM(L2,U2)
  A_COMPLEX_RANDOM=CMPLX(R,I,DOUBLE_COMPLEX_KIND_)
  RETURN
END FUNCTION A_COMPLEX_RANDOM




DOUBLE COMPLEX FUNCTION A_STEPPED_RAN_COMPLEX(L,U,S)
  USE BASE_DATA
  USE MYRAND_INTERFACE_2
  IMPLICIT NONE
  DOUBLE COMPLEX   :: L, U, S
  DOUBLE PRECISION :: L2, U2, S2, R, I
  L2=REAL(L)
  U2=REAL(U)
  S2=REAL(S)
  R=A_STEPPED_RAN_DOUBLE(L2,U2,S2)
  L2=AIMAG(L)
  U2=AIMAG(U)
  S2=AIMAG(S)
  I=A_STEPPED_RAN_DOUBLE(L2,U2,S2)
  A_STEPPED_RAN_COMPLEX=CMPLX(R,I,DOUBLE_COMPLEX_KIND_)
  RETURN
END FUNCTION A_STEPPED_RAN_COMPLEX




DOUBLE COMPLEX FUNCTION A_COMPLEX_RAN_EXCLUSIVE(S,R)
  USE BASE_DATA
  USE MYRAND_INTERFACE_1
  IMPLICIT NONE
  INTEGER            :: I
  DOUBLE COMPLEX     :: S, R(4)
  DOUBLE PRECISION   :: S2, R2(4), RR, II
  DO I=1,4
     R2(I)=REAL(R(I))
  END DO
  S2=REAL(S)
  RR=A_DOUBLE_RAN_EXCLUSIVE(S2,R2)

  DO I=1,4
     R2(I)=AIMAG(R(I))
  END DO
  S2=AIMAG(S)
  II=A_DOUBLE_RAN_EXCLUSIVE(S2,R2)

  A_COMPLEX_RAN_EXCLUSIVE=CMPLX(RR,II,DOUBLE_COMPLEX_KIND_)
  RETURN
END FUNCTION A_COMPLEX_RAN_EXCLUSIVE




function integer_to_character(i,length)
IMPLICIT NONE
character*20 :: integer_to_character
integer :: i,length,j,k,l

length=0
integer_to_character=' '
if(i.lt.0) then
   length=1
   integer_to_character(1:1)='-'
end if

j=abs(i)
k=0
loop: do
   k=k+1
   j=j/10
   if(j.eq.0) exit loop
end do loop
length=length+k

j=abs(i)
do l=1,k
   integer_to_character(length+1-l:length+1-l)=char(mod(j,10)+48)
   j=j/10
end do

return
end function integer_to_character




SUBROUTINE STATE_REQUIRED_QUESTIONS(TUNNEL)
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: TUNNEL
  WRITE(TUNNEL,'(A)')WORDS_REQUIRED_QUESTIONS_1//' %'
  WRITE(TUNNEL,*)BIG_QUESTIONS(6,BIG_QUESTION_NUMBER),' %'
  WRITE(TUNNEL,'(A)')WORDS_REQUIRED_QUESTIONS_2//' %'
  WRITE(TUNNEL,*)BIG_QUESTIONS(0,BIG_QUESTION_NUMBER),' %'
  WRITE(TUNNEL,'(A)')WORDS_REQUIRED_QUESTIONS_3//' %'
  WRITE(TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                  &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT//'1'//DOT_END//'%'
  WRITE(TUNNEL,'(A)')WORDS_REQUIRED_QUESTIONS_4//' %'
  WRITE(TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                  &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                  &//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//DOT_END//'%'
  WRITE(TUNNEL,'(A)')WORDS_REQUIRED_QUESTIONS_5
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,*)'  '
  RETURN
END SUBROUTINE STATE_REQUIRED_QUESTIONS




SUBROUTINE WRITE_QUESTION_TITLE()
  USE BASE_DATA
  USE INT_TO_CHAR_INTERFACE
  USE A_TITLED_BOX_INTERFACE
  IMPLICIT NONE
  INTEGER :: I, J, K, L, CP, KK=1, FROM, TO, ACC
  DOUBLE PRECISION :: DB

  INSIDE_BIGQUESTION=.TRUE.

  LAYER_NUMBER=0
  INPUT_NUMBER=0
  INPUT_STRING_POSITION=0
  CALCULATED_NUMBER=0
  ANSWER_FOUND=.FALSE.
  SOLUTION_FOUND=.FALSE.
  MANY_CHOICES_FOUND=.FALSE.
  MANY_TO_ORDER_FOUND=.FALSE.
  ANSWER_COUNTER=0
  SOLUTION_COUNTER=0
  MANY_CHOICES_COUNTER=0
  MANY_TO_ORDER_COUNTER=0
  TOTAL_NUMBER_OF_ITEMS=0
  CALCULATED_ACCURACY=DEFAULT_CALCULATED_ACCURACY
  CONSTANT_TABLE_HEAD_FOUND=.FALSE.

  QUESTION_TITLE_FOUND=.FALSE.
  FROM=-1
  TO=-1
  IF(BIG_QUESTIONS(1,  BIG_QUESTION_NUMBER).EQ.1) THEN
     J=BIG_QUESTIONS(2,BIG_QUESTION_NUMBER)
     K=CHOOSE_POSITION(1,J)
     L=CHOOSE_POSITION(2,J)
     I=0
     CALL OPEN_READ_TO(I)
     READ_DO: DO I=1, L
           IF(LINE_NUMBER.GT.L) EXIT READ_DO
           CALL READ_A_LINE()
           IF(LINE_NUMBER.GT.K) THEN
              IF(INDEX(THE_READ(1:THE_READ_LENGTH), END_QUESTION_TITLE_KEY).GT.0) THEN
                 TO=LINE_NUMBER-1
                 IF(QUESTION_TITLE_FOUND) THEN
                    EXIT READ_DO
                 ELSE
                    PRINT*, 'No ',QUESTION_TITLE_KEY, ' before ', END_QUESTION_TITLE_KEY, &
                            ' in CHOOSE region: ', J, ' before line ', I
                    STOP
                 END IF
              ELSE IF(INDEX(THE_READ(1:THE_READ_LENGTH),QUESTION_TITLE_KEY).GT.0) THEN
                 IF(QUESTION_TITLE_FOUND) THEN
                    PRINT*, 'The second ',QUESTION_TITLE_KEY, &
                            ' is not allowed in CHOOSE region: ', J, ' at line ', I
                    STOP
                 ELSE
                    QUESTION_TITLE_FOUND=.TRUE.
                    FROM=LINE_NUMBER
                 END IF
              END IF
           END IF
     END DO READ_DO
     CALL CLOSE_INPUT()
  END IF

  IF((FROM.GT.0).AND.(TO.LE.0)) THEN
      PRINT*, 'No matching QUESTION TITLE ENDING: ', &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
      STOP
  END IF

  IF((.NOT.QUESTION_TITLE_FOUND).AND.(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER).LE.1)) THEN
     ELSE
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')SPACING
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
                    IF(MARK_BOX_FOR_QUESTIONS.EQ.1) THEN
                       CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_MARK,YOUR_MARK_POST)
                       DB=BIG_MARKS(BIG_QUESTION_NUMBER)
                       ACC=MARK_ACCURACY
                       CALL CONVERT_A_DOUBLE(DB,ACC)
                       CALL A_FILLED_BOX(OUTPUT_FILE_TUNNEL,2,THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),&
                            FULL_MARK, FULL_MARK_POST)
                    END IF
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
                    WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '

                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                     &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(ANSW_LUTION_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '

                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(JOURNAL_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
                    WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '

                    WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')SPACING
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(ANSWER_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '

                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')SPACING
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(SOLUTION_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
                    WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '

                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')SPACING
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIN
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')QUESTION_END
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '
                    WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '

        IF(BIG_QUESTIONS(6,BIG_QUESTION_NUMBER).LT.BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)) THEN
        IF(BIG_QUESTIONS(1,BIG_QUESTION_NUMBER).EQ.1)                                    THEN
           CHAR_OF_INT5=INTEGER_TO_CHARACTER(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER),CHAR_OF_INT5_LENGTH)
           IF(REQUIRED_QUESTIONS_STATED.EQ.1) THEN
              CALL STATE_REQUIRED_QUESTIONS(      OUTPUT_FILE_TUNNEL)
              CALL STATE_REQUIRED_QUESTIONS(     JOURNAL_FILE_TUNNEL)
              CALL STATE_REQUIRED_QUESTIONS( ANSW_LUTION_FILE_TUNNEL)
           END IF
           CALL STATE_REQUIRED_QUESTIONS(         ANSWER_FILE_TUNNEL)
           CALL STATE_REQUIRED_QUESTIONS(       SOLUTION_FILE_TUNNEL)
           CALL STATE_REQUIRED_QUESTIONS(SHORTEST_ANSWER_FILE_TUNNEL)
        END IF
        END IF

  END IF

        LINE_NUMBER_LIMIT=TO
        CALL OPEN_READ_TO(FROM)
        READ_DO2: DO
        CALL READ_A_LINE()
        IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) EXIT READ_DO2
        CHECK_DO: DO

           CP=-1
           CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
           IF(CP.LE.0) THEN
              CALL WRITE_THE_READ_TO_ANSW_LUTION()
              CALL WRITE_THE_READ_TO_JOURNAL()
              CALL WRITE_THE_READ()
              CYCLE READ_DO2
           END IF

           IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO

           ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO

           ELSE
              PRINT*, 'No other key is allowed IN THE QUESTION TITLE REGION: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
           END IF

        END DO CHECK_DO
        END DO READ_DO2
        CALL CLOSE_INPUT()

        IF(CONSTANT_TABLE_HEAD_FOUND) THEN
              PRINT*, 'NOT ENDDED CONSTANT TABLE (WRITE_QUESTION_TITLE): ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
        END IF

  INSIDE_BIGQUESTION=.FALSE.

  RETURN
END SUBROUTINE WRITE_QUESTION_TITLE




SUBROUTINE GET_A_PAPER()
  USE BASE_DATA
  USE RAND_INTERFACE
  IMPLICIT NONE
  INTEGER :: I, J, K, BI, BJ

  DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
     BIG_QUESTIONS_USED(I)=I
  END DO

  IF(QUESTIONS_DISORDERED.EQ.1) THEN
     DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS-1
        J=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_BIG_QUESTIONS+1-I)
        TEMP_QUESTIONS_USED(I)=BIG_QUESTIONS_USED(J)
        IF(J.NE.TOTAL_NUMBER_OF_BIG_QUESTIONS+1-I) &
        BIG_QUESTIONS_USED(J)=BIG_QUESTIONS_USED(TOTAL_NUMBER_OF_BIG_QUESTIONS+1-I)
     END DO
     TEMP_QUESTIONS_USED(TOTAL_NUMBER_OF_BIG_QUESTIONS)=BIG_QUESTIONS_USED(1)
     BIG_QUESTIONS_USED(1:TOTAL_NUMBER_OF_BIG_QUESTIONS)=&
      TEMP_QUESTIONS_USED(1:TOTAL_NUMBER_OF_BIG_QUESTIONS)

     DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS-1
        DO J=I+1, TOTAL_NUMBER_OF_BIG_QUESTIONS
           IF(TEMP_QUESTIONS_USED(I).GT.TEMP_QUESTIONS_USED(J)) THEN
              K=TEMP_QUESTIONS_USED(J)
              TEMP_QUESTIONS_USED(J)=TEMP_QUESTIONS_USED(I)
              TEMP_QUESTIONS_USED(I)=K
           END IF
        END DO
     END DO

     DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
        IF(TEMP_QUESTIONS_USED(I).NE.I) THEN
           PRINT*, 'Bug in GET_A_PAPER:'
           PRINT*, BIG_QUESTIONS_USED(1:TOTAL_NUMBER_OF_BIG_QUESTIONS)
           PRINT*, ' '
           PRINT*, TEMP_QUESTIONS_USED(1:TOTAL_NUMBER_OF_BIG_QUESTIONS)
           STOP
        END IF
     END DO
  END IF

  DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS-1
     BI=BIG_QUESTIONS_USED(I)
     DO J=I+1, TOTAL_NUMBER_OF_BIG_QUESTIONS
        BJ=BIG_QUESTIONS_USED(J)
        IF(BIG_QUESTIONS(5,BI).GT.BIG_QUESTIONS(5,BJ)) THEN
           K=BI
           BI=BJ
           BJ=K
           K=BIG_QUESTIONS_USED(I)
           BIG_QUESTIONS_USED(I)=BIG_QUESTIONS_USED(J)
           BIG_QUESTIONS_USED(J)=K
        END IF
     END DO
  END DO

  WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
  WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'In this paper, big questions will be generated in the following order: '
  WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
  WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
  DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
     J=BIG_QUESTIONS_USED(I)
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)' ', I, '(',BIG_QUESTIONS_USED(I), ')'
     IF(I.LT.TOTAL_NUMBER_OF_BIG_QUESTIONS)WRITE(ANSW_LUTION_FILE_TUNNEL,*)','
     IF(I.EQ.TOTAL_NUMBER_OF_BIG_QUESTIONS)WRITE(ANSW_LUTION_FILE_TUNNEL,*)'.'
  END DO

  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')'In this paper, big questions will be generated in the following order: '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  DO I=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
     J=BIG_QUESTIONS_USED(I)
     WRITE(JOURNAL_FILE_TUNNEL,*)' ', I, '(',BIG_QUESTIONS_USED(I), ')'
     IF(I.LT.TOTAL_NUMBER_OF_BIG_QUESTIONS)WRITE(JOURNAL_FILE_TUNNEL,*)','
     IF(I.EQ.TOTAL_NUMBER_OF_BIG_QUESTIONS)WRITE(JOURNAL_FILE_TUNNEL,*)'.'
  END DO

  RETURN
END SUBROUTINE GET_A_PAPER




SUBROUTINE GET_QUESTIONS()
  USE BASE_DATA
  USE RAND_INTERFACE
  IMPLICIT NONE
  INTEGER :: I, J, K, Q1, Q2, NQ

  Q1=BIG_QUESTIONS(3,BIG_QUESTION_NUMBER)
  Q2=BIG_QUESTIONS(4,BIG_QUESTION_NUMBER)
  NQ=Q2-Q1+1

  DO I=1, NQ
     ALL_QUESTIONS_USED(I)=I+Q1-1
  END DO

  IF(QUESTIONS_DISORDERED.EQ.1) THEN
     DO I=1, NQ-1
        J=AN_INTEGER_RANDOM(1, NQ+1-I)
        TEMP_QUESTIONS_USED(I)=ALL_QUESTIONS_USED(J)
        IF(J.NE.NQ+1-I) &
        ALL_QUESTIONS_USED(J)=ALL_QUESTIONS_USED(NQ+1-I)
     END DO
     TEMP_QUESTIONS_USED(NQ)=ALL_QUESTIONS_USED(1)
     ALL_QUESTIONS_USED(1:NQ)=TEMP_QUESTIONS_USED(1:NQ)

     DO I=1, NQ-1
        DO J=I+1, NQ
           IF(TEMP_QUESTIONS_USED(I).GT.TEMP_QUESTIONS_USED(J)) THEN
              K=TEMP_QUESTIONS_USED(J)
              TEMP_QUESTIONS_USED(J)=TEMP_QUESTIONS_USED(I)
              TEMP_QUESTIONS_USED(I)=K
           END IF
        END DO
     END DO

     DO I=1, NQ
        IF(TEMP_QUESTIONS_USED(I).NE.I+Q1-1) THEN
           PRINT*, 'Bug in GET_QUESTIONS:'
           PRINT*, ALL_QUESTIONS_USED(1:NQ)
           PRINT*, ' '
           PRINT*, TEMP_QUESTIONS_USED(1:NQ)
           STOP
        END IF
     END DO
  END IF

  IF(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER).GT.1) THEN
     IF(.NOT.QUESTION_TITLE_FOUND) THEN
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIN
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT &
        !                             //CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
        !WRITE(ANSW_LUTION_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
        !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_END
     END IF

     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'In this big question of CHOOSE structure, ', &
         BIG_QUESTIONS(0,BIG_QUESTION_NUMBER), ' questions will be generated: '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
     DO I=1, BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)
        J=ALL_QUESTIONS_USED(I)
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)' ', I, '(',J, ',', QUESTION_POSITION(0,J), ')'
        IF(I.LT.BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)) WRITE(ANSW_LUTION_FILE_TUNNEL,*)','
        IF(I.EQ.BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)) WRITE(ANSW_LUTION_FILE_TUNNEL,*)'.'
     END DO
  END IF

  IF(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER).GT.1) THEN
     IF(.NOT.QUESTION_TITLE_FOUND) THEN
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_BEGIN
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT &
        !                              //CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
        !WRITE(JOURNAL_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,')'
        !WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_END
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'NO QUESTION TITLE FOUND.'
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
     END IF

     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'In this big question of CHOOSE structure, ', &
          BIG_QUESTIONS(0,BIG_QUESTION_NUMBER), ' questions will be generated: '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
     DO I=1, BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)
        J=ALL_QUESTIONS_USED(I)
        WRITE(JOURNAL_FILE_TUNNEL,*)' ', I, '(',J, ',', QUESTION_POSITION(0,J), ')'
        IF(I.LT.BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)) WRITE(JOURNAL_FILE_TUNNEL,*)','
        IF(I.EQ.BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)) WRITE(JOURNAL_FILE_TUNNEL,*)'.'
     END DO
  END IF

  RETURN
END SUBROUTINE GET_QUESTIONS




SUBROUTINE FIRST_PROCESSING(KEY)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  KEY
    INTEGER           ::  J, L
    IIIRRRCCC=0
    DOLLAR_NUMBER=0
    J=INDEX(THE_READ(1:THE_READ_LENGTH), KEY)
    IF(J.GT.1) THEN
    IF(THE_READ(1:J-1).NE.' ') THEN
        IF(SOLUTION_FOUND) THEN
           WRITE( ANSW_LUTION_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
           WRITE( SOLUTION_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
        ELSE IF(ANSWER_FOUND) THEN
           WRITE( ANSW_LUTION_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
           WRITE( ANSWER_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
           WRITE( SHORTEST_ANSWER_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
        ELSE
           WRITE( OUTPUT_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
        END IF
        WRITE(JOURNAL_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
    END IF
    END IF
    L=LEN(KEY)+J-1
    THE_READ(1:L)=' '
    CALL RESET_THE_READ()
   !IF(THE_READ(L:L).NE.' ') THEN
   !   PRINT*, 'Sorry, ',KEY, ' is followed by a non-empty character: ', L, &
   !           LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !   STOP
   !ELSE
   !END IF

    RETURN
END SUBROUTINE FIRST_PROCESSING




SUBROUTINE FIRST_PROCESSING0(KEY)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  KEY
    INTEGER           ::  J, L
    IIIRRRCCC=0
    DOLLAR_NUMBER=0
    J=INDEX(THE_READ(1:THE_READ_LENGTH), KEY)
    IF(J.GT.1) THEN
    IF(THE_READ(1:J-1).NE.' ') THEN
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
    END IF
    END IF
    L=LEN(KEY)+J-1
    THE_READ(1:L)=' '
    CALL RESET_THE_READ()
   !IF(THE_READ(L:L).NE.' ') THEN
   !   PRINT*, 'Sorry, ',KEY, ' is followed by a non-empty character: ', L, &
   !           LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !   STOP
   !ELSE
   !END IF

    RETURN
END SUBROUTINE FIRST_PROCESSING0




SUBROUTINE FIRST_PROCESSING_TEMP3(KEY)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  KEY
    INTEGER           ::  J, L
    IIIRRRCCC=0
    DOLLAR_NUMBER=0
    J=INDEX(THE_READ(1:THE_READ_LENGTH), KEY)
    IF(J.GT.1) THEN
    IF(THE_READ(1:J-1).NE.' ') THEN
        WRITE(TEMP3_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
        POINTER_TEMP3=POINTER_TEMP3+1
    END IF
    END IF

    L=LEN(KEY)+J-1
    THE_READ(1:L)=' '
    CALL RESET_THE_READ()
   !IF(THE_READ(L:L).NE.' ') THEN
   !   PRINT*, 'Sorry, ',KEY, ' is followed by a non-empty character: ',L,THE_READ(1:L),' ',THE_READ(L:L),&
   !           LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !   STOP
   !ELSE
   !END IF
    RETURN
END SUBROUTINE FIRST_PROCESSING_TEMP3




SUBROUTINE FIRST_PROCESSING11(KEY)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  KEY
    INTEGER           ::  J, L
    IIIRRRCCC=0
    DOLLAR_NUMBER=0
    J=INDEX(THE_READ(1:THE_READ_LENGTH), KEY)
    IF(J.GT.1) THEN
    IF(THE_READ(1:J-1).NE.' ') THEN
        WRITE( OUTPUT_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
        WRITE(JOURNAL_FILE_TUNNEL,'(A)') THE_READ(1:J-1)//' % '
    END IF
    END IF
    L=LEN(KEY)+J-1
    THE_READ(1:L)=' '
    CALL RESET_THE_READ()
   !IF(THE_READ(L:L).NE.' ') THEN
   !   PRINT*, 'Sorry, ',KEY, ' is followed by a non-empty character: ', L, &
   !           LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !   STOP
   !ELSE
   !END IF

    RETURN
END SUBROUTINE FIRST_PROCESSING11




SUBROUTINE READ_AN_INTEGER(FROM,TO,THE_INTEGER)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    INTEGER           ::  FROM,TO,THE_INTEGER,I,J,K,L,L6

    DO I=FROM, TO
       IF(THE_READ_WORK2(I:I).EQ.'$') THEN
          DOLLAR_NUMBER=DOLLAR_NUMBER+1
          THE_READ_WORK2(I:I)=' '
       END IF
    END DO

    K=-1
    DO I=FROM, TO
       AA=THE_READ_WORK2(I:I)
       L=IACHAR(AA)
       IF(AA.EQ.' ') THEN
       ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
          K=I
          L6=K
          EXIT
       ELSE
          PRINT*, 'Sorry, INTEGER expected (READ_AN_INTEGER) but : "'//THE_READ_WORK2(1:I)//'" found: ',I,&
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
       END IF
    END DO

    IF(K.LE.0) THEN
          PRINT*, 'Sorry, no INTEGER (READ_AN_INTEGER) found: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    IF(THE_READ_WORK2(K:K).EQ.'+') K=K+1
    IF(THE_READ_WORK2(K:K).EQ.'-') K=K+1

    J=-1
    THE_INTEGER=0
    DO I=K, TO
       AA=THE_READ_WORK2(I:I)
       L=IACHAR(AA)
       IF(AA.EQ.' ') THEN
          EXIT
       ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
          EXIT
       ELSE IF(AA.EQ.DATA_END_KEY) THEN
          EXIT
       ELSE IF((L.GE.48).AND.(L.LE.57)) THEN
          J=I
          THE_INTEGER=THE_INTEGER*10+L-48
       ELSE
          PRINT*, 'Sorry, numbers expected (READ_AN_INTEGER2) but : "'//AA//'" found: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
       END IF
    END DO

    IF(THE_READ_WORK2(L6:L6).EQ.'-') THE_INTEGER=THE_INTEGER*(-1)

    IF(J.LE.0) THEN
          PRINT*, 'Sorry, no INTEGER (READ_AN_INTEGER2) FOUND: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    RETURN

END SUBROUTINE READ_AN_INTEGER




SUBROUTINE READ_A_DOUBLE(FROM,TO,THE_DOUBLE,ACCURACY,NEW_FROM)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    DOUBLE PRECISION  ::  THE_DOUBLE
    INTEGER           ::  FROM,TO,ACCURACY,NEW_FROM,I,J,K,L,M,N,L1,L2,L3,L4,L5,L6,N2

    DO I=FROM, TO
       IF(THE_READ_WORK2(I:I).EQ.'$') THEN
          DOLLAR_NUMBER=DOLLAR_NUMBER+1
          THE_READ_WORK2(I:I)=' '
       END IF
    END DO

    K=-1
    DO I=FROM, TO
       AA=THE_READ_WORK2(I:I)
       L=IACHAR(AA)
       IF(AA.EQ.' ') THEN
       ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'.').OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
          K=I
          L6=K
          EXIT
       ELSE
          PRINT*, 'Sorry, DOUBLE expected (READ_A_DOUBLE) but : "'//THE_READ_WORK2(1:I)//'" found: ',I,&
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*, THE_READ_WORK2(FROM:TO)
          STOP
       END IF
    END DO

    IF(K.LE.0) THEN
          PRINT*, 'Sorry, no DOUBLE (READ_A_DOUBLE) found: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    IF(THE_READ_WORK2(K:K).EQ.'+') K=K+1
    IF(THE_READ_WORK2(K:K).EQ.'-') K=K+1
    J=-1
    DO I=K, TO
       AA=THE_READ_WORK2(I:I)
       L=IACHAR(AA)
       IF(AA.EQ.'.') THEN
          J=I
          EXIT
       ELSE IF((L.GE.48).AND.(L.LE.57)) THEN
       ELSE
          PRINT*, 'Sorry, DOUBLE expected (READ_A_DOUBLE2) but : "'//AA//'" found before ".": ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*, THE_READ_WORK2(FROM:TO)
          STOP
       END IF
    END DO

    IF(J.LE.0) THEN
          PRINT*, 'Sorry, no "." (READ_A_DOUBLE2) FOUND: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    M=J-K

    K=-1
    N=J
    N2=N
    NEW_FROM=J+1
    ACCURACY=0
    L3=0
    DO I=J+1, TO
       AA=THE_READ_WORK2(I:I)
       L=IACHAR(AA)
       IF(AA.EQ.' ') THEN
          N=I-1
          N2=N
          NEW_FROM=I
          ACCURACY=J+1-I
          EXIT
       ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
          N=I-1
          N2=N
          NEW_FROM=I
          ACCURACY=J+1-I
          EXIT
       ELSE IF(AA.EQ.DATA_END_KEY) THEN
          N=I-1
          N2=N
          NEW_FROM=I
          ACCURACY=J+1-I
          EXIT
       ELSE IF((L.GE.48).AND.(L.LE.57)) THEN
          K=I
          N=I
          N2=N
          NEW_FROM=I+1
          ACCURACY=J-I
       ELSE IF((AA.EQ.'d').OR.(AA.EQ.'D').OR.(AA.EQ.'e').OR.(AA.EQ.'E')) THEN
          ACCURACY=J+1-I
          L1=1
          L2=I+2
          IF(THE_READ_WORK2(I+1:I+1).EQ.'+') THEN
          ELSE IF(THE_READ_WORK2(I+1:I+1).EQ.'-') THEN
             L1=-1
          ELSE
             L2=I+1
          END IF
          N=-1
          DO L5=L2, TO
             AA=THE_READ_WORK2(L5:L5)
             L4=IACHAR(AA)
             IF((L4.GE.48).AND.(L4.LE.57)) THEN
                L3=L3*10+L4-48
                N=L5
                NEW_FROM=L5+1
             ELSE
                NEW_FROM=L5
                EXIT
             END IF
          END DO
          IF(N.LE.0) THEN
             PRINT*, 'Sorry, incomplete real (READ_A_DOUBLE4) found: ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          L3=L3*L1
          ACCURACY=ACCURACY+L3
          EXIT
       ELSE
          PRINT*, 'Sorry, DOUBLE expected (READ_A_DOUBLE3) but : "'//AA//'" found: ',  &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*, THE_READ_WORK2(FROM:TO)
          STOP
       END IF
    END DO

    IF(K.GT.0) THEN
    ELSE IF(M.LE.0) THEN
          PRINT*, 'Sorry, NO DIGITS FOR DOUBLE (READ_A_DOUBLE5): ',             &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    THE_DOUBLE=0.0D0
    DO I=N2, J+1, -1
       AA=THE_READ_WORK2(I:I)
       THE_DOUBLE=THE_DOUBLE+(IACHAR(AA)-48)*(10.0D0**(J-I))
    END DO
    DO I=1, M
       AA=THE_READ_WORK2(J-I:J-I)
       THE_DOUBLE=THE_DOUBLE+(IACHAR(AA)-48)*(10.0D0**(I-1))
    END DO
    THE_DOUBLE=THE_DOUBLE*(10.0D0**L3)
    IF(THE_READ_WORK2(L6:L6).EQ.'-') THE_DOUBLE=THE_DOUBLE*(-1.0D0)

   !THE_READ_WORK=' '
   !THE_READ_WORK_LENGTH=N-L6+3
   !THE_READ_WORK(1:THE_READ_WORK_LENGTH)=' '//THE_READ_WORK2(L6:N)//' '
   !CALL INTERNAL_READ_DOUBLE(1,THE_READ_WORK_LENGTH,THE_DOUBLE)

    RETURN

END SUBROUTINE READ_A_DOUBLE




SUBROUTINE INTERNAL_READ_DOUBLE(FROM,TO,THE_DOUBLE)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER          :: FROM, TO
    DOUBLE PRECISION :: THE_DOUBLE
    OPEN(TEMP1_FILE_TUNNEL, FILE=TEMP1_FILE)
         WRITE(TEMP1_FILE_TUNNEL,'(A)') THE_READ_WORK(FROM:TO)
         WRITE(TEMP1_FILE_TUNNEL,*)
         WRITE(TEMP1_FILE_TUNNEL,*)
    CLOSE(TEMP1_FILE_TUNNEL)
    OPEN(TEMP1_FILE_TUNNEL, FILE=TEMP1_FILE)
         READ(TEMP1_FILE_TUNNEL,*) THE_DOUBLE
    CLOSE(TEMP1_FILE_TUNNEL)
    RETURN
END SUBROUTINE INTERNAL_READ_DOUBLE




SUBROUTINE PRINT_A_PARAMETER(CP)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  I,J,CP,JJ,C

    IIIRRRCCC=0
    DOLLAR_NUMBER=0
    DATA_BEGIN_NUMBER=0
    THE_READ_WORK6=' '
    THE_READ_WORK6_LENGTH=MAX(0,CP-1)
    IF(THE_READ_WORK6_LENGTH.GE.1) THEN
       THE_READ_WORK6(1:THE_READ_WORK6_LENGTH)=THE_READ(1:THE_READ_WORK6_LENGTH)
    END IF
    THE_READ(1:CP-1+PRINT_PARAMETER_KEY_LENTH)=' '
    CALL RESET_THE_READ()
           !THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)

    CALL CHECK_AND_DELETE_S(DATA_BEGIN_KEY,C,JJ)
    CALL CHECK_AND_DELETE_S(DATA_END_KEY,  C,JJ)
    IF(JJ.NE.3) THEN
          PRINT*,'Sorry, illegal '//PRINT_PARAMETER_KEY//' struct: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    DO I=1,C
       IF(THE_READ_WORK2(I:I).NE.' ') THEN
          J=I
          EXIT
       END IF
    END DO

    IF(INDEX(THE_READ_WORK2(J:C), TOTAL_SUBPROBLEM_REQUIRED_KEY).GT.0) THEN
       IF(INSIDE_BIGQUESTION) THEN
          THE_READ_WORK2(J:TOTAL_SUBPROBLEM_REQUIRED_L+J-1)=' '
          CHAR_OF_INT6=INTEGER_TO_CHARACTER(BIG_QUESTIONS(6,BIG_QUESTION_NUMBER),CHAR_OF_INT6_LENGTH)
       ELSE
          PRINT*,'I am not in a question, then '//PRINT_PARAMETER_KEY//' with '//&
                TOTAL_SUBPROBLEM_REQUIRED_KEY//' argument is not good: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    ELSE IF(INDEX(THE_READ_WORK2(J:C), TOTAL_SUBPROBLEM_KEY).GT.0) THEN
       IF(INSIDE_BIGQUESTION) THEN
          THE_READ_WORK2(J:TOTAL_SUBPROBLEM_KEY_LENTH+J-1)=' '
          CHAR_OF_INT6=INTEGER_TO_CHARACTER(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER),CHAR_OF_INT6_LENGTH)
       ELSE
          PRINT*,'I am not in a question, then '//PRINT_PARAMETER_KEY//' with '//&
                TOTAL_SUBPROBLEM_KEY//' argument is not good: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    ELSE IF(INDEX(THE_READ_WORK2(J:C), TOTAL_PROBLEM_KEY).GT.0) THEN
       THE_READ_WORK2(J:TOTAL_PROBLEM_KEY_LENTH+J-1)=' '
       CHAR_OF_INT6=INTEGER_TO_CHARACTER(TOTAL_NUMBER_OF_BIG_QUESTIONS,CHAR_OF_INT6_LENGTH)

    ELSE IF(INDEX(THE_READ_WORK2(J:C), TOTAL_PAPER_KEY).GT.0) THEN
       THE_READ_WORK2(J:TOTAL_PAPER_KEY_LENTH+J-1)=' '
       CHAR_OF_INT6=INTEGER_TO_CHARACTER(TOTAL_NUMBER_OF_EXAMINEES,CHAR_OF_INT6_LENGTH)

    ELSE IF(INDEX(THE_READ_WORK2(J:C), GLOBAL_SUBPROBLEM_KEY).GT.0) THEN
       THE_READ_WORK2(J:GLOBAL_SUBPROBLEM_KEY_LENGTH+J-1)=' '
       CHAR_OF_INT6=INTEGER_TO_CHARACTER(TOTAL_ACTUAL_QUESTIONS,CHAR_OF_INT6_LENGTH)

    ELSE IF(INDEX(THE_READ_WORK2(J:C), GLOBAL_SUBPROBLEM_REQUIRED_KEY).GT.0) THEN
       THE_READ_WORK2(J:GLOBAL_SUBPROBLEM_REQUIRED_L+J-1)=' '
       CHAR_OF_INT6=INTEGER_TO_CHARACTER(TOTAL_QUESTIONS_TO_BE_ANSWERED,CHAR_OF_INT6_LENGTH)

    ELSE IF(INDEX(THE_READ_WORK2(J:C), SUBPROBLEM_KEY).GT.0) THEN
       IF(INSIDE_QUESTION.AND.INSIDE_SUBQUESTION) THEN
          THE_READ_WORK2(J:SUBPROBLEM_KEY_LENTH+J-1)=' '
          CHAR_OF_INT6=CHAR_OF_INT3
          CHAR_OF_INT6_LENGTH=CHAR_OF_INT3_LENGTH
       ELSE
          PRINT*,'I am not in a sub-question, then '//PRINT_PARAMETER_KEY//' with '//&
                SUBPROBLEM_KEY//' argument is not good: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    ELSE IF(INDEX(THE_READ_WORK2(J:C), PROBLEM_KEY).GT.0) THEN
       IF(INSIDE_BIGQUESTION) THEN
          THE_READ_WORK2(J:PROBLEM_KEY_LENTH+J-1)=' '
          CHAR_OF_INT6=CHAR_OF_INT2
          CHAR_OF_INT6_LENGTH=CHAR_OF_INT2_LENGTH
       ELSE
          PRINT*,'I am not in a question, then '//PRINT_PARAMETER_KEY//' with '//&
                PROBLEM_KEY//' argument is not good: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    ELSE IF(INDEX(THE_READ_WORK2(J:C), PAPER_KEY).GT.0) THEN
       THE_READ_WORK2(J:PAPER_KEY_LENTH+J-1)=' '
          CHAR_OF_INT6=INTEGER_TO_CHARACTER(EXAMINEE_NUMBER,CHAR_OF_INT6_LENGTH)

    ELSE
          PRINT*,'Sorry, illegal '//PRINT_PARAMETER_KEY//' struct: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    IF(THE_READ_WORK2(1:C).NE.' ') THEN
          PRINT*,'Sorry, illegal '//PRINT_PARAMETER_KEY//' struct: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK6_LENGTH+CHAR_OF_INT6_LENGTH+THE_READ_WORK2_LENGTH-C
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK6(1:THE_READ_WORK6_LENGTH)//&
            &CHAR_OF_INT6(1:CHAR_OF_INT6_LENGTH)//THE_READ_WORK2(C+1:THE_READ_WORK2_LENGTH)

    RETURN
END SUBROUTINE PRINT_A_PARAMETER




SUBROUTINE PRINT_AN_INPUT(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  AN_INPUT, ACCURACY, ACCURACY2, I, KK, L, JJ, K, NTL, KKK
    LOGICAL           ::  LT2
    DOUBLE PRECISION  ::  R
    DOUBLE COMPLEX    ::  C

    DATA_BEGIN_NUMBER=0

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(PRINT_IN_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(PRINT_IN_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(PRINT_IN_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(AN_INPUT)

    IF(AN_INPUT.LE.0) THEN
       PRINT*,' ILLEGAL input number ', AN_INPUT, ', ', INPUT_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_INPUT.GT.INPUT_NUMBER) THEN
       PRINT*,' No such an input number ', AN_INPUT, ', ', INPUT_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    SELECT CASE (INPUT_TYPE(AN_INPUT))

    CASE(I_TYPE)
       I=GENERATED_I(AN_INPUT)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+CHAR_OF_INT5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,':  '//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(R_TYPE)
       R=GENERATED_R(AN_INPUT)
       ACCURACY=INPUT_ACCURACY(1,AN_INPUT)
       CALL CONVERT_A_DOUBLE(R, ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK3_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,':  '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(V_TYPE)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=1
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)='('
       DO I=1, 3
          R=GENERATED_V(I,AN_INPUT)
          ACCURACY=INPUT_ACCURACY(I,AN_INPUT)
          CALL CONVERT_A_DOUBLE(R, ACCURACY)
          THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH)=&
                                                      THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH
          IF(I.NE.3) THEN
             THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+3)=' , '
             THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+3
          END IF
       END DO
       THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+2)=') '
       THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+2

       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,':  ', &
                            THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(C_TYPE)
       C=GENERATED_C(AN_INPUT)
       ACCURACY= INPUT_ACCURACY(1,AN_INPUT)
       ACCURACY2=INPUT_ACCURACY(2,AN_INPUT)
       CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,':  '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(L_TYPE)
       CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
       IF(JJ.EQ.3) THEN
          CALL RESET_THE_WORK2_2(K)
          L=GENERATED_I(AN_INPUT)
       ELSE IF(JJ.EQ.2) THEN
          DO JJ=1,K
          IF(THE_READ_WORK2(JJ:JJ).NE.' ') THEN
             PRINT*,'Sorry, UNACCEPTABLE CHARACTER IN LLL5 PRINT: ' &
                   ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
          END DO
          CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
          IF(JJ.EQ.3) THEN
             THE_READ_WORK3=' '
             THE_READ_WORK3=ADJUSTL(THE_READ_WORK2(1:K))
             IF(THE_READ_WORK3(1:NOT_KEY_LENTH).EQ.NOT_KEY) THEN
                IF(GENERATED_L(AN_INPUT)) THEN
                   L=GENERATED_POSITION(F_POST,AN_INPUT)
                ELSE
                   L=GENERATED_POSITION(T_POST,AN_INPUT)
                END IF
             ELSE IF(THE_READ_WORK3(1:TRUE_KEY_LENTH).EQ.TRUE_KEY) THEN
                L=GENERATED_POSITION(T_POST,AN_INPUT)
             ELSE IF(THE_READ_WORK3(1:FALSE_KEY_LENTH).EQ.FALSE_KEY) THEN
                L=GENERATED_POSITION(F_POST,AN_INPUT)
             ELSE
                PRINT*,'Sorry, ILLEGAL LOGICAL CONSTANT IN LLL4 PRINT: ' &
                      ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
                STOP
             END IF
             CALL RESET_THE_WORK2_2(K)
          ELSE
             PRINT*,'Sorry, '//DATA_END_KEY//' IS NOT FOUND IN LLL3 PRINT: ' &
                   ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       ELSE
          PRINT*,'Sorry, '//DATA_SEPARATE_KEY//' or '//DATA_END_KEY//' IS NOT FOUND IN LLL PRINT: ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
       END IF

       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(INPUT_SSS(L))
          THE_READ(1:THE_READ_LENGTH)=  &
              TRIM(INPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          IF(L.EQ.GENERATED_POSITION(T_POST,AN_INPUT)) THEN
             LT2=.TRUE.
          ELSE
             LT2=.FALSE.
          END IF
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,' $ ',LT2,': ', &
                                                                TRIM(INPUT_SSS(L))
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(S_TYPE)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          L=GENERATED_I(AN_INPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(INPUT_SSS(L))
          THE_READ(1:THE_READ_LENGTH)=  &
              TRIM(INPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,': ',L-GENERATED_POSITION(1,AN_INPUT)+1, &
                                  ' $ (',GENERATED_POSITION(2,AN_INPUT)-GENERATED_POSITION(1,AN_INPUT)+1, &
                                           ' strings): '//TRIM(INPUT_SSS(L))
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(I_MATRIX_TYPE, R_MATRIX_TYPE, C_MATRIX_TYPE, S_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL SWITCH_PRINTING_MATRIX(KKK,AN_INPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH
          THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.

          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-IN: $ ',AN_INPUT,'  $ :  '
             CALL PRINT_A_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_INPUT,NTL,2)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_IN_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE DEFAULT
       PRINT*,' A BUG INSIDE (PRINT_AN_INPUT), PLEASE REPORT: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    RETURN
END SUBROUTINE PRINT_AN_INPUT




SUBROUTINE PRINT_AN_INPUT4(TUNNEL, AN_INPUT,K2)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  AN_INPUT, ACCURACY, ACCURACY2, I, J, TUNNEL, L, NTL, K2
    DOUBLE PRECISION  ::  R
    DOUBLE COMPLEX    ::  C

    IF(AN_INPUT.LE.0) THEN
       PRINT*,' ILLEGAL4 input number ', AN_INPUT, ', ', INPUT_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_INPUT.GT.INPUT_NUMBER) THEN
       PRINT*,' No such4 an input number ', AN_INPUT, ', ', INPUT_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    WRITE(TUNNEL,'(A)')' '
    WRITE(TUNNEL,'(A)')' '
    SELECT CASE (INPUT_TYPE(AN_INPUT))

    CASE(I_TYPE)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & integer &  & $'
       DO J=1,3
          I=INPUT_III(J,AN_INPUT)
          CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
          WRITE(TUNNEL,*)CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)
          IF(J.NE.3) WRITE(TUNNEL,*)', '
       END DO
       I=GENERATED_I(AN_INPUT)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
       WRITE(TUNNEL,*)'$ & $ '//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//' $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(R_TYPE)
       ACCURACY=INPUT_ACCURACY(1,AN_INPUT)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & real & $ ', ACCURACY, ' $ & $'
       DO J=1,3
          R=INPUT_RRR(J,AN_INPUT)
          CALL CONVERT_A_DOUBLE(R, ACCURACY)
          WRITE(TUNNEL,*)THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          IF(J.NE.3) WRITE(TUNNEL,*)' $ & \\'
          IF(J.NE.3) WRITE(TUNNEL,*)' & & &  $'
       END DO
       R=GENERATED_R(AN_INPUT)
       CALL CONVERT_A_DOUBLE(R, ACCURACY)
       WRITE(TUNNEL,*)'$ & $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(V_TYPE)
       DO I=1, 3
          ACCURACY=INPUT_ACCURACY(I,AN_INPUT)
          DO J=1,3
             IF(I.EQ.1) THEN
                IF(J.EQ.1)  THEN
                   WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & vector & $ ', ACCURACY, ' $ & $'
                ELSE
                   WRITE(TUNNEL,*)' & & & $'
                END IF
             ELSE
                IF(J.EQ.1)  THEN
                   WRITE(TUNNEL,*)' & & $ ', ACCURACY, ' $ & $'
                ELSE
                   WRITE(TUNNEL,*)' & & & $'
                END IF
             END IF
             R=INPUT_VVV(J+(I-1)*3,AN_INPUT)
             CALL CONVERT_A_DOUBLE(R, ACCURACY)
             WRITE(TUNNEL,'(A)')THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
             IF(J.NE.3) WRITE(TUNNEL,*)' $ & \\'
          END DO
          R=GENERATED_V(I,AN_INPUT)
          CALL CONVERT_A_DOUBLE(R, ACCURACY)
          WRITE(TUNNEL,'(A)')'$ & $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
          IF(I.NE.3) WRITE(TUNNEL,*)' \\'
       END DO
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(C_TYPE)
       ACCURACY= INPUT_ACCURACY(1,AN_INPUT)
       ACCURACY2=INPUT_ACCURACY(2,AN_INPUT)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & complex & $ ', ACCURACY, ' , ', ACCURACY2, ' $ & $'
      !DO J=1,3
      !   C=INPUT_CCC(J,AN_INPUT)
      !   CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
      !   WRITE(TUNNEL,*)THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
      !   IF(J.NE.3) WRITE(TUNNEL,*)' $ & \\'
      !   IF(J.NE.3) WRITE(TUNNEL,*)' & & &  $'
      !END DO
      !C=GENERATED_C(AN_INPUT)
      !CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
      !WRITE(TUNNEL,*)'$ & $ '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '

       DO J=1,3
          C=INPUT_CCC(J,AN_INPUT)
          CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
          WRITE(TUNNEL,'(A)')THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
          WRITE(TUNNEL,*)' $ & \\'
          WRITE(TUNNEL,*)' & & &  $'
       END DO
       C=GENERATED_C(AN_INPUT)
       CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
       WRITE(TUNNEL,'(A)')' '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ & $ <-- $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(L_TYPE)
       L=GENERATED_I(AN_INPUT)
       DO I=GENERATED_POSITION(1,AN_INPUT),GENERATED_POSITION(2,AN_INPUT)
          IF(I.EQ.GENERATED_POSITION(1,AN_INPUT)) THEN
             WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & logical & .TRUE. & '
          ELSE
             WRITE(TUNNEL,*)' & & .FALSE. & '
          END IF
          WRITE(TUNNEL,*) TRIM(INPUT_SSS(I))//' & '
          IF(I.EQ.L)                       WRITE(TUNNEL,*) ' $ <-- $ '
          IF(I.NE.GENERATED_POSITION(2,AN_INPUT)) WRITE(TUNNEL,*) ' \\'
       END DO
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(S_TYPE)
       DO I=GENERATED_POSITION(1,AN_INPUT),GENERATED_POSITION(2,AN_INPUT)
          IF(I.EQ.GENERATED_POSITION(1,AN_INPUT)) THEN
             WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & string & & '
          ELSE
             WRITE(TUNNEL,*)' & & & '
          END IF
          WRITE(TUNNEL,*) TRIM(INPUT_SSS(I))//' & '
          IF(I.EQ.GENERATED_I(AN_INPUT))   WRITE(TUNNEL,*) ' $ <-- $ '
          IF(I.NE.GENERATED_POSITION(2,AN_INPUT)) WRITE(TUNNEL,*)' \\'
       END DO
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(I_MATRIX_TYPE)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & i-matrix &  & $'
       DO J=1,3
          I=INPUT_III(J,AN_INPUT)
          CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
          WRITE(TUNNEL,*)CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)
          IF(J.NE.3) WRITE(TUNNEL,*)', '
       END DO
       WRITE(TUNNEL,*)'$ & (size: ',GENERATED_M(AN_INPUT)%SIZES(1),' by ',GENERATED_M(AN_INPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_A_MATRIX(TUNNEL,AN_INPUT,NTL,2)
       K2=0

    CASE(R_MATRIX_TYPE)
       ACCURACY=INPUT_ACCURACY(1,AN_INPUT)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & r-matrix & $ ', ACCURACY, ' $ & $'
       DO J=1,3
          R=INPUT_RRR(J,AN_INPUT)
          CALL CONVERT_A_DOUBLE(R, ACCURACY)
          WRITE(TUNNEL,*)THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          IF(J.NE.3) WRITE(TUNNEL,*)' $ & \\'
          IF(J.NE.3) WRITE(TUNNEL,*)' & & &  $'
       END DO
       WRITE(TUNNEL,*)'$ & (size: ',GENERATED_M(AN_INPUT)%SIZES(1),' by ',GENERATED_M(AN_INPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_A_MATRIX(TUNNEL,AN_INPUT,NTL,2)
       K2=0

    CASE(C_MATRIX_TYPE)
       ACCURACY= INPUT_ACCURACY(1,AN_INPUT)
       ACCURACY2=INPUT_ACCURACY(2,AN_INPUT)
       WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & c-matrix & $ ', ACCURACY, ' , ', ACCURACY2, ' $ & $'
       DO J=1,3
          C=INPUT_CCC(J,AN_INPUT)
          CALL CONVERT_A_COMPLEX(C, ACCURACY, ACCURACY2)
          WRITE(TUNNEL,'(A)')THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
          IF(J.NE.3) WRITE(TUNNEL,*)' $ & \\'
          IF(J.NE.3) WRITE(TUNNEL,*)' & & &  $'
       END DO
       WRITE(TUNNEL,*)'$ & (size: ',GENERATED_M(AN_INPUT)%SIZES(1),' by ',GENERATED_M(AN_INPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_A_MATRIX(TUNNEL,AN_INPUT,NTL,2)
       K2=0

    CASE(S_MATRIX_TYPE)
       DO I=GENERATED_POSITION(1,AN_INPUT),GENERATED_POSITION(2,AN_INPUT)
          IF(I.EQ.GENERATED_POSITION(1,AN_INPUT)) THEN
             WRITE(TUNNEL,*)' INPUT $ ',AN_INPUT, '$ & s-matrix & & '
          ELSE
             WRITE(TUNNEL,*)' & & & '
          END IF
          WRITE(TUNNEL,'(A)') ' $ '//TRIM(INPUT_SSS(I))//' $ & '
          IF(I.NE.GENERATED_POSITION(2,AN_INPUT)) WRITE(TUNNEL,*)' \\'
       END DO
       WRITE(TUNNEL,*)' (size: ',GENERATED_M(AN_INPUT)%SIZES(1),' by ',GENERATED_M(AN_INPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_A_MATRIX(TUNNEL,AN_INPUT,NTL,2)
       K2=0

    CASE DEFAULT
       PRINT*,' A BUG INSIDE (PRINT_AN_INPUT4), PLEASE REPORT: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT


    RETURN
END SUBROUTINE PRINT_AN_INPUT4




SUBROUTINE PRINT_AN_OUTPUT(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    LOGICAL           ::  LT2
    INTEGER           ::  AN_OUTPUT, ANOTHER_INTEGER, ACCURACY, ACCURACY2, I, KK, L, K, JJ, NTL, KKK
    DOUBLE PRECISION  ::  R
    DOUBLE COMPLEX    ::  C

    DATA_BEGIN_NUMBER=0

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(PRINT_OUT_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(PRINT_OUT_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(PRINT_OUT_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(AN_OUTPUT)
    ANOTHER_INTEGER=0
   !CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
   !CALL GET_AN_INTEGER(ANOTHER_INTEGER)
    CALL SOLVE_THE_QUESTION(AN_OUTPUT,ANOTHER_INTEGER)

    IF(AN_OUTPUT.LE.0) THEN
       PRINT*,' ILLEGAL OUTPUT number ', AN_OUTPUT, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_OUTPUT.GT.CALCULATED_NUMBER) THEN
       PRINT*,' No such an OUTPUT number ', AN_OUTPUT, ', ', CALCULATED_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    SELECT CASE (CALCULATED_TYPE(AN_OUTPUT))

    CASE(I_TYPE)
       I=CALCULATED_I(AN_OUTPUT)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL CHECK_AND_DELETE(DATA_END_KEY)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+CHAR_OF_INT5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,&
                                          ':  '//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(R_TYPE)
       R=CALCULATED_R(AN_OUTPUT)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL CHECK_AND_DELETE(DATA_END_KEY)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK3_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,&
                          ', ',ACCURACY,':  '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(V_TYPE)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=1
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)='('
       DO I=1, 3
          R=CALCULATED_V(I,AN_OUTPUT)
          CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
          CALL GET_AN_INTEGER(ACCURACY)
          IF(ACCURACY.LE.0) THEN
             PRINT*,'Sorry, the ACCURACY is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          CALCULATED_ACCURACY(I,AN_OUTPUT)=ACCURACY
          CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
          THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH)=&
                                                      THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH
          IF(I.NE.3) THEN
             THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+3)=' , '
             THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+3
          END IF
       END DO
       THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+2)=') '
       THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+2

       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,&
                                          ', ',CALCULATED_ACCURACY(1,AN_OUTPUT),&
                                          ', ',CALCULATED_ACCURACY(2,AN_OUTPUT),&
                                          ', ',CALCULATED_ACCURACY(3,AN_OUTPUT),&
                                          ':  '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(C_TYPE)
       C=CALCULATED_C(AN_OUTPUT)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY2)
       IF(ACCURACY2.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY2 is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY2, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALCULATED_ACCURACY(2,AN_OUTPUT)=ACCURACY2
       CALL CONVERT_A_COMPLEX_DIFS(C, ACCURACY, ACCURACY2)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL CHECK_AND_DELETE(DATA_END_KEY)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,&
                ', ',ACCURACY,', ',ACCURACY2,':  '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(L_TYPE)
       CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
       IF(JJ.EQ.3) THEN
          CALL RESET_THE_WORK2_2(K)
          IF(CALCULATED_L(AN_OUTPUT)) THEN
             L=CALCULATED_POSITION(T_POST,AN_OUTPUT)
          ELSE
             L=CALCULATED_POSITION(F_POST,AN_OUTPUT)
          END IF
       ELSE IF(JJ.EQ.2) THEN
          DO JJ=1,K
          IF(THE_READ_WORK2(JJ:JJ).NE.' ') THEN
             PRINT*,'Sorry, UNACCEPTABLE CHARACTER IN LLL5 PRINT-OUT: ' &
                   ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
          END DO
          CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
          IF(JJ.EQ.3) THEN
             THE_READ_WORK3=' '
             THE_READ_WORK3=ADJUSTL(THE_READ_WORK2(1:K))
             IF(THE_READ_WORK3(1:NOT_KEY_LENTH).EQ.NOT_KEY) THEN
                IF(CALCULATED_L(AN_OUTPUT)) THEN
                   L=CALCULATED_POSITION(F_POST,AN_OUTPUT)
                ELSE
                   L=CALCULATED_POSITION(T_POST,AN_OUTPUT)
                END IF
             ELSE IF(THE_READ_WORK3(1:TRUE_KEY_LENTH).EQ.TRUE_KEY) THEN
                L=CALCULATED_POSITION(T_POST,AN_OUTPUT)
             ELSE IF(THE_READ_WORK3(1:FALSE_KEY_LENTH).EQ.FALSE_KEY) THEN
                L=CALCULATED_POSITION(F_POST,AN_OUTPUT)
             ELSE
                PRINT*,'Sorry, ILLEGAL LOGICAL CONSTANT IN LLL4 PRINT-OUT: ' &
                      ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
                STOP
             END IF
             CALL RESET_THE_WORK2_2(K)
          ELSE
             PRINT*,'Sorry, '//DATA_END_KEY//' IS NOT FOUND IN LLL3 PRINT-OUT: ' &
                   ,JJ,LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       ELSE
          PRINT*,'Sorry, '//DATA_SEPARATE_KEY//' or '//DATA_END_KEY//' IS NOT FOUND IN LLL PRINT-OUT: ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
       END IF

       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(OUTPUT_SSS(L))
          THE_READ(1:THE_READ_LENGTH)=  &
              TRIM(OUTPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          IF(L.EQ.CALCULATED_POSITION(T_POST,AN_OUTPUT)) THEN
             LT2=.TRUE.
          ELSE
             LT2=.FALSE.
          END IF
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,' $ ',LT2,': ', &
                                                                TRIM(OUTPUT_SSS(L))
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(S_TYPE)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          L=CALCULATED_I(AN_OUTPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(OUTPUT_SSS(L))
          THE_READ(1:THE_READ_LENGTH)=  &
              TRIM(OUTPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,': ',L-CALCULATED_POSITION(1,AN_OUTPUT)+1,&
                 ' $ ( $ ', CALCULATED_POSITION(2,AN_OUTPUT)-CALCULATED_POSITION(1,AN_OUTPUT)+1, &
                 ' $ strings): '//TRIM(OUTPUT_SSS(L))
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(I_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL SWITCH_PRINTING_OUT_MATRIX(KKK,AN_OUTPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH
          THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.

          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT,'  $ :  '
             CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,2)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(R_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL SWITCH_PRINTING_OUT_MATRIX(KKK,AN_OUTPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH
          THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.

          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT, '(',ACCURACY,') $ :  '
             CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,2)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(C_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY2)
       IF(ACCURACY2.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY2 is not acceptable in '//PRINT_OUT_KEY//' region: ', ACCURACY2, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALCULATED_ACCURACY(2,AN_OUTPUT)=ACCURACY2
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL SWITCH_PRINTING_OUT_MATRIX(KKK,AN_OUTPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH
          THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.

          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT, '(',ACCURACY,',',ACCURACY2,') $ :'
             CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,2)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE(S_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          CALL SWITCH_PRINTING_OUT_MATRIX(KKK,AN_OUTPUT)
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH
          THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
          IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,*)' PRINT-OUT: $ ',AN_OUTPUT, ' $ :'
             CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,2)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//PRINT_OUT_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    CASE DEFAULT
       PRINT*,' UNDEFINED CALCULATED DATA TYPE (PRINT_AN_OUTPUT): ',CALCULATED_TYPE(AN_OUTPUT), AN_OUTPUT,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    RETURN
END SUBROUTINE PRINT_AN_OUTPUT




SUBROUTINE PRINT_AN_OUTPUT4(TUNNEL, AN_OUTPUT, K2)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  AN_OUTPUT, TUNNEL, ACCURACY, ACCURACY2, I, L, NTL, K2
    DOUBLE PRECISION  ::  R
    DOUBLE COMPLEX    ::  C

    IF(AN_OUTPUT.LE.0) THEN
       PRINT*,' ILLEGAL OUTPUT number ', AN_OUTPUT, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_OUTPUT.GT.CALCULATED_NUMBER) THEN
       PRINT*,' No such an OUTPUT number ', AN_OUTPUT, ', ', CALCULATED_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    WRITE(TUNNEL,'(A)')' '
    WRITE(TUNNEL,'(A)')' '
    SELECT CASE (CALCULATED_TYPE(AN_OUTPUT))

    CASE(I_TYPE)
       I=CALCULATED_I(AN_OUTPUT)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & integer &  & '
       WRITE(TUNNEL,*)' $ '//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//' $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(R_TYPE)
       R=CALCULATED_R(AN_OUTPUT)
       ACCURACY=CALCULATED_ACCURACY(1,AN_OUTPUT)
       CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & real & $ ', ACCURACY, ' $ & '
       WRITE(TUNNEL,'(A)')' $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(V_TYPE)
       DO I=1, 3
          R=CALCULATED_V(I,AN_OUTPUT)
          ACCURACY=CALCULATED_ACCURACY(I,AN_OUTPUT)
          CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
          IF(I.EQ.1) THEN
             WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & vector &  '
          ELSE
             WRITE(TUNNEL,*)' & & '
          END IF
          WRITE(TUNNEL,*)' $ ', CALCULATED_ACCURACY(I,AN_OUTPUT), ' $ '
          WRITE(TUNNEL,'(A)')' &  $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
          IF(I.LT.3) THEN
             WRITE(TUNNEL,'(A)')' \\    '
          END IF
       END DO
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(C_TYPE)
       C=CALCULATED_C(AN_OUTPUT)
       ACCURACY= CALCULATED_ACCURACY(1,AN_OUTPUT)
       ACCURACY2=CALCULATED_ACCURACY(2,AN_OUTPUT)
       CALL CONVERT_A_COMPLEX_DIFS(C, ACCURACY, ACCURACY2)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & complex & $ ', ACCURACY, ' , ', ACCURACY2, ' $ & '
       WRITE(TUNNEL,'(A)')' $ '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ '
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(L_TYPE)
       IF(CALCULATED_L(AN_OUTPUT)) THEN
          L=CALCULATED_POSITION(T_POST,AN_OUTPUT)
       ELSE
          L=CALCULATED_POSITION(F_POST,AN_OUTPUT)
       END IF
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & logical &  ', CALCULATED_L(AN_OUTPUT), ' & '
       WRITE(TUNNEL,'(A)')TRIM(OUTPUT_SSS(L))
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(S_TYPE)
       L=CALCULATED_I(AN_OUTPUT)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & string & $ ', L-CALCULATED_POSITION(1,AN_OUTPUT)+1,&
             ' $ ( $', CALCULATED_POSITION(2,AN_OUTPUT)-CALCULATED_POSITION(1,AN_OUTPUT)+1,' $ strings): '
       WRITE(TUNNEL,'(A)')' & '//TRIM(OUTPUT_SSS(L))
       WRITE(TUNNEL,'(A)')' \\  \hline  '

    CASE(I_MATRIX_TYPE)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & i-matrix &  & '
       WRITE(TUNNEL,*)'(size: ',CALCULATED_M(AN_OUTPUT)%SIZES(1),' by ',CALCULATED_M(AN_OUTPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_AN_OUT_MATRIX(TUNNEL,AN_OUTPUT,NTL,2)
       K2=0

    CASE(R_MATRIX_TYPE)
       ACCURACY=CALCULATED_ACCURACY(1,AN_OUTPUT)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & r-matrix &  $ ', ACCURACY, ' $ & '
       WRITE(TUNNEL,*)'(size: ',CALCULATED_M(AN_OUTPUT)%SIZES(1),' by ',CALCULATED_M(AN_OUTPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_AN_OUT_MATRIX(TUNNEL,AN_OUTPUT,NTL,2)
       K2=0

    CASE(C_MATRIX_TYPE)
       ACCURACY= CALCULATED_ACCURACY(1,AN_OUTPUT)
       ACCURACY2=CALCULATED_ACCURACY(2,AN_OUTPUT)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & c-matrix & $ ', ACCURACY, ' , ', ACCURACY2, ' $ & '
       WRITE(TUNNEL,*)'(size: ',CALCULATED_M(AN_OUTPUT)%SIZES(1),' by ',CALCULATED_M(AN_OUTPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_AN_OUT_MATRIX(TUNNEL,AN_OUTPUT,NTL,2)
       K2=0

    CASE(S_MATRIX_TYPE)
       WRITE(TUNNEL,*)' Calculated $ ',AN_OUTPUT, '$ & s-matrix & & '
       WRITE(TUNNEL,*)'(size: ',CALCULATED_M(AN_OUTPUT)%SIZES(1),' by ',CALCULATED_M(AN_OUTPUT)%SIZES(2),')'
       WRITE(TUNNEL,'(A)')' \\  \hline  '
       WRITE(TUNNEL,*)'\end{tabular}'
       WRITE(TUNNEL,*)'  '
       WRITE(TUNNEL,*)'  '
       CALL PRINT_AN_OUT_MATRIX(TUNNEL,AN_OUTPUT,NTL,2)
       K2=0

    CASE DEFAULT
       PRINT*,' UNDEFINED CALCULATED DATA TYPE (PRINT_AN_OUTPUT4): ',CALCULATED_TYPE(AN_OUTPUT), AN_OUTPUT,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    RETURN
END SUBROUTINE PRINT_AN_OUTPUT4




SUBROUTINE PRINT_AUTO_ANSWER(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  AAW, KK, I

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(PRINT_AUTO_ANSWER_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(PRINT_AUTO_ANSWER_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(PRINT_AUTO_ANSWER_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(AAW)
    CALL CHECK_AND_DELETE(DATA_END_KEY)
    IF(AAW.LE.0) THEN
       PRINT*,' ILLEGAL auto-answer number ', AAW, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AAW.GT.TOTAL_NUMBER_OF_AUTO_ANSWERS) THEN
       PRINT*,' No such an auto-answer number ', AAW, ', ', TOTAL_NUMBER_OF_AUTO_ANSWERS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(INSIDE_QUESTION) THEN
       IF(SOLUTION_FOUND) THEN
       ELSE IF(ANSWER_FOUND) THEN
       ELSE
          PRINT*, PRINT_AUTO_ANSWER_KEY//' struct must be in a solution/answer region: ', &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    ELSE
       PRINT*, PRINT_AUTO_ANSWER_KEY//' struct must be in a question: ', &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
    ELSE
       PRINT*,'ILLEGAL number of $s ', DOLLAR_NUMBER
       PRINT*,'in a '//PRINT_AUTO_ANSWER_KEY//': ', &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE)
    DO I=1, AUTO_ANSWER_INDEX(2, AAW)
        THE_READ_WORK7=' '
        READ(AUTO_TEMP_FILE_TUNNEL,'(A)', END=100) THE_READ_WORK7
        IF(I.GE.AUTO_ANSWER_INDEX(1, AAW)) THEN
           THE_READ_WORK7_LENGTH=LEN_TRIM(THE_READ_WORK7)
           IF(THE_READ_WORK7_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_PL) THEN
              PRINT*, 'Sorry, too long line in the temp auto-answer file, please report: ', &
                       THE_READ_WORK7_LENGTH, MAX_NUMBER_OF_CHARACTERS_PL, LINE_NUMBER
              STOP
           END IF
           WRITE(ANSW_LUTION_FILE_TUNNEL, '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
           WRITE(JOURNAL_FILE_TUNNEL,     '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
           IF(SOLUTION_FOUND) THEN
              WRITE(SOLUTION_FILE_TUNNEL, '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
           ELSE IF(ANSWER_FOUND) THEN
              WRITE(ANSWER_FILE_TUNNEL,   '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
           END IF
        END IF
    END DO
    CLOSE(AUTO_TEMP_FILE_TUNNEL)

    IF(ANSWER_FOUND) THEN
    OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE)
    DO I=1, AUTO_ANSWER_INDEX(4, AAW)
        THE_READ_WORK7=' '
        READ(AUTO_TEMP_FILE_TUNNEL,'(A)', END=100) THE_READ_WORK7
        IF(I.GE.AUTO_ANSWER_INDEX(3, AAW)) THEN
           THE_READ_WORK7_LENGTH=LEN_TRIM(THE_READ_WORK7)
           IF(THE_READ_WORK7_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_PL) THEN
              PRINT*, 'Sorry, too long line in the temp auto-answer file, please report: ', &
                       THE_READ_WORK7_LENGTH, MAX_NUMBER_OF_CHARACTERS_PL, LINE_NUMBER
              STOP
           END IF
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL, '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
        END IF
    END DO
    CLOSE(AUTO_TEMP_FILE_TUNNEL)
    END IF

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)

    RETURN
    100 PRINT*, 'A bug is here in "PRINT_AUTO_ANSWER", please report: ', &
                 LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    STOP
END SUBROUTINE PRINT_AUTO_ANSWER




SUBROUTINE SET_ACCURARY(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  AN_OUTPUT, ACCURACY, ACCURACY2, KK, I
   !INTEGER           ::  ANOTHER_INTEGER
   !DOUBLE PRECISION  ::  R
   !DOUBLE COMPLEX    ::  C

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(SET_ACCURACY_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(SET_ACCURACY_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(SET_ACCURACY_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(AN_OUTPUT)
   !CALL GET_AN_INTEGER(ANOTHER_INTEGER)

    IF(AN_OUTPUT.LE.0) THEN
       PRINT*,' ILLEGAL OUTPUT number ', AN_OUTPUT, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_OUTPUT.GT.CALCULATED_NUMBER) THEN
       PRINT*,' No such an OUTPUT number ', AN_OUTPUT, ', ', CALCULATED_NUMBER, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    SELECT CASE (CALCULATED_TYPE(AN_OUTPUT))

    CASE(I_TYPE)
          PRINT*,'Sorry, YOU CAN NOT SET ACCURACY FOR AN INTEGER: ', AN_OUTPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

    CASE(R_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ACCURACY SET: $ ', AN_OUTPUT, ' : ', ACCURACY, ' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       END IF
       END IF

    CASE(V_TYPE)
       DO I=1,3
          CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
          CALL GET_AN_INTEGER(ACCURACY)
          IF(ACCURACY.LE.0) THEN
             PRINT*,'Sorry, the ACCURACY is not acceptable in '//SET_ACCURACY_KEY//' region: ',ACCURACY,&
                   LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          CALCULATED_ACCURACY(I,AN_OUTPUT)=ACCURACY
       END DO
       IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ACCURACY SET: $ ', AN_OUTPUT, ' : (', &
                                               CALCULATED_ACCURACY(1,AN_OUTPUT)
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)', ',CALCULATED_ACCURACY(2,AN_OUTPUT)
          WRITE(ANSW_LUTION_FILE_TUNNEL,*)', ',CALCULATED_ACCURACY(3,AN_OUTPUT), ') $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       END IF
       END IF

    CASE(C_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY2)
       IF(ACCURACY2.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY2 is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY2, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALCULATED_ACCURACY(2,AN_OUTPUT)=ACCURACY2
       IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ACCURACY SET: $ ', AN_OUTPUT, ' : (', ACCURACY, ACCURACY2, ') $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       END IF
       END IF

    CASE(L_TYPE)
          PRINT*,'Sorry, YOU CAN NOT SET ACCURACY FOR A LOGICAL: ', AN_OUTPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

    CASE(S_TYPE)
          PRINT*,'Sorry, YOU CAN NOT SET ACCURACY FOR A STRING: ', AN_OUTPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

    CASE(I_MATRIX_TYPE)
          PRINT*,'Sorry, YOU CAN NOT SET ACCURACY FOR AN INTEGER MATRIX: ', AN_OUTPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

    CASE(R_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ACCURACY SET: $ ', AN_OUTPUT, ' : ', ACCURACY, ' $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       END IF
       END IF

    CASE(C_MATRIX_TYPE)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY2)
       IF(ACCURACY2.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY2 is not acceptable in '//SET_ACCURACY_KEY//' region: ', ACCURACY2, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       CALCULATED_ACCURACY(1,AN_OUTPUT)=ACCURACY
       CALCULATED_ACCURACY(2,AN_OUTPUT)=ACCURACY2
       IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ACCURACY SET: $ ', AN_OUTPUT, ' : (', ACCURACY, ACCURACY2, ') $ '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       END IF
       END IF

    CASE(S_MATRIX_TYPE)
          PRINT*,'Sorry, YOU CAN NOT SET ACCURACY FOR A STRING: ', AN_OUTPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

    CASE DEFAULT
       PRINT*,' UNDEFINED CALCULATED DATA TYPE (SET_ACCURARY): ',CALCULATED_TYPE(AN_OUTPUT), AN_OUTPUT,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT
    CALL CHECK_AND_DELETE(DATA_END_KEY)

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)

    RETURN
END SUBROUTINE SET_ACCURARY




SUBROUTINE GET_TRIPLE_INTEGERS(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  D1,D2,D3,KK

    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=I_TYPE

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(INTEGER_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(INTEGER_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(INTEGER_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_NO_PRINTING_AND_ENDS()

    IF(IIIRRRCCC.EQ.3) THEN
       D1=INPUT_III(1,INPUT_NUMBER)
       D2=INPUT_III(2,INPUT_NUMBER)
       D3=INPUT_III(3,INPUT_NUMBER)
       GENERATED_I(INPUT_NUMBER)=A_STEPPED_RAN_INTEGER(D1,D2,D3)
       D1=GENERATED_I(INPUT_NUMBER)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(D1,CHAR_OF_INT5_LENGTH)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+CHAR_OF_INT5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: $ ', INPUT_NUMBER, &
                               ' $ : $ '//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//' $ ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//INTEGER_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_TRIPLE_INTEGERS




SUBROUTINE GET_AN_INTEGER(THE_OBTAINED_INTEGER)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    INTEGER           ::  D1,THE_OBTAINED_INTEGER
    INTEGER           ::  I,J,K,L
    IIIRRRCCC=IIIRRRCCC+1
    FIND_EB: DO

       J=-1
       DO I=1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          L=IACHAR(AA)
          IF(AA.EQ.' ') THEN
          ELSE IF(AA.EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
             J=I
             EXIT FIND_EB
          ELSE
             PRINT*, 'Sorry, numbers expected (GET_AN_INTEGER) but : "'//AA//'" found: ',    &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (GET_AN_INTEGER): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, AN INTEGER expected but not found in the input file: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no INTEGER found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    K=THE_READ_WORK2_LENGTH
    DO I=J+1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          IF(AA.EQ.' ') THEN
             K=I
             EXIT
          ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.'$') THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.DATA_END_KEY) THEN
             K=I-1
             EXIT
          END IF
    END DO

    CALL READ_AN_INTEGER(J,K,D1)
    THE_OBTAINED_INTEGER=D1

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE GET_AN_INTEGER




SUBROUTINE GET_INTEGER_MATRIX(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  KK,KKK,D1,D2,D3,K1,K2

    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=I_MATRIX_TYPE

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(INTEGER_MATRIX_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(INTEGER_MATRIX_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(INTEGER_MATRIX_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL OPTIONAL_MATRIX_BEFORE_INTEGER(K1,K2)
    GENERATED_M(INPUT_NUMBER)%BRACE_INDEX=K2
    CALL GET_AN_INTEGER(D1)
    GENERATED_M(INPUT_NUMBER)%SIZES(1)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(D1)
    GENERATED_M(INPUT_NUMBER)%SIZES(2)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    IIIRRRCCC=0
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(D1)
    INPUT_III(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_NO_PRINTING_AND_ENDS()

    IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
    ELSE
       PRINT*,'Sorry, odd number of "$"s detected in a '//INTEGER_MATRIX_KEY//' region: ', &
          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    ALLOCATE(GENERATED_M(INPUT_NUMBER)%INTEGER_M(GENERATED_M(INPUT_NUMBER)%SIZES(1),&
                                                &GENERATED_M(INPUT_NUMBER)%SIZES(2)))
    D1=INPUT_III(1,INPUT_NUMBER)
    D2=INPUT_III(2,INPUT_NUMBER)
    D3=INPUT_III(3,INPUT_NUMBER)

    DO  K2=1, GENERATED_M(INPUT_NUMBER)%SIZES(2)
    DO  K1=1, GENERATED_M(INPUT_NUMBER)%SIZES(1)
        GENERATED_M(INPUT_NUMBER)%INTEGER_M(K1,K2)=A_STEPPED_RAN_INTEGER(D1,D2,D3)
    END DO
    END DO

    CALL GET_MATRIX_TAIL(KKK)

    RETURN
END SUBROUTINE GET_INTEGER_MATRIX




SUBROUTINE PRINT_A_MATRIX(TUNNEL,AN_INPUT,NTL,KKKK)
    USE BASE_DATA
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  TUNNEL,AN_INPUT,K1,K2,NTL,KKKK,KP
    INTEGER           ::  ACCURACY,ACCURACY1,ACCURACY2

    NTL=0

    IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) RETURN

    KP=GENERATED_M(AN_INPUT)%BRACE_INDEX
    IF(KP.EQ.MATRIX_DATA_ONLY) THEN
       IF(KKKK.EQ.0) THEN
       ELSE
          WRITE(TUNNEL,*)'$\begin{array}{'
          DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(2)
              WRITE(TUNNEL,*)'c'
          END DO
          WRITE(TUNNEL,*)'}'
          NTL=NTL+GENERATED_M(AN_INPUT)%SIZES(2)+2
       END IF
    ELSE
       IF(KKKK.EQ.0) THEN
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_BEGIN(KP))
       ELSE
          WRITE(TUNNEL,'(A)')' $ '//TRIM(MATRIX_BRACES_BEGIN(KP))
       END IF
       NTL=NTL+1
       IF((KP.GE.MATRIX_BRACE_ARRAY_FROM).AND.(KP.LE.MATRIX_BRACE_ARRAY_TO)) THEN
          WRITE(TUNNEL,*)'{'
          DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(2)
              WRITE(TUNNEL,*)'c'
          END DO
          WRITE(TUNNEL,*)'}'
          NTL=NTL+GENERATED_M(AN_INPUT)%SIZES(2)+2
       END IF
    END IF

    SELECT CASE (INPUT_TYPE(AN_INPUT))

    CASE(I_MATRIX_TYPE)
        DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(1)
        DO  K2=1, GENERATED_M(AN_INPUT)%SIZES(2)
           !CHAR_OF_INT5=INTEGER_TO_CHARACTER(GENERATED_M(AN_INPUT)%INTEGER_M(K1,K2),CHAR_OF_INT5_LENGTH)
            IF(K2.LT.GENERATED_M(AN_INPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,*) GENERATED_M(AN_INPUT)%INTEGER_M(K1,K2),' & '
            ELSE
               IF(K1.LT.GENERATED_M(AN_INPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,*) GENERATED_M(AN_INPUT)%INTEGER_M(K1,K2),' \\ '
               ELSE
                  WRITE(TUNNEL,*) GENERATED_M(AN_INPUT)%INTEGER_M(K1,K2)
               END IF
            END IF
        END DO
        END DO

    CASE(R_MATRIX_TYPE)
        ACCURACY=INPUT_ACCURACY(1,AN_INPUT)
        DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(1)
        DO  K2=1, GENERATED_M(AN_INPUT)%SIZES(2)
            CALL CONVERT_A_DOUBLE(GENERATED_M(AN_INPUT)%REAL_M(K1,K2), ACCURACY)
            IF(K2.LT.GENERATED_M(AN_INPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),' & '
            ELSE
               IF(K1.LT.GENERATED_M(AN_INPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),' \\ '
               ELSE
                  WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
               END IF
            END IF
        END DO
        END DO

    CASE(C_MATRIX_TYPE)
        ACCURACY1=INPUT_ACCURACY(1,AN_INPUT)
        ACCURACY2=INPUT_ACCURACY(2,AN_INPUT)
        DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(1)
        DO  K2=1, GENERATED_M(AN_INPUT)%SIZES(2)
            CALL CONVERT_A_COMPLEX(GENERATED_M(AN_INPUT)%COMPLEX_M(K1,K2), ACCURACY1, ACCURACY2)
            IF(K2.LT.GENERATED_M(AN_INPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' & '
            ELSE
               IF(K1.LT.GENERATED_M(AN_INPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' \\ '
               ELSE
                  WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
               END IF
            END IF
        END DO
        END DO

    CASE(S_MATRIX_TYPE)
        DO  K1=1, GENERATED_M(AN_INPUT)%SIZES(1)
        DO  K2=1, GENERATED_M(AN_INPUT)%SIZES(2)
            IF(K2.LT.GENERATED_M(AN_INPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,'(A)') TRIM(GENERATED_M(AN_INPUT)%STRING_M(K1,K2))//' & '
            ELSE
               IF(K1.LT.GENERATED_M(AN_INPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,'(A)') TRIM(GENERATED_M(AN_INPUT)%STRING_M(K1,K2))//' \\ '
               ELSE
                  WRITE(TUNNEL,'(A)') TRIM(GENERATED_M(AN_INPUT)%STRING_M(K1,K2))
               END IF
            END IF
        END DO
        END DO

    CASE DEFAULT
       PRINT*,' A BUG INSIDE (PRINT_A_MATRIX), PLEASE REPORT: ',AN_INPUT,INPUT_TYPE(AN_INPUT), &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    NTL=NTL+GENERATED_M(AN_INPUT)%SIZES(1)*GENERATED_M(AN_INPUT)%SIZES(2)

    IF(KP.EQ.MATRIX_DATA_ONLY) THEN
       IF(KKKK.EQ.0) THEN
       ELSE
          WRITE(TUNNEL,'(A)')'\end{array}  $ '
          NTL=NTL+1
       END IF
    ELSE
       IF(KKKK.EQ.0) THEN
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_END(KP))
       ELSE
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_END(KP))//' $ '
       END IF
       NTL=NTL+1
    END IF

    RETURN
END SUBROUTINE PRINT_A_MATRIX




SUBROUTINE PRINT_AN_OUT_MATRIX(TUNNEL,AN_OUTPUT,NTL,KKKK)
    USE BASE_DATA
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  TUNNEL,AN_OUTPUT,K1,K2,NTL,KKKK,KP
    INTEGER           ::  ACCURACY,ACCURACY1,ACCURACY2

    NTL=0

    KP=CALCULATED_M(AN_OUTPUT)%BRACE_INDEX
    IF(KP.EQ.MATRIX_DATA_ONLY) THEN
       IF(KKKK.EQ.0) THEN
       ELSE
          WRITE(TUNNEL,'(A)')'$\begin{array}{'
          DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
              WRITE(TUNNEL,*)'c'
          END DO
          WRITE(TUNNEL,*)'}'
          NTL=NTL+CALCULATED_M(AN_OUTPUT)%SIZES(2)+2
       END IF
    ELSE
       IF(KKKK.EQ.0) THEN
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_BEGIN(KP))
       ELSE
          WRITE(TUNNEL,'(A)')' $ '//TRIM(MATRIX_BRACES_BEGIN(KP))
       END IF
       NTL=NTL+1
       IF((KP.GE.MATRIX_BRACE_ARRAY_FROM).AND.(KP.LE.MATRIX_BRACE_ARRAY_TO)) THEN
          WRITE(TUNNEL,*)'{'
          DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
              WRITE(TUNNEL,*)'c'
          END DO
          WRITE(TUNNEL,*)'}'
          NTL=NTL+CALCULATED_M(AN_OUTPUT)%SIZES(2)+2
       END IF
    END IF

    SELECT CASE (CALCULATED_TYPE(AN_OUTPUT))

    CASE(I_MATRIX_TYPE)
        DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(1)
        DO  K2=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
           !CHAR_OF_INT5=INTEGER_TO_CHARACTER(CALCULATED_M(AN_OUTPUT)%INTEGER_M(K1,K2),CHAR_OF_INT5_LENGTH)
            IF(K2.LT.CALCULATED_M(AN_OUTPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,*) CALCULATED_M(AN_OUTPUT)%INTEGER_M(K1,K2),' & '
            ELSE
               IF(K1.LT.CALCULATED_M(AN_OUTPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,*) CALCULATED_M(AN_OUTPUT)%INTEGER_M(K1,K2),' \\ '
               ELSE
                  WRITE(TUNNEL,*) CALCULATED_M(AN_OUTPUT)%INTEGER_M(K1,K2)
               END IF
            END IF
        END DO
        END DO

    CASE(R_MATRIX_TYPE)
        ACCURACY=CALCULATED_ACCURACY(1,AN_OUTPUT)
        DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(1)
        DO  K2=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
            CALL CONVERT_A_DOUBLE_DIFS(CALCULATED_M(AN_OUTPUT)%REAL_M(K1,K2), ACCURACY)
            IF(K2.LT.CALCULATED_M(AN_OUTPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),' & '
            ELSE
               IF(K1.LT.CALCULATED_M(AN_OUTPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),' \\ '
               ELSE
                  WRITE(TUNNEL,*) THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
               END IF
            END IF
        END DO
        END DO

    CASE(C_MATRIX_TYPE)
        ACCURACY1=CALCULATED_ACCURACY(1,AN_OUTPUT)
        ACCURACY2=CALCULATED_ACCURACY(2,AN_OUTPUT)
        DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(1)
        DO  K2=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
            CALL CONVERT_A_COMPLEX_DIFS(CALCULATED_M(AN_OUTPUT)%COMPLEX_M(K1,K2), ACCURACY1, ACCURACY2)
            IF(K2.LT.CALCULATED_M(AN_OUTPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' & '
            ELSE
               IF(K1.LT.CALCULATED_M(AN_OUTPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' \\ '
               ELSE
                  WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
               END IF
            END IF
        END DO
        END DO

    CASE(S_MATRIX_TYPE)
        DO  K1=1, CALCULATED_M(AN_OUTPUT)%SIZES(1)
        DO  K2=1, CALCULATED_M(AN_OUTPUT)%SIZES(2)
            IF(K2.LT.CALCULATED_M(AN_OUTPUT)%SIZES(2)) THEN
               WRITE(TUNNEL,'(A)') TRIM(CALCULATED_M(AN_OUTPUT)%STRING_M(K1,K2))//' & '
            ELSE
               IF(K1.LT.CALCULATED_M(AN_OUTPUT)%SIZES(1)) THEN
                  WRITE(TUNNEL,'(A)') TRIM(CALCULATED_M(AN_OUTPUT)%STRING_M(K1,K2))//' \\ '
               ELSE
                  WRITE(TUNNEL,'(A)') TRIM(CALCULATED_M(AN_OUTPUT)%STRING_M(K1,K2))
               END IF
            END IF
        END DO
        END DO

    CASE DEFAULT
       PRINT*,' A BUG INSIDE (PRINT_AN_OUT_MATRIX), PLEASE REPORT: ',AN_OUTPUT,CALCULATED_TYPE(AN_OUTPUT), &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    NTL=NTL+CALCULATED_M(AN_OUTPUT)%SIZES(1)*CALCULATED_M(AN_OUTPUT)%SIZES(2)

    IF(KP.EQ.MATRIX_DATA_ONLY) THEN
       IF(KKKK.EQ.0) THEN
       ELSE
          WRITE(TUNNEL,*)'\end{array}  $ '
          NTL=NTL+1
       END IF
    ELSE
       IF(KKKK.EQ.0) THEN
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_END(KP))
       ELSE
          WRITE(TUNNEL,'(A)')TRIM(MATRIX_BRACES_END(KP))//' $ '
       END IF
       NTL=NTL+1
    END IF

    RETURN
END SUBROUTINE PRINT_AN_OUT_MATRIX




SUBROUTINE GET_REAL_MATRIX(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1,D2,D3
    INTEGER           ::  ACCURACY,KK,KKK,K1,K2
    INTEGER           ::  ACCRC1,ACCRC2, ACCRC3

    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=R_MATRIX_TYPE

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(REAL_MATRIX_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(REAL_MATRIX_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(REAL_MATRIX_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL OPTIONAL_MATRIX_BEFORE_INTEGER(K1,K2)
    GENERATED_M(INPUT_NUMBER)%BRACE_INDEX=K2
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(1)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(2)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    IIIRRRCCC=0
    CALL GET_A_DOUBLE(D1,ACCRC1)
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC2)
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC3)
    ACCURACY=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY=                  ACCRC3
    IF(D1.EQ.0.0D0) THEN
       ACCURACY=ACCRC1
       IF(INPUT_RRR(2,INPUT_NUMBER).LT.INPUT_RRR(1,INPUT_NUMBER)) THEN
          D1=2.0D0*(INPUT_RRR(2,INPUT_NUMBER)-INPUT_RRR(1,INPUT_NUMBER))-1000.0D0
       ELSE
          D1=2.0D0*(INPUT_RRR(2,INPUT_NUMBER)-INPUT_RRR(1,INPUT_NUMBER))+1000.0D0
       END IF
    END IF
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_NO_PRINTING_AND_ENDS()
    INPUT_ACCURACY(1,INPUT_NUMBER)=ACCURACY

    IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
    ELSE
       PRINT*,'Sorry, odd number of "$"s detected in a '//REAL_MATRIX_KEY//' region: ', &
          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    ALLOCATE(GENERATED_M(INPUT_NUMBER)%REAL_M(GENERATED_M(INPUT_NUMBER)%SIZES(1),&
                                             &GENERATED_M(INPUT_NUMBER)%SIZES(2)))

    D1=INPUT_RRR(1,INPUT_NUMBER)
    D2=INPUT_RRR(2,INPUT_NUMBER)
    D3=INPUT_RRR(3,INPUT_NUMBER)
    DO  K2=1, GENERATED_M(INPUT_NUMBER)%SIZES(2)
    DO  K1=1, GENERATED_M(INPUT_NUMBER)%SIZES(1)
        GENERATED_M(INPUT_NUMBER)%REAL_M(K1,K2)=A_STEPPED_RAN_DOUBLE(D1,D2,D3)
    END DO
    END DO

    CALL GET_MATRIX_TAIL(KKK)

    RETURN
END SUBROUTINE GET_REAL_MATRIX




SUBROUTINE GET_COMPLEX_MATRIX(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    DOUBLE COMPLEX    ::  C1,C2,C3
    DOUBLE PRECISION  ::  D1,D2,D3,D4,D5,D6
    INTEGER           ::  ACCURACY1,ACCURACY2,KK,KKK,K1,K2
    INTEGER           ::  ACCRC1 , ACCRC2 , ACCRC3

    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=C_MATRIX_TYPE

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(COMPLEX_MATRIX_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(COMPLEX_MATRIX_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(COMPLEX_MATRIX_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL OPTIONAL_MATRIX_BEFORE_INTEGER(K1,K2)
    GENERATED_M(INPUT_NUMBER)%BRACE_INDEX=K2
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(1)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(2)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    IIIRRRCCC=0
    CALL GET_A_DOUBLE(D1,ACCRC1)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D2,ACCRC2)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D3,ACCRC3)
    ACCURACY1=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY1=ACCRC3
    IF(D3.EQ.0.0D0) THEN
       ACCURACY1=ACCRC1
       IF(D2.LT.D1) THEN
          D3=2.0D0*(D2-D1)-1000.0D0
       ELSE
          D3=2.0D0*(D2-D1)+1000.0D0
       END IF
    END IF

    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D4,ACCRC1)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D5,ACCRC2)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D6,ACCRC3)
    ACCURACY2=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY2=ACCRC3
    IF(D6.EQ.0.0D0) THEN
       ACCURACY2=ACCRC1
       IF(D5.LT.D4) THEN
          D6=2.0D0*(D5-D4)-1000.0D0
       ELSE
          D6=2.0D0*(D5-D4)+1000.0D0
       END IF
    END IF

    CALL CHECK_NO_PRINTING_AND_ENDS()

    INPUT_CCC(1,INPUT_NUMBER)=CMPLX(D1,D4)
    INPUT_CCC(2,INPUT_NUMBER)=CMPLX(D2,D5)
    INPUT_CCC(3,INPUT_NUMBER)=CMPLX(D3,D6)

    INPUT_ACCURACY(1,INPUT_NUMBER)=ACCURACY1
    INPUT_ACCURACY(2,INPUT_NUMBER)=ACCURACY2

    IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
    ELSE
       PRINT*,'Sorry, odd number of "$"s detected in a '//COMPLEX_MATRIX_KEY//' region: ', &
          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    ALLOCATE(GENERATED_M(INPUT_NUMBER)%COMPLEX_M(GENERATED_M(INPUT_NUMBER)%SIZES(1),&
                                                &GENERATED_M(INPUT_NUMBER)%SIZES(2)))

    C1=INPUT_CCC(1,INPUT_NUMBER)
    C2=INPUT_CCC(2,INPUT_NUMBER)
    C3=INPUT_CCC(3,INPUT_NUMBER)
    DO  K2=1, GENERATED_M(INPUT_NUMBER)%SIZES(2)
    DO  K1=1, GENERATED_M(INPUT_NUMBER)%SIZES(1)
        GENERATED_M(INPUT_NUMBER)%COMPLEX_M(K1,K2)=A_STEPPED_RAN_COMPLEX(C1,C2,C3)
    END DO
    END DO

    CALL GET_MATRIX_TAIL(KKK)

    RETURN
END SUBROUTINE GET_COMPLEX_MATRIX




SUBROUTINE GET_STRING_MATRIX(KK,KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: KK,KKK,L,K1,K2,K,JJ

    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=S_MATRIX_TYPE

    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(STRING_MATRIX_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(STRING_MATRIX_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(STRING_MATRIX_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF

    DATA_BEGIN_NUMBER=0
    CALL CHECK_AND_DELETE_S(DATA_BEGIN_KEY,K,JJ)
    CALL RESET_THE_WORK2_2(K)
    CALL OPTIONAL_MATRIX_BEFORE_INTEGER(K1,K2)
    GENERATED_M(INPUT_NUMBER)%BRACE_INDEX=K2
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(1)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_AN_INTEGER(K1)
    GENERATED_M(INPUT_NUMBER)%SIZES(2)=K1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL READ_TRUE_STRINGS()

    IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
    ELSE
       PRINT*,'Sorry, odd number of "$"s detected in a '//STRING_MATRIX_KEY//' region: ', &
          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    ALLOCATE(GENERATED_M(INPUT_NUMBER)%STRING_M(GENERATED_M(INPUT_NUMBER)%SIZES(1),&
                                               &GENERATED_M(INPUT_NUMBER)%SIZES(2)))
    ALLOCATE(GENERATED_M(INPUT_NUMBER)%INTEGER_M(GENERATED_M(INPUT_NUMBER)%SIZES(1),&
                                                &GENERATED_M(INPUT_NUMBER)%SIZES(2)))

    DO  K2=1, GENERATED_M(INPUT_NUMBER)%SIZES(2)
    DO  K1=1, GENERATED_M(INPUT_NUMBER)%SIZES(1)
        L=AN_INTEGER_RANDOM(GENERATED_POSITION(1,INPUT_NUMBER),GENERATED_POSITION(2,INPUT_NUMBER))+0.4
        IF(L.GT.GENERATED_POSITION(2,INPUT_NUMBER)) L=GENERATED_POSITION(2,INPUT_NUMBER)
        GENERATED_M(INPUT_NUMBER)%INTEGER_M(K1,K2)=L
        GENERATED_M(INPUT_NUMBER)%STRING_M(K1,K2)=' '
        GENERATED_M(INPUT_NUMBER)%STRING_M(K1,K2)=TRIM(INPUT_SSS(L))
        IF(INPUT_STK(L).LE.0) THEN
           INPUT_STK(L)=1
        ELSE
           INPUT_STK(L)=INPUT_STK(L)+1
        END IF
    END DO
    END DO

    CALL GET_MATRIX_TAIL(KKK)

    RETURN
END SUBROUTINE GET_STRING_MATRIX




SUBROUTINE GET_MATRIX_TAIL(KKK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  KKK,NTL

    CALL SWITCH_PRINTING_MATRIX(KKK,INPUT_NUMBER)

    PRINTING=.TRUE.

    IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
       IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
       IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: $ ', INPUT_NUMBER, ' $ : '
          CALL PRINT_A_MATRIX(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,NTL,2)
          WRITE(ANSW_LUTION_FILE_TUNNEL, *)' ; '
       ELSE
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
       END IF
       END IF
    END IF

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    IF(THE_READ_LENGTH.LE.0) DO_NOT_OUTPUT=.TRUE.

    RETURN
END SUBROUTINE GET_MATRIX_TAIL




SUBROUTINE SWITCH_PRINTING_MATRIX(KKK,AN_INPUT)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  KKK,NTL,AN_INPUT

    IF(KKK.EQ.2) THEN
       CALL PRINT_A_MATRIX(TEMP3_FILE_TUNNEL,AN_INPUT,NTL,0)
       POINTER_TEMP3=POINTER_TEMP3+NTL
    ELSE IF(KKK.EQ.4) THEN
       CALL PRINT_A_MATRIX(OUTPUT_FILE_TUNNEL,AN_INPUT,NTL,0)
       CALL PRINT_A_MATRIX(JOURNAL_FILE_TUNNEL,AN_INPUT,NTL,0)
    ELSE IF(KKK.EQ.10) THEN
       IF(SOLUTION_FOUND) THEN
            CALL PRINT_A_MATRIX(SOLUTION_FILE_TUNNEL,AN_INPUT,NTL,0)
            CALL PRINT_A_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_INPUT,NTL,0)
       ELSE IF(ANSWER_FOUND) THEN
            CALL PRINT_A_MATRIX(ANSWER_FILE_TUNNEL,AN_INPUT,NTL,0)
            CALL PRINT_A_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_INPUT,NTL,0)
            CALL PRINT_A_MATRIX(SHORTEST_ANSWER_FILE_TUNNEL,AN_INPUT,NTL,0)
       ELSE
            CALL PRINT_A_MATRIX(OUTPUT_FILE_TUNNEL,AN_INPUT,NTL,0)
       END IF
       CALL PRINT_A_MATRIX(JOURNAL_FILE_TUNNEL,AN_INPUT,NTL,0)
    ELSE
       PRINT*,'NOT ACCEPTED KKK: ',KKK
       STOP
    END IF

    RETURN
END SUBROUTINE SWITCH_PRINTING_MATRIX




SUBROUTINE SWITCH_PRINTING_OUT_MATRIX(KKK,AN_OUTPUT)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  KKK,NTL,AN_OUTPUT

          IF(KKK.EQ.2) THEN
             CALL PRINT_AN_OUT_MATRIX(TEMP3_FILE_TUNNEL,AN_OUTPUT,NTL,0)
             POINTER_TEMP3=POINTER_TEMP3+NTL
          ELSE IF(KKK.EQ.4) THEN
             CALL PRINT_AN_OUT_MATRIX(OUTPUT_FILE_TUNNEL,AN_OUTPUT,NTL,0)
             CALL PRINT_AN_OUT_MATRIX(JOURNAL_FILE_TUNNEL,AN_OUTPUT,NTL,0)
          ELSE IF(KKK.EQ.10) THEN
             IF(SOLUTION_FOUND) THEN
                CALL PRINT_AN_OUT_MATRIX(SOLUTION_FILE_TUNNEL,AN_OUTPUT,NTL,0)
                CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,0)
             ELSE IF(ANSWER_FOUND) THEN
                CALL PRINT_AN_OUT_MATRIX(ANSWER_FILE_TUNNEL,AN_OUTPUT,NTL,0)
                CALL PRINT_AN_OUT_MATRIX(ANSW_LUTION_FILE_TUNNEL,AN_OUTPUT,NTL,0)
                CALL PRINT_AN_OUT_MATRIX(SHORTEST_ANSWER_FILE_TUNNEL,AN_OUTPUT,NTL,0)
             ELSE
                CALL PRINT_AN_OUT_MATRIX(OUTPUT_FILE_TUNNEL,AN_OUTPUT,NTL,0)
             END IF
             CALL PRINT_AN_OUT_MATRIX(JOURNAL_FILE_TUNNEL,AN_OUTPUT,NTL,0)
          ELSE
             PRINT*,'NOT ACCEPTED KKK: ',KKK
             STOP
          END IF

    RETURN
END SUBROUTINE SWITCH_PRINTING_OUT_MATRIX




SUBROUTINE CHECK_AND_DELETE(STRING)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  STRING
    INTEGER           ::  I,K
    FIND_EB: DO

       DO I=1, THE_READ_WORK2_LENGTH
          IF(THE_READ_WORK2(I:I).EQ.' ') THEN
          ELSE IF(THE_READ_WORK2(I:I).EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(THE_READ_WORK2(I:I).EQ.STRING) THEN
             K=I
             THE_READ_WORK2(I:I)=' '
             IF(STRING.EQ.DATA_BEGIN_KEY) DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER+1
             IF(STRING.EQ.DATA_END_KEY)   DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER-1
             EXIT FIND_EB
          ELSE
             PRINT*, 'Sorry, character "'//STRING//'" expected (CHECK_AND_DELETE) but ', &
                    THE_READ_WORK2(I:I)//' found: ', THE_READ(1:THE_READ_length), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
       END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (CHECK_AND_DELETE): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, character "'//STRING//'" expected (CHECK_AND_DELETE2) but not found: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no '//STRING//' found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE CHECK_AND_DELETE




SUBROUTINE CHECK_AND_DELETE_S(STRING,K,JJ)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  STRING
    INTEGER           ::  I,K,JJ
    JJ=0
    FIND_EB: DO

       IF(STRING.EQ.DATA_BEGIN_KEY) THEN
          DO I=1, THE_READ_WORK2_LENGTH
             IF(THE_READ_WORK2(I:I).EQ.' ') THEN
            !ELSE IF(THE_READ_WORK2(I:I).EQ.'$') THEN
            !   THE_READ_WORK2(I:I)=' '
            !   DOLLAR_NUMBER=DOLLAR_NUMBER+1
             ELSE IF(THE_READ_WORK2(I:I).EQ.STRING) THEN
                K=I
                JJ=1
                THE_READ_WORK2(I:I)=' '
                DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER+1
                EXIT FIND_EB
             ELSE
                PRINT*, 'Sorry, character "'//STRING//'" expected (CHECK_AND_DELETE_S) but ', &
                       THE_READ_WORK2(I:I)//' found: ', &
                       LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
             END IF
          END DO

       ELSE IF((STRING.EQ.DATA_SEPARATE_KEY).OR.(STRING.EQ.DATA_END_KEY)) THEN
          DO I=1, THE_READ_WORK2_LENGTH
             IF(THE_READ_WORK2(I:I).EQ.DATA_BEGIN_KEY) THEN
                DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER+1
             ELSE IF(THE_READ_WORK2(I:I).EQ.DATA_SEPARATE_KEY) THEN
                IF(DATA_BEGIN_NUMBER.EQ.1) THEN
                   K=I
                   JJ=2
                   THE_READ_WORK2(I:I)=' '
                   EXIT FIND_EB
                END IF
             ELSE IF(THE_READ_WORK2(I:I).EQ.DATA_END_KEY) THEN
                DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER-1
                IF(DATA_BEGIN_NUMBER.EQ.0) THEN
                   K=I
                   JJ=3
                   THE_READ_WORK2(I:I)=' '
                   EXIT FIND_EB
                ELSE IF(DATA_BEGIN_NUMBER.LT.0) THEN
                   PRINT*,'A BUG IN CHECK_AND_DELETE_S, PLEASE REPORT: ', DATA_BEGIN_NUMBER, STRING, &
                       LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                   STOP
                END IF
             END IF
          END DO

       ELSE
          PRINT*,'KEY NOT SUPPORTED (CHECK_AND_DELETE_S): ', STRING, &
                 LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (CHECK_AND_DELETE_S): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, "'//STRING//'" or ")" expected but not found in the input file (CHECK_AND_DELETE_S): ',&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no "'//STRING//'" found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    RETURN
END SUBROUTINE CHECK_AND_DELETE_S




SUBROUTINE CHECK_AND_DELETE_ABSOLUTE(J)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  STRING, STRING2, AA
    INTEGER           ::  I,K,J,L

    STRING=ABSOLUTE_KEY(1:1)
    STRING2=ADDITION_KEY(1:1)
    IF(STRING.EQ.STRING2) THEN
        PRINT*, 'CODE BUG IN CHECK_AND_DELETE_ABSOLUTE: '//STRING//STRING2
        STOP
    END IF

    FIND_EB: DO

       DO I=1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          L=IACHAR(AA)
          IF(AA.EQ.' ') THEN
          ELSE IF(THE_READ_WORK2(I:I).EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(THE_READ_WORK2(I:I).EQ.STRING) THEN
             IF(THE_READ_WORK2(I:I-1+ABSOLUTE_KEY_LENTH).EQ.ABSOLUTE_KEY) THEN
                J=0
                K=I-1+ABSOLUTE_KEY_LENTH
                THE_READ_WORK2(I:I-1+ABSOLUTE_KEY_LENTH)=' '
                EXIT FIND_EB
             ELSE
                PRINT*, 'Sorry, searching '//ABSOLUTE_KEY//' (CHECK_AND_DELETE_ABSOLUTE) but: ', &
                    THE_READ_WORK2(I:I-1+ABSOLUTE_KEY_LENTH), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
             END IF
          ELSE IF(THE_READ_WORK2(I:I).EQ.STRING2) THEN
             IF(THE_READ_WORK2(I:I-1+ADDITION_KEY_LENTH).EQ.ADDITION_KEY) THEN
                J=1
                K=I-1+ADDITION_KEY_LENTH
                THE_READ_WORK2(I:I-1+ADDITION_KEY_LENTH)=' '
                EXIT FIND_EB
             ELSE
                PRINT*, 'Sorry, searching '//ABSOLUTE_KEY//' (CHECK_AND_DELETE_ABSOLUTE) but: ', &
                    THE_READ_WORK2(I:I-1+ABSOLUTE_KEY_LENTH), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
             END IF
          ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'.').OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
             J=2
             RETURN

          ELSE
             PRINT*, 'Sorry, "'//ADDITION_KEY//' or '//ABSOLUTE_KEY//'" or number expected ',&
                    &'(CHECK_AND_DELETE_ABSOLUTE) but ', &
                    THE_READ_WORK2(1:I)//' found: ', &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
       END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (CHECK_AND_DELETE_ABSOLUTE): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, character "'//STRING//'" expected (CHECK_AND_DELETE_ABSOLUTE) but not found: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no '//STRING//' found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE CHECK_AND_DELETE_ABSOLUTE




SUBROUTINE CHECK_NO_PRINTING_AND_ENDS()
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER    ::  I,KK,JJ

    PRINTING=.TRUE.

    CALL SEPARATER_OR_ENDER(KK,JJ)
    CALL RESET_THE_WORK2_2(KK)

    IF(JJ.EQ.3)  RETURN

    CALL CHECK_AND_DELETE_S(DATA_END_KEY,KK,JJ)
    IF(JJ.NE.3)  THEN
       PRINT*, 'Sorry, searching "'//DATA_END_KEY//'" (CHECK_NO_PRINTING_AND_ENDS) but ', &
                THE_READ_WORK2(1:KK)//' found: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    DO I=1, KK
       IF(THE_READ_WORK2(I:I).EQ.'$') THEN
          THE_READ_WORK2(I:I)=' '
          DOLLAR_NUMBER=DOLLAR_NUMBER+1
       END IF
    END DO
    IF( (    TRIM(ADJUSTL(THE_READ_WORK2(1:KK))).EQ.NO_PRINTING_KEY)      .AND. &
        (LEN_TRIM(ADJUSTL(THE_READ_WORK2(1:KK))).EQ.NO_PRINTING_KEY_LENTH) ) THEN
         PRINTING=.FALSE.
    ELSE IF(THE_READ_WORK2(1:KK).EQ.' ') THEN
    ELSE
       PRINT*, 'Sorry, searching "'//NO_PRINTING_KEY//'" (CHECK_NO_PRINTING_AND_ENDS) but ', &
                'unexpected strings: '//THE_READ_WORK2(1:KK)//' found: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    CALL RESET_THE_WORK2_2(KK)

    RETURN
END SUBROUTINE CHECK_NO_PRINTING_AND_ENDS




SUBROUTINE SEPARATER_OR_ENDER(K,JJ)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  I,K,JJ
    JJ=0
    FIND_EB: DO

          DO I=1, THE_READ_WORK2_LENGTH
             IF(THE_READ_WORK2(I:I).EQ.' ') THEN
             ELSE IF(THE_READ_WORK2(I:I).EQ.'$') THEN
                THE_READ_WORK2(I:I)=' '
                DOLLAR_NUMBER=DOLLAR_NUMBER+1
             ELSE IF(THE_READ_WORK2(I:I).EQ.DATA_SEPARATE_KEY) THEN
                K=I
                JJ=2
                THE_READ_WORK2(I:I)=' '
                EXIT FIND_EB
             ELSE IF(THE_READ_WORK2(I:I).EQ.DATA_END_KEY) THEN
                DATA_BEGIN_NUMBER=DATA_BEGIN_NUMBER-1
                K=I
                JJ=3
                THE_READ_WORK2(I:I)=' '
                EXIT FIND_EB
             ELSE
                PRINT*, 'Sorry, ILLEGAL CHARACTER (SEPARATER_OR_ENDER) ', &
                    THE_READ_WORK2(I:I)//' found: ', &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
             END IF
          END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (CHECK_AND_DELETE_S): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, NOTHING found in the input file (SEPARATER_OR_ENDER): ',&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no SEPARATER_OR_ENDER found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    RETURN
END SUBROUTINE SEPARATER_OR_ENDER




SUBROUTINE OPTIONAL_MATRIX_BEFORE_INTEGER(K,JJ)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  I,K,JJ,B
    K=-1
    FIND_EB: DO

          DO I=1, THE_READ_WORK2_LENGTH
             IF(THE_READ_WORK2(I:I).EQ.'$') THEN
                THE_READ_WORK2(I:I)=' '
                DOLLAR_NUMBER=DOLLAR_NUMBER+1
             ELSE IF(THE_READ_WORK2(I:I).EQ.DATA_SEPARATE_KEY) THEN
                K=I
                EXIT FIND_EB
             END IF
          END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (OPTIONAL_MATRIX_BEFORE_INTEGER): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, NOTHING found in the input file (OPTIONAL_MATRIX_BEFORE_INTEGER): ',&
                DATA_SEPARATE_KEY, LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no ', DATA_SEPARATE_KEY, ' found: ',          &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    B=0
    DO I=1, K
       IF(THE_READ_WORK2(I:I).NE.' ') THEN
          B=I
          EXIT
       END IF
    END DO

    JJ=MATRIX_DATA_ONLY
    DO I=1, NUMBER_OF_MATRIX_BRACES
      !IF(INDEX(THE_READ_WORK2(B:K),TRIM(ADJUSTL(MATRIX_BRACES(I)))).GT.0) THEN
       IF(INDEX(THE_READ_WORK2(B:K),TRIM(MATRIX_BRACES(I))).GT.0) THEN
          JJ=I
          THE_READ_WORK2(B:K)=' '
          EXIT
       END IF
    END DO

    RETURN
END SUBROUTINE OPTIONAL_MATRIX_BEFORE_INTEGER




SUBROUTINE GET_AN_INTEGER_TEMP3(THE_OBTAINED_INTEGER)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    INTEGER           ::  D1,THE_OBTAINED_INTEGER
    INTEGER           ::  I,J,K,L
    IIIRRRCCC=IIIRRRCCC+1
    FIND_EB: DO

       J=-1
       DO I=1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          L=IACHAR(AA)
          IF(AA.EQ.' ') THEN
          ELSE IF(AA.EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
             J=I
             EXIT FIND_EB
          ELSE
             PRINT*, 'Sorry, numbers expected (GET_AN_INTEGER_TEMP3) but : "'//AA//'" found: ',             &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       END DO

       CALL READ_A_LINE()

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, AN INTEGER expected but not found in the input file: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no INTEGER found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    K=THE_READ_WORK2_LENGTH
    DO I=J+1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          IF(AA.EQ.' ') THEN
             K=I
             EXIT
          ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.'$') THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.DATA_END_KEY) THEN
             K=I-1
             EXIT
          END IF
    END DO

    CALL READ_AN_INTEGER(J,K,D1)
    THE_OBTAINED_INTEGER=D1

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE GET_AN_INTEGER_TEMP3




SUBROUTINE GET_SOME_CHOICES()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1
    INTEGER           ::  M, ACCURACY, CFO, I, J, KK, RS(MAX_NUMBER_OF_SSS_INPUT_TERMS)
   !INTEGER           ::  IRW(MAX_WRONG_POSSIBLE), IA(4)
   !INTEGER           ::  ANOTHER_I
   !DOUBLE PRECISION  ::  DA(4), RW(MAX_WRONG_POSSIBLE)

    IF(SOLUTION_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in a solution region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(ANSWER_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in an ANSWER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in an ORDER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in a MATCH region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    CALL FIRST_PROCESSING_TEMP3(SOME_CHOICE_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER_TEMP3(CFO)
    IF((CFO.LE.0).OR.(CFO.GT.CALCULATED_NUMBER)) THEN
       PRINT*, 'ILLEGAL CALCULATED NUMBER in the CHOICE region: ', CFO, CALCULATED_NUMBER,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
   !CALL GET_AN_INTEGER_TEMP3(ANOTHER_I)
   !CALL SOLVE_THE_QUESTION(CFO,ANOTHER_I)

    DO I=1, LAYER_NUMBER
       IF(LAYER_CALCULATED(I).EQ.CFO) THEN
          PRINT*, 'SAME CALCULATED NUMBER USED TWICE IN the CHOICE region: ',CFO,I,LAYER_NUMBER,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END DO


    LAYER_NUMBER=LAYER_NUMBER+1
    IF(LAYER_NUMBER.GT.MAX_LAYER_OF_CHOICES) THEN
       PRINT*, 'Too many layers in the CHOICE region: ', LAYER_NUMBER, MAX_LAYER_OF_CHOICES,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    LAYER_CALCULATED( LAYER_NUMBER)=CFO
    LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
    LAYER_TYPE(       LAYER_NUMBER)=CALCULATED_TYPE(CFO)

    SELECT CASE (CALCULATED_TYPE(CFO))

    CASE(I_TYPE)
         LAYER_I(0,LAYER_NUMBER)=CALCULATED_I(CFO)
         D1=1.0D0*LAYER_I(0,LAYER_NUMBER)
         CALL GET_FIVE_DOUBELS(D1)
         !IA=DA
         !J=LAYER_I(0,LAYER_NUMBER)
         !CALL GET_WRONG_INTEGERS_2(IRW,MAX_WRONG_POSSIBLE,J,IA)
         !DO I=1,MAX_WRONG_POSSIBLE
         !   LAYER_I(I,LAYER_NUMBER)=IRW(I)
         !END DO
         !LAYER_EXT(LAYER_NUMBER)=MAX_WRONG_POSSIBLE+1

    CASE(R_TYPE)
         LAYER_R(0,LAYER_NUMBER)=CALCULATED_R(CFO)
         CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
         CALL GET_AN_INTEGER_TEMP3( ACCURACY)
         CALCULATED_ACCURACY(1,CFO)=ACCURACY
         LAYER_ACCURACY(1, LAYER_NUMBER)=ACCURACY
         D1=LAYER_R(0,LAYER_NUMBER)
         CALL GET_FIVE_DOUBELS(D1)
         !CALL GET_WRONG_VALUES(RW,MAX_WRONG_POSSIBLE,D1,DA)
         !DO I=1,MAX_WRONG_POSSIBLE
         !   LAYER_R(I,LAYER_NUMBER)=RW(I)
         !END DO
         !LAYER_EXT(LAYER_NUMBER)=MAX_WRONG_POSSIBLE+1

    CASE(C_TYPE)
         WRITE(TEMP3_FILE_TUNNEL,'(A)') '('
         POINTER_TEMP3=POINTER_TEMP3+1
         LAYER_NUMBER=LAYER_NUMBER-1
         LAYER_R(0,LAYER_NUMBER+1)= REAL(CALCULATED_C(CFO))
         LAYER_R(0,LAYER_NUMBER+2)=AIMAG(CALCULATED_C(CFO))
         DO KK=1, 2
            LAYER_NUMBER=LAYER_NUMBER+1
            IF(LAYER_NUMBER.GT.MAX_LAYER_OF_CHOICES) THEN
               PRINT*, 'Too many layers in the CHOICE region: ', LAYER_NUMBER, MAX_LAYER_OF_CHOICES,&
                        LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
               STOP
            END IF
            LAYER_CALCULATED( LAYER_NUMBER)=CFO
            LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
            LAYER_TYPE(       LAYER_NUMBER)=R_TYPE
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER_TEMP3( ACCURACY)
            CALCULATED_ACCURACY(KK,CFO)=ACCURACY
            LAYER_ACCURACY(1, LAYER_NUMBER)=ACCURACY
            D1=LAYER_R(0,LAYER_NUMBER)
            CALL GET_FIVE_DOUBELS(D1)
            !CALL GET_WRONG_VALUES(RW,MAX_WRONG_POSSIBLE,D1,DA)
            !DO I=1,MAX_WRONG_POSSIBLE
            !   LAYER_R(I,LAYER_NUMBER)=RW(I)
            !END DO
            !LAYER_EXT(LAYER_NUMBER)=MAX_WRONG_POSSIBLE+1
            IF(KK.LT.2) THEN
               WRITE(TEMP3_FILE_TUNNEL,'(A)') ','
            ELSE
               WRITE(TEMP3_FILE_TUNNEL,'(A)') ')'
            END IF
            POINTER_TEMP3=POINTER_TEMP3+1
         END DO

    CASE(V_TYPE)
         WRITE(TEMP3_FILE_TUNNEL,'(A)') '('
         POINTER_TEMP3=POINTER_TEMP3+1
         LAYER_NUMBER=LAYER_NUMBER-1
         LAYER_R(0,LAYER_NUMBER+1)=CALCULATED_V(1,CFO)
         LAYER_R(0,LAYER_NUMBER+2)=CALCULATED_V(2,CFO)
         LAYER_R(0,LAYER_NUMBER+3)=CALCULATED_V(3,CFO)
         DO KK=1, 3
            LAYER_NUMBER=LAYER_NUMBER+1
            IF(LAYER_NUMBER.GT.MAX_LAYER_OF_CHOICES) THEN
               PRINT*, 'Too many layers in the CHOICE region: ', LAYER_NUMBER, MAX_LAYER_OF_CHOICES,&
                        LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
               STOP
            END IF
            LAYER_CALCULATED( LAYER_NUMBER)=CFO
            LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
            LAYER_TYPE(       LAYER_NUMBER)=R_TYPE
            CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
            CALL GET_AN_INTEGER_TEMP3( ACCURACY)
            CALCULATED_ACCURACY(KK,CFO)=ACCURACY
            LAYER_ACCURACY(1, LAYER_NUMBER)=ACCURACY
            D1=LAYER_R(0,LAYER_NUMBER)
            CALL GET_FIVE_DOUBELS(D1)
            !CALL GET_WRONG_VALUES(RW,MAX_WRONG_POSSIBLE,D1,DA)
            !DO I=1,MAX_WRONG_POSSIBLE
            !   LAYER_R(I,LAYER_NUMBER)=RW(I)
            !END DO
            !LAYER_EXT(LAYER_NUMBER)=MAX_WRONG_POSSIBLE+1
            IF(KK.LT.3) THEN
               WRITE(TEMP3_FILE_TUNNEL,'(A)') ','
            ELSE
               WRITE(TEMP3_FILE_TUNNEL,'(A)') ')'
            END IF
            POINTER_TEMP3=POINTER_TEMP3+1
         END DO

    CASE(L_TYPE)
         LAYER_S(:,LAYER_NUMBER)=' '
         IF(CALCULATED_L(CFO)) THEN
            I= CALCULATED_POSITION(T_POST,CFO)
            KK=CALCULATED_POSITION(F_POST,CFO)
         ELSE
            I= CALCULATED_POSITION(F_POST,CFO)
            KK=CALCULATED_POSITION(T_POST,CFO)
         END IF
         LAYER_S(0,LAYER_NUMBER)=TRIM(OUTPUT_SSS(I ))
         LAYER_S(1,LAYER_NUMBER)=TRIM(OUTPUT_SSS(KK))
         LAYER_EXT(LAYER_NUMBER)=2

    CASE(S_TYPE)
         CALL RANDOM_SELECT(RS,CALCULATED_POSITION(1,CFO),CALCULATED_POSITION(2,CFO),CALCULATED_I(CFO:),1,M)
         LAYER_EXT(LAYER_NUMBER)=MIN(CALCULATED_POSITION(2,CFO)-CALCULATED_POSITION(1,CFO),MAX_WRONG_POSSIBLE,M)
         IF(LAYER_EXT(LAYER_NUMBER).LE.0) THEN
            PRINT*,' No other choice for strings: ', CFO, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
            STOP
         END IF
         I=CALCULATED_I(CFO)
         LAYER_S(0, LAYER_NUMBER)=' '
         LAYER_S(0, LAYER_NUMBER)=OUTPUT_SSS(I)
         DO I=1,LAYER_EXT(LAYER_NUMBER)
            J=RS(I)
            LAYER_S(I, LAYER_NUMBER)=' '
            LAYER_S(I, LAYER_NUMBER)=OUTPUT_SSS(J)
         END DO
         LAYER_EXT(LAYER_NUMBER)=LAYER_EXT(LAYER_NUMBER)+1

    CASE DEFAULT
       PRINT*,' ILLEGAL DATA TYPE IN GET_SOME_CHOICES, PLEASE REPORT: ', CALCULATED_TYPE(CFO), CFO, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT
    CALL CHECK_AND_DELETE(DATA_END_KEY)

    THE_READ_LENGTH= THE_READ_WORK2_LENGTH
    THE_READ=' '
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    LAYER_POSITION(2, LAYER_NUMBER)=THE_READ_LENGTH

    RETURN
END SUBROUTINE GET_SOME_CHOICES




SUBROUTINE MAKE_ALL_IR_WRONG_VALUES()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER  ::  L

    DO L=1, LAYER_NUMBER
       SELECT CASE (LAYER_TYPE(L))

       CASE(I_TYPE)
            CALL GET_WRONG_INTEGERS(L)

       CASE(R_TYPE)
            CALL GET_WRONG_DOUBLES(L)

       CASE(L_TYPE)

       CASE(S_TYPE)

       END SELECT
    END DO

    RETURN
END SUBROUTINE MAKE_ALL_IR_WRONG_VALUES




SUBROUTINE RANDOM_SELECT(TO,FF,FE,ECL,NECL,M)
    USE BASE_DATA
    USE RAND_INTERFACE
    INTEGER           ::  FF, FE, NECL
    INTEGER           ::  TO(1:FE-FF+1), ECL(NECL)
    INTEGER           ::  I, J, K, L, M, FROM(1:FE-FF+1)
    IF(FF.GT.FE) THEN
       PRINT*,' NOT ACCEPTABLE RANG (RANDOM_SELECT): ',FF, FE, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    IF(NECL.LT.0) THEN
       PRINT*,' NOT ACCEPTABLE NUMBER OF EXCLUSIVES (RANDOM_SELECT): ',NECL , &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    DO I=1, NECL
       IF(ECL(I).LT.FF) THEN
          PRINT*,' NOT ACCEPTABLE ELEMENT OF EXCLUSIVES (RANDOM_SELECT): ', ECL(I), FF, I, NECL , &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(ECL(I).GT.FE) THEN
          PRINT*,' NOT ACCEPTABLE ELEMENT OF EXCLUSIVES (RANDOM_SELECT): ', ECL(I), FE, I, NECL , &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END DO

    L=0
    I_DO: DO I=1, FE-FF+1
       J=I+FF-1
       DO K=1, NECL
          IF(ECL(K).EQ.J) CYCLE I_DO
       END DO
       L=L+1
       FROM(L)=J
    END DO I_DO
    M=L

    IF(L.NE.FE-FF+1-NECL) THEN
       PRINT*,' A BUG INSIDE RANDOM_SELECT1, PLEASE REPORT: ',L,FF,FE,NECL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    DO I=1, L-1
       J=AN_INTEGER_RANDOM(1, L+1-I)
       TO(I)=FROM(J)
       IF(J.NE.L+1-I) FROM(J)=FROM(L+1-I)
    END DO
    TO(L)=FROM(1)

    FROM(1:L)=TO(1:L)

    DO I=1, L-1
       DO J=I+1, L
          IF(FROM(I).GT.FROM(J)) THEN
             K=FROM(J)
             FROM(J)=FROM(I)
             FROM(I)=K
          END IF
       END DO
    END DO

    L=0
    I_DO2: DO I=1, FE-FF+1
       J=I+FF-1
       DO K=1, NECL
          IF(ECL(K).EQ.J) CYCLE I_DO2
       END DO
       L=L+1
       IF(FROM(L).NE.J) THEN
          PRINT*,' A BUG INSIDE RANDOM_SELECT2, PLEASE REPORT: ',FROM(L),J,L,FROM(1:M),TO(1:M), &
                   LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END DO I_DO2

    RETURN
END SUBROUTINE RANDOM_SELECT




SUBROUTINE GET_WRONG_VALUES(RW,N,D1,DA)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER, PARAMETER::  M=6
    INTEGER           ::  N
    DOUBLE PRECISION  ::  RW(N),D1,DA(4),R,S
    INTEGER           ::  I, L, TO(N*M), EXCL(2), M2
    L=N*M
    IF(L.LE.0) THEN
       PRINT*, 'Sorry, BAD INTEGER in GET_WRONG_VALUES: ', L, N, M, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    S=1.0D0/L
    CALL RANDOM_SELECT(TO,1,L,EXCL,0,M2)
    DO I=1, N
       R=(TO(I)-1.0D0+MYRAND())*S
       IF(R.GT.1.0D0) R=1.0D0
       IF(R.LT.0.0D0) R=0.0D0
       RW(I)=USE_A_DOUBLE_RAN_EXCLUSIVE(R,D1,DA)
    END DO
    RETURN
END SUBROUTINE GET_WRONG_VALUES




SUBROUTINE GET_WRONG_DOUBLES(LLL)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  R, S
    INTEGER           ::  I, J, KK, LLL, ACCURACY
    ACCURACY=LAYER_ACCURACY(1,LLL)
    IF(ACCURACY.LE.0) THEN
          PRINT*,'Sorry, the ACCURACY is not acceptable in GET_WRONG_DOUBLES: ', ACCURACY, LLL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    S=LAYER_R(0, LLL)
    CALL CONVERT_A_DOUBLE_DIFS(S, ACCURACY)
    IF(THE_READ_WORK3_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_SSS) THEN
       PRINT*,'Sorry, too long doubles to be expressed, please increase MAX_NUMBER_OF_CHARACTERS_SSS to',&
          THE_READ_WORK3_LENGTH, ' at least. ', &
          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    LAYER_S(0, LLL)=' '
    LAYER_S(0, LLL)(1:THE_READ_WORK3_LENGTH)=THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)

    DO I=1, LAYER_EXT(LLL)
          KK=0
          10 KK=KK+1
          IF(KK.GT.MAX_WRONG_TRYS) THEN
             PRINT*, 'Sorry, I can not get enough wrong reals within ', MAX_WRONG_TRYS, ' tryings: ', &
                LAYER_EXT(LLL), ' expected, in the range of [', LAYER_RANGE(1, LLL), ',', &
                LAYER_RANGE(2, LLL), '] with exclusion of [', LAYER_RANGE(3, LLL), ',', &
                LAYER_RANGE(4, LLL), '] ',LAYER_R(0, LLL), LLL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          IF((LAYER_RANGE(1, LLL).LT.LAYER_RANGE(3, LLL)).AND. &
             (LAYER_RANGE(4, LLL).LT.LAYER_RANGE(2, LLL))) THEN
             IF(MYRAND().LE.LAYER_L_POSSIBILITY(LLL)) THEN
                R=A_DOUBLE_RANDOM(LAYER_RANGE(1, LLL),LAYER_RANGE(3, LLL))
             ELSE
                R=A_DOUBLE_RANDOM(LAYER_RANGE(4, LLL),LAYER_RANGE(2, LLL))
             END IF
          ELSE
             R=A_DOUBLE_RANDOM(LAYER_RANGE(1, LLL),LAYER_RANGE(2, LLL))
             IF((R.GE.LAYER_RANGE(3, LLL)).AND.(R.LE.LAYER_RANGE(4,LLL))) GO TO 10
          END IF
          DO J=0, I-1
             IF(LAYER_R(J, LLL).GE.0.0D0) THEN
                IF((R.GE.LAYER_R(J, LLL)*0.99D0).AND.(R.LE.LAYER_R(J, LLL)*1.01D0)) GO TO 10
             ELSE
                IF((R.GE.LAYER_R(J, LLL)*1.01D0).AND.(R.LE.LAYER_R(J, LLL)*0.99D0)) GO TO 10
             END IF
          END DO
          LAYER_R(I, LLL)=R
          S=LAYER_R(I, LLL)
          CALL CONVERT_A_DOUBLE_DIFS(S, ACCURACY)
          IF(THE_READ_WORK3_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_SSS) THEN
             PRINT*,'Sorry, too long doubles to be expressed, please increase '//&
                'MAX_NUMBER_OF_CHARACTERS_SSS to',&
                THE_READ_WORK3_LENGTH, ' at least. ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          LAYER_S(I, LLL)=' '
          LAYER_S(I, LLL)(1:THE_READ_WORK3_LENGTH)=THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
          DO J=0, I-1
             IF(LAYER_S(I, LLL).EQ.LAYER_S(J, LLL)) GO TO 10
          END DO
    END DO

    RETURN
END SUBROUTINE GET_WRONG_DOUBLES




SUBROUTINE GET_WRONG_INTEGERS_0(IRW,N,I1,I4)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  N,I1,I4(4)
    INTEGER           ::  IRW(N),IA(4),C1,C2
    INTEGER           ::  I, J, K, KK, TAKEN(0:N),NT
    DOUBLE PRECISION  ::  R
    IA=I4
    DO I=1, 4-1
       DO J=I+1, 4
          IF(IA(I).GT.IA(J)) THEN
             KK=IA(I)
             IA(I)=IA(J)
             IA(J)=KK
          END IF
       END DO
    END DO
    TAKEN(0)=I1
    NT=0
    C1=IA(2)-IA(1)+1
    IF((I1.GE.IA(1)).AND.(I1.LE.IA(2))) C1=C1-1
    C2=IA(4)-IA(3)+1
    IF((I1.GE.IA(3)).AND.(I1.LE.IA(4))) C2=C2-1
    IF(C1+C2.LT.N) THEN
       PRINT*, 'Sorry, NOT ENOUGH CHOICE IN GET_WRONG_INTEGERS: ', C1,C2,N,I1,I4, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    10 CONTINUE
    R=MYRAND()

    IF(R.LT.0.5) THEN
       IF(C1.GE.2) THEN
          20 K=IA(1)+(IA(2)-IA(1))*MYRAND()+0.2
          DO J=0, NT
             IF(K.EQ.TAKEN(J)) GO TO 20
          END DO
       ELSE IF(C1.EQ.1) THEN
          DO_J: DO J=IA(1), IA(2)
             DO I=0, NT
                IF(TAKEN(I).EQ.J) CYCLE DO_J
             END DO
             K=J
             EXIT DO_J
          END DO DO_J
       ELSE
          GO TO 10
       END IF
       C1=C1-1
       NT=NT+1
       TAKEN(NT)=K
       IF(NT.LT.N) GO TO 10

    ELSE
       IF(C2.GE.2) THEN
          40 K=IA(3)+(IA(4)-IA(3))*MYRAND()+0.2
          DO J=0, NT
             IF(K.EQ.TAKEN(J)) GO TO 40
          END DO
       ELSE IF(C2.EQ.1) THEN
          DO_J2: DO J=IA(3), IA(4)
             DO I=0, NT
                IF(TAKEN(I).EQ.J) CYCLE DO_J2
             END DO
             K=J
             EXIT DO_J2
          END DO DO_J2
       ELSE
          GO TO 10
       END IF
       C2=C2-1
       NT=NT+1
       TAKEN(NT)=K
       IF(NT.LT.N) GO TO 10

    END IF

    IRW(1:N)=TAKEN(1:N)

    DO I=0, NT-1
    DO J=I+1, NT
       IF(TAKEN(I).EQ.TAKEN(J)) THEN
          PRINT*, 'SORRY, A BUG IN GET_WRONG_INTEGERS: ', TAKEN,I,J,NT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END DO
    END DO

    DO I=1, N
       IF(TAKEN(I).LT.IA(1)) THEN
          PRINT*, 'SORRY, A BUG IN GET_WRONG_INTEGERS 2: ', TAKEN,I,N,IA, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF((TAKEN(I).GT.IA(2)).AND.(TAKEN(I).LT.IA(3))) THEN
          PRINT*, 'SORRY, A BUG IN GET_WRONG_INTEGERS 3: ', TAKEN,I,N,IA, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(TAKEN(I).GT.IA(4)) THEN
          PRINT*, 'SORRY, A BUG IN GET_WRONG_INTEGERS 4: ', TAKEN,I,N,IA, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END DO
    RETURN
END SUBROUTINE GET_WRONG_INTEGERS_0




SUBROUTINE GET_WRONG_INTEGERS(LLL)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  IA(4), I, J, K, KK, LLL

    IA(1:4)=LAYER_RANGE(1:4, LLL)

    IF((IA(1).LT.IA(3)).AND.(IA(4).LT.IA(2))) THEN
       DO I=1, LAYER_EXT(LLL)
          KK=0
          10 KK=KK+1
          IF(KK.GT.MAX_WRONG_TRYS) THEN
             PRINT*, 'Sorry, I can not get enough wrong integers within ', MAX_WRONG_TRYS, ' tryings: ', &
                LAYER_EXT(LLL), ' expected, in the range of [', IA(1), ',', IA(2), '] with ', &
                'exclusion of [', IA(3), ',', IA(4), '] ',LAYER_I(0, LLL),LAYER_RANGE(1:4, LLL),LLL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          IF(MYRAND().LE.LAYER_L_POSSIBILITY(LLL)) THEN
             K=AN_INTEGER_RANDOM(IA(1),IA(3)-1)
          ELSE
             K=AN_INTEGER_RANDOM(IA(4)+1,IA(2))
          END IF
          DO J=0, I-1
             IF(K.EQ.LAYER_I(J, LLL)) GO TO 10
          END DO
          LAYER_I(I, LLL)=K
       END DO
       RETURN
    END IF

    IF(IA(2).LE.IA(4)) IA(2)=MIN(IA(2),IA(3)-1)
    IF(IA(1).GE.IA(3)) IA(1)=MAX(IA(1),IA(4)+1)

    IF((IA(2)-IA(1)+1).LT.LAYER_EXT(LLL)) THEN
             PRINT*, 'Sorry, no range for wrong integers, with ', &
                LAYER_EXT(LLL), ' expected, in the range of [', IA(1), ',', IA(2), '] with ', &
                'exclusion of [', IA(3), ',', IA(4), '] ',LAYER_I(0, LLL),LAYER_RANGE(1:4, LLL),LLL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
    END IF

       DO I=1, LAYER_EXT(LLL)
          KK=0
          20 KK=KK+1
          IF(KK.GT.MAX_WRONG_TRYS) THEN
             PRINT*, 'Sorry, I can not get enough wrong integers within ', MAX_WRONG_TRYS, ' tryings: ', &
                LAYER_EXT(LLL), ' expected, in the range of [', IA(1), ',', IA(2), '] with ', &
                'exclusion of [', IA(3), ',', IA(4), '] ',LAYER_I(0, LLL),LAYER_RANGE(1:4, LLL),LLL, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          K=AN_INTEGER_RANDOM(IA(1), IA(2))
          IF((K.GE.IA(3)).AND.(K.LE.IA(4))) GO TO 20
          DO J=0, I-1
             IF(K.EQ.LAYER_I(J, LLL))       GO TO 20
          END DO
          LAYER_I(I, LLL)=K
       END DO


    RETURN
END SUBROUTINE GET_WRONG_INTEGERS




SUBROUTINE GET_FOUR_DOUBELS(D1,DA)
    USE BASE_DATA
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1,D2,DA(4)
    INTEGER           ::  I, J, ACCURACY
    DO I=1, 4
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL CHECK_AND_DELETE_ABSOLUTE(J)
       CALL GET_A_DOUBLE_TEMP3(D2,ACCURACY)
       IF(J.EQ.0) THEN
         DA(I)=D1*D2
       ELSE
         DA(I)=D2
       END IF
    END DO
    RETURN
END SUBROUTINE GET_FOUR_DOUBELS




SUBROUTINE GET_FIVE_DOUBELS(D1)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1,D2
    INTEGER           ::  I, J, ACCURACY
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE_TEMP3(D2,ACCURACY)
    LAYER_L_POSSIBILITY(LAYER_NUMBER)=D2
    DO I=1, 4
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL CHECK_AND_DELETE_ABSOLUTE(J)
       CALL GET_A_DOUBLE_TEMP3(D2,ACCURACY)
       IF(J.EQ.0) THEN
         LAYER_RANGE(I,LAYER_NUMBER)=D2
       ELSE IF(J.EQ.1) THEN
         LAYER_RANGE(I,LAYER_NUMBER)=D1+D2
       ELSE IF(J.EQ.2) THEN
         LAYER_RANGE(I,LAYER_NUMBER)=D1*D2
       ELSE
         STOP
       END IF
    END DO
    IF(LAYER_RANGE(1,LAYER_NUMBER).GT.LAYER_RANGE(2,LAYER_NUMBER)) THEN
       D2=LAYER_RANGE(1,LAYER_NUMBER)
       LAYER_RANGE(1,LAYER_NUMBER)=LAYER_RANGE(2,LAYER_NUMBER)
       LAYER_RANGE(2,LAYER_NUMBER)=D2
    END IF
    IF(LAYER_RANGE(3,LAYER_NUMBER).GT.LAYER_RANGE(4,LAYER_NUMBER)) THEN
       D2=LAYER_RANGE(3,LAYER_NUMBER)
       LAYER_RANGE(3,LAYER_NUMBER)=LAYER_RANGE(4,LAYER_NUMBER)
       LAYER_RANGE(4,LAYER_NUMBER)=D2
    END IF

    IF(LAYER_RANGE(4,LAYER_NUMBER).GE.LAYER_RANGE(2,LAYER_NUMBER)) THEN
       IF(LAYER_RANGE(3,LAYER_NUMBER).LE.LAYER_RANGE(2,LAYER_NUMBER)) THEN
          LAYER_RANGE(2,LAYER_NUMBER)=LAYER_RANGE(3,LAYER_NUMBER)
          IF(LAYER_RANGE(2,LAYER_NUMBER).LT.LAYER_RANGE(1,LAYER_NUMBER)) THEN
              PRINT*, 'Invalid range for generating wrong numbers for multi-choices: ',&
                      D1,LAYER_RANGE(:,LAYER_NUMBER),&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
          END IF
       END IF
       RETURN
    END IF

    IF(LAYER_RANGE(3,LAYER_NUMBER).LE.LAYER_RANGE(1,LAYER_NUMBER)) THEN
       IF(LAYER_RANGE(4,LAYER_NUMBER).GE.LAYER_RANGE(1,LAYER_NUMBER)) THEN
          LAYER_RANGE(1,LAYER_NUMBER)=LAYER_RANGE(4,LAYER_NUMBER)
          IF(LAYER_RANGE(2,LAYER_NUMBER).LT.LAYER_RANGE(1,LAYER_NUMBER)) THEN
              PRINT*, 'Invalid range for generating wrong numbers for multi-choices:: ',&
                      D1,LAYER_RANGE(:,LAYER_NUMBER),&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
          END IF
       END IF
       RETURN
    END IF

    !IF((LAYER_RANGE(2,LAYER_NUMBER)-LAYER_RANGE(4,LAYER_NUMBER)).GT. &
    !   (LAYER_RANGE(3,LAYER_NUMBER)-LAYER_RANGE(1,LAYER_NUMBER))*3.0D0) THEN
    !   RETURN
    !END IF

    !IF(3.0D0*(LAYER_RANGE(2,LAYER_NUMBER)-LAYER_RANGE(4,LAYER_NUMBER)).LT.
    !         (LAYER_RANGE(3,LAYER_NUMBER)-LAYER_RANGE(1,LAYER_NUMBER))) THEN
    !   RETURN
    !END IF

    !IF(LAYER_RANGE(3,LAYER_NUMBER).GT.D1) RETURN
    !IF(LAYER_RANGE(4,LAYER_NUMBER).LT.D1) RETURN

    !D2=MYRAND()
    !IF(D2.LT.0.1) LAYER_RANGE(2,LAYER_NUMBER)=LAYER_RANGE(3,LAYER_NUMBER)
    !IF(D2.GT.0.9) LAYER_RANGE(1,LAYER_NUMBER)=LAYER_RANGE(4,LAYER_NUMBER)

    RETURN
END SUBROUTINE GET_FIVE_DOUBELS




SUBROUTINE MAKE_EXTENTS()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  I, K

    IF(LAYER_NUMBER.LE.0) THEN
       PRINT*,'NO VARIABLE IS USED TO GENERATE CHOICES: ', LAYER_NUMBER, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    ELSE IF(LAYER_NUMBER.EQ.1) THEN

       IF(CHOICES_TO_BE_GENERATED.LT.2) CHOICES_TO_BE_GENERATED=DEFAULT_CHOICES_TO_GENERATE

       IF(CHOICES_TO_BE_GENERATED.GT.MAX_WRONG_POSSIBLE) THEN
           PRINT*,'Too many choices expected: ',CHOICES_TO_BE_GENERATED,  &
                  'No more than ', MAX_WRONG_POSSIBLE, ' please. ', LAYER_TYPE(1), &
                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
           STOP
       END IF

       IF(LAYER_TYPE(LAYER_NUMBER).EQ.I_TYPE) THEN
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED
       ELSE IF(LAYER_TYPE(LAYER_NUMBER).EQ.R_TYPE) THEN
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED
       ELSE IF(LAYER_TYPE(LAYER_NUMBER).EQ.L_TYPE) THEN
           LAYER_EXT(1)=2
           IF(LAYER_EXT(1).NE.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS1: ', &
                    LAYER_EXT(1), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF
       ELSE IF(LAYER_TYPE(LAYER_NUMBER).EQ.S_TYPE) THEN
           IF(LAYER_EXT(1).LT.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS1: ', &
                    LAYER_EXT(1), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED
       END IF
       RETURN

    ELSE IF(LAYER_NUMBER.GT.2) THEN
       IF(CHOICES_TO_BE_GENERATED.LT.2) CHOICES_TO_BE_GENERATED=2**LAYER_NUMBER
       IF(CHOICES_TO_BE_GENERATED.GT.2**LAYER_NUMBER) THEN
                PRINT*,'ONLY UP TO ', 2**LAYER_NUMBER, ' CHOICES ALLOWED IN MAKE_EXTENTS3: ', &
                    'FOR ',LAYER_NUMBER,' LAYERS, BUT ', CHOICES_TO_BE_GENERATED, ' WANTED, SORRY! ', &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
       END IF
       LAYER_EXT=2
       RETURN
    END IF

    IF(CHOICES_TO_BE_GENERATED.LT.2) CHOICES_TO_BE_GENERATED=DEFAULT_CHOICES_TO_GENERATE
!IF(CHOICES_TO_BE_GENERATED.GT.MAX_WRONG_POSSIBLE) CHOICES_TO_BE_GENERATED=DEFAULT_CHOICES_TO_GENERATE


    SELECT CASE (LAYER_TYPE(1))

    CASE(I_TYPE)
       SELECT CASE (LAYER_TYPE(2))

       CASE(I_TYPE)
           DO I=2, CHOICES_TO_BE_GENERATED
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO

       CASE(R_TYPE)
           DO I=2, CHOICES_TO_BE_GENERATED
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO

       CASE(L_TYPE)
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1

       CASE(S_TYPE)
           K=LAYER_EXT(2)
           DO I=2, K
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1

       CASE DEFAULT
           PRINT*,' ILLEGAL DATA TYPE IN MAKE_EXTENTS, PLEASE REPORT2: ', LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
           STOP

       END SELECT

    CASE(R_TYPE)
       SELECT CASE (LAYER_TYPE(2))

       CASE(I_TYPE)
           DO I=2, CHOICES_TO_BE_GENERATED
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO

       CASE(R_TYPE)
           DO I=2, CHOICES_TO_BE_GENERATED
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO

       CASE(L_TYPE)
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1

       CASE(S_TYPE)
           K=LAYER_EXT(2)
           DO I=2, K
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1

       CASE DEFAULT
           PRINT*,' ILLEGAL DATA TYPE IN MAKE_EXTENTS, PLEASE REPORT2: ', LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
           STOP

       END SELECT

    CASE(L_TYPE)
       SELECT CASE (LAYER_TYPE(2))

       CASE(I_TYPE)
           LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1

       CASE(R_TYPE)
           LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1

       CASE(L_TYPE)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS: ', &
                    LAYER_EXT(1), LAYER_EXT(2), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF

       CASE(S_TYPE)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS: ', &
                    LAYER_EXT(1), LAYER_EXT(2), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF
           LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1

       CASE DEFAULT
          PRINT*,' ILLEGAL DATA TYPE IN MAKE_EXTENTS, PLEASE REPORT2: ', LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

       END SELECT

    CASE(S_TYPE)
       SELECT CASE (LAYER_TYPE(2))

       CASE(I_TYPE)
           K=LAYER_EXT(1)
           DO I=2, K
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO
           LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1

       CASE(R_TYPE)
           K=LAYER_EXT(1)
           DO I=2, K
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO
           LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1

       CASE(L_TYPE)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS: ', &
                    LAYER_EXT(1), LAYER_EXT(2), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF
           LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1

       CASE(S_TYPE)
           IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) THEN
                PRINT*,' NOT SO MANY CHOICES AVAILABLE IN MAKE_EXTENTS: ', &
                    LAYER_EXT(1), LAYER_EXT(2), CHOICES_TO_BE_GENERATED, LAYER_TYPE(1), LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
           END IF

           DO I=2, MIN(LAYER_EXT(1), LAYER_EXT(2))
              IF(I*I.GE.CHOICES_TO_BE_GENERATED) THEN
                 LAYER_EXT(1:2)=I
                 GO TO 100
              END IF
           END DO

           IF(LAYER_EXT(1).GE.LAYER_EXT(2)) THEN
              LAYER_EXT(1)=CHOICES_TO_BE_GENERATED/LAYER_EXT(2)
              IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(1)=LAYER_EXT(1)+1
           ELSE
              LAYER_EXT(2)=CHOICES_TO_BE_GENERATED/LAYER_EXT(1)
              IF(LAYER_EXT(1)*LAYER_EXT(2).LT.CHOICES_TO_BE_GENERATED) LAYER_EXT(2)=LAYER_EXT(2)+1
           END IF

       CASE DEFAULT
          PRINT*,' ILLEGAL DATA TYPE IN MAKE_EXTENTS, PLEASE REPORT2: ', LAYER_TYPE(2), &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP

       END SELECT

    CASE DEFAULT
       PRINT*,' ILLEGAL DATA TYPE IN MAKE_EXTENTS, PLEASE REPORT1: ', LAYER_TYPE(1), &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT


    100 CONTINUE
    IF((LAYER_EXT(1).GT.MAX_WRONG_POSSIBLE).OR.(LAYER_EXT(2).GT.MAX_WRONG_POSSIBLE)) THEN
        PRINT*,'Sorry, in order to generate total ', CHOICES_TO_BE_GENERATED, ' choices, ', LAYER_EXT(1),&
               ' and ', LAYER_EXT(2), ' values are needed for the two variables respectively, which is ',&
               'bigger than the maximum: ', MAX_WRONG_POSSIBLE, '. If you really want to generate so ',&
               'many choices, please change MAX_WRONG_POSSIBLE in the code. ', &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
        STOP
    END IF

    RETURN
END SUBROUTINE MAKE_EXTENTS




SUBROUTINE MAKE_CHOICES()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CP, I, J, K, CRT, KK=3, KKK=2

    LAYER_NUMBER=0
    POINTER_TEMP3=0
    SOME_CHOICE_KEY_FOUND=.FALSE.

    IF(SOLUTION_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in a solution region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(ANSWER_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in an ANSWER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' is not allowed in an ORDER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_CHOICES_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' keys are not allowed NESTEDLY. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, MANY_CHOICES_KEY, ' keys are not IN A MATCH REGION. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    MANY_CHOICES_FOUND=.TRUE.

    CALL FIRST_PROCESSING(MANY_CHOICES_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(I)
    CHOICES_TO_BE_GENERATED=I
    CALL READ_NONE_CHOICE()


   !CALL FIRST_PROCESSING(MANY_CHOICES_KEY)
    CALL SOLVE_THE_QUESTION(0,0)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)

    READ_DO: DO
         CALL READ_A_LINE()
         IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
              PRINT*, 'NO ', END_MANY_CHOICES_KEY, ' KEY FOUND. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF
         CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)

         IF(DO_NOT_OUTPUT) THEN
            DO_NOT_OUTPUT=.FALSE.
            CYCLE READ_DO
         END IF
         IF(CP.LE.0) THEN
              WRITE(TEMP3_FILE_TUNNEL,'(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              POINTER_TEMP3=POINTER_TEMP3+1
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+INTEGER_KEY_LENTH), INTEGER_KEY).GT.0) THEN
              CALL GET_TRIPLE_INTEGERS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_KEY_LENTH), REAL_KEY).GT.0) THEN
              CALL GET_TRIPLE_DOUBLES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_KEY_LENTH), COMPLEX_KEY).GT.0) THEN
              CALL GET_TRIPLE_COMPLEXES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+VECTOR_KEY_LENTH), VECTOR_KEY).GT.0) THEN
              CALL GET_TRIPLE_VECTORS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+LOGICAL_KEY_LENTH), LOGICAL_KEY).GT.0) THEN
              CALL GET_LOGICALS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_KEY_LENTH), STRING_KEY).GT.0) THEN
              CALL GET_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+NEW_STRING_KEY_LENTH), NEW_STRING_KEY).GT.0) THEN
              CALL GET_NEW_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+INTEGER_MATRIX_KEY_LENTH), INTEGER_MATRIX_KEY).GT.0) THEN
              CALL GET_INTEGER_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_MATRIX_KEY_LENTH), REAL_MATRIX_KEY).GT.0) THEN
              CALL GET_REAL_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_MATRIX_KEY_LENTH), COMPLEX_MATRIX_KEY).GT.0) THEN
              CALL GET_COMPLEX_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_MATRIX_KEY_LENTH), STRING_MATRIX_KEY).GT.0) THEN
              CALL GET_STRING_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_IN_KEY_LENTH), PRINT_IN_KEY).GT.0) THEN
              CALL PRINT_AN_INPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_OUT_KEY_LENTH), PRINT_OUT_KEY).GT.0) THEN
              CALL PRINT_AN_OUTPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SET_ACCURACY_KEY_LENTH), SET_ACCURACY_KEY).GT.0) THEN
              CALL SET_ACCURARY(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SOME_CHOICE_KEY_LENTH), SOME_CHOICE_KEY).GT.0) THEN
              IF(SOME_CHOICE_KEY_FOUND) THEN
                !PRINT*, 'Only one '//SOME_CHOICE_KEY//' key allowed in multichoice-auto region: ', &
                !         LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                !STOP
              ELSE
                 SOME_CHOICE_KEY_FOUND=.TRUE.
              END IF
              CALL GET_SOME_CHOICES()
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_MANY_CHOICES_KEY_LENTH), END_MANY_CHOICES_KEY).GT.0) THEN
             !CALL FIRST_PROCESSING_TEMP3(END_MANY_CHOICES_KEY)
              MANY_CHOICES_FOUND=.FALSE.
              THE_READ=' '
              THE_READ_LENGTH=0
             !IF(THE_READ_LENGTH.GT.0) THEN
             !   PRINT*, 'No character is allowed after and in the same line ',END_MANY_CHOICES_KEY,'. ',&
             !            LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             !   STOP
             !END IF
              EXIT READ_DO
         ELSE
              PRINT*, 'No other key is allowed here (MAKE_CHOICES): ', TRIM(THE_READ), &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

         END DO CHECK_DO

    END DO READ_DO

    WRITE(TEMP3_FILE_TUNNEL,*)' '
    CLOSE(TEMP3_FILE_TUNNEL)

    !IF(QUESTION_POSITION(5,QUESTION_NUMBER).EQ.MULTIPLE_CHOICE_DISABLED) THEN
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) CHOICE_REPLACED_BY_SPACE
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   RETURN
    !END IF


    CALL MAKE_EXTENTS()
    TOTAL_NUMBER_OF_ITEMS=1
    DO I=1, LAYER_NUMBER
       TOTAL_NUMBER_OF_ITEMS=TOTAL_NUMBER_OF_ITEMS*LAYER_EXT(I)
    END DO
    CALL GENERATE_CHOICES(CRT)

    TOTAL_NUMBER_OF_ITEMS=CHOICES_TO_BE_GENERATED

    CALL MAKE_ALL_IR_WRONG_VALUES()


    IF(BOX_FOR_CHOICE.EQ.1) THEN
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_CHOICE,YOUR_CHOICE_POST)
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    END IF

    DO I=1, LAYER_NUMBER-1
    DO J=I+1, LAYER_NUMBER
       IF(LAYER_POSITION(1,I).GE.LAYER_POSITION(1,J)) THEN
              PRINT*, 'A BUG IN THE CODE WORKING ON A CHOICE REGION, PLEASE REPORT: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
       END IF
    END DO
    END DO

    DO I=1, LAYER_NUMBER
       IF(LAYER_POSITION(1,I).GT.POINTER_TEMP3) THEN
              PRINT*, 'A BUG IN THE CODE WORKING ON A CHOICE REGION, PLEASE REPORT: ',LAYER_POSITION(1,I),&
                      LAYER_NUMBER, LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
       END IF
    END DO

    NONE_CHOICE_WON=.FALSE.

    TOTAL_NUMBER_OF_AUTO_ANSWERS=TOTAL_NUMBER_OF_AUTO_ANSWERS+1
    IF(TOTAL_NUMBER_OF_AUTO_ANSWERS.GT.MAX_NUMBER_AUTO_ANSWERS) THEN
       PRINT*, 'NO MORE SPACE FOR AUTO-ANSWER #: ', TOTAL_NUMBER_OF_AUTO_ANSWERS, MAX_NUMBER_AUTO_ANSWERS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE, POSITION='APPEND')

    IF(LAYER_NUMBER.LE.0) THEN
       PRINT*, 'NOTHING TO CHOOSE IN A CHOICE REGION: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    ELSE IF(LAYER_NUMBER.EQ.1) THEN
      !TOTAL_NUMBER_OF_ITEMS=LAYER_EXT(1)
      !CALL GENERATE_CHOICES()
      !DO I=1, TOTAL_NUMBER_OF_ITEMS
      !   IF(LAYER_GENERATOR(I).EQ.1) THEN
      !      CRT=I
      !      EXIT
      !   END IF
      !END DO

       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL DECIDE_NONE_CHOICE()
          IF(NONE_CHOICE_WON) THEN
             IF(CRT.NE.TOTAL_NUMBER_OF_ITEMS) THEN
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
                CRT=TOTAL_NUMBER_OF_ITEMS
             END IF
          ELSE
             IF(CRT.EQ.TOTAL_NUMBER_OF_ITEMS) THEN
                CRT=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_ITEMS-1)
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
             END IF
          END IF
       END IF

       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          CALL WRITE_A_CHOICE1( OUTPUT_FILE_TUNNEL,I)
          CALL WRITE_A_CHOICE1(JOURNAL_FILE_TUNNEL,I)
       END DO

       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL WRITE_A_CHOICE_HEAD( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE( OUTPUT_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
       ELSE
          CALL WRITE_A_CHOICE1( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
          CALL WRITE_A_CHOICE1(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
       END IF

       IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWEL
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(ANSW_LUTION_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSWER_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE1(ANSW_LUTION_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE1(    JOURNAL_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE1(     ANSWER_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,CRT-1)
       END IF
       END IF

       AUTO_ANSWER_INDEX(1, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(AUTO_TEMP_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE1(AUTO_TEMP_FILE_TUNNEL,CRT)
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,CRT-1)
       END IF
       AUTO_ANSWER_INDEX(4, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS

    ELSE IF(LAYER_NUMBER.EQ.2) THEN
      !IF(LAYER_EXT(1).GT.3) LAYER_EXT(1)=3
      !IF(LAYER_EXT(2).GT.3) LAYER_EXT(2)=3
      !TOTAL_NUMBER_OF_ITEMS=LAYER_EXT(1)*LAYER_EXT(2)
      !IF(TOTAL_NUMBER_OF_ITEMS.GT.8) TOTAL_NUMBER_OF_ITEMS=8
      !CALL GENERATE_CHOICES()
      !DO I=1, TOTAL_NUMBER_OF_ITEMS
      !   IF(LAYER_GENERATOR(I).EQ.1) THEN
      !      CRT=I
      !      EXIT
      !   END IF
      !END DO
      !IF(CRT.GT.6) THEN
      !    J=AN_INTEGER_RANDOM(1, 6)
      !   LAYER_GENERATOR(CRT)=LAYER_GENERATOR(J)
      !   LAYER_GENERATOR(J)=1
      !  CRT=J
      !END IF
      !IF(TOTAL_NUMBER_OF_ITEMS.GT.6) TOTAL_NUMBER_OF_ITEMS=6

       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL DECIDE_NONE_CHOICE()
          IF(NONE_CHOICE_WON) THEN
             IF(CRT.NE.TOTAL_NUMBER_OF_ITEMS) THEN
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
                CRT=TOTAL_NUMBER_OF_ITEMS
             END IF
          ELSE
             IF(CRT.EQ.TOTAL_NUMBER_OF_ITEMS) THEN
                CRT=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_ITEMS-1)
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
             END IF
          END IF
       END IF

       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          CALL WRITE_A_CHOICE2( OUTPUT_FILE_TUNNEL,I)
          CALL WRITE_A_CHOICE2(JOURNAL_FILE_TUNNEL,I)
       END DO

       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL WRITE_A_CHOICE_HEAD( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE( OUTPUT_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
       ELSE
          CALL WRITE_A_CHOICE2( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
          CALL WRITE_A_CHOICE2(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
       END IF


       IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWEL
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(ANSW_LUTION_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSWER_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE2(ANSW_LUTION_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE2(    JOURNAL_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE2(     ANSWER_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,CRT-1)
       END IF
       END IF

       AUTO_ANSWER_INDEX(1, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(AUTO_TEMP_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE2(AUTO_TEMP_FILE_TUNNEL,CRT)
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,CRT-1)
       END IF
       AUTO_ANSWER_INDEX(4, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS

    ELSE  ! For more than two layers.
      !TOTAL_NUMBER_OF_ITEMS=2**LAYER_NUMBER
      !CALL GENERATE_CHOICES()
      !DO I=1, TOTAL_NUMBER_OF_ITEMS
      !   IF(LAYER_GENERATOR(I).EQ.1) THEN
      !      CRT=I
      !      EXIT
      !   END IF
      !END DO
       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL DECIDE_NONE_CHOICE()
          IF(NONE_CHOICE_WON) THEN
             IF(CRT.NE.TOTAL_NUMBER_OF_ITEMS) THEN
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
                CRT=TOTAL_NUMBER_OF_ITEMS
             END IF
          ELSE
             IF(CRT.EQ.TOTAL_NUMBER_OF_ITEMS) THEN
                CRT=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_ITEMS-1)
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
             END IF
          END IF
       END IF
       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          CALL WRITE_A_CHOICE( OUTPUT_FILE_TUNNEL,I)
          CALL WRITE_A_CHOICE(JOURNAL_FILE_TUNNEL,I)
       END DO
       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL WRITE_A_CHOICE_HEAD( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE( OUTPUT_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
       ELSE
          CALL WRITE_A_CHOICE( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
          CALL WRITE_A_CHOICE(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
       END IF


       IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWEL
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(ANSW_LUTION_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(ANSWER_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE(ANSW_LUTION_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE(    JOURNAL_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE(     ANSWER_FILE_TUNNEL,CRT)
          CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,CRT-1)
       END IF
       END IF

       AUTO_ANSWER_INDEX(1, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(AUTO_TEMP_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE
          CALL WRITE_A_CHOICE(AUTO_TEMP_FILE_TUNNEL,CRT)
          AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
          AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,CRT-1)
       END IF
       AUTO_ANSWER_INDEX(4, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS

    END IF

    IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_ENL
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
      !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
      !WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
    END IF

    WRITE(OUTPUT_FILE_TUNNEL,'(A)')' '
    WRITE(OUTPUT_FILE_TUNNEL,'(A)')' '

    ANSWER_COUNTER=ANSWER_COUNTER+1
    MANY_CHOICES_COUNTER=MANY_CHOICES_COUNTER+1

    CLOSE(AUTO_TEMP_FILE_TUNNEL)

    RETURN
END SUBROUTINE MAKE_CHOICES




SUBROUTINE GET_AN_ORDER()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CFO
   !INTEGER           ::  ANOTHER_I

    IF(SOLUTION_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed in a solution region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(ANSWER_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed in an ANSWER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(MANY_CHOICES_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed in a CHOICE region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed in a MATCH region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    LAYER_NUMBER=LAYER_NUMBER+1
    IF(LAYER_NUMBER.GT.MAX_LAYER_TO_ORDER) THEN
       PRINT*, 'Too many layers in the ORDER region: ', LAYER_NUMBER, MAX_LAYER_TO_ORDER,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    CALL FIRST_PROCESSING_TEMP3(ONE_TO_ORDER_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER_TEMP3(CFO)
    CALL CHECK_AND_DELETE(DATA_END_KEY)
    IF((CFO.LE.-1).OR.(CFO.GE.2)) THEN
       PRINT*, 'ILLEGAL CALCULATED NUMBER in the ORDER region: ', CFO, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
   !CALL GET_AN_INTEGER_TEMP3(ANOTHER_I)
   !CALL SOLVE_THE_QUESTION(CFO,ANOTHER_I)

    LAYER_CORRECT(LAYER_NUMBER)=CFO
    LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
   !LAYER_CALCULATED( LAYER_NUMBER)=CFO
   !LAYER_TYPE(       LAYER_NUMBER)=CALCULATED_TYPE(CFO)

    THE_READ_LENGTH= THE_READ_WORK2_LENGTH
    THE_READ=' '
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    LAYER_POSITION(2, LAYER_NUMBER)=THE_READ_LENGTH

    RETURN
END SUBROUTINE GET_AN_ORDER




SUBROUTINE MAKE_ORDERS()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CP, I, J, K, CRT, KK=3, KKK=2, T_CRTS, T_CRTS_EFFT
    LAYER_NUMBER=0
    POINTER_TEMP3=0

    IF(SOLUTION_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed in a solution region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(ANSWER_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed IN AN ANSWER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_CHOICES_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed IN A CHOICE region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed IN A MATCH region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, MANY_TO_ORDER_KEY, ' is not allowed NESTEDLY. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    MANY_TO_ORDER_FOUND=.TRUE.

    CALL FIRST_PROCESSING(MANY_TO_ORDER_KEY)
    DATA_BEGIN_NUMBER=0
    CALL CHECK_AND_DELETE_S(DATA_BEGIN_KEY,K,I)
    IF((THE_READ_WORK2(1:K).NE.' ').OR.(I.NE.1)) THEN
              PRINT*, 'No bracket follows the key '//MANY_TO_ORDER_KEY//' immediately: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    CALL READ_NONE_CHOICE_STRING()


   !CALL FIRST_PROCESSING(MANY_TO_ORDER_KEY)
    CALL SOLVE_THE_QUESTION(0,0)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)

    READ_DO: DO
         CALL READ_A_LINE()
         IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
              PRINT*, 'NO ', END_MANY_TO_ORDER_KEY, ' KEY FOUND. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF
         CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
         IF(DO_NOT_OUTPUT) THEN
            DO_NOT_OUTPUT=.FALSE.
            CYCLE READ_DO
         END IF
         IF(CP.LE.0) THEN
              WRITE(TEMP3_FILE_TUNNEL,'(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              POINTER_TEMP3=POINTER_TEMP3+1
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+INTEGER_KEY_LENTH), INTEGER_KEY).GT.0) THEN
              CALL GET_TRIPLE_INTEGERS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_KEY_LENTH), REAL_KEY).GT.0) THEN
              CALL GET_TRIPLE_DOUBLES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_KEY_LENTH), COMPLEX_KEY).GT.0) THEN
              CALL GET_TRIPLE_COMPLEXES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+VECTOR_KEY_LENTH), VECTOR_KEY).GT.0) THEN
              CALL GET_TRIPLE_VECTORS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+LOGICAL_KEY_LENTH), LOGICAL_KEY).GT.0) THEN
              CALL GET_LOGICALS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_KEY_LENTH), STRING_KEY).GT.0) THEN
              CALL GET_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+NEW_STRING_KEY_LENTH), NEW_STRING_KEY).GT.0) THEN
              CALL GET_NEW_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+INTEGER_MATRIX_KEY_LENTH), INTEGER_MATRIX_KEY).GT.0) THEN
              CALL GET_INTEGER_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_MATRIX_KEY_LENTH), REAL_MATRIX_KEY).GT.0) THEN
              CALL GET_REAL_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_MATRIX_KEY_LENTH), COMPLEX_MATRIX_KEY).GT.0) THEN
              CALL GET_COMPLEX_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_MATRIX_KEY_LENTH), STRING_MATRIX_KEY).GT.0) THEN
              CALL GET_STRING_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_IN_KEY_LENTH), PRINT_IN_KEY).GT.0) THEN
              CALL PRINT_AN_INPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_OUT_KEY_LENTH), PRINT_OUT_KEY).GT.0) THEN
              CALL PRINT_AN_OUTPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SET_ACCURACY_KEY_LENTH), SET_ACCURACY_KEY).GT.0) THEN
              CALL SET_ACCURARY(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+ONE_TO_ORDER_KEY_LENTH), ONE_TO_ORDER_KEY).GT.0) THEN
              CALL GET_AN_ORDER()
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_MANY_TO_ORDER_KEY_LENTH), END_MANY_TO_ORDER_KEY).GT.0) THEN
             !CALL FIRST_PROCESSING_TEMP3(END_MANY_TO_ORDER_KEY)
              THE_READ=' '
              THE_READ_LENGTH=0
              MANY_TO_ORDER_FOUND=.FALSE.
              LAYER_POSITION(1,LAYER_NUMBER+1)=POINTER_TEMP3+100
             !IF(THE_READ_LENGTH.GT.0) THEN
             !   PRINT*, 'No character is allowed after and in the same line ',END_MANY_TO_ORDER_KEY,'. ',&
             !            LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             !   STOP
             !END IF
              EXIT READ_DO
         ELSE
              PRINT*, 'No other key is allowed here: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

         END DO CHECK_DO

    END DO READ_DO

    WRITE(TEMP3_FILE_TUNNEL,*)' '
    CLOSE(TEMP3_FILE_TUNNEL)

    !IF(QUESTION_POSITION(5,QUESTION_NUMBER).EQ.MULTIPLE_CHOICE_DISABLED) THEN
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) CHOICE_REPLACED_BY_SPACE
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    !   RETURN
    !END IF

    IF(BOX_FOR_CHOICE.EQ.1) THEN
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_CHOICE,YOUR_CHOICE_POST)
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
       WRITE(OUTPUT_FILE_TUNNEL,*) ' '
    END IF

    DO I=1, LAYER_NUMBER-1
    DO J=I+1, LAYER_NUMBER
       IF(LAYER_POSITION(1,I).GE.LAYER_POSITION(1,J)) THEN
              PRINT*, 'A BUG IN THE CODE WORKING ON AN ORDER REGION, PLEASE REPORT: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
       END IF
    END DO
    END DO

    J=0
    DO I=1, LAYER_NUMBER
       IF((LAYER_POSITION(1,I).LT.1).OR.(LAYER_POSITION(1,I).GT.POINTER_TEMP3)) THEN
              PRINT*, 'A BUG IN THE CODE WORKING ON AN ORDER REGION, PLEASE REPORT: ',LAYER_POSITION(1,I),&
                      LAYER_NUMBER, LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
       END IF
       IF(LAYER_CORRECT(I).GT.0) THEN
          J=J+1
          !IF(J.GT.1) THEN
          !    PRINT*, 'ONLY ONE CORRECT CHOICE ALLOWED IN AN ORDER REGION: ', J, I, LAYER_NUMBER, &
          !            LAYER_NUMBER, LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          !    STOP
          !END IF
       END IF
    END DO
    IF(J.LT.1) THEN
              PRINT*, 'NO CORRECT CHOICE IN AN ORDER REGION: ', J, LAYER_NUMBER, &
                      LAYER_NUMBER, LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    T_CRTS=J

    IF(LAYER_NUMBER.LE.1) THEN
              PRINT*, 'NO CHOICE IN AN ORDER REGION: ', LAYER_NUMBER, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    IF(LAYER_POSITION(1,1).NE.1) THEN
              PRINT*, 'Nothing is allowed in between PTC-MULTICHOICE-USER() and PTC-CHOICE()', &
                      LAYER_POSITION(1,1), LAYER_NUMBER, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF

    TOTAL_NUMBER_OF_ITEMS=LAYER_NUMBER
    CHOICES_TO_BE_GENERATED=TOTAL_NUMBER_OF_ITEMS
    CALL GENERATE_CHOICES(CRT)
    DO I=1, TOTAL_NUMBER_OF_ITEMS
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
             CRT=I
             EXIT
          END IF
    END DO

    NONE_CHOICE_WON=.FALSE.

    IF(T_CRTS.EQ.1) THEN
       IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL DECIDE_NONE_CHOICE()
          IF(NONE_CHOICE_WON) THEN
             IF(CRT.NE.TOTAL_NUMBER_OF_ITEMS) THEN
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
                CRT=TOTAL_NUMBER_OF_ITEMS
             END IF
          ELSE
             IF(CRT.EQ.TOTAL_NUMBER_OF_ITEMS) THEN
                CRT=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_ITEMS-1)
                K=LAYER_GENERATOR(CRT)
                LAYER_GENERATOR(CRT)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)
                LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS)=K
             END IF
          END IF
       END IF
    END IF

    DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          CALL WRITE_AN_ORDER( OUTPUT_FILE_TUNNEL,I)
          CALL WRITE_AN_ORDER(JOURNAL_FILE_TUNNEL,I)
    END DO

    IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
          CALL WRITE_A_CHOICE_HEAD( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE( OUTPUT_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
    ELSE
          CALL WRITE_AN_ORDER( OUTPUT_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
          CALL WRITE_AN_ORDER(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS)
    END IF
    WRITE(OUTPUT_FILE_TUNNEL,'(A)')' '
    WRITE(OUTPUT_FILE_TUNNEL,'(A)')' '

    IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWEL
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER

       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
             CALL WRITE_AN_ORDER(ANSW_LUTION_FILE_TUNNEL,I)
             CALL WRITE_AN_ORDER(    JOURNAL_FILE_TUNNEL,I)
             CALL WRITE_AN_ORDER(     ANSWER_FILE_TUNNEL,I)
             CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,I-1)
          END IF
       END DO

       IF(NONE_CHOICE_WON) THEN
             CALL WRITE_A_CHOICE_HEAD(ANSW_LUTION_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
             WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
             CALL WRITE_A_CHOICE_HEAD(JOURNAL_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
             WRITE(JOURNAL_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
             CALL WRITE_A_CHOICE_HEAD(ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
             WRITE(ANSWER_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
             CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
       ELSE
             I=TOTAL_NUMBER_OF_ITEMS
             J=LAYER_GENERATOR(I)
             IF(LAYER_CORRECT(J).GE.1) THEN
                CALL WRITE_AN_ORDER(ANSW_LUTION_FILE_TUNNEL,I)
                CALL WRITE_AN_ORDER(    JOURNAL_FILE_TUNNEL,I)
                CALL WRITE_AN_ORDER(     ANSWER_FILE_TUNNEL,I)
                CALL WRITE_A_CHOICE_HEAD2(SHORTEST_ANSWER_FILE_TUNNEL,I-1)
             END IF
       END IF

       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_ENL
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
      !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
      !WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
       WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
    END IF

    TOTAL_NUMBER_OF_AUTO_ANSWERS=TOTAL_NUMBER_OF_AUTO_ANSWERS+1
    IF(TOTAL_NUMBER_OF_AUTO_ANSWERS.GT.MAX_NUMBER_AUTO_ANSWERS) THEN
          PRINT*, 'NO MORE SPACE FOR AUTO-ANSWER #: ', TOTAL_NUMBER_OF_AUTO_ANSWERS, MAX_NUMBER_AUTO_ANSWERS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE, POSITION='APPEND')
    AUTO_ANSWER_INDEX(1, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1

       T_CRTS_EFFT=0
       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
             CALL WRITE_AN_ORDER(AUTO_TEMP_FILE_TUNNEL,I)
             T_CRTS_EFFT=T_CRTS_EFFT+1
          END IF
       END DO

       IF(NONE_CHOICE_WON) THEN
          IF(T_CRTS_EFFT.GE.1) THEN
              PRINT*, 'A bug is found in MAKE_ORDERS (asdfas), please report: ', &
                      NONE_CHOICE_WON, T_CRTS_EFFT, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
          END IF
          T_CRTS_EFFT=T_CRTS_EFFT+1
          CALL WRITE_A_CHOICE_HEAD(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
          WRITE(AUTO_TEMP_FILE_TUNNEL,'(A)') TRIM(NONE_ABOVE_CHOICE)
          LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
       ELSE IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
       ELSE
          I=TOTAL_NUMBER_OF_ITEMS
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
                CALL WRITE_AN_ORDER(AUTO_TEMP_FILE_TUNNEL,I)
                T_CRTS_EFFT=T_CRTS_EFFT+1
          END IF
       END IF
       IF(T_CRTS_EFFT.LE.0) THEN
              PRINT*, 'A bug is found in MAKE_ORDERS (asdfUIUIas), please report: ', &
                      T_CRTS_EFFT, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
       END IF

    AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
    AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1

       DO I=1, TOTAL_NUMBER_OF_ITEMS-1
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
             CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,I-1)
          END IF
       END DO

       IF(NONE_CHOICE_WON) THEN
          CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,TOTAL_NUMBER_OF_ITEMS-1)
       ELSE IF((NONE_CHOICE_REPLACES.EQ.1).AND.(TOTAL_NUMBER_OF_ITEMS.GE.MIN_TOTAL_TERMS_FOR_NONE)) THEN
       ELSE
          I=TOTAL_NUMBER_OF_ITEMS
          J=LAYER_GENERATOR(I)
          IF(LAYER_CORRECT(J).GE.1) THEN
                CALL WRITE_A_CHOICE_HEAD2(AUTO_TEMP_FILE_TUNNEL,I-1)
          END IF
       END IF

    AUTO_ANSWER_INDEX(4, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
    CLOSE(AUTO_TEMP_FILE_TUNNEL)

    ANSWER_COUNTER=ANSWER_COUNTER+1
    MANY_TO_ORDER_COUNTER=MANY_TO_ORDER_COUNTER+1

    RETURN
END SUBROUTINE MAKE_ORDERS




SUBROUTINE GET_COLUMN_LEFT()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CFO
    LAYER_NUMBER=LAYER_NUMBER+1
    IF(LAYER_NUMBER.GT.MAX_LAYER_TO_ORDER) THEN
       PRINT*, 'Too many layers in the ORDER region: ', LAYER_NUMBER, MAX_LAYER_TO_ORDER,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    IF(LAYER_NUMBER.GT.MAX_ITEMS_IN_A_COLUMN) THEN
       PRINT*, 'Too many items in the COLUMN region: ', LAYER_NUMBER, MAX_ITEMS_IN_A_COLUMN,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    TOTAL_NUMBER_OF_LEFT_COLUMN=TOTAL_NUMBER_OF_LEFT_COLUMN+1
    CALL FIRST_PROCESSING_TEMP3(COLUMN_LEFT_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER_TEMP3(CFO)
    CALL CHECK_AND_DELETE(DATA_END_KEY)
    LEFT_COLUMN(1,TOTAL_NUMBER_OF_LEFT_COLUMN)=CFO
    LEFT_COLUMN(2,TOTAL_NUMBER_OF_LEFT_COLUMN)=LAYER_NUMBER
    LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
    THE_READ_LENGTH= THE_READ_WORK2_LENGTH
    THE_READ=' '
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    RETURN
END SUBROUTINE GET_COLUMN_LEFT




SUBROUTINE GET_COLUMN_RIGHT()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CFO
    LAYER_NUMBER=LAYER_NUMBER+1
    IF(LAYER_NUMBER.GT.MAX_LAYER_TO_ORDER) THEN
       PRINT*, 'Too many layers in the ORDER region: ', LAYER_NUMBER, MAX_LAYER_TO_ORDER,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    IF(LAYER_NUMBER.GT.MAX_ITEMS_IN_A_COLUMN) THEN
       PRINT*, 'Too many items in the COLUMN region: ', LAYER_NUMBER, MAX_ITEMS_IN_A_COLUMN,&
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    TOTAL_NUMBER_OF_RIGHT_COLUMN=TOTAL_NUMBER_OF_RIGHT_COLUMN+1
    CALL FIRST_PROCESSING_TEMP3(COLUMN_RIGHT_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER_TEMP3(CFO)
    CALL CHECK_AND_DELETE(DATA_END_KEY)
    RIGHT_COLUMN(1,TOTAL_NUMBER_OF_RIGHT_COLUMN)=CFO
    RIGHT_COLUMN(2,TOTAL_NUMBER_OF_RIGHT_COLUMN)=LAYER_NUMBER
    LAYER_POSITION(1, LAYER_NUMBER)=POINTER_TEMP3+1
    THE_READ_LENGTH= THE_READ_WORK2_LENGTH
    THE_READ=' '
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    RETURN
END SUBROUTINE GET_COLUMN_RIGHT




SUBROUTINE GET_A_MATCH_ANSWER_R(TUNNEL,L,KEY)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER  :: TUNNEL,KEY, I1, K2, L, R3

    IF(KEY.NE.0) THEN
       K2=0
       DO I1=1, PAIRS_FOR_MATCH
          R3=SELECTED_RIGHT_COLUMN(I1)
          IF(LEFT_COLUMN(1,L).EQ.RIGHT_COLUMN(1,R3)) THEN
             K2=K2+1
             IF(K2.GT.1) THEN
                WRITE(TUNNEL,'(A)')', '
                IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
             END IF
             CALL WRITE_A_CHOICE_HEAD2(TUNNEL,I1-1)
          END IF
       END DO
    END IF
    WRITE(TUNNEL,'(A)')' & '
    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1

    RETURN
END SUBROUTINE GET_A_MATCH_ANSWER_R




SUBROUTINE GET_A_MATCH_ANSWER_L(TUNNEL,R,KEY)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER  :: TUNNEL,KEY, I1, K2, R, L3
    WRITE(TUNNEL,'(A)')' & '
    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1

    IF(KEY.NE.0) THEN
       K2=0
       DO I1=1, PAIRS_FOR_MATCH
          L3=SELECTED_LEFT_COLUMN(I1)
          IF(LEFT_COLUMN(1,L3).EQ.RIGHT_COLUMN(1,R)) THEN
             K2=K2+1
             IF(K2.GT.1) THEN
                WRITE(TUNNEL,'(A)')', '
                IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
             END IF
             CALL WRITE_A_CHOICE_HEAD2(TUNNEL,I1-1)
          END IF
       END DO
    END IF

    RETURN
END SUBROUTINE GET_A_MATCH_ANSWER_L




SUBROUTINE WRITE_A_MATCH(TUNNEL,KEY)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    INTEGER  :: TUNNEL,KEY,I, L, R, L2, R2

    WRITE(TUNNEL,*)' '
    WRITE(TUNNEL,*)' '
    IF(LEFT_RIGHT_OR_BOTH.EQ.3) THEN
       WRITE(TUNNEL,'(A)')'\begin{tabular}{|l|l|l|l|}'
    ELSE
       WRITE(TUNNEL,'(A)')'\begin{tabular}{|l|l|l|}'
    END IF
    WRITE(TUNNEL,*)'\hline'
    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+4

    IF(LEFT_RIGHT_OR_BOTH.EQ.1) THEN
       WRITE(TUNNEL,'(A)')CHOICE_OR_ANSWER(KEY+1)//' & '//COLUMN_NAMES//' \\ '
    ELSE IF(LEFT_RIGHT_OR_BOTH.EQ.2) THEN
       WRITE(TUNNEL,'(A)')COLUMN_NAMES//' & '//CHOICE_OR_ANSWER(KEY+1)//' \\ '
    ELSE IF(LEFT_RIGHT_OR_BOTH.EQ.3) THEN
       WRITE(TUNNEL,'(A)')CHOICE_OR_ANSWER(KEY+1)//' & '//COLUMN_NAMES//' & '//CHOICE_OR_ANSWER(KEY+1)//' \\ '
    END IF
    WRITE(TUNNEL,*)'\hline'
    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+2

    DO I=1, PAIRS_FOR_MATCH
       L=SELECTED_LEFT_COLUMN(I)
       R=SELECTED_RIGHT_COLUMN(I)
       L2=LEFT_COLUMN(2,L)
       R2=RIGHT_COLUMN(2,R)

       IF(LEFT_RIGHT_OR_BOTH.EQ.1) THEN
          CALL GET_A_MATCH_ANSWER_R(TUNNEL,L,KEY)
       ELSE IF(LEFT_RIGHT_OR_BOTH.EQ.2) THEN
          CALL WRITE_A_CHOICE_HEAD2(TUNNEL,I-1)
       ELSE IF(LEFT_RIGHT_OR_BOTH.EQ.3) THEN
          CALL GET_A_MATCH_ANSWER_R(TUNNEL,L,KEY)
          CALL WRITE_A_CHOICE_HEAD2(TUNNEL,I-1)
       END IF

       CALL COPY_LINES_FROM_TEMP3(TUNNEL,L2)
       WRITE(TUNNEL,*)' & '
       IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1

       IF((LEFT_RIGHT_OR_BOTH.EQ.1).OR.(LEFT_RIGHT_OR_BOTH.EQ.3)) THEN
          CALL WRITE_A_CHOICE_HEAD2(TUNNEL,I-1)
       END IF

       CALL COPY_LINES_FROM_TEMP3(TUNNEL,R2)

       IF((LEFT_RIGHT_OR_BOTH.EQ.2).OR.(LEFT_RIGHT_OR_BOTH.EQ.3)) THEN
          CALL GET_A_MATCH_ANSWER_L(TUNNEL,R,KEY)
       END IF
       WRITE(TUNNEL,'(A)')' \\ '
       WRITE(TUNNEL,'(A)')' \hline'
       IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+2
    END DO
    WRITE(TUNNEL,*)'\end{tabular}'
    WRITE(TUNNEL,*)' '
    WRITE(TUNNEL,*)' '
    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+3
    RETURN
END SUBROUTINE WRITE_A_MATCH




SUBROUTINE COPY_LINES_FROM_TEMP3(TUNNEL,J)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J
    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)
    READ_DO: DO I=1, LAYER_POSITION(1,J+1)-1
        THE_READ_WORK7=' '
        READ(TEMP3_FILE_TUNNEL,'(A)') THE_READ_WORK7
        IF(I.GE.LAYER_POSITION(1,J)) THEN
           THE_READ_WORK7_LENGTH=LEN_TRIM(THE_READ_WORK7)
           IF(THE_READ_WORK7_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_PL) THEN
              PRINT*, 'Sorry, too long line in the temp3 file (COPY_...FROM_TEMP3), please report: ', &
                       THE_READ_WORK7_LENGTH, MAX_NUMBER_OF_CHARACTERS_PL, I, LINE_NUMBER
              STOP
           END IF
           WRITE(TUNNEL, '(A)') THE_READ_WORK7(1:THE_READ_WORK7_LENGTH)
           IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
        END IF
    END DO READ_DO
    CLOSE(TEMP3_FILE_TUNNEL)
    RETURN
END SUBROUTINE COPY_LINES_FROM_TEMP3




SUBROUTINE MAKE_MATCH()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  J, J1, J2, J3, J4
    INTEGER           ::  CP, I, K, M, EXC(1), KK=3, KKK=2
    LAYER_NUMBER=0
    POINTER_TEMP3=0
    COLUMN_NUMBER=0
    PAIRS_FOR_MATCH=0
    TOTAL_NUMBER_OF_LEFT_COLUMN=0
    TOTAL_NUMBER_OF_RIGHT_COLUMN=0

    IF(SOLUTION_FOUND) THEN
              PRINT*, COLUMN_MATCH_KEY, ' is not allowed in a solution region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(ANSWER_FOUND) THEN
              PRINT*, COLUMN_MATCH_KEY, ' is not allowed IN AN ANSWER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_CHOICES_FOUND) THEN
              PRINT*, COLUMN_MATCH_KEY, ' is not allowed IN A CHOICE region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(MANY_TO_ORDER_FOUND) THEN
              PRINT*, COLUMN_MATCH_KEY, ' is not allowed IN AN ORDER region. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    IF(COLUMN_MATCH_FOUND) THEN
              PRINT*, COLUMN_MATCH_KEY, ' is not allowed NESTEDLY. ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    COLUMN_MATCH_FOUND=.TRUE.

    CALL FIRST_PROCESSING(COLUMN_MATCH_KEY)
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(I)
    PAIRS_FOR_MATCH=I
    IF(PAIRS_FOR_MATCH.LE.0) THEN
       PRINT*, 'Nothing to generate in MATCH region: ', PAIRS_FOR_MATCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    POSSIBILITY_FROM_LEFT_COLUMN=0.5D0
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    DATA_BEGIN_NUMBER=1
    CALL CHECK_AND_DELETE_S(DATA_END_KEY,K,I)
    IF(INDEX(THE_READ_WORK2(1:K),LEFT_KEY).GT.0) THEN
       LEFT_RIGHT_OR_BOTH=1
    ELSE IF(INDEX(THE_READ_WORK2(1:K),RIGHT_KEY).GT.0) THEN
       LEFT_RIGHT_OR_BOTH=2
    ELSE IF(INDEX(THE_READ_WORK2(1:K),BOTH_KEY).GT.0) THEN
       LEFT_RIGHT_OR_BOTH=3
    ELSE
       PRINT*, 'CHOICE OF LEFT, RIGHT, OR BOTH MUST BE SPECIFIED IN '//COLUMN_MATCH_KEY// &
              &' STRUCT: ', LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    THE_READ_WORK2(1:K)=' '

    CALL SOLVE_THE_QUESTION(0,0)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)

    READ_DO: DO
         CALL READ_A_LINE()
         IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
              PRINT*, 'NO ', END_COLUMN_MATCH_KEY, ' KEY FOUND. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF
         CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
         IF(DO_NOT_OUTPUT) THEN
            DO_NOT_OUTPUT=.FALSE.
            CYCLE READ_DO
         END IF
         IF(CP.LE.0) THEN
              WRITE(TEMP3_FILE_TUNNEL,'(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              POINTER_TEMP3=POINTER_TEMP3+1
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+INTEGER_KEY_LENTH), INTEGER_KEY).GT.0) THEN
              CALL GET_TRIPLE_INTEGERS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_KEY_LENTH), REAL_KEY).GT.0) THEN
              CALL GET_TRIPLE_DOUBLES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_KEY_LENTH), COMPLEX_KEY).GT.0) THEN
              CALL GET_TRIPLE_COMPLEXES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+VECTOR_KEY_LENTH), VECTOR_KEY).GT.0) THEN
              CALL GET_TRIPLE_VECTORS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+LOGICAL_KEY_LENTH), LOGICAL_KEY).GT.0) THEN
              CALL GET_LOGICALS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_KEY_LENTH), STRING_KEY).GT.0) THEN
              CALL GET_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+NEW_STRING_KEY_LENTH), NEW_STRING_KEY).GT.0) THEN
              CALL GET_NEW_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+INTEGER_MATRIX_KEY_LENTH), INTEGER_MATRIX_KEY).GT.0) THEN
              CALL GET_INTEGER_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_MATRIX_KEY_LENTH), REAL_MATRIX_KEY).GT.0) THEN
              CALL GET_REAL_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_MATRIX_KEY_LENTH), COMPLEX_MATRIX_KEY).GT.0) THEN
              CALL GET_COMPLEX_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_MATRIX_KEY_LENTH), STRING_MATRIX_KEY).GT.0) THEN
              CALL GET_STRING_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_IN_KEY_LENTH), PRINT_IN_KEY).GT.0) THEN
              CALL PRINT_AN_INPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_OUT_KEY_LENTH), PRINT_OUT_KEY).GT.0) THEN
              CALL PRINT_AN_OUTPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SET_ACCURACY_KEY_LENTH), SET_ACCURACY_KEY).GT.0) THEN
              CALL SET_ACCURARY(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COLUMN_LEFT_KEY_LENTH), COLUMN_LEFT_KEY).GT.0) THEN
              CALL GET_COLUMN_LEFT()
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COLUMN_RIGHT_KEY_LENTH), COLUMN_RIGHT_KEY).GT.0) THEN
              CALL GET_COLUMN_RIGHT()
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_COLUMN_MATCH_KEY_LENTH), END_COLUMN_MATCH_KEY).GT.0) THEN
              THE_READ=' '
              THE_READ_LENGTH=0
              COLUMN_MATCH_FOUND=.FALSE.
              LAYER_POSITION(1,LAYER_NUMBER+1)=POINTER_TEMP3+1
              EXIT READ_DO
         ELSE
              PRINT*, 'No other key is allowed here: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

         END DO CHECK_DO

    END DO READ_DO

    WRITE(TEMP3_FILE_TUNNEL,*)' '
    CLOSE(TEMP3_FILE_TUNNEL)

    IF(PAIRS_FOR_MATCH.GT.TOTAL_NUMBER_OF_LEFT_COLUMN) THEN
       PRINT*, 'Too few items in LEFT-COLUMN to choose for: ', PAIRS_FOR_MATCH, TOTAL_NUMBER_OF_LEFT_COLUMN, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(PAIRS_FOR_MATCH.GT.TOTAL_NUMBER_OF_RIGHT_COLUMN) THEN
       PRINT*, 'Too few items in RIGHT-COLUMN to choose for: ', PAIRS_FOR_MATCH, TOTAL_NUMBER_OF_RIGHT_COLUMN, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(LAYER_POSITION(1,1).NE.1) THEN
       PRINT*, 'Nothing (even an empty line) is allowed before the first COLUMN item in the MATCH struct: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    CALL RANDOM_SELECT(SELECTED_LEFT_COLUMN, 1,TOTAL_NUMBER_OF_LEFT_COLUMN, EXC,0,M)
    CALL RANDOM_SELECT(SELECTED_RIGHT_COLUMN,1,TOTAL_NUMBER_OF_RIGHT_COLUMN,EXC,0,M)

    SELECTED_TEMP_COLUMN=0
    IF(MYRAND().LE.POSSIBILITY_FROM_LEFT_COLUMN) THEN
       L_DO: DO J1=1, PAIRS_FOR_MATCH
          J2=SELECTED_LEFT_COLUMN(J1)
          DO J3=1, TOTAL_NUMBER_OF_RIGHT_COLUMN
             J4=SELECTED_RIGHT_COLUMN(J3)
             IF(LEFT_COLUMN(1,J2).EQ.RIGHT_COLUMN(1,J4)) THEN
             IF(SELECTED_TEMP_COLUMN(J3).NE.1) THEN
                SELECTED_TEMP_COLUMN(J3)=1
                CYCLE L_DO
             END IF
             END IF
          END DO
       END DO L_DO
       IF(SUM(SELECTED_TEMP_COLUMN).GT.PAIRS_FOR_MATCH) THEN
          PRINT*, 'Bugs in MAKE_MATCH, please report.'
          STOP
       END IF
       DO J1=PAIRS_FOR_MATCH+1, TOTAL_NUMBER_OF_RIGHT_COLUMN
          IF(SELECTED_TEMP_COLUMN(J1).EQ.1) THEN
             IF(SUM(SELECTED_TEMP_COLUMN(1:PAIRS_FOR_MATCH)).GE.PAIRS_FOR_MATCH) THEN
                PRINT*, 'Bugs in MAKE_MATCH 5, please report.'
                STOP
             ELSE IF(SUM(SELECTED_TEMP_COLUMN(1:PAIRS_FOR_MATCH))+1.EQ.PAIRS_FOR_MATCH) THEN
                DO J2=1, PAIRS_FOR_MATCH
                   IF(SELECTED_TEMP_COLUMN(J2).EQ.0) THEN
                      J=J2
                      GO TO 50
                   END IF
                END DO
             ELSE
                DO J2=1, PAIRS_FOR_MATCH*10000
                   J=AN_INTEGER_RANDOM(1, PAIRS_FOR_MATCH)
                   IF(SELECTED_TEMP_COLUMN(J).EQ.0) GO TO 50
                END DO
                PRINT*, 'Too many tries in MAKE_MATCH, but fails, please report.'
                STOP
             END IF
             50 CONTINUE
             J3=SELECTED_TEMP_COLUMN(J)
             SELECTED_TEMP_COLUMN(J)=SELECTED_TEMP_COLUMN(J1)
             SELECTED_TEMP_COLUMN(J1)=J3
             J3=SELECTED_RIGHT_COLUMN(J)
             SELECTED_RIGHT_COLUMN(J)=SELECTED_RIGHT_COLUMN(J1)
             SELECTED_RIGHT_COLUMN(J1)=J3
          END IF
       END DO

    ELSE
       R_DO: DO J1=1, PAIRS_FOR_MATCH
          J2=SELECTED_RIGHT_COLUMN(J1)
          DO J3=1, TOTAL_NUMBER_OF_LEFT_COLUMN
             J4=SELECTED_LEFT_COLUMN(J3)
             IF(RIGHT_COLUMN(1,J2).EQ.LEFT_COLUMN(1,J4)) THEN
             IF(SELECTED_TEMP_COLUMN(J3).NE.1) THEN
                SELECTED_TEMP_COLUMN(J3)=1
                CYCLE R_DO
             END IF
             END IF
          END DO
       END DO R_DO
       IF(SUM(SELECTED_TEMP_COLUMN).GT.PAIRS_FOR_MATCH) THEN
          PRINT*, 'Bugs in MAKE_MATCH, please report.'
          STOP
       END IF
       DO J1=PAIRS_FOR_MATCH+1, TOTAL_NUMBER_OF_LEFT_COLUMN
          IF(SELECTED_TEMP_COLUMN(J1).EQ.1) THEN
             IF(SUM(SELECTED_TEMP_COLUMN(1:PAIRS_FOR_MATCH)).GE.PAIRS_FOR_MATCH) THEN
                PRINT*, 'Bugs in MAKE_MATCH 5, please report.'
                STOP
             ELSE IF(SUM(SELECTED_TEMP_COLUMN(1:PAIRS_FOR_MATCH))+1.EQ.PAIRS_FOR_MATCH) THEN
                DO J2=1, PAIRS_FOR_MATCH
                   IF(SELECTED_TEMP_COLUMN(J2).EQ.0) THEN
                      J=J2
                      GO TO 80
                   END IF
                END DO
             ELSE
                DO J2=1, PAIRS_FOR_MATCH*10000
                   J=AN_INTEGER_RANDOM(1, PAIRS_FOR_MATCH)
                   IF(SELECTED_TEMP_COLUMN(J).EQ.0) GO TO 80
                END DO
                PRINT*, 'Too many tries in MAKE_MATCH, but fails, please report.'
                STOP
             END IF
             80 CONTINUE
             J3=SELECTED_TEMP_COLUMN(J)
             SELECTED_TEMP_COLUMN(J)=SELECTED_TEMP_COLUMN(J1)
             SELECTED_TEMP_COLUMN(J1)=J3
             J3=SELECTED_LEFT_COLUMN(J)
             SELECTED_LEFT_COLUMN(J)=SELECTED_LEFT_COLUMN(J1)
             SELECTED_LEFT_COLUMN(J1)=J3
          END IF
       END DO
    END IF

    CALL WRITE_A_MATCH(OUTPUT_FILE_TUNNEL,0)
    CALL WRITE_A_MATCH(JOURNAL_FILE_TUNNEL,0)

    IF(AUTO_ANSWER_SWITCH.EQ.1) THEN
          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER

          CALL WRITE_A_MATCH(SHORTEST_ANSWER_FILE_TUNNEL,1)
          CALL WRITE_A_MATCH(ANSW_LUTION_FILE_TUNNEL,1)
          CALL WRITE_A_MATCH(JOURNAL_FILE_TUNNEL,1)
          CALL WRITE_A_MATCH(ANSWER_FILE_TUNNEL,1)

          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
         !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(JOURNAL_FILE_TUNNEL,'(A)')' '
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
         !WRITE(ANSWER_FILE_TUNNEL,'(A)')CORRECT_ANSWER_END
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
          WRITE(ANSWER_FILE_TUNNEL,'(A)')' '
    END IF

       TOTAL_NUMBER_OF_AUTO_ANSWERS=TOTAL_NUMBER_OF_AUTO_ANSWERS+1
       IF(TOTAL_NUMBER_OF_AUTO_ANSWERS.GT.MAX_NUMBER_AUTO_ANSWERS) THEN
          PRINT*, 'NO MORE SPACE FOR AUTO-ANSWER #: ', TOTAL_NUMBER_OF_AUTO_ANSWERS, MAX_NUMBER_AUTO_ANSWERS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
         STOP
       END IF
       OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE, POSITION='APPEND')
       AUTO_ANSWER_INDEX(1, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
       AUTO_ANSWER_INDEX(3, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS+1
       CALL WRITE_A_MATCH(AUTO_TEMP_FILE_TUNNEL,1)
       AUTO_ANSWER_INDEX(2, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS
       AUTO_ANSWER_INDEX(4, TOTAL_NUMBER_OF_AUTO_ANSWERS)=LINE_OF_AUTO_ANSWERS

       CLOSE(AUTO_TEMP_FILE_TUNNEL)

    ANSWER_COUNTER=ANSWER_COUNTER+1
    COLUMN_MATCH_COUNTER=COLUMN_MATCH_COUNTER+1

    RETURN
END SUBROUTINE MAKE_MATCH




SUBROUTINE MAKE_AN_ABSTRACT(CP0)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  CP0, CP
   !INTEGER           ::  KK=4

    IF(CP0.GT.1) THEN
    IF(THE_READ(1:CP0-1).NE.' ') THEN
              PRINT*, 'Nothing is allowed before and in the '//ABSTRACT_KEY//' line: ',&
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
    END IF
    END IF

    WRITE(JOURNAL_FILE_TUNNEL,    '(A)')
    WRITE(JOURNAL_FILE_TUNNEL,    '(A)')
    WRITE(ANSWER_FILE_TUNNEL,     '(A)')
    WRITE(ANSWER_FILE_TUNNEL,     '(A)')
    WRITE(SOLUTION_FILE_TUNNEL,   '(A)')
    WRITE(SOLUTION_FILE_TUNNEL,   '(A)')
    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')
    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')

    WRITE(JOURNAL_FILE_TUNNEL,    '(A)') ABSTRACT_WORD
    IF(ABSTRACTS_PRINTED.EQ.1) THEN
    WRITE(ANSWER_FILE_TUNNEL,     '(A)') ABSTRACT_WORD
    WRITE(SOLUTION_FILE_TUNNEL,   '(A)') ABSTRACT_WORD
    WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ABSTRACT_WORD
    END IF
    IF(CP0+ABSTRACT_KEY_LENTH.LE.THE_READ_LENGTH) THEN
       WRITE(JOURNAL_FILE_TUNNEL,    '(A)') THE_READ(CP0+ABSTRACT_KEY_LENTH:THE_READ_LENGTH)
       IF(ABSTRACTS_PRINTED.EQ.1) THEN
       WRITE(ANSWER_FILE_TUNNEL,     '(A)') THE_READ(CP0+ABSTRACT_KEY_LENTH:THE_READ_LENGTH)
       WRITE(SOLUTION_FILE_TUNNEL,   '(A)') THE_READ(CP0+ABSTRACT_KEY_LENTH:THE_READ_LENGTH)
       WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') THE_READ(CP0+ABSTRACT_KEY_LENTH:THE_READ_LENGTH)
       END IF
    END IF

    !IF(MANY_CHOICES_FOUND) THEN
    !          PRINT*, ABSTRACT_KEY, ' is not allowed IN A CHOICE region. ',&
    !                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !          STOP
    !END IF
    !IF(MANY_TO_ORDER_FOUND) THEN
    !          PRINT*, ABSTRACT_KEY, ' is not allowed IN AN ORDER region. ',&
    !                  LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !          STOP
    !END IF

    READ_DO: DO
         CALL READ_A_LINE()
         IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
              PRINT*, 'NO ', END_ABSTRACT_KEY, ' KEY FOUND. ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF
         CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
        !IF(DO_NOT_OUTPUT) THEN
        !   DO_NOT_OUTPUT=.FALSE.
        !   CYCLE READ_DO
        !END IF
         IF(CP.LE.0) THEN
              WRITE(JOURNAL_FILE_TUNNEL,    '(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              IF(ABSTRACTS_PRINTED.EQ.1) THEN
              WRITE(ANSWER_FILE_TUNNEL,     '(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              WRITE(SOLUTION_FILE_TUNNEL,   '(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ADJUSTL(THE_READ(1:THE_READ_LENGTH))
              END IF
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+END_ABSTRACT_KEY_LENTH), END_ABSTRACT_KEY).GT.0) THEN
              IF(CP.GT.1) THEN
                 WRITE(JOURNAL_FILE_TUNNEL,    '(A)') THE_READ(1:CP-1)
                 IF(ABSTRACTS_PRINTED.EQ.1) THEN
                 WRITE(ANSWER_FILE_TUNNEL,     '(A)') THE_READ(1:CP-1)
                 WRITE(SOLUTION_FILE_TUNNEL,   '(A)') THE_READ(1:CP-1)
                 WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') THE_READ(1:CP-1)
                 END IF
              END IF
              WRITE(JOURNAL_FILE_TUNNEL,    '(A)') ABSTRACT_WORD_END
              WRITE(JOURNAL_FILE_TUNNEL,    '(A)')
              WRITE(JOURNAL_FILE_TUNNEL,    '(A)')
              IF(ABSTRACTS_PRINTED.EQ.1) THEN
              WRITE(ANSWER_FILE_TUNNEL,     '(A)') ABSTRACT_WORD_END
              WRITE(ANSWER_FILE_TUNNEL,     '(A)')
              WRITE(ANSWER_FILE_TUNNEL,     '(A)')
              WRITE(SOLUTION_FILE_TUNNEL,   '(A)') ABSTRACT_WORD_END
              WRITE(SOLUTION_FILE_TUNNEL,   '(A)')
              WRITE(SOLUTION_FILE_TUNNEL,   '(A)')
              WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ABSTRACT_WORD_END
              WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')
              WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')
              END IF

              THE_READ(1:CP-1+END_ABSTRACT_KEY_LENTH)=' '
              IF(THE_READ_LENGTH.LE.CP-1+END_ABSTRACT_KEY_LENTH) THE_READ_LENGTH=0
              EXIT READ_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+ABSTRACT_KEY_LENTH), ABSTRACT_KEY).GT.0) THEN
              PRINT*, 'No '//ABSTRACT_KEY//' again before '//END_ABSTRACT_KEY//' keys, please!', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
        !ELSE IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
        !     CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
        !     CYCLE CHECK_DO
         ELSE
              PRINT*, 'No other key is allowed inside an ABSTRACT: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

         END DO CHECK_DO

    END DO READ_DO

    RETURN
END SUBROUTINE MAKE_AN_ABSTRACT




SUBROUTINE DECIDE_NONE_CHOICE()
    USE BASE_DATA
    USE RAND_INTERFACE
    NONE_CHOICE_WON=.FALSE.
    IF(MYRAND().GE.BIGGER_THEN_NONE_CHOICE) NONE_CHOICE_WON=.TRUE.
    RETURN
END SUBROUTINE DECIDE_NONE_CHOICE




SUBROUTINE GET_LAYERS2(M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  ::  I,J,K,M
    J=M
    DO I=1, LAYER_NUMBER
       K=J/LAYER_EXT(I)
       LAYER_USED(I)=J-K*LAYER_EXT(I)
       J=K
    END DO
    RETURN
!
!   integer :: j, k, i
!   print*,'layers ?'
!   read(*,*) layer_number
!   j=1
!   do i=1, layer_number
!      print*,'extent for layers ',i,' ?'
!      read(*,*) layer_ext(i)
!      j=j*layer_ext(i)
!   end do
!   do i=0, j-1
!      call get_layers2(i)
!      write(*,'(1x, 9(i5,a2,i3,a2))') (layer_used(k),' (',layer_ext(k),') y',k=1,layer_number)
!   end do
!   stop
!
END SUBROUTINE GET_LAYERS2




SUBROUTINE GET_LAYERS(M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  ::  I,J,K,M
    J=M
    DO I=1, LAYER_NUMBER
       K=J/2
       LAYER_USED(I)=J-K*2
       J=K
    END DO
    RETURN
END SUBROUTINE GET_LAYERS




SUBROUTINE WRITE_A_CHOICE_HEAD(TUNNEL,I)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER          ::  TUNNEL,I,J,K,L,M
    CHARACTER*10     ::  STRING

    L=0
    IF(I.LT.0) THEN
       L=1
       STRING(1:1)='-'
    END IF

    J=ABS(I)
    K=0
    LOOP: DO
       K=K+1
       J=J/26
       IF(J.EQ.0) EXIT LOOP
    END DO LOOP

    L=L+K

    J=ABS(I)
    DO M=1,K
       STRING(L+1-M:L+1-M)=CHAR(MOD(J,26)+65)
       J=J/26
    END DO

    WRITE(TUNNEL,'(A)') ' '
    WRITE(TUNNEL,'(A)') ' '
    WRITE(TUNNEL,'(A)') CHOICE_CHARATER_BEGIN
    WRITE(TUNNEL,'(A)') STRING(1:L)//CHOICE_CHARATER_END

    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+4

    RETURN
END SUBROUTINE WRITE_A_CHOICE_HEAD




SUBROUTINE WRITE_A_CHOICE_HEAD2(TUNNEL,I)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER          ::  TUNNEL,I,J,K,L,M
    CHARACTER*10     ::  STRING

    L=0
    IF(I.LT.0) THEN
       L=1
       STRING(1:1)='-'
    END IF

    J=ABS(I)
    K=0
    LOOP: DO
       K=K+1
       J=J/26
       IF(J.EQ.0) EXIT LOOP
    END DO LOOP

    L=L+K

    J=ABS(I)
    DO M=1,K
       STRING(L+1-M:L+1-M)=CHAR(MOD(J,26)+65)
       J=J/26
    END DO

    WRITE(TUNNEL,'(A)') CHOICE_CHARATER_BEGIN2
    WRITE(TUNNEL,'(A)') STRING(1:L)//CHOICE_CHARATER_END

    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+2

    RETURN
END SUBROUTINE WRITE_A_CHOICE_HEAD2




SUBROUTINE WRITE_A_CHOICE1(TUNNEL,M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J, M

    CALL WRITE_A_CHOICE_HEAD(TUNNEL,M-1)
    J=LAYER_GENERATOR(M)-1

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)
    READ_DO: DO I=1, POINTER_TEMP3
       THE_READ=' '
       READ(TEMP3_FILE_TUNNEL,'(A)') THE_READ
       THE_READ_LENGTH=LEN_TRIM(THE_READ)
       IF(I.EQ.LAYER_POSITION(1,1)) THEN
          CALL PRINT_A_CHOICE_VALUE(TUNNEL,J,1)
          CYCLE READ_DO
       END IF
       WRITE(TUNNEL,'(A)') THE_READ(1:THE_READ_LENGTH)
       IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
    END DO READ_DO
    CLOSE(TEMP3_FILE_TUNNEL)

    RETURN
END SUBROUTINE WRITE_A_CHOICE1




SUBROUTINE WRITE_A_CHOICE2(TUNNEL,M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J, K, M

    CALL WRITE_A_CHOICE_HEAD(TUNNEL,M-1)
    J=LAYER_GENERATOR(M)
    CALL GET_LAYERS2(J-1)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)
    READ_DO: DO I=1, POINTER_TEMP3
       THE_READ=' '
       READ(TEMP3_FILE_TUNNEL,'(A)') THE_READ
       THE_READ_LENGTH=LEN_TRIM(THE_READ)
       DO K=1, LAYER_NUMBER
          IF(I.EQ.LAYER_POSITION(1,K)) THEN
             CALL PRINT_A_CHOICE_VALUE(TUNNEL,LAYER_USED(K),K)
             CYCLE READ_DO
          END IF
       END DO
       WRITE(TUNNEL,'(A)') THE_READ(1:THE_READ_LENGTH)
       IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
    END DO READ_DO
    CLOSE(TEMP3_FILE_TUNNEL)

    RETURN
END SUBROUTINE WRITE_A_CHOICE2




SUBROUTINE WRITE_A_CHOICE(TUNNEL,M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J, K, M

    CALL WRITE_A_CHOICE_HEAD(TUNNEL,M-1)
    J=LAYER_GENERATOR(M)
    CALL GET_LAYERS(J-1)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)
    READ_DO: DO I=1, POINTER_TEMP3
       THE_READ=' '
       READ(TEMP3_FILE_TUNNEL,'(A)') THE_READ
       THE_READ_LENGTH=LEN_TRIM(THE_READ)
       DO K=1, LAYER_NUMBER
          IF(I.EQ.LAYER_POSITION(1,K)) THEN
             CALL PRINT_A_CHOICE_VALUE(TUNNEL,LAYER_USED(K),K)
             CYCLE READ_DO
          END IF
       END DO
       WRITE(TUNNEL,'(A)') THE_READ(1:THE_READ_LENGTH)
       IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
    END DO READ_DO
    CLOSE(TEMP3_FILE_TUNNEL)

    RETURN
END SUBROUTINE WRITE_A_CHOICE




SUBROUTINE WRITE_AN_ORDER(TUNNEL,M)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J, M

    CALL WRITE_A_CHOICE_HEAD(TUNNEL,M-1)
    J=LAYER_GENERATOR(M)

    OPEN(TEMP3_FILE_TUNNEL, FILE=TEMP3_FILE)
    READ_DO: DO I=1, POINTER_TEMP3
       THE_READ=' '
       READ(TEMP3_FILE_TUNNEL,'(A)') THE_READ
       THE_READ_LENGTH=LEN_TRIM(THE_READ)
       IF(I.GE.LAYER_POSITION(1,J+1)) THEN
          EXIT READ_DO
       ELSE IF(I.GE.LAYER_POSITION(1,J)) THEN
          WRITE(TUNNEL,'(A)') THE_READ(1:THE_READ_LENGTH)
          IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
          CYCLE READ_DO
       END IF
    END DO READ_DO
    CLOSE(TEMP3_FILE_TUNNEL)

    RETURN
END SUBROUTINE WRITE_AN_ORDER




SUBROUTINE PRINT_A_CHOICE_VALUE(TUNNEL,J,K)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  TUNNEL, I, J, K
   !DOUBLE PRECISION  ::  R
   !INTEGER           ::  ACCURACY, ACCURACY2
   !DOUBLE COMPLEX    ::  C

    SELECT CASE (LAYER_TYPE(K))

    CASE(I_TYPE)
       I=LAYER_I(J,K)
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(I,CHAR_OF_INT5_LENGTH)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=CHAR_OF_INT5_LENGTH
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)=CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)

    CASE(R_TYPE)
      !R=LAYER_R(J,K)
      !ACCURACY=LAYER_ACCURACY(1,K)
      !IF(ACCURACY.LE.0) THEN
      !   PRINT*,'Sorry, the ACCURACY is not acceptable in PRINT_A_CHOICE_VALUE: ', ACCURACY, &
      !         LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
      !   STOP
      !END IF
      !CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
      !THE_READ_WORK5=' '
      !THE_READ_WORK5_LENGTH=THE_READ_WORK3_LENGTH
      !THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)=THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=LEN_TRIM(LAYER_S(J,K))
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)=TRIM(LAYER_S(J,K))

    CASE(L_TYPE)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=LEN_TRIM(LAYER_S(J,K))
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)=TRIM(LAYER_S(J,K))

    CASE(S_TYPE)
       THE_READ_WORK5=' '
       THE_READ_WORK5_LENGTH=LEN_TRIM(LAYER_S(J,K))
       THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)=TRIM(LAYER_S(J,K))

   !CASE(V_TYPE)

   !CASE(C_TYPE)
   !   C=LAYER_C(J,K)
   !   ACCURACY= LAYER_ACCURACY(1,K)
   !   ACCURACY2=LAYER_ACCURACY(2,K)
   !   IF(ACCURACY.LE.0) THEN
   !      PRINT*,'Sorry, the ACCURACY is not acceptable in PRINT_A_CHOICE_VALUE region: ', ACCURACY, &
   !            LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !      STOP
   !   END IF
   !   IF(ACCURACY2.LE.0) THEN
   !      PRINT*,'Sorry, the ACCURACY2 is not acceptable in PRINT_A_CHOICE_VALUE region: ', ACCURACY2, &
   !            LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
   !      STOP
   !   END IF
   !   CALL CONVERT_A_COMPLEX_DIFS(C, ACCURACY, ACCURACY2)

    CASE DEFAULT
       PRINT*,' A BUG IN PRINT_A_CHOICE_VALUE, PLEASE REPORT: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP

    END SELECT

    IF(THE_READ_WORK5_LENGTH.GT.MAX_NUMBER_OF_CHARACTERS_P2) THEN
       PRINT*,' A BUG IN PRINT_A_CHOICE_VALUE2, PLEASE REPORT: ', THE_READ_WORK5_LENGTH, MAX_NUMBER_OF_CHARACTERS_P2, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(LAYER_POSITION(2,K).GT.0) THEN
       WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ(1:THE_READ_LENGTH)
    ELSE
       WRITE(TUNNEL,'(A)') THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)
       IF(THE_READ_LENGTH.GT.0) THEN
          WRITE(TUNNEL,'(A)') THE_READ(1:THE_READ_LENGTH)
          IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1
       END IF
    END IF

    IF(TUNNEL.EQ.AUTO_TEMP_FILE_TUNNEL) LINE_OF_AUTO_ANSWERS=LINE_OF_AUTO_ANSWERS+1

    RETURN
END SUBROUTINE PRINT_A_CHOICE_VALUE




SUBROUTINE GENERATE_CHOICES(CRT)
     USE BASE_DATA
     USE RAND_INTERFACE
     IMPLICIT NONE
     INTEGER :: I, J, K, CRT

     DO I=1, TOTAL_NUMBER_OF_ITEMS
        LAYER_GENERATOR(I)=I
     END DO

     DO I=1, TOTAL_NUMBER_OF_ITEMS-1
        J=AN_INTEGER_RANDOM(1, TOTAL_NUMBER_OF_ITEMS+1-I)
        LAYER_GENERATOR_TEMP(I)=LAYER_GENERATOR(J)
        IF(J.NE.TOTAL_NUMBER_OF_ITEMS+1-I) &
        LAYER_GENERATOR(J)=LAYER_GENERATOR(TOTAL_NUMBER_OF_ITEMS+1-I)
     END DO
     LAYER_GENERATOR_TEMP(TOTAL_NUMBER_OF_ITEMS)=LAYER_GENERATOR(1)

     DO I=1, TOTAL_NUMBER_OF_ITEMS
        IF(LAYER_GENERATOR_TEMP(I).EQ.1) THEN
           CRT=I
           EXIT
        END IF
     END DO

     IF(CRT.GT.CHOICES_TO_BE_GENERATED) THEN
        J=AN_INTEGER_RANDOM(1, CHOICES_TO_BE_GENERATED)
        K=LAYER_GENERATOR_TEMP(J)
        LAYER_GENERATOR_TEMP(J)=LAYER_GENERATOR_TEMP(CRT)
        LAYER_GENERATOR_TEMP(CRT)=K
        CRT=J
     ELSE IF(CRT.LE.0) THEN
        PRINT*,' A BUG OF CRT IN GENERATE_CHOICES, PLEASE REPORT: ', CRT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
        STOP
     END IF

     LAYER_GENERATOR(1:TOTAL_NUMBER_OF_ITEMS)=&
     LAYER_GENERATOR_TEMP(1:TOTAL_NUMBER_OF_ITEMS)

     DO I=1, TOTAL_NUMBER_OF_ITEMS-1
        DO J=I+1, TOTAL_NUMBER_OF_ITEMS
           IF(LAYER_GENERATOR_TEMP(I).GT.LAYER_GENERATOR_TEMP(J)) THEN
              K=LAYER_GENERATOR_TEMP(J)
              LAYER_GENERATOR_TEMP(J)=LAYER_GENERATOR_TEMP(I)
              LAYER_GENERATOR_TEMP(I)=K
           END IF
        END DO
     END DO

     DO I=1, TOTAL_NUMBER_OF_ITEMS
        IF(LAYER_GENERATOR_TEMP(I).NE.I) THEN
           PRINT*, 'Bug in GENERATE_CHOICES:'
           PRINT*, LAYER_GENERATOR(1:TOTAL_NUMBER_OF_ITEMS)
           PRINT*, ' '
           PRINT*, LAYER_GENERATOR_TEMP(1:TOTAL_NUMBER_OF_ITEMS)
           STOP
        END IF
     END DO

     RETURN
END SUBROUTINE GENERATE_CHOICES




SUBROUTINE GENERAL_OUTPUT(KK)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER :: KK
    GENERAL_READ_LENTH=MAX(1,LEN_TRIM(GENERAL_READ))
    IF(KK.EQ.1) THEN
        IF(SOLUTION_FOUND) THEN
           WRITE(SOLUTION_FILE_TUNNEL,'(A)')   GENERAL_READ(1:GENERAL_READ_LENTH)
        ELSE IF(ANSWER_FOUND) THEN
           WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
           WRITE(ANSWER_FILE_TUNNEL,         '(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
        ELSE
           WRITE(OUTPUT_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
        END IF
        WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
    ELSE IF(KK.EQ.3) THEN
        WRITE(TEMP3_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
        POINTER_TEMP3=POINTER_TEMP3+1
    ELSE IF(KK.EQ.11) THEN
        WRITE( OUTPUT_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
    ELSE IF(KK.EQ.0) THEN
       !WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')GENERAL_READ(1:GENERAL_READ_LENTH)
    END IF

    RETURN
END SUBROUTINE GENERAL_OUTPUT




SUBROUTINE MAKE_CONSTANT_TABLE_HEAD(KK)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK
    CONSTANT_TABLE_HEAD_FOUND=.TRUE.
    GENERAL_READ=' '
    CALL GENERAL_OUTPUT(KK)
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ='\noindent\begin{tabular}{|l|l|l|}'
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ='\hline'
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ='Constant & Symbol & Value \\'
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ='\hline'
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_TABLE_HEAD




SUBROUTINE MAKE_CONSTANT_TABLE_LINE(KK,I,ACCURACY)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK,I,ACCURACY
    DOUBLE PRECISION   :: R
    IF(I.LE.0) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(I.GT.TOTAL_NUMBER_OF_CONSTANTS) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    GENERAL_READ=TRIM(CONSTANT_NAME(I))//' & '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_SYMBOL(I))//' & '
    CALL GENERAL_OUTPUT(KK)
    R=CONSTANT_R(I)
    IF(ACCURACY.LE.0) ACCURACY=CONSTANT_ACCURACY(I)
    ACCURACY=    MIN( ACCURACY,CONSTANT_ACCURACY(I))
    CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
    GENERAL_READ=' $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_UNIT(I))//' \\ '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ='\hline'
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_TABLE_LINE




SUBROUTINE MAKE_CONSTANT_VALUE(KK,I,ACCURACY)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK,I,ACCURACY
    DOUBLE PRECISION   :: R
    IF(I.LE.0) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(I.GT.TOTAL_NUMBER_OF_CONSTANTS) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    R=CONSTANT_R(I)
    IF(ACCURACY.LE.0) ACCURACY=CONSTANT_ACCURACY(I)
    ACCURACY=    MIN( ACCURACY,CONSTANT_ACCURACY(I))
    CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
    GENERAL_READ=' $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_VALUE




SUBROUTINE MAKE_CONSTANT_VALUE_UNIT(KK,I,ACCURACY)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK,I,ACCURACY
    DOUBLE PRECISION   :: R
    IF(I.LE.0) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(I.GT.TOTAL_NUMBER_OF_CONSTANTS) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    R=CONSTANT_R(I)
    IF(ACCURACY.LE.0) ACCURACY=CONSTANT_ACCURACY(I)
    ACCURACY=    MIN( ACCURACY,CONSTANT_ACCURACY(I))
    CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
    GENERAL_READ=' $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_UNIT(I))
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_VALUE_UNIT




SUBROUTINE MAKE_CONSTANT_EQUATION(KK,I,ACCURACY)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK,I,ACCURACY
    DOUBLE PRECISION   :: R
    IF(I.LE.0) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(I.GT.TOTAL_NUMBER_OF_CONSTANTS) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    GENERAL_READ=TRIM(CONSTANT_SYMBOL(I))//'$ = '
    CALL GENERAL_OUTPUT(KK)
    R=CONSTANT_R(I)
    IF(ACCURACY.LE.0) ACCURACY=CONSTANT_ACCURACY(I)
    ACCURACY=    MIN( ACCURACY,CONSTANT_ACCURACY(I))
    CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
    GENERAL_READ=THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_UNIT(I))
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_EQUATION




SUBROUTINE MAKE_CONSTANT_NAME_EQUATION(KK,I,ACCURACY)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK,I,ACCURACY
    DOUBLE PRECISION   :: R
    IF(I.LE.0) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(I.GT.TOTAL_NUMBER_OF_CONSTANTS) THEN
       PRINT*,'Sorry, BAD CONSTANT SEQUENTIAL NUMBER: ',I,TOTAL_NUMBER_OF_CONSTANTS, &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    GENERAL_READ=TRIM(CONSTANT_NAME(I))
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_SYMBOL(I))//'$ = '
    CALL GENERAL_OUTPUT(KK)
    R=CONSTANT_R(I)
    IF(ACCURACY.LE.0) ACCURACY=CONSTANT_ACCURACY(I)
    ACCURACY=    MIN( ACCURACY,CONSTANT_ACCURACY(I))
    CALL CONVERT_A_DOUBLE_DIFS(R, ACCURACY)
    GENERAL_READ=THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ '
    CALL GENERAL_OUTPUT(KK)
    GENERAL_READ=TRIM(CONSTANT_UNIT(I))
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_NAME_EQUATION




SUBROUTINE MAKE_CONSTANT_TABLE_TAIL(KK)
    USE BASE_DATA
    IMPLICIT NONE
    INTEGER  :: KK
    CONSTANT_TABLE_HEAD_FOUND=.FALSE.
    GENERAL_READ='\end{tabular}'
    CALL GENERAL_OUTPUT(KK)
    RETURN
END SUBROUTINE MAKE_CONSTANT_TABLE_TAIL




SUBROUTINE MAKE_CONSTANTS(KK0, ZZ)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           ::  I,J,K,ACCURACY,KK0,KK,ZZ

    KK=KK0
    !IF(KK0.EQ.11) THEN
    !      ANSWER_FOUND=.FALSE.
    !      SOLUTION_FOUND=.FALSE.
    !      KK=1
    !END IF

    IF(INDEX(THE_READ(ZZ+1:ZZ+WHOLE_TABLE_KEY_LENTH), WHOLE_TABLE_KEY).GT.0) THEN

       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//WHOLE_TABLE_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//WHOLE_TABLE_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//WHOLE_TABLE_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//WHOLE_TABLE_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF

       J=TOTAL_NUMBER_OF_CONSTANTS/MAX_LINES_OF_CONSTANT_TABLE
       DO K=1,J
          CALL MAKE_CONSTANT_TABLE_HEAD(KK)
          DO I=(K-1)*MAX_LINES_OF_CONSTANT_TABLE+1, K*MAX_LINES_OF_CONSTANT_TABLE
             ACCURACY=0
             CALL MAKE_CONSTANT_TABLE_LINE(KK,I,ACCURACY)
          END DO
          CALL MAKE_CONSTANT_TABLE_TAIL(KK)
       END DO
       IF(TOTAL_NUMBER_OF_CONSTANTS.GT.MAX_LINES_OF_CONSTANT_TABLE*J) THEN
          CALL MAKE_CONSTANT_TABLE_HEAD(KK)
          DO I=J*MAX_LINES_OF_CONSTANT_TABLE+1, TOTAL_NUMBER_OF_CONSTANTS
             ACCURACY=0
             CALL MAKE_CONSTANT_TABLE_LINE(KK,I,ACCURACY)
          END DO
          CALL MAKE_CONSTANT_TABLE_TAIL(KK)
       END IF

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+TABLE_HEAD_KEY_LENTH), TABLE_HEAD_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TABLE_HEAD_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//TABLE_HEAD_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TABLE_HEAD_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TABLE_HEAD_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF

       CALL MAKE_CONSTANT_TABLE_HEAD(KK)

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+TABLE_LINE_KEY_LENTH), TABLE_LINE_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TABLE_LINE_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//TABLE_LINE_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TABLE_LINE_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TABLE_LINE_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF

       CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
       CALL GET_AN_INTEGER(I)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       CALL MAKE_CONSTANT_TABLE_LINE(KK,I,ACCURACY)

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+TABLE_TAIL_KEY_LENTH), TABLE_TAIL_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TABLE_TAIL_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//TABLE_TAIL_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TABLE_TAIL_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TABLE_TAIL_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF
       CALL MAKE_CONSTANT_TABLE_TAIL(KK)

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+VALUE_UNIT_KEY_LENTH), VALUE_UNIT_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//VALUE_UNIT_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//VALUE_UNIT_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//VALUE_UNIT_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//VALUE_UNIT_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
       CALL GET_AN_INTEGER(I)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       CALL MAKE_CONSTANT_VALUE_UNIT(KK,I,ACCURACY)
       IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
          THE_READ_WORK2_LENGTH=3
          THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
       END IF

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+VALUE_KEY_LENTH), VALUE_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//VALUE_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//VALUE_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//VALUE_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//VALUE_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
       CALL GET_AN_INTEGER(I)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       CALL MAKE_CONSTANT_VALUE(KK,I,ACCURACY)
       IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
          THE_READ_WORK2_LENGTH=3
          THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
       END IF

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+EQUATION_KEY_LENTH), EQUATION_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//EQUATION_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//EQUATION_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//EQUATION_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//EQUATION_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
       CALL GET_AN_INTEGER(I)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       CALL MAKE_CONSTANT_EQUATION(KK,I,ACCURACY)
       IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
          THE_READ_WORK2_LENGTH=3
          THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
       END IF

    ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+NAME_EQUATION_KEY_LENTH), NAME_EQUATION_KEY).GT.0) THEN
       IF(KK.EQ.0) THEN
          CALL FIRST_PROCESSING0(CONSTANT_PREKEY//NAME_EQUATION_KEY)
       ELSE IF(KK.EQ.1) THEN
          CALL FIRST_PROCESSING(CONSTANT_PREKEY//NAME_EQUATION_KEY)
       ELSE IF(KK.EQ.11) THEN
          CALL FIRST_PROCESSING11(CONSTANT_PREKEY//NAME_EQUATION_KEY)
       ELSE IF(KK.EQ.3) THEN
          CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//NAME_EQUATION_KEY)
       ELSE
          PRINT*,'NOT ACCEPTED KK: ',KK
          STOP
       END IF
       CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
       CALL GET_AN_INTEGER(I)
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
       CALL GET_AN_INTEGER(ACCURACY)
       CALL CHECK_AND_DELETE(DATA_END_KEY)
       CALL MAKE_CONSTANT_NAME_EQUATION(KK,I,ACCURACY)
       IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
          THE_READ_WORK2_LENGTH=3
          THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
       END IF

    ELSE

       DO J=1, TOTAL_NUMBER_OF_CONSTANTS
          IF(INDEX(THE_READ(ZZ+1:ZZ+CONSTANT_KEY_LENGTH(J)), TRIM(CONSTANT_KEY(J))).GT.0) THEN
             ZZ=ZZ+CONSTANT_KEY_LENGTH(J)
             I=J
             IF(INDEX(THE_READ(ZZ+1:ZZ+M_VALUE_UNIT_KEY_LENTH), M_VALUE_UNIT_KEY).GT.0) THEN
                IF(KK.EQ.0) THEN
                   CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_UNIT_KEY)
                ELSE IF(KK.EQ.1) THEN
                   CALL FIRST_PROCESSING(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_UNIT_KEY)
                ELSE IF(KK.EQ.11) THEN
                   CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_UNIT_KEY)
                ELSE IF(KK.EQ.3) THEN
                   CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_UNIT_KEY)
                ELSE
                   PRINT*,'NOT ACCEPTED KK: ',KK
                   STOP
                END IF

                CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
                CALL GET_AN_INTEGER(ACCURACY)
                CALL CHECK_AND_DELETE(DATA_END_KEY)
                CALL MAKE_CONSTANT_VALUE_UNIT(KK,I,ACCURACY)
                IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
                   THE_READ_WORK2_LENGTH=3
                   THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
                END IF

             ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+M_VALUE_KEY_LENTH), M_VALUE_KEY).GT.0) THEN
                IF(KK.EQ.0) THEN
                   CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_KEY)
                ELSE IF(KK.EQ.1) THEN
                   CALL FIRST_PROCESSING(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_KEY)
                ELSE IF(KK.EQ.11) THEN
                   CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_KEY)
                ELSE IF(KK.EQ.3) THEN
                   CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_VALUE_KEY)
                ELSE
                   PRINT*,'NOT ACCEPTED KK: ',KK
                   STOP
                END IF

                CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
                CALL GET_AN_INTEGER(ACCURACY)
                CALL CHECK_AND_DELETE(DATA_END_KEY)
                CALL MAKE_CONSTANT_VALUE(KK,I,ACCURACY)
                IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
                   THE_READ_WORK2_LENGTH=3
                   THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
                END IF

             ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+M_EQUATION_KEY_LENTH), M_EQUATION_KEY).GT.0) THEN
                IF(KK.EQ.0) THEN
                   CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_EQUATION_KEY)
                ELSE IF(KK.EQ.1) THEN
                   CALL FIRST_PROCESSING(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_EQUATION_KEY)
                ELSE IF(KK.EQ.11) THEN
                   CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_EQUATION_KEY)
                ELSE IF(KK.EQ.3) THEN
                   CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_EQUATION_KEY)
                ELSE
                   PRINT*,'NOT ACCEPTED KK: ',KK
                   STOP
                END IF

                CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
                CALL GET_AN_INTEGER(ACCURACY)
                CALL CHECK_AND_DELETE(DATA_END_KEY)
                CALL MAKE_CONSTANT_EQUATION(KK,I,ACCURACY)
                IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
                   THE_READ_WORK2_LENGTH=3
                   THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
                END IF

             ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+M_NAME_EQUATION_KEY_LENTH), M_NAME_EQUATION_KEY).GT.0) THEN
                IF(KK.EQ.0) THEN
                   CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_NAME_EQUATION_KEY)
                ELSE IF(KK.EQ.1) THEN
                   CALL FIRST_PROCESSING(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_NAME_EQUATION_KEY)
                ELSE IF(KK.EQ.11) THEN
                   CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_NAME_EQUATION_KEY)
                ELSE IF(KK.EQ.3) THEN
                   CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_NAME_EQUATION_KEY)
                ELSE
                   PRINT*,'NOT ACCEPTED KK: ',KK
                   STOP
                END IF

                CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
                CALL GET_AN_INTEGER(ACCURACY)
                CALL CHECK_AND_DELETE(DATA_END_KEY)
                CALL MAKE_CONSTANT_NAME_EQUATION(KK,I,ACCURACY)
                IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
                   THE_READ_WORK2_LENGTH=3
                   THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
                END IF

             ELSE IF(INDEX(THE_READ(ZZ+1:ZZ+M_TABLE_LINE_KEY_LENTH), M_TABLE_LINE_KEY).GT.0) THEN
                IF(KK.EQ.0) THEN
                   CALL FIRST_PROCESSING0(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_TABLE_LINE_KEY)
                ELSE IF(KK.EQ.1) THEN
                   CALL FIRST_PROCESSING(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_TABLE_LINE_KEY)
                ELSE IF(KK.EQ.11) THEN
                   CALL FIRST_PROCESSING11(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_TABLE_LINE_KEY)
                ELSE IF(KK.EQ.3) THEN
                   CALL FIRST_PROCESSING_TEMP3(CONSTANT_PREKEY//TRIM(CONSTANT_KEY(J))//M_TABLE_LINE_KEY)
                ELSE
                   PRINT*,'NOT ACCEPTED KK: ',KK
                   STOP
                END IF

                CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
                CALL GET_AN_INTEGER(ACCURACY)
                CALL CHECK_AND_DELETE(DATA_END_KEY)
                CALL MAKE_CONSTANT_TABLE_LINE(KK,I,ACCURACY)
                IF(THE_READ_WORK2_LENGTH.EQ.0) THEN
                   THE_READ_WORK2_LENGTH=3
                   THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)=' % '
                END IF

             ELSE
                PRINT*,'Sorry, CONSTANT KEY NOT ALLOWED: '//THE_READ(1:THE_READ_LENGTH), &
                     LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
                STOP
             END IF
             GO TO 100
          END IF
       END DO
       PRINT*,'Sorry, CONSTANT KEY NOT ALLOWED: '//THE_READ(1:THE_READ_LENGTH), &
               LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    100 CONTINUE
    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH
    THE_READ(1:THE_READ_LENGTH)=THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)

    RETURN
END SUBROUTINE MAKE_CONSTANTS




DOUBLE PRECISION FUNCTION GET_CONSTANT_VALUE_OF(STRING)
    USE BASE_DATA
    IMPLICIT NONE
    CHARACTER (LEN=*) ::  STRING
    INTEGER           ::  J,STRING_LENGTH
    STRING_LENGTH=LEN(STRING)
    DO J=1, TOTAL_NUMBER_OF_CONSTANTS
       IF(STRING_LENGTH.EQ.CONSTANT_KEY_LENGTH(J)) THEN
          IF(STRING.EQ.TRIM(CONSTANT_KEY(J)))      THEN
             GET_CONSTANT_VALUE_OF=CONSTANT_R(J)
             GO TO 100
          END IF
       END IF
    END DO

    DO J=1, TOTAL_NUMBER_OF_CONSTANTS
       IF(STRING_LENGTH.EQ.LEN_TRIM(CONSTANT_NAME(J))) THEN
          IF(STRING.EQ.TRIM(CONSTANT_NAME(J)))      THEN
             GET_CONSTANT_VALUE_OF=CONSTANT_R(J)
             GO TO 100
          END IF
       END IF
    END DO

    PRINT*, 'ILLEGAL STRING FOR CONSTANT: ', STRING
    STOP
    100 RETURN
END FUNCTION GET_CONSTANT_VALUE_OF




SUBROUTINE READ_STRINGS()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: K,JJ
    DATA_BEGIN_NUMBER=0
    CALL CHECK_AND_DELETE_S(DATA_BEGIN_KEY,K,JJ)
    CALL RESET_THE_WORK2_2(K)
    CALL READ_TRUE_STRINGS()
    RETURN
END SUBROUTINE READ_STRINGS




SUBROUTINE READ_TRUE_STRINGS()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: K,JJ

    PRINTING=.TRUE.

    GENERATED_POSITION(1,INPUT_NUMBER)=INPUT_STRING_POSITION+1
    FIND_DO: DO
       CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
       INPUT_STRING_POSITION=INPUT_STRING_POSITION+1

       IF(INPUT_STRING_POSITION.GT.MAX_NUMBER_OF_SSS_INPUT_TERMS) THEN
          PRINT*,'Sorry, TOO MANY STRINGS (READ_TRUE_STRINGS): ',INPUT_STRING_POSITION, &
                  MAX_NUMBER_OF_SSS_INPUT_TERMS,LINE_NUMBER, QUESTION_NUMBER, &
                  QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(K.GT.MAX_NUMBER_OF_CHARACTERS_SSS) THEN
          PRINT*,'Sorry, TOO LONG STRING (READ_TRUE_STRINGS): ',K,MAX_NUMBER_OF_CHARACTERS_SSS,&
                 LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       INPUT_STK(INPUT_STRING_POSITION)=0
       INPUT_SSS(INPUT_STRING_POSITION)=' '
       INPUT_SSS(INPUT_STRING_POSITION)(1:K)=THE_READ_WORK2(1:K)
       CALL RESET_THE_WORK2_2(K)
       IF(JJ.EQ.3) EXIT FIND_DO
    END DO FIND_DO
    GENERATED_POSITION(2,INPUT_NUMBER)=INPUT_STRING_POSITION

    IF( (     TRIM(ADJUSTL(INPUT_SSS(INPUT_STRING_POSITION))).EQ.NO_PRINTING_KEY       )  .AND.&
        ( LEN_TRIM(ADJUSTL(INPUT_SSS(INPUT_STRING_POSITION))).EQ.NO_PRINTING_KEY_LENTH ) ) THEN
        GENERATED_POSITION(2,INPUT_NUMBER)=INPUT_STRING_POSITION-1
        INPUT_STK(INPUT_STRING_POSITION)=0
        INPUT_SSS(INPUT_STRING_POSITION)=' '
        INPUT_STRING_POSITION=INPUT_STRING_POSITION-1
        PRINTING=.FALSE.
        IF(GENERATED_POSITION(2,INPUT_NUMBER).LT.GENERATED_POSITION(1,INPUT_NUMBER)) THEN
           PRINT*,'Sorry, no effective string found (READ_TRUE_STRINGS): ',K, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
           STOP
        END IF
    END IF

    RETURN
END SUBROUTINE READ_TRUE_STRINGS




SUBROUTINE READ_NONE_CHOICE()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: K,JJ

    DATA_BEGIN_NUMBER=1
    CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
    CALL RESET_THE_WORK2_2(K)

    IF(JJ.EQ.2) THEN
       CALL READ_NONE_CHOICE_STRING()
    ELSE IF(JJ.EQ.3) THEN
       NONE_CHOICE_REPLACES=0
    ELSE
       PRINT*,'Sorry, illegal struct (READ_NONE_CHOICE B): ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    RETURN
END SUBROUTINE READ_NONE_CHOICE




SUBROUTINE READ_NONE_CHOICE_STRING()
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: K,JJ

    NONE_CHOICE_REPLACES=0
    CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
    IF(JJ.EQ.3) THEN
          IF(K-1.GT.MAX_OF_CHARACTERS_AS_NONE_CHOICE) THEN
             PRINT*,'Sorry, too many characters for NONE CHOICE (READ_NONE_CHOICE C): ',K-1, &
                MAX_OF_CHARACTERS_AS_NONE_CHOICE, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             STOP
          END IF
          NONE_ABOVE_CHOICE=' '
          IF(K.GT.1)  NONE_ABOVE_CHOICE(1:K-1)=THE_READ_WORK2(1:K-1)
          IF(LEN_TRIM(NONE_ABOVE_CHOICE).GE.1) THEN
             NONE_CHOICE_REPLACES=1
          END IF
          CALL RESET_THE_WORK2_2(K)
    ELSE
          PRINT*,'Sorry, illegal construct (READ_NONE_CHOICE A): ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    RETURN
END SUBROUTINE READ_NONE_CHOICE_STRING




SUBROUTINE GET_STRINGS(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: KK,L
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=S_TYPE

    IF(KK.EQ.0) THEN
        CALL FIRST_PROCESSING0(STRING_KEY)
    ELSE IF(KK.EQ.1) THEN
        CALL FIRST_PROCESSING(STRING_KEY)
    ELSE IF(KK.EQ.3) THEN
        CALL FIRST_PROCESSING_TEMP3(STRING_KEY)
    ELSE
        PRINT*,'NOT ACCEPTED KK: ',KK
        STOP
    END IF

    CALL READ_STRINGS()

    L=AN_INTEGER_RANDOM(GENERATED_POSITION(1,INPUT_NUMBER),GENERATED_POSITION(2,INPUT_NUMBER))+0.4
    IF(L.GT.GENERATED_POSITION(2,INPUT_NUMBER)) L=GENERATED_POSITION(2,INPUT_NUMBER)
    GENERATED_I(INPUT_NUMBER)=L
    INPUT_STK(L)=1

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(INPUT_SSS(L))
    THE_READ(1:THE_READ_LENGTH)=TRIM(INPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: ', INPUT_NUMBER, &
                      L-GENERATED_POSITION(1,INPUT_NUMBER)+1, &
                      GENERATED_POSITION(2,INPUT_NUMBER)-GENERATED_POSITION(1,INPUT_NUMBER)+1, &
                      ' SSS: '//INPUT_SSS(L)//' ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_STRINGS




SUBROUTINE GET_NEW_STRINGS(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: I,KK,L,AN_INPUT
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=S_TYPE
    IF(KK.EQ.0) THEN
        CALL FIRST_PROCESSING0(NEW_STRING_KEY)
    ELSE IF(KK.EQ.1) THEN
        CALL FIRST_PROCESSING(NEW_STRING_KEY)
    ELSE IF(KK.EQ.3) THEN
        CALL FIRST_PROCESSING_TEMP3(NEW_STRING_KEY)
    ELSE
        PRINT*,'NOT ACCEPTED KK: ',KK
        STOP
    END IF

    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_AN_INTEGER(AN_INPUT)
    CALL CHECK_NO_PRINTING_AND_ENDS()

    IF(AN_INPUT.LE.0) THEN
       PRINT*,' ILLEGAL input number (GET_NEW_STRINGS): ', AN_INPUT, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    ELSE IF(AN_INPUT.GT.INPUT_NUMBER-1) THEN
       PRINT*,' ILLEGAL input number (GET_NEW_STRINGS): ', AN_INPUT, ', ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    IF(INPUT_TYPE(AN_INPUT).NE.S_TYPE) THEN
       PRINT*,' MISMATCHING DATA TYPE (GET_NEW_STRINGS): ',INPUT_TYPE(AN_INPUT),S_TYPE, AN_INPUT, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF

    GENERATED_POSITION(:,INPUT_NUMBER)=GENERATED_POSITION(:,AN_INPUT)

    DO I=GENERATED_POSITION(1,INPUT_NUMBER), GENERATED_POSITION(2,INPUT_NUMBER)
       IF(INPUT_STK(I).LE.0) GO TO 100
    END DO
    PRINT*,' SORRY, NO CHOICE LEFT (GET_NEW_STRINGS): ', AN_INPUT, ', ', &
           LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    STOP

    100 CONTINUE

    L=AN_INTEGER_RANDOM(GENERATED_POSITION(1,INPUT_NUMBER),GENERATED_POSITION(2,INPUT_NUMBER))+0.4
    IF(L.GT.GENERATED_POSITION(2,INPUT_NUMBER)) L=GENERATED_POSITION(2,INPUT_NUMBER)
    IF(INPUT_STK(L).GE.1) GO TO 100
    INPUT_STK(L)=1
    GENERATED_I(INPUT_NUMBER)=L

    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(INPUT_SSS(L))
    THE_READ(1:THE_READ_LENGTH)=TRIM(INPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: ', INPUT_NUMBER, &
                      L-GENERATED_POSITION(1,INPUT_NUMBER)+1, &
                      GENERATED_POSITION(2,INPUT_NUMBER)-GENERATED_POSITION(1,INPUT_NUMBER)+1, &
                      ' SSS: '//INPUT_SSS(L)//' ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_NEW_STRINGS




SUBROUTINE GET_LOGICALS(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    INTEGER           :: KK,K,JJ,L
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=L_TYPE
    IF(KK.EQ.0) THEN
        CALL FIRST_PROCESSING0(LOGICAL_KEY)
    ELSE IF(KK.EQ.1) THEN
        CALL FIRST_PROCESSING(LOGICAL_KEY)
    ELSE IF(KK.EQ.3) THEN
        CALL FIRST_PROCESSING_TEMP3(LOGICAL_KEY)
    ELSE
        PRINT*,'NOT ACCEPTED KK: ',KK
        STOP
    END IF

    DATA_BEGIN_NUMBER=0
    CALL CHECK_AND_DELETE_S(DATA_BEGIN_KEY,K,JJ)
    CALL RESET_THE_WORK2_2(K)

    CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
    IF(JJ.NE.2) THEN
          PRINT*,'Sorry, '//DATA_SEPARATE_KEY//' IS NOT FOUND IN LLL REGION: ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
    END IF
    IF(K.GT.MAX_NUMBER_OF_CHARACTERS_SSS) THEN
          PRINT*,'Sorry, TOO LONG STRING (LLL): ',K,MAX_NUMBER_OF_CHARACTERS_SSS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
    END IF
    INPUT_STRING_POSITION=INPUT_STRING_POSITION+1
    IF(INPUT_STRING_POSITION.GT.MAX_NUMBER_OF_SSS_INPUT_TERMS) THEN
          PRINT*,'Sorry, TOO MANY STRINGS (LLL): ',INPUT_STRING_POSITION,MAX_NUMBER_OF_SSS_INPUT_TERMS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    GENERATED_POSITION(T_POST,INPUT_NUMBER)=INPUT_STRING_POSITION
    INPUT_SSS(INPUT_STRING_POSITION)=' '
    INPUT_SSS(INPUT_STRING_POSITION)=THE_READ_WORK2(1:K)
    CALL RESET_THE_WORK2_2(K)

    CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
    IF(K.GT.MAX_NUMBER_OF_CHARACTERS_SSS) THEN
          PRINT*,'Sorry, TOO LONG STRING (LLL): ',K,MAX_NUMBER_OF_CHARACTERS_SSS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_STRING_POSITION=INPUT_STRING_POSITION+1
    IF(INPUT_STRING_POSITION.GT.MAX_NUMBER_OF_SSS_INPUT_TERMS) THEN
          PRINT*,'Sorry, TOO MANY STRINGS (LLL): ',INPUT_STRING_POSITION,MAX_NUMBER_OF_SSS_INPUT_TERMS, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    GENERATED_POSITION(F_POST,INPUT_NUMBER)=INPUT_STRING_POSITION
    INPUT_SSS(INPUT_STRING_POSITION)=' '
    INPUT_SSS(INPUT_STRING_POSITION)=THE_READ_WORK2(1:K)
    CALL RESET_THE_WORK2_2(K)

    PRINTING=.TRUE.
    IF(JJ.EQ.2) THEN
       CALL CHECK_AND_DELETE_S(DATA_SEPARATE_KEY,K,JJ)
       IF(JJ.NE.3) THEN
          PRINT*,'Sorry, '//DATA_END_KEY//' IS NOT FOUND IN LLL REGION: ',JJ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          PRINT*,THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          STOP
       END IF
       IF((     TRIM(ADJUSTL(THE_READ_WORK2(1:K))).EQ.NO_PRINTING_KEY       )  .AND. &
          ( LEN_TRIM(ADJUSTL(THE_READ_WORK2(1:K))).EQ.NO_PRINTING_KEY_LENTH ) ) THEN
          PRINTING=.FALSE.
          CALL RESET_THE_WORK2_2(K)
       ELSE IF(THE_READ_WORK2(1:K).EQ.' ') THEN
       ELSE
          PRINT*,'Sorry, unacceptable LLL REGION: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    ELSE IF(JJ.EQ.3) THEN
    ELSE
          PRINT*,'Sorry, unacceptable LLL REGION: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    L=AN_INTEGER_RANDOM(GENERATED_POSITION(1,INPUT_NUMBER),GENERATED_POSITION(2,INPUT_NUMBER))+0.4
    IF(L.GT.GENERATED_POSITION(2,INPUT_NUMBER)) L=GENERATED_POSITION(2,INPUT_NUMBER)
    GENERATED_I(INPUT_NUMBER)=L

    IF(L.EQ.GENERATED_POSITION(T_POST,INPUT_NUMBER)) THEN
       GENERATED_L(INPUT_NUMBER)=.TRUE.
    ELSE IF(L.EQ.GENERATED_POSITION(F_POST,INPUT_NUMBER)) THEN
       GENERATED_L(INPUT_NUMBER)=.FALSE.
    ELSE
       PRINT*,'Sorry, A BUG INSIDE (LLL), PLEASE REPORT: ', L, F_POST, T_POST, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
       STOP
    END IF
    THE_READ=' '
    THE_READ_LENGTH=THE_READ_WORK2_LENGTH+LEN_TRIM(INPUT_SSS(L))
    THE_READ(1:THE_READ_LENGTH)=TRIM(INPUT_SSS(L))//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
    END IF

          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: ', INPUT_NUMBER, &
                      GENERATED_L(INPUT_NUMBER),' : '//TRIM(INPUT_SSS(L))//' ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_LOGICALS




SUBROUTINE GET_TRIPLE_VECTORS(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1,D2,D3
    INTEGER           ::  I,ACCURACY,KK,ACCRC1(9)
    IIIRRRCCC=0
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=V_TYPE
    IF(KK.EQ.0) THEN
        CALL FIRST_PROCESSING0(VECTOR_KEY)
    ELSE IF(KK.EQ.1) THEN
        CALL FIRST_PROCESSING(VECTOR_KEY)
    ELSE IF(KK.EQ.3) THEN
        CALL FIRST_PROCESSING_TEMP3(VECTOR_KEY)
    ELSE
        PRINT*,'NOT ACCEPTED KK: ',KK
        STOP
    END IF
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    DO I=1, 8
       CALL GET_A_DOUBLE(D1,ACCURACY)
       ACCRC1(I)=ACCURACY
       INPUT_VVV(IIIRRRCCC,INPUT_NUMBER)=D1
       CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    END DO
    CALL GET_A_DOUBLE(D1,ACCURACY)
    ACCRC1(9)=ACCURACY
    INPUT_VVV(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_NO_PRINTING_AND_ENDS()

    DO I=1, 3
       INPUT_ACCURACY(I,INPUT_NUMBER)=MIN(ACCRC1(I*3-2),ACCRC1(I*3-1),ACCRC1(I*3))
       INPUT_ACCURACY(I,INPUT_NUMBER)=ACCRC1(I*3)
       IF(INPUT_VVV(I*3,INPUT_NUMBER).EQ.0.0D0) THEN
          INPUT_ACCURACY(I,INPUT_NUMBER)=MIN(ACCRC1(I*3-2),ACCRC1(I*3-1))
          INPUT_ACCURACY(I,INPUT_NUMBER)=    ACCRC1(I*3-2)
          IF(INPUT_VVV(I*3-1,INPUT_NUMBER).LT.INPUT_VVV(I*3-2,INPUT_NUMBER)) THEN
             INPUT_VVV(I*3,INPUT_NUMBER)=2.0D0*(INPUT_VVV(I*3-1,INPUT_NUMBER)- &
                                                INPUT_VVV(I*3-2,INPUT_NUMBER))-1000.0D0
          ELSE
             INPUT_VVV(I*3,INPUT_NUMBER)=2.0D0*(INPUT_VVV(I*3-1,INPUT_NUMBER)- &
                                                INPUT_VVV(I*3-2,INPUT_NUMBER))+1000.0D0
          END IF
       END IF
    END DO

    THE_READ_WORK5=' '
    THE_READ_WORK5_LENGTH=1
    THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)='('
    DO I=1, 3
       D1=INPUT_VVV(1+(I-1)*3,INPUT_NUMBER)
       D2=INPUT_VVV(2+(I-1)*3,INPUT_NUMBER)
       D3=INPUT_VVV(3+(I-1)*3,INPUT_NUMBER)
       GENERATED_V(I,INPUT_NUMBER)=A_STEPPED_RAN_DOUBLE(D1,D2,D3)
       D1=GENERATED_V(I,INPUT_NUMBER)
       ACCURACY=INPUT_ACCURACY(I,INPUT_NUMBER)
       CALL CONVERT_A_DOUBLE(D1, ACCURACY)
       THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH)=&
                                                   THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)
       THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH
       IF(I.NE.3) THEN
          THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+3)=' , '
          THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+3
       END IF
    END DO
    THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+2)=') '
    THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+2

       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: $ ', INPUT_NUMBER, &
                               ' $ : $ '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//VECTOR_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_TRIPLE_VECTORS




SUBROUTINE GET_TRIPLE_DOUBLES(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION  ::  D1,D2,D3
    INTEGER           ::  ACCURACY,KK
    INTEGER           ::  ACCRC1,ACCRC2,ACCRC3
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=R_TYPE
    IF(KK.EQ.0) THEN
        CALL FIRST_PROCESSING0(REAL_KEY)
    ELSE IF(KK.EQ.1) THEN
        CALL FIRST_PROCESSING(REAL_KEY)
    ELSE IF(KK.EQ.3) THEN
        CALL FIRST_PROCESSING_TEMP3(REAL_KEY)
    ELSE
        PRINT*,'NOT ACCEPTED KK: ',KK
        STOP
    END IF
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC1)
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC2)
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC3)
    ACCURACY=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY=                  ACCRC3
    IF(D1.EQ.0.0D0) THEN
       ACCURACY=MIN(ACCRC1,ACCRC2)
       ACCURACY=    ACCRC1
       IF(INPUT_RRR(2,INPUT_NUMBER).LT.INPUT_RRR(1,INPUT_NUMBER)) THEN
          D1=2.0D0*(INPUT_RRR(2,INPUT_NUMBER)-INPUT_RRR(1,INPUT_NUMBER))-1000.0D0
       ELSE
          D1=2.0D0*(INPUT_RRR(2,INPUT_NUMBER)-INPUT_RRR(1,INPUT_NUMBER))+1000.0D0
       END IF
    END IF
    INPUT_RRR(IIIRRRCCC,INPUT_NUMBER)=D1
    CALL CHECK_NO_PRINTING_AND_ENDS()

    IF(IIIRRRCCC.EQ.3) THEN
       INPUT_ACCURACY(1,INPUT_NUMBER)=ACCURACY
       D1=INPUT_RRR(1,INPUT_NUMBER)
       D2=INPUT_RRR(2,INPUT_NUMBER)
       D3=INPUT_RRR(3,INPUT_NUMBER)
       GENERATED_R(INPUT_NUMBER)=A_STEPPED_RAN_DOUBLE(D1,D2,D3)
       D1=GENERATED_R(INPUT_NUMBER)
       ACCURACY=INPUT_ACCURACY(1,INPUT_NUMBER)
       CALL CONVERT_A_DOUBLE(D1, ACCURACY)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK3_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: $ ', INPUT_NUMBER, &
                               ' $ : $ '//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//' $ ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//REAL_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_TRIPLE_DOUBLES




SUBROUTINE GET_A_DOUBLE(THE_OBTAINED_DOUBLE,ACCURACY)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    DOUBLE PRECISION  ::  D1,THE_OBTAINED_DOUBLE
    INTEGER           ::  ACCURACY,NEW_FROM,I,J,K,L
    IIIRRRCCC=IIIRRRCCC+1
    FIND_EB: DO

       J=-1
       DO I=1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          L=IACHAR(AA)
          IF(AA.EQ.' ') THEN
          ELSE IF(AA.EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'.').OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
             J=I
             EXIT FIND_EB
          ELSE
             PRINT*, 'Sorry, DOUBLE expected (GET_A_DOUBLE) but : "'//THE_READ_WORK2(1:I)//'" found: ',&
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       END DO

       IF(READ_ROUTINE_SWITCH.EQ.1) THEN
          CALL READ_A_LINE()
       ELSE IF(READ_ROUTINE_SWITCH.EQ.2) THEN
          CALL READ_A_LINE2()
       ELSE
          PRINT*, 'ILLEGAL READ_ROUTINE_SWITCH (GET_A_DOUBLE): ', READ_ROUTINE_SWITCH, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF


       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, a double expected but not found in the input file: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no DOUBLE found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    K=THE_READ_WORK2_LENGTH
    DO I=J+1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          IF(AA.EQ.' ') THEN
             K=I
             EXIT
          ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.'$') THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.DATA_END_KEY) THEN
             K=I-1
             EXIT
          END IF
    END DO

    CALL READ_A_DOUBLE(J,K,D1,ACCURACY,NEW_FROM)
    THE_OBTAINED_DOUBLE=D1

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE GET_A_DOUBLE




SUBROUTINE GET_A_DOUBLE_TEMP3(THE_OBTAINED_DOUBLE,ACCURACY)
    USE BASE_DATA
    USE RAND_INTERFACE
    IMPLICIT NONE
    CHARACTER (LEN=1) ::  AA
    DOUBLE PRECISION  ::  D1,THE_OBTAINED_DOUBLE
    INTEGER           ::  ACCURACY,NEW_FROM,I,J,K,L
    IIIRRRCCC=IIIRRRCCC+1
    FIND_EB: DO

       J=-1
       DO I=1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          L=IACHAR(AA)
          IF(AA.EQ.' ') THEN
          ELSE IF(AA.EQ.'$') THEN
             THE_READ_WORK2(I:I)=' '
             DOLLAR_NUMBER=DOLLAR_NUMBER+1
          ELSE IF(((L.GE.48).AND.(L.LE.57)).OR.(AA.EQ.'.').OR.(AA.EQ.'+').OR.(AA.EQ.'-')) THEN
             J=I
             EXIT FIND_EB
          ELSE
             PRINT*, 'Sorry, numbers expected (GET_A_DOUBLE_TEMP3) but : "'//AA//'" found: ',             &
                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
             PRINT*, THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
             STOP
          END IF
       END DO

       CALL READ_A_LINE()

       IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) THEN
          PRINT*, 'Sorry, a double expected but not found in the input file: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       IF(THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1.GT.MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH) THEN
          PRINT*, 'Sorry, so many characters checked but no DOUBLE found: ',             &
                THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1, MAX_NUMBER_OF_CHARACTERS_P2-ADDITIONAL_LENTH, &
                                    LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
       THE_READ_WORK2(THE_READ_WORK2_LENGTH+1:THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1) &
                                                     =' '//THE_READ(1:THE_READ_LENGTH)
       THE_READ_WORK2_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_LENGTH+1
    END DO FIND_EB

    K=THE_READ_WORK2_LENGTH
    DO I=J+1, THE_READ_WORK2_LENGTH
          AA=THE_READ_WORK2(I:I)
          IF(AA.EQ.' ') THEN
             K=I
             EXIT
          ELSE IF(AA.EQ.DATA_SEPARATE_KEY) THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.'$') THEN
             K=I-1
             EXIT
          ELSE IF(AA.EQ.DATA_END_KEY) THEN
             K=I-1
             EXIT
          END IF
    END DO

    CALL READ_A_DOUBLE(J,K,D1,ACCURACY,NEW_FROM)
    THE_OBTAINED_DOUBLE=D1

    CALL RESET_THE_WORK2_2(K)

    RETURN
END SUBROUTINE GET_A_DOUBLE_TEMP3




SUBROUTINE GET_TRIPLE_COMPLEXES(KK)
    USE BASE_DATA
    USE RAND_INTERFACE
    USE PROCESSING_INTERFACE
    IMPLICIT NONE
    DOUBLE COMPLEX    ::  C1,C2,C3
    DOUBLE PRECISION  ::  D1,D2,D3,D4,D5,D6
    INTEGER           ::  ACCURACY1,ACCURACY2,KK
    INTEGER           ::  ACCRC1, ACCRC2, ACCRC3
    INPUT_NUMBER=INPUT_NUMBER+1
    IF(INPUT_NUMBER.GT.MAX_NUMBER_OF_INPUTS_PQ) THEN
          PRINT*,'Sorry, TOO MANY INPUTS: ',INPUT_NUMBER,MAX_NUMBER_OF_INPUTS_PQ, &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF
    INPUT_TYPE(INPUT_NUMBER)=C_TYPE
    IF(KK.EQ.0) THEN
       CALL FIRST_PROCESSING0(COMPLEX_KEY)
    ELSE IF(KK.EQ.1) THEN
       CALL FIRST_PROCESSING(COMPLEX_KEY)
    ELSE IF(KK.EQ.3) THEN
       CALL FIRST_PROCESSING_TEMP3(COMPLEX_KEY)
    ELSE
       PRINT*,'NOT ACCEPTED KK: ',KK
       STOP
    END IF
    CALL CHECK_AND_DELETE(DATA_BEGIN_KEY)
    CALL GET_A_DOUBLE(D1,ACCRC1)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D2,ACCRC2)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D3,ACCRC3)
    ACCURACY1=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY1=                  ACCRC3
    IF(D3.EQ.0.0D0) THEN
       ACCURACY1=MIN(ACCRC1,ACCRC2)
       ACCURACY1=    ACCRC1
       IF(D2.LT.D1) THEN
          D3=2.0D0*(D2-D1)-1000.0D0
       ELSE
          D3=2.0D0*(D2-D1)+1000.0D0
       END IF
    END IF

    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D4,ACCRC1)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D5,ACCRC2)
    CALL CHECK_AND_DELETE(DATA_SEPARATE_KEY)
    CALL GET_A_DOUBLE(D6,ACCRC3)
    ACCURACY2=MIN(ACCRC1,ACCRC2,ACCRC3)
    ACCURACY2=                  ACCRC3
    CALL CHECK_NO_PRINTING_AND_ENDS()
    IF(D6.EQ.0.0D0) THEN
       ACCURACY2=MIN(ACCRC1,ACCRC2)
       ACCURACY2=    ACCRC1
       IF(D5.LT.D4) THEN
          D6=2.0D0*(D5-D4)-1000.0D0
       ELSE
          D6=2.0D0*(D5-D4)+1000.0D0
       END IF
    END IF

    INPUT_CCC(1,INPUT_NUMBER)=CMPLX(D1,D4)
    INPUT_CCC(2,INPUT_NUMBER)=CMPLX(D2,D5)
    INPUT_CCC(3,INPUT_NUMBER)=CMPLX(D3,D6)

    IIIRRRCCC=3

    IF(IIIRRRCCC.EQ.3) THEN
       INPUT_ACCURACY(1,INPUT_NUMBER)=ACCURACY1
       INPUT_ACCURACY(2,INPUT_NUMBER)=ACCURACY2
       C1=INPUT_CCC(1,INPUT_NUMBER)
       C2=INPUT_CCC(2,INPUT_NUMBER)
       C3=INPUT_CCC(3,INPUT_NUMBER)
       GENERATED_C(INPUT_NUMBER)=A_STEPPED_RAN_COMPLEX(C1,C2,C3)
       C1=GENERATED_C(INPUT_NUMBER)
       ACCURACY1=INPUT_ACCURACY(1,INPUT_NUMBER)
       ACCURACY2=INPUT_ACCURACY(2,INPUT_NUMBER)
       CALL CONVERT_A_COMPLEX(C1, ACCURACY1, ACCURACY2)
       IF(MOD(DOLLAR_NUMBER,2).EQ.0) THEN
          THE_READ=' '
          THE_READ_LENGTH=THE_READ_WORK2_LENGTH+THE_READ_WORK5_LENGTH
          THE_READ(1:THE_READ_LENGTH)=  &
              THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          IF((NO_PRINTING_SWITCH.EQ.1).AND.(.NOT.PRINTING)) THEN
             THE_READ_LENGTH=THE_READ_WORK2_LENGTH+1
             THE_READ(1:THE_READ_LENGTH)=' '//THE_READ_WORK2(1:THE_READ_WORK2_LENGTH)
          END IF
          IF((.NOT.ANSWER_FOUND).AND.(.NOT.SOLUTION_FOUND)) THEN
             IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
             IF(SIMPLE_PRINT_INPUTS.EQ.1) THEN
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
               !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL, *)' Generated: $ ', INPUT_NUMBER, &
                            ' $ : $ '//THE_READ_WORK5(1:THE_READ_WORK5_LENGTH)//' $ ; '
             ELSE
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')' '
                CALL PRINT_INPUT_TO_TABLE(ANSW_LUTION_FILE_TUNNEL,INPUT_NUMBER,INPUT_NUMBER)
             END IF
             END IF
          END IF
       ELSE
          PRINT*,'Sorry, odd number of "$"s detected in a '//COMPLEX_KEY//' region: ', &
                LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
       END IF
    END IF

    PRINTING=.TRUE.

    RETURN
END SUBROUTINE GET_TRIPLE_COMPLEXES




SUBROUTINE CONVERT_A_DOUBLE(THE_DOUBLE, ACCURACY)
    USE BASE_DATA
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION :: THE_DOUBLE
    INTEGER          :: ACCURACY, TOP, DIFS
    DOUBLE PRECISION :: G,H
    LOGICAL          :: SEPRATE

    IF(THE_DOUBLE.EQ.0.0D0) THEN
       THE_READ_WORK3=' '
       THE_READ_WORK3(1:1)='0'
       THE_READ_WORK3_LENGTH=1
       RETURN
    END IF

    G=ABS(THE_DOUBLE)
    H=LOG10(G)
    TOP=H
    IF(H.LT.0) THEN
       IF(TOP.GT.H) TOP=TOP-1
    END IF

    IF(ACCURACY.GT.TOP) THEN
          TOP=ACCURACY
    !     PRINT*, 'Sorry, PROBLEM OF ACCURACY OF THE DOUBLE: ',THE_DOUBLE, ACCURACY, TOP,&
    !                     LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !     STOP
    !ELSE IF(ACCURACY.EQ.TOP) THEN
    !     PRINT*, 'Warning, PROBLEM OF ACCURACY OF THE DOUBLE: ',THE_DOUBLE, ACCURACY, TOP,&
    !                     LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !ELSE
    END IF

    DIFS=TOP-ACCURACY

    OPEN(TEMP2_FILE_TUNNEL, FILE=TEMP2_FILE)
         IF((TOP.GE.-1).AND.(ACCURACY.LE.1))THEN
            WRITE(TEMP2_FILE_TUNNEL,'('//REAL_FORM_HEAD//TRIM(REAL_DIGITS(ABS(MIN(ACCURACY,0))))//')') THE_DOUBLE
            SEPRATE=.FALSE.
         ELSE
            SEPRATE=.TRUE.
            H=THE_DOUBLE/10.0D0**(TOP)
            WRITE(TEMP2_FILE_TUNNEL,'('//REAL_FORM_HEAD//TRIM(REAL_DIGITS(DIFS))//')') H
         END IF
         WRITE(TEMP2_FILE_TUNNEL,*)
         WRITE(TEMP2_FILE_TUNNEL,*)
    CLOSE(TEMP2_FILE_TUNNEL)
    OPEN(TEMP2_FILE_TUNNEL, FILE=TEMP2_FILE)
         THE_READ_WORK4=' '
         READ(TEMP2_FILE_TUNNEL,*) THE_READ_WORK4
    CLOSE(TEMP2_FILE_TUNNEL)
    THE_READ_WORK3=' '
    IF(SEPRATE) THEN
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(TOP,CHAR_OF_INT5_LENGTH)
       THE_READ_WORK3=ADJUSTL(THE_READ_WORK4)
       THE_READ_WORK3_LENGTH=LEN_TRIM(THE_READ_WORK3)
       THE_READ_WORK3(THE_READ_WORK3_LENGTH+1:THE_READ_WORK3_LENGTH+CHAR_OF_INT5_LENGTH+13)= &
                                    ' \times 10^{'//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//'}'
       THE_READ_WORK3_LENGTH=THE_READ_WORK3_LENGTH+CHAR_OF_INT5_LENGTH+13
    ELSE
       THE_READ_WORK3=ADJUSTL(THE_READ_WORK4)
       THE_READ_WORK3_LENGTH=LEN_TRIM(THE_READ_WORK3)
    END IF

    RETURN
END SUBROUTINE CONVERT_A_DOUBLE




SUBROUTINE CONVERT_A_COMPLEX(THE_COMPLEX, ACC1, ACC2)
    USE BASE_DATA
    IMPLICIT NONE
    DOUBLE COMPLEX   :: THE_COMPLEX
    DOUBLE PRECISION :: THE_DOUBLE
    INTEGER          :: ACC1, ACC2

    THE_DOUBLE=REAL(THE_COMPLEX)
    CALL CONVERT_A_DOUBLE(THE_DOUBLE, ACC1)
    THE_READ_WORK5=' '
    THE_READ_WORK5='('//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//', '
    THE_READ_WORK5_LENGTH=THE_READ_WORK3_LENGTH+3

    THE_DOUBLE=AIMAG(THE_COMPLEX)
    CALL CONVERT_A_DOUBLE(THE_DOUBLE, ACC2)
    THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH+1)= &
                                                THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//')'
    THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH+1
    RETURN
END SUBROUTINE CONVERT_A_COMPLEX




SUBROUTINE CONVERT_A_DOUBLE_DIFS(THE_DOUBLE, DIFS)
    USE BASE_DATA
    USE INT_TO_CHAR_INTERFACE
    IMPLICIT NONE
    DOUBLE PRECISION :: THE_DOUBLE
    INTEGER          :: ACCURACY, TOP, DIFS
    DOUBLE PRECISION :: G,H
    LOGICAL          :: SEPRATE

    IF(DIFS.LE.0) THEN
          PRINT*, 'Sorry, PROBLEM OF ACCURACY (DIFS) FOR A DOUBLE: ',DIFS,&
                          LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
          STOP
    END IF

    IF(THE_DOUBLE.EQ.0.0D0) THEN
       THE_READ_WORK3=' '
       THE_READ_WORK3(1:1)='0'
       THE_READ_WORK3_LENGTH=1
       RETURN
    END IF

    G=ABS(THE_DOUBLE)
    H=LOG10(G)
    TOP=H
    IF(H.LT.0) THEN
       IF(TOP.GT.H) TOP=TOP-1
    END IF

    ACCURACY=TOP-DIFS+1

    !IF(ACCURACY.GT.TOP) THEN
    !     PRINT*, 'Sorry, PROBLEM OF ACCURACY OF THE DOUBLE: ',THE_DOUBLE, ACCURACY, TOP,&
    !                     LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !     STOP
    !ELSE IF(ACCURACY.EQ.TOP) THEN
    !     PRINT*, 'Warning, PROBLEM OF ACCURACY OF THE DOUBLE: ',THE_DOUBLE, ACCURACY, TOP,&
    !                     LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
    !ELSE
    !END IF

    OPEN(TEMP2_FILE_TUNNEL, FILE=TEMP2_FILE)
         IF((TOP.GE.-1).AND.(ACCURACY.LE.1))THEN
            WRITE(TEMP2_FILE_TUNNEL,'('//REAL_FORM_HEAD//TRIM(REAL_DIGITS(ABS(MIN(ACCURACY,0))))//')') THE_DOUBLE
            SEPRATE=.FALSE.
         ELSE
            SEPRATE=.TRUE.
            H=THE_DOUBLE/10.0D0**(TOP)
            WRITE(TEMP2_FILE_TUNNEL,'('//REAL_FORM_HEAD//TRIM(REAL_DIGITS(DIFS-1))//')') H
         END IF
         WRITE(TEMP2_FILE_TUNNEL,*)
         WRITE(TEMP2_FILE_TUNNEL,*)
    CLOSE(TEMP2_FILE_TUNNEL)
    OPEN(TEMP2_FILE_TUNNEL, FILE=TEMP2_FILE)
         THE_READ_WORK4=' '
         READ(TEMP2_FILE_TUNNEL,*) THE_READ_WORK4
    CLOSE(TEMP2_FILE_TUNNEL)
    THE_READ_WORK3=' '
    IF(SEPRATE) THEN
       CHAR_OF_INT5=INTEGER_TO_CHARACTER(TOP,CHAR_OF_INT5_LENGTH)
       THE_READ_WORK3=ADJUSTL(THE_READ_WORK4)
       THE_READ_WORK3_LENGTH=LEN_TRIM(THE_READ_WORK3)
       THE_READ_WORK3(THE_READ_WORK3_LENGTH+1:THE_READ_WORK3_LENGTH+CHAR_OF_INT5_LENGTH+13)= &
                                    ' \times 10^{'//CHAR_OF_INT5(1:CHAR_OF_INT5_LENGTH)//'}'
       THE_READ_WORK3_LENGTH=THE_READ_WORK3_LENGTH+CHAR_OF_INT5_LENGTH+13
    ELSE
       THE_READ_WORK3=ADJUSTL(THE_READ_WORK4)
       THE_READ_WORK3_LENGTH=LEN_TRIM(THE_READ_WORK3)
    END IF

    RETURN
END SUBROUTINE CONVERT_A_DOUBLE_DIFS




SUBROUTINE CONVERT_A_COMPLEX_DIFS(THE_COMPLEX, ACC1, ACC2)
    USE BASE_DATA
    IMPLICIT NONE
    DOUBLE COMPLEX   :: THE_COMPLEX
    DOUBLE PRECISION :: THE_DOUBLE
    INTEGER          :: ACC1, ACC2

    THE_DOUBLE=REAL(THE_COMPLEX)
    CALL CONVERT_A_DOUBLE_DIFS(THE_DOUBLE, ACC1)
    THE_READ_WORK5=' '
    THE_READ_WORK5='('//THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//', '
    THE_READ_WORK5_LENGTH=THE_READ_WORK3_LENGTH+3

    THE_DOUBLE=AIMAG(THE_COMPLEX)
    CALL CONVERT_A_DOUBLE_DIFS(THE_DOUBLE, ACC2)
    THE_READ_WORK5(THE_READ_WORK5_LENGTH+1:THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH+1)= &
                                                THE_READ_WORK3(1:THE_READ_WORK3_LENGTH)//')'
    THE_READ_WORK5_LENGTH=THE_READ_WORK5_LENGTH+THE_READ_WORK3_LENGTH+1
    RETURN
END SUBROUTINE CONVERT_A_COMPLEX_DIFS




SUBROUTINE PRINT_INPUT_TO_TABLE(TUNNEL,I1,I2)
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I, I1, I2, TUNNEL, K2
  K2=0
  DO I=I1, I2
     IF(K2.EQ.0) THEN
        WRITE(TUNNEL,'(A)')'  '
        WRITE(TUNNEL,'(A)')'  '
        WRITE(TUNNEL,'(A)')'\noindent\begin{tabular}{|l|l|l|l|l|}'
        WRITE(TUNNEL,'(A)')'\hline'
        WRITE(TUNNEL,'(A)')' Sequential & Type & Accuracy & Three inputs & Generated \\ '
        WRITE(TUNNEL,'(A)')'\hline'
        K2=1
     END IF
     CALL PRINT_AN_INPUT4(TUNNEL,I, K2)
  END DO
  IF(K2.NE.0) THEN
     WRITE(TUNNEL,*)'\end{tabular}'
     WRITE(TUNNEL,*)'  '
     WRITE(TUNNEL,*)'  '
  END IF
  RETURN
END SUBROUTINE PRINT_INPUT_TO_TABLE




SUBROUTINE PRINT_OUTPUT_TO_TABLE(TUNNEL,I1,I2)
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I, I1, I2, TUNNEL, K2
  K2=0
  DO I=I1, I2
     IF(K2.EQ.0) THEN
        WRITE(TUNNEL,'(A)')'  '
        WRITE(TUNNEL,'(A)')'  '
        WRITE(TUNNEL,'(A)')'\noindent\begin{tabular}{|l|l|l|l|}'
        WRITE(TUNNEL,'(A)')'\hline'
        WRITE(TUNNEL,'(A)')' Sequential & Type & Accuracy & Calculated \\ '
        WRITE(TUNNEL,'(A)')'\hline'
        K2=1
     END IF
     CALL PRINT_AN_OUTPUT4(TUNNEL,I,K2)
  END DO
  IF(K2.NE.0) THEN
     WRITE(TUNNEL,*)'\end{tabular}'
     WRITE(TUNNEL,*)'  '
     WRITE(TUNNEL,*)'  '
  END IF
  RETURN
END SUBROUTINE PRINT_OUTPUT_TO_TABLE




SUBROUTINE MAKE_A_QUESTION()
  USE BASE_DATA
  USE RAND_INTERFACE
  USE PROCESSING_INTERFACE
  USE A_TITLED_BOX_INTERFACE
  IMPLICIT NONE
  INTEGER :: I, J, CP, ACC, KK=1, KKK=10
  DOUBLE PRECISION :: DB

  INSIDE_BIGQUESTION=.TRUE.
  INSIDE_QUESTION=.TRUE.
  IF((.NOT.QUESTION_TITLE_FOUND).AND.(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER).LE.1)) THEN
     INSIDE_SUBQUESTION=.FALSE.
  ELSE
     INSIDE_SUBQUESTION=.TRUE.
  END IF
  SWITCH_TURNED_ON=.FALSE.
  EFFECTIVE_SWITCH_VALUE=QUESTION_POSITION(5,QUESTION_NUMBER)

  TOTAL_NUMBER_OF_AUTO_ANSWERS=0
  OPEN(AUTO_TEMP_FILE_TUNNEL, FILE=AUTO_ANSWER_TEMP_FILE)
       WRITE(AUTO_TEMP_FILE_TUNNEL, *) 'BEGINS...'
  CLOSE(AUTO_TEMP_FILE_TUNNEL)
  LINE_OF_AUTO_ANSWERS=1

  LAYER_NUMBER=0
  INPUT_NUMBER=0
  INPUT_TYPE=UNDEFINED_TYPE
  INPUT_STRING_POSITION=0
  CALCULATED_NUMBER=0
  CALCULATED_TYPE=UNDEFINED_TYPE
  ANSWER_FOUND=.FALSE.
  SOLUTION_FOUND=.FALSE.
  MANY_CHOICES_FOUND=.FALSE.
  MANY_TO_ORDER_FOUND=.FALSE.
  COLUMN_MATCH_FOUND=.FALSE.
  ANSWER_COUNTER=0
  SOLUTION_COUNTER=0
  MANY_CHOICES_COUNTER=0
  MANY_TO_ORDER_COUNTER=0
  COLUMN_MATCH_COUNTER=0
  COLUMN_NUMBER=0
  PAIRS_FOR_MATCH=0
  TOTAL_NUMBER_OF_ITEMS=0
  CALCULATED_ACCURACY=DEFAULT_CALCULATED_ACCURACY
  CONSTANT_TABLE_HEAD_FOUND=.FALSE.
  GENERATED_M(:)%BRACE_INDEX=MATRIX_DATA_ONLY
  CALCULATED_M(:)%BRACE_INDEX=MATRIX_DATA_ONLY
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')SPACING
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSWER_FILE_TUNNEL,'(A)')SPACING
  WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'  '
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')SPACING
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
  IF((.NOT.QUESTION_TITLE_FOUND).AND.(BIG_QUESTIONS(0,BIG_QUESTION_NUMBER).LE.1)) THEN
     IF(MARK_BOX_FOR_QUESTIONS.EQ.1) THEN
        CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_MARK,YOUR_MARK_POST)
        DB=QUESTION_MARKS(2,QUESTION_NUMBER)
        ACC=MARK_ACCURACY
        CALL CONVERT_A_DOUBLE(DB,ACC)
        CALL A_FILLED_BOX(OUTPUT_FILE_TUNNEL,2,THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),&
                      FULL_MARK, FULL_MARK_POST)
     END IF
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIN
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIN
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_BEGIN
     WRITE(ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIN
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIN2
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')QUESTION_BEGIN
  ELSE
     IF(MARK_BOX_FOR_QUESTIONS.EQ.1) THEN
        CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_MARL,YOUR_MARL_POST)
        DB=QUESTION_MARKS(2,QUESTION_NUMBER)
        ACC=MARK_ACCURACY
        CALL CONVERT_A_DOUBLE(DB,ACC)
        CALL A_FILLED_BOX(OUTPUT_FILE_TUNNEL,2,THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),&
                      FULL_MARL, FULL_MARL_POST)
     END IF
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIL
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')QUESTION_BEGIL
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_BEGIL
     WRITE(ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIL
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')QUESTION_BEGIL2
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')QUESTION_BEGIL
  END IF
  IF(BIG_QUESTIONS(1,  BIG_QUESTION_NUMBER).EQ.0) THEN
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                      &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                   &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                  &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
     WRITE(ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                          &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT_END
  ELSE IF(BIG_QUESTIONS(1,  BIG_QUESTION_NUMBER).EQ.1) THEN
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                      &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                      &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                   &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                   &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                  &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                  &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
     WRITE(ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                 &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                          &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                          &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')CHAR_OF_INT( 1: CHAR_OF_INT_LENGTH)//DOT&
                                 &//CHAR_OF_INT2(1:CHAR_OF_INT2_LENGTH)//DOT&
                                 &//CHAR_OF_INT3(1:CHAR_OF_INT3_LENGTH)//DOT_END
  END IF
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')QUESTION_END
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '
  WRITE(OUTPUT_FILE_TUNNEL,'(A)')'  '

  WRITE(ANSW_LUTION_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,',',QUESTION_NUMBER, ',' &
                                        ,QUESTION_POSITION(0,QUESTION_NUMBER),')'
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')QUESTION_END
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
 !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')VALUES_TITLE
 !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
 !WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(SOLUTION_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,',',QUESTION_NUMBER, ',' &
                                        ,QUESTION_POSITION(0,QUESTION_NUMBER),')'
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')QUESTION_END
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(SOLUTION_FILE_TUNNEL,'(A)')'  '
  WRITE(JOURNAL_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,',',QUESTION_NUMBER, ',' &
                                         ,QUESTION_POSITION(0,QUESTION_NUMBER),')'
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')QUESTION_END
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
 !WRITE(JOURNAL_FILE_TUNNEL,'(A)')VALUES_TITLE
 !WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
 !WRITE(JOURNAL_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSWER_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,',',QUESTION_NUMBER, ',' &
                                        ,QUESTION_POSITION(0,QUESTION_NUMBER),')'
  WRITE(ANSWER_FILE_TUNNEL,'(A)')QUESTION_END
  WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '
  WRITE(ANSWER_FILE_TUNNEL,'(A)')'  '

  WRITE(SHORTEST_ANSWER_FILE_TUNNEL, *   )'(',BIG_QUESTION_NUMBER,',',QUESTION_NUMBER, ',' &
                                        ,QUESTION_POSITION(0,QUESTION_NUMBER),')'
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')QUESTION_END

  I=QUESTION_POSITION(1,QUESTION_NUMBER)
  CALL OPEN_READ_TO(I)
  READ_DO: DO I=QUESTION_POSITION(1,QUESTION_NUMBER)+1, QUESTION_POSITION(2,QUESTION_NUMBER)
      CALL READ_A_LINE2()
      IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) EXIT READ_DO
      CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
         IF(DO_NOT_OUTPUT) THEN
            DO_NOT_OUTPUT=.FALSE.
            CYCLE READ_DO
         END IF
         IF(CP.LE.0) THEN
              IF(SOLUTION_FOUND) THEN
                 CALL WRITE_THE_READ_TO_SOLUTION()
                 CALL WRITE_THE_READ_TO_ANSW_LUTION()
              ELSE IF(ANSWER_FOUND) THEN
                 CALL WRITE_THE_READ_TO_ANSWER()
                 CALL WRITE_THE_READ_TO_SHORTEST()
                 CALL WRITE_THE_READ_TO_ANSW_LUTION()
              ELSE
                 CALL WRITE_THE_READ()
              END IF
              CALL WRITE_THE_READ_TO_JOURNAL()
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+INTEGER_KEY_LENTH), INTEGER_KEY).GT.0) THEN
              CALL GET_TRIPLE_INTEGERS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_KEY_LENTH), REAL_KEY).GT.0) THEN
              CALL GET_TRIPLE_DOUBLES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_KEY_LENTH), COMPLEX_KEY).GT.0) THEN
              CALL GET_TRIPLE_COMPLEXES(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+VECTOR_KEY_LENTH), VECTOR_KEY).GT.0) THEN
              CALL GET_TRIPLE_VECTORS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+LOGICAL_KEY_LENTH), LOGICAL_KEY).GT.0) THEN
              CALL GET_LOGICALS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_KEY_LENTH), STRING_KEY).GT.0) THEN
              CALL GET_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+NEW_STRING_KEY_LENTH), NEW_STRING_KEY).GT.0) THEN
              CALL GET_NEW_STRINGS(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+INTEGER_MATRIX_KEY_LENTH), INTEGER_MATRIX_KEY).GT.0) THEN
              CALL GET_INTEGER_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+REAL_MATRIX_KEY_LENTH), REAL_MATRIX_KEY).GT.0) THEN
              CALL GET_REAL_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+COMPLEX_MATRIX_KEY_LENTH), COMPLEX_MATRIX_KEY).GT.0) THEN
              CALL GET_COMPLEX_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+STRING_MATRIX_KEY_LENTH), STRING_MATRIX_KEY).GT.0) THEN
              CALL GET_STRING_MATRIX(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_IN_KEY_LENTH), PRINT_IN_KEY).GT.0) THEN
              CALL PRINT_AN_INPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_OUT_KEY_LENTH), PRINT_OUT_KEY).GT.0) THEN
              CALL PRINT_AN_OUTPUT(KK,KKK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SET_ACCURACY_KEY_LENTH), SET_ACCURACY_KEY).GT.0) THEN
              CALL SET_ACCURARY(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_MANY_CHOICES_KEY_LENTH), END_MANY_CHOICES_KEY).GT.0) THEN
              PRINT*, END_MANY_CHOICES_KEY,' is not allowed before ', MANY_CHOICES_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+MANY_CHOICES_KEY_LENTH), MANY_CHOICES_KEY).GT.0) THEN
              CALL MAKE_CHOICES()
              CYCLE READ_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+SOME_CHOICE_KEY_LENTH), SOME_CHOICE_KEY).GT.0) THEN
              PRINT*, SOME_CHOICE_KEY,' is not allowed before ', MANY_CHOICES_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_MANY_TO_ORDER_KEY_LENTH), END_MANY_TO_ORDER_KEY).GT.0) THEN
              PRINT*, END_MANY_TO_ORDER_KEY,' is not allowed before ', MANY_TO_ORDER_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+MANY_TO_ORDER_KEY_LENTH), MANY_TO_ORDER_KEY).GT.0) THEN
              CALL MAKE_ORDERS()
              CYCLE READ_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+ONE_TO_ORDER_KEY_LENTH), ONE_TO_ORDER_KEY).GT.0) THEN
              PRINT*, ONE_TO_ORDER_KEY,' is not allowed before ', MANY_TO_ORDER_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_COLUMN_MATCH_KEY_LENTH), END_COLUMN_MATCH_KEY).GT.0) THEN
              PRINT*, END_COLUMN_MATCH_KEY,' is not allowed before ', COLUMN_MATCH_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+COLUMN_MATCH_KEY_LENTH), COLUMN_MATCH_KEY).GT.0) THEN
              CALL MAKE_MATCH()
              CYCLE READ_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_AUTO_ANSWER_KEY_LENTH), PRINT_AUTO_ANSWER_KEY).GT.0) THEN
              CALL PRINT_AUTO_ANSWER(KK)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+END_ABSTRACT_KEY_LENTH), END_ABSTRACT_KEY).GT.0) THEN
              PRINT*, END_ABSTRACT_KEY,' is not allowed before ', ABSTRACT_KEY, &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         ELSE IF(INDEX(THE_READ(CP:CP-1+ABSTRACT_KEY_LENTH), ABSTRACT_KEY).GT.0) THEN
              CALL MAKE_AN_ABSTRACT(CP)
              CYCLE CHECK_DO
         ELSE
              PRINT*, 'No other key is allowed here: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

      END DO CHECK_DO
  END DO READ_DO
  CALL CLOSE_INPUT()

  IF(CONSTANT_TABLE_HEAD_FOUND) THEN
     PRINT*, 'NOT ENDDED CONSTANT TABLE (MAKE_A_QUESTION): ', &
             LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
     STOP
  END IF

  CALL WRITE_A_TOTAL(JOURNAL_FILE_TUNNEL)
  IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
     CALL WRITE_A_TOTAL(ANSW_LUTION_FILE_TUNNEL)
     CALL WRITE_A_TOTAL(SOLUTION_FILE_TUNNEL)
     CALL WRITE_A_TOTAL(ANSWER_FILE_TUNNEL)
  END IF

  CALL SOLVE_THE_QUESTION(0,0)
  IF(PRINT_SOME_ADDITIONALS.EQ.1) THEN
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')CALCULATED_TITLE
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
  END IF
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)')CALCULATED_TITLE
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '

  J=CALCULATED_NUMBER/MAX_LINES_OF_OUT_TABLE
  DO I=1,J
     IF(PRINT_SOME_ADDITIONALS.EQ.1) &
     CALL PRINT_OUTPUT_TO_TABLE( ANSW_LUTION_FILE_TUNNEL,(I-1)*MAX_LINES_OF_OUT_TABLE+1,I*MAX_LINES_OF_OUT_TABLE)
     CALL PRINT_OUTPUT_TO_TABLE(JOURNAL_FILE_TUNNEL,(I-1)*MAX_LINES_OF_OUT_TABLE+1,I*MAX_LINES_OF_OUT_TABLE)
  END DO
  IF(CALCULATED_NUMBER.GT.J*MAX_LINES_OF_OUT_TABLE) THEN
     IF(PRINT_SOME_ADDITIONALS.EQ.1) &
     CALL PRINT_OUTPUT_TO_TABLE( ANSW_LUTION_FILE_TUNNEL,J*MAX_LINES_OF_OUT_TABLE+1,CALCULATED_NUMBER)
     CALL PRINT_OUTPUT_TO_TABLE(JOURNAL_FILE_TUNNEL,J*MAX_LINES_OF_OUT_TABLE+1,CALCULATED_NUMBER)
  END IF

  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)') '\noindent\vspace{0.1in}\hspace{-0.08in} {\textbf{\Large{All inputs: }}}'
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '
  WRITE(JOURNAL_FILE_TUNNEL,*)'  '

  J=INPUT_NUMBER/MAX_LINES_OF_TABLE
  DO I=1,J
     CALL PRINT_INPUT_TO_TABLE(JOURNAL_FILE_TUNNEL,(I-1)*MAX_LINES_OF_TABLE+1,I*MAX_LINES_OF_TABLE)
  END DO
  IF(INPUT_NUMBER.GT.J*MAX_LINES_OF_TABLE) THEN
     CALL PRINT_INPUT_TO_TABLE(JOURNAL_FILE_TUNNEL,J*MAX_LINES_OF_TABLE+1,INPUT_NUMBER)
  END IF

  INSIDE_BIGQUESTION=.FALSE.
  INSIDE_QUESTION=.FALSE.
  INSIDE_SUBQUESTION=.FALSE.
  SWITCH_TURNED_ON=.FALSE.

  RETURN
END SUBROUTINE MAKE_A_QUESTION




SUBROUTINE CLEAN_ALLOCATES()
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I
  DO I=1, INPUT_NUMBER
     IF(ASSOCIATED(GENERATED_M(I)%REAL_M))    DEALLOCATE(GENERATED_M(I)%REAL_M)
     IF(ASSOCIATED(GENERATED_M(I)%STRING_M))  DEALLOCATE(GENERATED_M(I)%STRING_M)
     IF(ASSOCIATED(GENERATED_M(I)%INTEGER_M)) DEALLOCATE(GENERATED_M(I)%INTEGER_M)
     IF(ASSOCIATED(GENERATED_M(I)%COMPLEX_M)) DEALLOCATE(GENERATED_M(I)%COMPLEX_M)
  END DO
  DO I=1, CALCULATED_NUMBER
     IF(ASSOCIATED(CALCULATED_M(I)%REAL_M))   DEALLOCATE(CALCULATED_M(I)%REAL_M)
     IF(ASSOCIATED(CALCULATED_M(I)%STRING_M)) DEALLOCATE(CALCULATED_M(I)%STRING_M)
     IF(ASSOCIATED(CALCULATED_M(I)%INTEGER_M))DEALLOCATE(CALCULATED_M(I)%INTEGER_M)
     IF(ASSOCIATED(CALCULATED_M(I)%COMPLEX_M))DEALLOCATE(CALCULATED_M(I)%COMPLEX_M)
  END DO
  RETURN
END SUBROUTINE CLEAN_ALLOCATES




SUBROUTINE CLEAN_ALLOCATES_OLD()
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I
  DO I=1, INPUT_NUMBER
    SELECT CASE (INPUT_TYPE(I))

    CASE(R_MATRIX_TYPE)
         DEALLOCATE(GENERATED_M(I)%REAL_M)

    CASE(S_MATRIX_TYPE)
         DEALLOCATE(GENERATED_M(I)%STRING_M)
         DEALLOCATE(GENERATED_M(I)%INTEGER_M)

    CASE(I_MATRIX_TYPE)
         DEALLOCATE(GENERATED_M(I)%INTEGER_M)

    CASE(C_MATRIX_TYPE)
         DEALLOCATE(GENERATED_M(I)%COMPLEX_M)

    CASE DEFAULT

    END SELECT
  END DO

  DO I=1, CALCULATED_NUMBER
    SELECT CASE (CALCULATED_TYPE(I))

    CASE(R_MATRIX_TYPE)
         DEALLOCATE(CALCULATED_M(I)%REAL_M)

    CASE(S_MATRIX_TYPE)
         DEALLOCATE(CALCULATED_M(I)%STRING_M)
         IF(ASSOCIATED(CALCULATED_M(I)%INTEGER_M))DEALLOCATE(CALCULATED_M(I)%INTEGER_M)

    CASE(I_MATRIX_TYPE)
         DEALLOCATE(CALCULATED_M(I)%INTEGER_M)

    CASE(C_MATRIX_TYPE)
         DEALLOCATE(CALCULATED_M(I)%COMPLEX_M)

    CASE DEFAULT

    END SELECT
  END DO

  RETURN
END SUBROUTINE CLEAN_ALLOCATES_OLD




SUBROUTINE WRITE_A_TOTAL(TUNNEL)
  USE BASE_DATA
  USE RAND_INTERFACE
  USE PROCESSING_INTERFACE
  USE A_TITLED_BOX_INTERFACE
  IMPLICIT NONE
  INTEGER :: TUNNEL
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,'(A)') '\noindent{\textbf{\Large{Total numbers: }}}'
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,'(A)')'\noindent\begin{tabular}{|l|l|l|l|l|l|l|}'
  WRITE(TUNNEL,*)'\hline'
  WRITE(TUNNEL,'(A)')'Inputs & Calculates & Choices & Layers & Matches & Answer & Solution \\ \hline'
  WRITE(TUNNEL,*)INPUT_NUMBER, ' & '
  WRITE(TUNNEL,*)CALCULATED_NUMBER,' & '
  WRITE(TUNNEL,*)TOTAL_NUMBER_OF_ITEMS
  IF(MANY_TO_ORDER_COUNTER.GT.0) THEN
     WRITE(TUNNEL,*)' simple  '
  END IF
  WRITE(TUNNEL,*)' & '
  WRITE(TUNNEL,*)LAYER_NUMBER ,' & '
  WRITE(TUNNEL,*)PAIRS_FOR_MATCH,' & '
  IF(ANSWER_COUNTER.GT.0) THEN
     WRITE(TUNNEL,*)' yes & '
  ELSE
     WRITE(TUNNEL,*)' no & '
  END IF
  IF(SOLUTION_COUNTER.GT.0) THEN
     WRITE(TUNNEL,*)' yes '
  ELSE
     WRITE(TUNNEL,*)' no '
  END IF
  WRITE(TUNNEL,*)' \\ \hline'
  WRITE(TUNNEL,*)'\end{tabular}'
  WRITE(TUNNEL,*)'  '
  WRITE(TUNNEL,*)'  '
  RETURN
END SUBROUTINE WRITE_A_TOTAL




SUBROUTINE SHORTEST_HEAD()
     USE BASE_DATA
     USE INT_TO_CHAR_INTERFACE
     IMPLICIT NONE
     INTEGER :: K, L, CP, KK=0

     LAYER_NUMBER=0
     INPUT_NUMBER=0
     INPUT_STRING_POSITION=0
     CALCULATED_NUMBER=0
     ANSWER_FOUND=.FALSE.
     SOLUTION_FOUND=.FALSE.
     MANY_CHOICES_FOUND=.FALSE.
     MANY_TO_ORDER_FOUND=.FALSE.
     ANSWER_COUNTER=0
     SOLUTION_COUNTER=0
     MANY_CHOICES_COUNTER=0
     MANY_TO_ORDER_COUNTER=0
     TOTAL_NUMBER_OF_ITEMS=0
     CALCULATED_ACCURACY=DEFAULT_CALCULATED_ACCURACY
     CONSTANT_TABLE_HEAD_FOUND=.FALSE.

     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'\noindent{\textbf{\Large{THIS IS THE ANSWER-ONLY FOR}}}'
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     IF(SIMPLE_HEADS.NE.1) THEN
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')HEAD_RESET_SHORTEST
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     END IF
     K=TITLE_POSITION
     L=TITLE_POSITION_END
     LINE_NUMBER_LIMIT=L
     READ_ROUTINE_SWITCH=1

     IF(K.LE.0) RETURN
     CALL OPEN_READ_TO(K)

     READ_DO: DO
     CALL READ_A_LINE()
     IF(LINE_NUMBER.GT.LINE_NUMBER_LIMIT) EXIT READ_DO
     CHECK_DO: DO

         CP=-1
         CP=INDEX(THE_READ(1:THE_READ_LENGTH), ROOT_KEY)
         IF(CP.LE.0) THEN
              CALL WRITE_THE_READ_TO_SHORTEST()
              CYCLE READ_DO
         END IF

         IF(INDEX(THE_READ(CP:CP-1+CONSTANT_PREKEY_LENTH), CONSTANT_PREKEY).GT.0) THEN
              CALL MAKE_CONSTANTS(KK, CP-1+CONSTANT_PREKEY_LENTH)
              CYCLE CHECK_DO
         ELSE IF(INDEX(THE_READ(CP:CP-1+PRINT_PARAMETER_KEY_LENTH), PRINT_PARAMETER_KEY).GT.0) THEN
              CALL PRINT_A_PARAMETER(CP)
              CYCLE CHECK_DO
         ELSE
              PRINT*, 'No other key is allowed IN THE SHORTEST_HEAD: ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
         END IF

     END DO CHECK_DO
     END DO READ_DO
     CALL CLOSE_INPUT()

     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '

     IF(CONSTANT_TABLE_HEAD_FOUND) THEN
              PRINT*, 'NOT ENDDED CONSTANT TABLE (THE SHORTEST_HEAD): ', &
                      LINE_NUMBER, QUESTION_NUMBER, QUESTION_POSITION(0,QUESTION_NUMBER)
              STOP
     END IF

     RETURN
END SUBROUTINE SHORTEST_HEAD




SUBROUTINE MAKE_NOTES()
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I
  DO I=1, TOTAL_NUMBER_OF_NOTES
     IF(NOTE_TO_OUTPUT(I)) THEN
     IF(NOTE_POSITION(0,I).LE.BIG_QUESTIONS(5,BIG_QUESTION_NUMBER)) THEN
        CALL MAKE_A_NOTE(I)
     END IF
     END IF
  END DO
  RETURN
END SUBROUTINE MAKE_NOTES




SUBROUTINE MAKE_REST_NOTES()
  USE BASE_DATA
  IMPLICIT NONE
  INTEGER :: I
  DO I=1, TOTAL_NUMBER_OF_NOTES
     IF(NOTE_TO_OUTPUT(I)) THEN
    !IF(NOTE_POSITION(0,I).LE.BIG_QUESTIONS(5,BIG_QUESTION_NUMBER)) THEN
        CALL MAKE_A_NOTE(I)
    !END IF
     END IF
  END DO
  RETURN
END SUBROUTINE MAKE_REST_NOTES




SUBROUTINE END_OF_PAPER_WITH_SEED()
    USE BASE_DATA
    USE SEED_MODULE
    CALL END_OF_PAPER_A_FILE(OUTPUT_FILE_TUNNEL)
    CALL END_OF_PAPER_A_FILE(SHORTEST_ANSWER_FILE_TUNNEL)
    CALL END_OF_PAPER_A_FILE(ANSWER_FILE_TUNNEL)
    CALL END_OF_PAPER_A_FILE(SOLUTION_FILE_TUNNEL)
    CALL END_OF_PAPER_A_FILE(ANSW_LUTION_FILE_TUNNEL)
    CALL END_OF_PAPER_A_FILE(JOURNAL_FILE_TUNNEL)
    RETURN
END SUBROUTINE END_OF_PAPER_WITH_SEED




SUBROUTINE END_OF_PAPER_A_FILE(TUNNEL)
    USE BASE_DATA
    USE SEED_MODULE
    IMPLICIT NONE
    INTEGER :: TUNNEL
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)') END_PAPER_WORD0
    WRITE(TUNNEL,'(A)') END_PAPER_WORD1
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,'(A)') END_PAPER_WORD2
    WRITE(TUNNEL,*)SEED_NUMBER0, '(', THE_FIRST_EXAMINEE, ', ', THE_LAST_EXAMINEE,')'
    WRITE(TUNNEL,*)'  '
    WRITE(TUNNEL,*)'  '
    RETURN
END SUBROUTINE END_OF_PAPER_A_FILE




SUBROUTINE MAKEPAPERS()
  USE BASE_DATA
  USE SEED_MODULE
  USE RAND_INTERFACE
  USE INT_TO_CHAR_INTERFACE
  IMPLICIT NONE
  INTEGER :: I, K, L, ACC
  DOUBLE PRECISION :: DB

  CALL SHORTEST_HEAD()

  DO EXAMINEE_NUMBER=THE_FIRST_EXAMINEE, THE_LAST_EXAMINEE

     DO I=1, SEED_SIZE
        SEED_NEW_VALUES(I)=SEED_NUMBER0+I+3+EXAMINEE_NUMBER*7
     END DO
     CALL RANDOM_SEED(PUT=SEED_NEW_VALUES)

     DO I=1, ABS(EXAMINEE_NUMBER)+5
        DB=MYRAND()
     END DO

     CHAR_OF_INT=INTEGER_TO_CHARACTER(EXAMINEE_NUMBER,CHAR_OF_INT_LENGTH)
     WRITE(OUTPUT_FILE_TUNNEL,*)'  '
     WRITE(OUTPUT_FILE_TUNNEL,*)'  '
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')'\newpage '
     WRITE(OUTPUT_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
     WRITE(OUTPUT_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
     WRITE(OUTPUT_FILE_TUNNEL,*)'  '
     WRITE(OUTPUT_FILE_TUNNEL,*)'  '
    !WRITE(OUTPUT_FILE_TUNNEL,'(A)')HEAD_RESET
    !WRITE(OUTPUT_FILE_TUNNEL,*)'  '
    !WRITE(OUTPUT_FILE_TUNNEL,*)'  '
     IF(BOXES_IN_PAPER_TITLE.EQ.1) THEN
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_NAME,YOUR_NAME_POST)
        CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,YOUR_ID  ,  YOUR_ID_POST)
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        WRITE(OUTPUT_FILE_TUNNEL,*)'  '
        CALL A_TITLED_BOX(OUTPUT_FILE_TUNNEL,2,TOTAL_MARK,TOTAL_MARK_POST)
        DB=TOTAL_ACTUAL_MARKS
        ACC=MARK_ACCURACY
        CALL CONVERT_A_DOUBLE(DB,ACC)
        CALL A_FILLED_BOX(OUTPUT_FILE_TUNNEL,2,THE_READ_WORK3(1:THE_READ_WORK3_LENGTH),&
                            FULL_TOTAL_MARK, FULL_TOTAL_MARK_POST)
     END IF

     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'\newpage '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')'\noindent{\textbf{\large{THIS IS THE ANSWER AND SOLUTION FOR}}}'
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'{\textbf{ \Large{ PAPER NUMBER ', EXAMINEE_NUMBER, ' }}}'
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')SPACING
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     IF(SIMPLE_HEADS.NE.1) THEN
        WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)')HEAD_RESET_ANSW_LUTION
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
        WRITE(ANSW_LUTION_FILE_TUNNEL,*)'  '
     END IF

     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')'\newpage '
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
     WRITE(SOLUTION_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')'\noindent{\textbf{\huge{THIS IS THE SOLUTIONS FOR}}}'
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'{\textbf{ \Large{ PAPER NUMBER ', EXAMINEE_NUMBER, ' }}}'
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,'(A)')SPACING
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     IF(SIMPLE_HEADS.NE.1) THEN
        WRITE(SOLUTION_FILE_TUNNEL,'(A)')HEAD_RESET_SOLUTION
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
        WRITE(SOLUTION_FILE_TUNNEL,*)'  '
     END IF

     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,'(A)')'\newpage '
     WRITE(ANSWER_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
     WRITE(ANSWER_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,'(A)')'\noindent{\textbf{\huge{THIS IS THE ANSWERS FOR}}}'
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'{\textbf{ \Large{ PAPER NUMBER ', EXAMINEE_NUMBER, ' }}}'
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,'(A)')SPACING
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     WRITE(ANSWER_FILE_TUNNEL,*)'  '
     IF(SIMPLE_HEADS.NE.1) THEN
        WRITE(ANSWER_FILE_TUNNEL,'(A)')HEAD_RESET_ANSWER
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
        WRITE(ANSWER_FILE_TUNNEL,*)'  '
     END IF

     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')'\newpage '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
     WRITE(JOURNAL_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')'\noindent{\textbf{\huge{THIS IS THE JOURNAL FOR}}}'
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'{\textbf{ \Large{ PAPER NUMBER ', EXAMINEE_NUMBER, ' }}}'
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,'(A)')SPACING
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     IF(SIMPLE_HEADS.NE.1) THEN
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')HEAD_RESET_JOURNAL
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
        WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     END IF

     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     IF(SHORTEST_PAGED.EQ.1) THEN
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
        IF(EXAMINEE_NUMBER.GT.THE_FIRST_EXAMINEE) WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'\newpage '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)')'\setcounter{page}{ '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(1X, I8, A3)')EXAMINEE_NUMBER*PAGE_NUMBER_JUMPER+1,' } '
        WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     END IF
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'{\textbf{ \Large{ PAPER NUMBER ', EXAMINEE_NUMBER, ' }}}'
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '
     WRITE(SHORTEST_ANSWER_FILE_TUNNEL,*)'  '

     K=TITLE_POSITION
     L=TITLE_POSITION_END
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     LINE_NUMBER_LIMIT=L
     READ_ROUTINE_SWITCH=1
     IF(L.GT.K) THEN
        CALL WRITE_TITLE_AND_TAIL(K,L)
        WRITE(JOURNAL_FILE_TUNNEL,*)'PAPER TITLE GENERATED.'
     ELSE
        WRITE(JOURNAL_FILE_TUNNEL,*)'NO PAPER TITLE FOUND.'
     END IF
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '

     NOTE_TO_OUTPUT=.TRUE.
     CALL GET_A_PAPER()
     INSIDE_BIGQUESTION=.FALSE.
     DO ORDERED_BIG_QUESTION_NUMBER=1, TOTAL_NUMBER_OF_BIG_QUESTIONS
        CHAR_OF_INT2=INTEGER_TO_CHARACTER(     ORDERED_BIG_QUESTION_NUMBER,CHAR_OF_INT2_LENGTH)
        BIG_QUESTION_NUMBER=BIG_QUESTIONS_USED(ORDERED_BIG_QUESTION_NUMBER)
        CALL MAKE_NOTES()
        LINE_NUMBER_LIMIT=L
        READ_ROUTINE_SWITCH=1
        CALL WRITE_QUESTION_TITLE()
        CALL GET_QUESTIONS()
        DO ORDERED_QUESTION_NUMBER=1, BIG_QUESTIONS(0,BIG_QUESTION_NUMBER)
           CHAR_OF_INT3= INTEGER_TO_CHARACTER(ORDERED_QUESTION_NUMBER,CHAR_OF_INT3_LENGTH)
           QUESTION_NUMBER=ALL_QUESTIONS_USED(ORDERED_QUESTION_NUMBER)
           LINE_NUMBER_LIMIT=QUESTION_POSITION(2,QUESTION_NUMBER)
           READ_ROUTINE_SWITCH=2
           CALL MAKE_A_QUESTION()
           CALL CLEAN_ALLOCATES()
        END DO
     END DO
     CALL MAKE_REST_NOTES()

     K=TAIL_POSITION
     L=TAIL_POSITION_END
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     LINE_NUMBER_LIMIT=L
     READ_ROUTINE_SWITCH=1
     IF(L.GT.K) THEN
        CALL WRITE_TITLE_AND_TAIL(K,L)
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'\vspace{2.0in} PAPER TAIL GENERATED.'
     ELSE
        WRITE(JOURNAL_FILE_TUNNEL,'(A)')'\vspace{2.0in} NO PAPER TAIL DETECTED.'
     END IF
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '
     WRITE(JOURNAL_FILE_TUNNEL,*)'  '

     IF(END_OF_PAPER_WITH_SEED_SWITCH.EQ.1) CALL END_OF_PAPER_WITH_SEED()

     PRINT*, 'PAPER: ', EXAMINEE_NUMBER, ' (', THE_LAST_EXAMINEE,') GENERATED.'

  END DO

  RETURN
END SUBROUTINE MAKEPAPERS




SUBROUTINE FINALIZE()
  USE BASE_DATA
  USE SEED_MODULE
  IMPLICIT NONE

  WRITE(OUTPUT_FILE_TUNNEL,'(A)') ' '
  WRITE(OUTPUT_FILE_TUNNEL,'(A)') ' '
  WRITE(OUTPUT_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(OUTPUT_FILE_TUNNEL)
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') ' '
  WRITE(ANSW_LUTION_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(ANSW_LUTION_FILE_TUNNEL)
  WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)') ' '
  WRITE(JOURNAL_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(JOURNAL_FILE_TUNNEL)
  WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
  WRITE(ANSWER_FILE_TUNNEL,'(A)') ' '
  WRITE(ANSWER_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(ANSWER_FILE_TUNNEL)
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') ' '
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') ' '
  WRITE(SHORTEST_ANSWER_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(SHORTEST_ANSWER_FILE_TUNNEL)
  WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
  WRITE(SOLUTION_FILE_TUNNEL,'(A)') ' '
  WRITE(SOLUTION_FILE_TUNNEL,'(A)') LATEX_END
  CLOSE(SOLUTION_FILE_TUNNEL)

 !OPEN(SEED_FILE_TUNNEL,FILE=SEED_FILE)
 !WRITE(SEED_FILE_TUNNEL,*) TOTAL_NUMBER_OF_EXAMINEES, ' , !Total number of examinees.'
 !WRITE(SEED_FILE_TUNNEL,*) TOTAL_FULL_MARKS, ' , !Total full marks.'
 !WRITE(SEED_FILE_TUNNEL,*) SEED_NUMBER0, ' , !Seed integer.'
 !CLOSE(SEED_FILE_TUNNEL)

  DEALLOCATE(SEED_VALUES)
  DEALLOCATE(SEED_NEW_VALUES)

  PRINT*, 'DONE.'
  PRINT*, 'DONE.'
  PRINT*, 'DONE.'
  RETURN
END SUBROUTINE FINALIZE
!
!
!   This is Personalized Test Creator
!           Version 1.0
!   free for registered non-commercial use.
!   This file is not suggested to be changed by users for normal usage.
!   Any problems/suggestions/comments, please send to gang.liu@queensu.ca
!   Please be advised that neither the author nor HPCVL accept any
!   responsibility for any consequences arising out of the usage of this
!   software, especially for damage.
!   Copyright (c) 2007-2008 by High Performance Computing Virtual Laboratory
!
!
